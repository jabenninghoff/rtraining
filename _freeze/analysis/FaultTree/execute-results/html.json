{
  "hash": "cc0d7fa2659b631e4a3d655dfcbd6d7e",
  "result": {
    "markdown": "---\ntitle: \"FaultTree.widget Test\"\nauthor: \"John Benninghoff\"\ndate: '2021-09-30'\nfile-modified: '2022-01-12'\ncategories: notes\norder: 103\noutput:\n  html_notebook:\n    theme:\n      version: 5\n      preset: bootstrap\n    css: assets/extra.css\n    highlight: textmate\n    toc: yes\n    toc_float:\n      collapsed: no\n      smooth_scroll: no\n---\n\n\nNotebook for testing FaultTree.widget rendering fixes.\n\n# Example\n\nThe fault tree below is centered in-frame when viewed in RStudio, but is partially off-frame when viewed in a browser, and completely off-frame if the browser window is wide enough. This is true for both `html_notebook` and `html_document`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(FaultTree)\nlibrary(FaultTree.widget)\n\n# nolint start\ntree1 <- ftree.make(type = \"priority\", reversible_cond = TRUE, name = \"Site power loss\")\ntree1 <- addLogic(tree1, at = 1, type = \"or\", name = \"neither emergency\", name2 = \"generator operable\")\ntree1 <- addLogic(tree1, at = 2, type = \"and\", name = \"Independent failure\", name2 = \"of generators\")\ntree1 <- addLatent(tree1, at = 3, mttf = 5, mttr = 12 / 8760, inspect = 1 / 26, name = \"e-gen set fails\")\ntree1 <- addLatent(tree1, at = 3, mttf = 5, mttr = 12 / 8760, inspect = 1 / 26, name = \"e-gen set fails\")\ntree1 <- addLogic(tree1, at = 2, type = \"inhibit\", name = \"Common cause\", name2 = \"failure of generators\")\ntree1 <- addProbability(tree1, at = 6, prob = .05, name = \"Common cause\", name2 = \"beta factor\")\ntree1 <- addLatent(tree1, at = 6, mttf = 5, mttr = 12 / 8760, inspect = 1 / 26, name = \"e-gen set fails\")\ntree1 <- addDemand(tree1, at = 1, mttf = 1.0, name = \"External power\", name2 = \"interruption\")\n# nolint end\n\ntree1 <- ftree.calc(tree1)\n\nftree2widget(tree1, height = 500, width = 800)\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"htmlwidget-f52b4f4d1e82413ba2a1\" style=\"width:100%;height:406px;\" class=\"ftree_widget1 html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-f52b4f4d1e82413ba2a1\">{\"x\":{\"root\":{\"id\":1,\"gparent\":-1,\"tag\":\"top\",\"type\":14,\"cfr\":0.000222339590217002,\"pbf\":3.04575275244065e-07,\"crt\":0.00136986565331405,\"moe\":0,\"condition\":0,\"cond_code\":1,\"etype\":0,\"p1\":-1,\"p2\":-1,\"collapse\":0,\"name\":\"Site power loss\",\"name2\":\"\",\"children\":[{\"id\":2,\"gparent\":1,\"tag\":\"G_2\",\"type\":10,\"cfr\":-1,\"pbf\":0.000222339590217002,\"crt\":0.00136986565331405,\"moe\":0,\"condition\":1,\"cond_code\":0,\"etype\":0,\"p1\":-1,\"p2\":-1,\"collapse\":0,\"name\":\"neither emergency\",\"name2\":\"generator operable\",\"children\":[{\"id\":3,\"gparent\":2,\"tag\":\"G_3\",\"type\":11,\"cfr\":0.00163690899152319,\"pbf\":1.68851766373046e-05,\"crt\":0.00136986301369863,\"moe\":0,\"condition\":0,\"cond_code\":0,\"etype\":0,\"p1\":-1,\"p2\":-1,\"collapse\":0,\"name\":\"Independent failure\",\"name2\":\"of generators\",\"children\":[{\"id\":4,\"gparent\":3,\"tag\":\"\",\"type\":2,\"cfr\":0.2,\"pbf\":0.00410915765544528,\"crt\":0.00136986301369863,\"moe\":0,\"condition\":0,\"cond_code\":0,\"etype\":0,\"p1\":0.000273897562311695,\"p2\":0.0384615384615385,\"collapse\":0,\"name\":\"e-gen set fails\",\"name2\":\"\"},{\"id\":5,\"gparent\":3,\"tag\":\"\",\"type\":2,\"cfr\":0.2,\"pbf\":0.00410915765544528,\"crt\":0.00136986301369863,\"moe\":0,\"condition\":0,\"cond_code\":0,\"etype\":0,\"p1\":0.000273897562311695,\"p2\":0.0384615384615385,\"collapse\":0,\"name\":\"e-gen set fails\",\"name2\":\"\"}]},{\"id\":6,\"gparent\":2,\"tag\":\"G_6\",\"type\":12,\"cfr\":0.01,\"pbf\":0.000205457882772264,\"crt\":0.00136986301369863,\"moe\":0,\"condition\":0,\"cond_code\":0,\"etype\":0,\"p1\":-1,\"p2\":-1,\"collapse\":0,\"name\":\"Common cause\",\"name2\":\"failure of generators\",\"children\":[{\"id\":7,\"gparent\":6,\"tag\":\"E_7\",\"type\":4,\"cfr\":-1,\"pbf\":0.05,\"crt\":-1,\"moe\":0,\"condition\":1,\"cond_code\":0,\"etype\":0,\"p1\":-1,\"p2\":-1,\"collapse\":0,\"name\":\"Common cause\",\"name2\":\"beta factor\"},{\"id\":8,\"gparent\":6,\"tag\":\"\",\"type\":2,\"cfr\":0.2,\"pbf\":0.00410915765544528,\"crt\":0.00136986301369863,\"moe\":0,\"condition\":0,\"cond_code\":0,\"etype\":0,\"p1\":0.000273897562311695,\"p2\":0.0384615384615385,\"collapse\":0,\"name\":\"e-gen set fails\",\"name2\":\"\"}]}]},{\"id\":9,\"gparent\":1,\"tag\":\"E_9\",\"type\":3,\"cfr\":1,\"pbf\":-1,\"crt\":-1,\"moe\":0,\"condition\":0,\"cond_code\":0,\"etype\":0,\"p1\":-1,\"p2\":-1,\"collapse\":0,\"name\":\"External power\",\"name2\":\"interruption\"}]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\nCheck rendering without height and width specified:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nftree2widget(tree1)\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"ftree_widget1 html-widget html-fill-item\" id=\"htmlwidget-de88ad41a62fc533341a\" style=\"width:100%;height:382px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-de88ad41a62fc533341a\">{\"x\":{\"root\":{\"id\":1,\"gparent\":-1,\"tag\":\"top\",\"type\":14,\"cfr\":0.000222339590217002,\"pbf\":3.04575275244065e-07,\"crt\":0.00136986565331405,\"moe\":0,\"condition\":0,\"cond_code\":1,\"etype\":0,\"p1\":-1,\"p2\":-1,\"collapse\":0,\"name\":\"Site power loss\",\"name2\":\"\",\"children\":[{\"id\":2,\"gparent\":1,\"tag\":\"G_2\",\"type\":10,\"cfr\":-1,\"pbf\":0.000222339590217002,\"crt\":0.00136986565331405,\"moe\":0,\"condition\":1,\"cond_code\":0,\"etype\":0,\"p1\":-1,\"p2\":-1,\"collapse\":0,\"name\":\"neither emergency\",\"name2\":\"generator operable\",\"children\":[{\"id\":3,\"gparent\":2,\"tag\":\"G_3\",\"type\":11,\"cfr\":0.00163690899152319,\"pbf\":1.68851766373046e-05,\"crt\":0.00136986301369863,\"moe\":0,\"condition\":0,\"cond_code\":0,\"etype\":0,\"p1\":-1,\"p2\":-1,\"collapse\":0,\"name\":\"Independent failure\",\"name2\":\"of generators\",\"children\":[{\"id\":4,\"gparent\":3,\"tag\":\"\",\"type\":2,\"cfr\":0.2,\"pbf\":0.00410915765544528,\"crt\":0.00136986301369863,\"moe\":0,\"condition\":0,\"cond_code\":0,\"etype\":0,\"p1\":0.000273897562311695,\"p2\":0.0384615384615385,\"collapse\":0,\"name\":\"e-gen set fails\",\"name2\":\"\"},{\"id\":5,\"gparent\":3,\"tag\":\"\",\"type\":2,\"cfr\":0.2,\"pbf\":0.00410915765544528,\"crt\":0.00136986301369863,\"moe\":0,\"condition\":0,\"cond_code\":0,\"etype\":0,\"p1\":0.000273897562311695,\"p2\":0.0384615384615385,\"collapse\":0,\"name\":\"e-gen set fails\",\"name2\":\"\"}]},{\"id\":6,\"gparent\":2,\"tag\":\"G_6\",\"type\":12,\"cfr\":0.01,\"pbf\":0.000205457882772264,\"crt\":0.00136986301369863,\"moe\":0,\"condition\":0,\"cond_code\":0,\"etype\":0,\"p1\":-1,\"p2\":-1,\"collapse\":0,\"name\":\"Common cause\",\"name2\":\"failure of generators\",\"children\":[{\"id\":7,\"gparent\":6,\"tag\":\"E_7\",\"type\":4,\"cfr\":-1,\"pbf\":0.05,\"crt\":-1,\"moe\":0,\"condition\":1,\"cond_code\":0,\"etype\":0,\"p1\":-1,\"p2\":-1,\"collapse\":0,\"name\":\"Common cause\",\"name2\":\"beta factor\"},{\"id\":8,\"gparent\":6,\"tag\":\"\",\"type\":2,\"cfr\":0.2,\"pbf\":0.00410915765544528,\"crt\":0.00136986301369863,\"moe\":0,\"condition\":0,\"cond_code\":0,\"etype\":0,\"p1\":0.000273897562311695,\"p2\":0.0384615384615385,\"collapse\":0,\"name\":\"e-gen set fails\",\"name2\":\"\"}]}]},{\"id\":9,\"gparent\":1,\"tag\":\"E_9\",\"type\":3,\"cfr\":1,\"pbf\":-1,\"crt\":-1,\"moe\":0,\"condition\":0,\"cond_code\":0,\"etype\":0,\"p1\":-1,\"p2\":-1,\"collapse\":0,\"name\":\"External power\",\"name2\":\"interruption\"}]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n# Solution\n\nA partial fix is to change the line in `inst/htmlwidgets/ftree_widget1.js` and `inst/htmlwidgets/ftree_widget2.js`\n\nfrom (which sets the position based on the width of the browser window):\n\n```javascript\nvar width_initial = $(window).width()/2-60;\n```\n\nto (which sets the position based on the width of the div containing the widget):\n\n```javascript\nvar width_initial = $(\"div\").width()/2-60;\n```\n\nThen the fault tree will position itself within view, but not always centered. A complete fix would render the fault tree centered within the widget.\n\nOther approaches tested:\n\n```javascript\n// var width_initial = $('div:contains(\"htmlwidget\")').width()/2-60;\n// var width_initial = $(\"div\").filter(function(){ return this.children.length === 0; }).width()/2-60;\n```\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../site_libs/htmlwidgets-1.6.3/htmlwidgets.js\"></script>\n<script src=\"../site_libs/d3-3.5.17/d3.min.js\"></script>\n<link href=\"../site_libs/ftree-0.0.2/ftree_styles.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/jquery-3.2.0/jquery.min.js\"></script>\n<script src=\"../site_libs/ftree_widget1-binding-0.2.8.1/ftree_widget1.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}