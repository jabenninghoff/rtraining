<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />



<meta name="date" content="2022-11-20" />

<title>ggplot2 (Layers)</title>

<script src="site_libs/header-attrs-2.19/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
<link href="site_libs/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-5.2.2/bootstrap.bundle.min.js"></script>
<script src="site_libs/bs3compat-0.4.2/transition.js"></script>
<script src="site_libs/bs3compat-0.4.2/tabs.js"></script>
<script src="site_libs/bs3compat-0.4.2/bs3compat.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script src="site_libs/navigation-1.1/sourceembed.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>




<style type="text/css">
#rmd-source-code {
  display: none;
}
</style>





<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">rtraining notebooks</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Analysis
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="FaultTree.html">FaultTree.widget Test</a>
    </li>
    <li>
      <a href="advanced-r-1.html">Advanced R Workbook (Foundations)</a>
    </li>
    <li>
      <a href="advanced-r-2.html">Advanced R Workbook (Functional programming)</a>
    </li>
    <li>
      <a href="advanced-r-3.html">Advanced R Workbook (Object-oriented programming)</a>
    </li>
    <li>
      <a href="ggplot2-1.html">ggplot2 (Getting started)</a>
    </li>
    <li>
      <a href="ggplot2-2.html">ggplot2 (Layers)</a>
    </li>
    <li>
      <a href="ggplot2-3.html">ggplot2 (Scales)</a>
    </li>
    <li>
      <a href="ggplot2-4.html">ggplot2 (Grammar)</a>
    </li>
    <li>
      <a href="ggplot2-5.html">ggplot2 (Extending)</a>
    </li>
    <li>
      <a href="r-setup-log.html">R Setup Log</a>
    </li>
    <li>
      <a href="r-training-log.html">R Training Log</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/jabenninghoff/rtraining/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
<li role="separator" class="divider"></li>
<li><a id="rmd-download-source" href="#">Download Rmd</a></li>
</ul>
</div>



<h1 class="title toc-ignore">ggplot2 (Layers)</h1>
<h4 class="date">2022-11-20</h4>

</div>


<p>Workbook for completing quizzes and exercises from the “Layers”
chapters of <a href="https://ggplot2-book.org/index.html">ggplot2:
Elegant Graphics for Data Analysis</a>, third edition, with comparisons
to solutions from <a
href="https://ggplot2-book-solutions-3ed.netlify.app">Solutions to
ggplot2: Elegant Graphics for Data Analysis</a>.</p>
<pre class="r"><code>library(ggplot2)
library(dplyr)
library(babynames) # nolint: unused_import_linter. attached for `babynames` data frame.
library(jbplot)
library(modelr)
library(maps) # nolint: unused_import_linter. maps is required by map_data().
library(sf)
library(USAboundaries)
library(USAboundariesData) # nolint: unused_import_linter. Needed by USAboundaries.
library(ggraph)
library(tidygraph)

knitr::opts_chunk$set(
  comment = &quot;#&gt;&quot;,
  fig.align = &quot;center&quot;
)</code></pre>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>This workbook includes answers and solutions to the quizzes and
exercises from <a href="https://ggplot2-book.org/index.html">ggplot2:
Elegant Graphics for Data Analysis</a> and <a
href="https://ggplot2-book-solutions-3ed.netlify.app">Solutions to
ggplot2: Elegant Graphics for Data Analysis</a>, organized by chapter.
It includes excerpts from both books, copied here.</p>
<p><strong>WARNING, SPOILERS!</strong> If you haven’t read the ggplot2
book and intend to complete the quizzes and exercises, don’t read this
notebook. It contains my (potentially wrong) answers to both.</p>
</div>
<div id="individual-geoms" class="section level1">
<h1>3 Individual geoms</h1>
<div id="exercises" class="section level2">
<h2>3.1.1 Exercises</h2>
<ol style="list-style-type: decimal">
<li><p>What geoms would you use to draw each of the following named
plots?</p>
<ol style="list-style-type: decimal">
<li>Scatterplot</li>
<li>Line chart</li>
<li>Histogram</li>
<li>Bar chart</li>
<li>Pie chart</li>
</ol></li>
</ol>
<p>Answer:</p>
<ol style="list-style-type: decimal">
<li>Scatterplot: <code>geom_point()</code></li>
<li>Line chart: <code>geom_line()</code></li>
<li>Histogram: <code>geom_histogram()</code></li>
<li>Bar chart: <code>geom_bar()</code></li>
<li>Pie chart: there is no native geom for a pie chart, but, as the <a
href="https://r-graph-gallery.com/piechart-ggplot2.html">R Graph
Gallery</a> demonstrates, it is possible to create a pie chart using
<code>geom_bar()</code> and <code>coord_polar()</code></li>
</ol>
<p>GG Solutions:</p>
<ul>
<li>Scatterplot: <code>geom_point()</code></li>
<li>Line chart: <code>geom_line()</code></li>
<li>Histogram: <code>geom_histogram()</code></li>
<li>Bar chart: <code>geom_bar()</code></li>
<li>Pie chart: ggplot2 does not have a geom to draw pie charts. One
workaround, according to the <a
href="https://www.r-graph-gallery.com/piechart-ggplot2.html">R Graph
Gallery</a> is to build a stacked bar chart with one bar only using the
<code>geom_bar()</code> function and then make it circular with
<code>coord_polar()</code></li>
</ul>
<hr />
<ol start="2" style="list-style-type: decimal">
<li>What’s the difference between <code>geom_path()</code> and
<code>geom_polygon()</code>? What’s the difference between
<code>geom_path()</code> and <code>geom_line()</code>?</li>
</ol>
<p>Answer: <code>geom_path()</code> connects observations with a line in
the order they appear in the data, <code>geom_line()</code> connects
them in order along the x axis, and <code>geom_polygon()</code> connects
the start and end points of <code>geom_path()</code> and fills in the
plot.</p>
<p>GG Solutions:</p>
<ul>
<li><code>geom_polygon</code> draws the same graph (lines) as
<code>geom_path</code>, but it fills these lines with color</li>
<li><code>geom_line()</code> connects points from left to right, whereas
<code>geom_path()</code> connects points in the order they appear in the
data</li>
</ul>
<hr />
<ol start="3" style="list-style-type: decimal">
<li>What low-level geoms are used to draw <code>geom_smooth()</code>?
What about <code>geom_boxplot()</code> and
<code>geom_violin()</code>?</li>
</ol>
<p>Answer: reviewing the source code:</p>
<p><a
href="https://github.com/tidyverse/ggplot2/blob/main/R/geom-smooth.r"><code>geom_smooth()</code></a>
uses:</p>
<ul>
<li><code>geom_path()</code> by way of <code>geom_line()</code></li>
<li><code>geom_area()</code> by way of <code>geom_ribbon()</code></li>
</ul>
<p><a
href="https://github.com/tidyverse/ggplot2/blob/main/R/geom-boxplot.r"><code>geom_boxplot()</code></a>
uses:</p>
<ul>
<li><code>geom_point()</code></li>
<li><code>geom_path()</code> by way of <code>geom_segment()</code> and
<code>geom_crossbar()</code></li>
<li><code>geom_polygon()</code> by way of
<code>geom_crossbar()</code></li>
</ul>
<p><a
href="https://github.com/tidyverse/ggplot2/blob/main/R/geom-violin.r"><code>geom_violin()</code></a>
uses:</p>
<ul>
<li><code>geom_path()</code></li>
<li><code>geom_polygon()</code></li>
</ul>
<p>GG Solutions:</p>
<p>(kangnade)</p>
<ul>
<li><code>geom_point()</code>, <code>geom_path()</code>, and
<code>geom_area()</code> are used to draw
<code>geom_smooth()</code></li>
<li><code>geom_rect()</code>, <code>geom_line()</code>,
<code>geom_point()</code> are used for <code>geom_boxplot()</code></li>
<li><code>geom_area()</code> and <code>geom_path()</code> are used for
<code>geom_violin()</code></li>
</ul>
<p>Note: GG Solutions answers appear to be incorrect guesses.</p>
<hr />
</div>
</div>
<div id="collective-geoms" class="section level1">
<h1>4 Collective geoms</h1>
<p>Geoms can be roughly divided into individual and collective geoms. An
<strong>individual</strong> geom draws a distinct graphical object for
each observation (row). For example, the point geom draws one point per
row. A <strong>collective</strong> geom displays multiple observations
with one geometric object. This may be a result of a statistical
summary, like a boxplot, or may be fundamental to the display of the
geom, like a polygon. Lines and paths fall somewhere in between: each
line is composed of a set of straight segments, but each segment
represents two points. How do we control the assignment of observations
to graphical elements? This is the job of the <code>group</code>
aesthetic.</p>
<div id="exercises-1" class="section level2">
<h2>4.5 Exercises</h2>
<p>GG Solutions offers no answers for this section.</p>
<ol style="list-style-type: decimal">
<li>Draw a boxplot of <code>hwy</code> for each value of
<code>cyl</code>, without turning <code>cyl</code> into a factor. What
extra aesthetic do you need to set?</li>
</ol>
<p>Answer: the <code>group</code> aesthetic is required.</p>
<pre class="r"><code>ggplot(ggplot2::mpg, aes(cyl, hwy, group = cyl)) +
  geom_boxplot()</code></pre>
<p><img src="ggplot2-2_files/figure-html/unnamed-chunk-1-1.png" width="768" style="display: block; margin: auto;" /></p>
<hr />
<ol start="2" style="list-style-type: decimal">
<li>Modify the following plot so that you get one boxplot per integer
value of <code>displ</code>.</li>
</ol>
<pre class="r"><code>ggplot(ggplot2::mpg, aes(displ, cty)) +
  geom_boxplot()</code></pre>
<p>Answer: grouping by the floor of displacement works, but is arranged
strangely. Mutating displacement first is a better solution:</p>
<pre class="r"><code>ggplot(ggplot2::mpg, aes(displ, cty, group = floor(displ))) +
  geom_boxplot()</code></pre>
<p><img src="ggplot2-2_files/figure-html/unnamed-chunk-3-1.png" width="768" style="display: block; margin: auto;" /></p>
<pre class="r"><code>ggplot2::mpg |&gt;
  mutate(displ = floor(displ)) |&gt;
  ggplot(aes(displ, cty, group = displ)) +
  geom_boxplot()</code></pre>
<p><img src="ggplot2-2_files/figure-html/unnamed-chunk-3-2.png" width="768" style="display: block; margin: auto;" /></p>
<hr />
<ol start="3" style="list-style-type: decimal">
<li>When illustrating the difference between mapping continuous and
discrete colours to a line, the discrete example needed
<code>aes(group = 1)</code>. Why? What happens if that is omitted?
What’s the difference between <code>aes(group = 1)</code> and
<code>aes(group = 2)</code>? Why?</li>
</ol>
<p>Answer: using the example from the book, omitting the group aesthetic
generates an error:</p>
<pre><code>`geom_line()`: Each group consists of only one observation.
ℹ Do you need to adjust the group aesthetic?</code></pre>
<p>There is no difference between <code>aes(group = 1)</code> and
<code>aes(group = 2)</code>, presumably because both methods put all
observations into a single group.</p>
<pre class="r"><code>df &lt;- data.frame(x = 1:3, y = 1:3, colour = c(1, 3, 5))

ggplot(df, aes(x, y, colour = factor(colour))) +
  geom_line(aes(group = 1), linewidth = 2) +
  geom_point(size = 5)</code></pre>
<p><img src="ggplot2-2_files/figure-html/unnamed-chunk-4-1.png" width="768" style="display: block; margin: auto;" /></p>
<pre class="r"><code>ggplot(df, aes(x, y, colour = factor(colour))) +
  geom_line(aes(group = 2), linewidth = 2) +
  geom_point(size = 5)</code></pre>
<p><img src="ggplot2-2_files/figure-html/unnamed-chunk-4-2.png" width="768" style="display: block; margin: auto;" /></p>
<hr />
<ol start="4" style="list-style-type: decimal">
<li>How many bars are in each of the following plots? (Hint: try adding
an outline around each bar with <code>colour = "white"</code>)</li>
</ol>
<pre class="r"><code>ggplot(ggplot2::mpg, aes(drv)) +
  geom_bar()
ggplot(ggplot2::mpg, aes(drv, fill = hwy, group = hwy)) +
  geom_bar()

mpg2 &lt;- ggplot2::mpg %&gt;%
  arrange(hwy) %&gt;%
  mutate(id = seq_along(hwy))
ggplot(mpg2, aes(drv, fill = hwy, group = id)) +
  geom_bar()</code></pre>
<p>Answer: in the first plot, there are three bars. In the second, there
is one bar for each unique value for <code>hwy</code> in each column. In
the third, there is one bar for each observation of
<code>hwy</code>.</p>
<pre class="r"><code>ggplot(ggplot2::mpg, aes(drv)) +
  geom_bar(color = &quot;white&quot;)</code></pre>
<p><img src="ggplot2-2_files/figure-html/unnamed-chunk-6-1.png" width="768" style="display: block; margin: auto;" /></p>
<pre class="r"><code>ggplot(ggplot2::mpg, aes(drv, fill = hwy, group = hwy)) +
  geom_bar(color = &quot;white&quot;)</code></pre>
<p><img src="ggplot2-2_files/figure-html/unnamed-chunk-6-2.png" width="768" style="display: block; margin: auto;" /></p>
<pre class="r"><code>ggplot2::mpg |&gt;
  arrange(hwy) |&gt;
  mutate(id = seq_along(hwy)) |&gt;
  ggplot(aes(drv, fill = hwy, group = id)) +
  geom_bar(color = &quot;white&quot;)</code></pre>
<p><img src="ggplot2-2_files/figure-html/unnamed-chunk-6-3.png" width="768" style="display: block; margin: auto;" /></p>
<hr />
<ol start="5" style="list-style-type: decimal">
<li>Install the babynames package. It contains data about the popularity
of babynames in the US. Run the following code and fix the resulting
graph. Why does this graph make me unhappy?</li>
</ol>
<pre class="r"><code>hadley &lt;- dplyr::filter(babynames, name == &quot;Hadley&quot;)
ggplot(hadley, aes(year, n)) +
  geom_line()</code></pre>
<p>Answer: the popularity of “Hadley” is sadly declining.</p>
<pre class="r"><code>babynames |&gt;
  filter(name == &quot;Hadley&quot;) |&gt;
  ggplot(aes(year, n, group = sex, color = sex)) +
  geom_line()</code></pre>
<p><img src="ggplot2-2_files/figure-html/unnamed-chunk-8-1.png" width="768" style="display: block; margin: auto;" /></p>
<hr />
<p>Bonus: a comparison of the popularity of my name (John) and
Hadley:</p>
<pre class="r"><code>babynames |&gt;
  filter(name %in% c(&quot;Hadley&quot;, &quot;John&quot;)) |&gt;
  ggplot(aes(year, prop, color = interaction(name, sex, sep = &quot;, &quot;, lex.order = TRUE))) +
  geom_line() +
  scale_y_log10() +
  scale_color_viridis_d() +
  labs(x = &quot;&quot;, y = &quot;&quot;, color = &quot;Name, Sex&quot;) +
  labs(title = &quot;Relative popularity of the names Hadley and John&quot;) +
  theme_quo()</code></pre>
<p><img src="ggplot2-2_files/figure-html/unnamed-chunk-9-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>Note: <code>group</code> is redundant for <code>geom_line()</code>
when using <code>color</code>.</p>
<hr />
</div>
</div>
<div id="statistical-summaries" class="section level1">
<h1>5 Statistical summaries</h1>
<div id="exercises-2" class="section level2">
<h2>5.4.1 Exercises</h2>
<ol style="list-style-type: decimal">
<li>What <code>binwidth</code> tells you the most interesting story
about the distribution of <code>carat</code>?</li>
</ol>
<p>Answer: as answered in <a href="ggplot2-1.html#266_Exercises">2.6.6
Exercises</a>:</p>
<p>Answer: using trial and error, <code>binwidth = 0.01</code> reveals
that carat weight is skewed towards round numbers (1, 1.25, 1.5, 2,
etc.). Using the smaller <code>binwidth = 0.005</code> doesn’t improve
the pattern, and makes it harder to see.</p>
<pre class="r"><code>ggplot(diamonds, aes(carat)) +
  geom_histogram(binwidth = 0.01)</code></pre>
<p><img src="ggplot2-2_files/figure-html/unnamed-chunk-10-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>GG Solutions:</p>
<ul>
<li>Highly subjective answer, but I would go with 0.2 since it gives you
the right amount of information about the distribution of
<code>carat</code>: right-skewed.</li>
</ul>
<hr />
<ol start="2" style="list-style-type: decimal">
<li>Draw a histogram of <code>price</code>. What interesting patterns do
you see?</li>
</ol>
<p>Answer: price has a multi-modal distribution with a gap. Looking at
the underlying data, there are no prices between $1454 and $1546</p>
<pre class="r"><code>ggplot(diamonds, aes(price)) +
  geom_histogram(binwidth = 50)</code></pre>
<p><img src="ggplot2-2_files/figure-html/unnamed-chunk-11-1.png" width="768" style="display: block; margin: auto;" /></p>
<pre class="r"><code>diamonds |&gt;
  filter(price &gt;= 1454 &amp; price &lt;= 1546)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["carat"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["cut"],"name":[2],"type":["ord"],"align":["right"]},{"label":["color"],"name":[3],"type":["ord"],"align":["right"]},{"label":["clarity"],"name":[4],"type":["ord"],"align":["right"]},{"label":["depth"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["table"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["price"],"name":[7],"type":["int"],"align":["right"]},{"label":["x"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["y"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["z"],"name":[10],"type":["dbl"],"align":["right"]}],"data":[{"1":"0.50","2":"Very Good","3":"D","4":"SI1","5":"61.6","6":"56","7":"1454","8":"5.09","9":"5.11","10":"3.14"},{"1":"0.52","2":"Ideal","3":"I","4":"VVS1","5":"60.1","6":"56","7":"1454","8":"5.24","9":"5.27","10":"3.16"},{"1":"0.54","2":"Ideal","3":"H","4":"VS1","5":"61.2","6":"55","7":"1454","8":"5.25","9":"5.31","10":"3.23"},{"1":"0.51","2":"Premium","3":"G","4":"VS2","5":"61.2","6":"60","7":"1546","8":"5.17","9":"5.12","10":"3.15"},{"1":"0.51","2":"Ideal","3":"G","4":"VS2","5":"62.9","6":"54","7":"1546","8":"5.12","9":"5.08","10":"3.21"},{"1":"0.51","2":"Premium","3":"G","4":"VS2","5":"62.4","6":"57","7":"1546","8":"5.11","9":"5.09","10":"3.18"},{"1":"0.51","2":"Premium","3":"G","4":"VS2","5":"62.7","6":"58","7":"1546","8":"5.12","9":"5.09","10":"3.20"},{"1":"0.51","2":"Premium","3":"G","4":"VS2","5":"62.2","6":"57","7":"1546","8":"5.15","9":"5.10","10":"3.19"},{"1":"0.51","2":"Ideal","3":"G","4":"VS2","5":"62.7","6":"57","7":"1546","8":"5.12","9":"5.05","10":"3.19"},{"1":"0.51","2":"Premium","3":"G","4":"VS2","5":"62.9","6":"58","7":"1546","8":"5.11","9":"5.06","10":"3.20"},{"1":"0.51","2":"Premium","3":"G","4":"VS2","5":"62.3","6":"59","7":"1546","8":"5.10","9":"5.07","10":"3.17"},{"1":"0.51","2":"Ideal","3":"E","4":"SI1","5":"59.6","6":"57","7":"1546","8":"5.24","9":"5.20","10":"3.11"},{"1":"0.51","2":"Premium","3":"E","4":"SI1","5":"61.3","6":"54","7":"1546","8":"5.18","9":"5.13","10":"3.16"},{"1":"0.51","2":"Ideal","3":"E","4":"SI1","5":"61.5","6":"55","7":"1546","8":"5.18","9":"5.16","10":"3.18"},{"1":"0.51","2":"Premium","3":"E","4":"SI1","5":"60.8","6":"57","7":"1546","8":"5.24","9":"5.19","10":"3.17"},{"1":"0.51","2":"Ideal","3":"E","4":"SI1","5":"62.8","6":"56","7":"1546","8":"5.15","9":"5.07","10":"3.21"},{"1":"0.51","2":"Ideal","3":"E","4":"SI1","5":"62.2","6":"57","7":"1546","8":"5.12","9":"5.08","10":"3.17"},{"1":"0.51","2":"Ideal","3":"E","4":"SI1","5":"62.1","6":"55","7":"1546","8":"5.15","9":"5.09","10":"3.18"},{"1":"0.51","2":"Ideal","3":"E","4":"SI1","5":"61.3","6":"55","7":"1546","8":"5.17","9":"5.11","10":"3.15"},{"1":"0.51","2":"Premium","3":"E","4":"SI1","5":"62.5","6":"57","7":"1546","8":"5.09","9":"5.06","10":"3.17"},{"1":"0.51","2":"Ideal","3":"E","4":"SI1","5":"62.7","6":"55","7":"1546","8":"5.10","9":"5.07","10":"3.19"},{"1":"0.51","2":"Ideal","3":"E","4":"SI1","5":"62.8","6":"55","7":"1546","8":"5.12","9":"5.07","10":"3.20"},{"1":"0.51","2":"Premium","3":"E","4":"SI1","5":"62.3","6":"58","7":"1546","8":"5.12","9":"5.05","10":"3.17"},{"1":"0.51","2":"Premium","3":"G","4":"VS2","5":"62.4","6":"58","7":"1546","8":"5.12","9":"5.11","10":"3.19"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>GG Solutions:</p>
<ul>
<li>It’s skewed to the right and has a long tail. Also, there is a small
peak around 5000 and a huge peak around 0.</li>
</ul>
<hr />
<ol start="3" style="list-style-type: decimal">
<li>How does the distribution of <code>price</code> vary with
<code>clarity</code>?</li>
</ol>
<p>Answer: a boxplot of price by clarity shows that diamonds with better
clarity aren’t necessarily more expensive.</p>
<p>However, as noted in my <a href="r-training-log.html">R Training
Log</a> and as answered in <a href="ggplot2-1.html#266_Exercises">2.6.6
Exercises</a>:</p>
<blockquote>
<p><a
href="https://r4ds.had.co.nz/exploratory-data-analysis.html#patterns-and-models">7.6
Patterns and models</a> covers models and residuals, here showing how to
reveal the expected relationship between cut and price:</p>
</blockquote>
<p>We can remove the relationship between carats and price, and redo the
boxplot, which shows the expected relationship:</p>
<pre class="r"><code>ggplot(diamonds, aes(clarity, price)) +
  geom_boxplot()</code></pre>
<p><img src="ggplot2-2_files/figure-html/unnamed-chunk-12-1.png" width="768" style="display: block; margin: auto;" /></p>
<pre class="r"><code># remove carat weight as a confounding variable
diamonds |&gt;
  add_residuals(lm(log(price) ~ log(carat), data = diamonds)) |&gt;
  mutate(resid = exp(resid)) |&gt;
  ggplot(aes(clarity, resid)) +
  geom_boxplot()</code></pre>
<p><img src="ggplot2-2_files/figure-html/unnamed-chunk-12-2.png" width="768" style="display: block; margin: auto;" /></p>
<p>GG Solutions:</p>
<ul>
<li>The range of prices is similar across clarity and the median and IQR
vary greatly with clarity.</li>
</ul>
<hr />
<ol start="4" style="list-style-type: decimal">
<li>Overlay a frequency polygon and density plot of <code>depth</code>.
What computed variable do you need to map to <code>y</code> to make the
two plots comparable? (You can either modify
<code>geom_freqpoly()</code> or <code>geom_density()</code>.)</li>
</ol>
<p>Answer: you need to either divide or multiply <code>y</code> by the
total number of observations, <code>nrow(diamonds)</code> using
<code>after_stat()</code>.</p>
<pre class="r"><code>ggplot(diamonds, aes(depth)) +
  geom_freqpoly(aes(y = after_stat(count) / nrow(diamonds)), binwidth = 1) +
  geom_density() +
  labs(y = &quot;&quot;)</code></pre>
<p><img src="ggplot2-2_files/figure-html/unnamed-chunk-13-1.png" width="768" style="display: block; margin: auto;" /></p>
<pre class="r"><code>ggplot(diamonds, aes(depth)) +
  geom_freqpoly(binwidth = 1) +
  geom_density(aes(y = after_stat(density) * nrow(diamonds))) +
  labs(y = &quot;&quot;)</code></pre>
<p><img src="ggplot2-2_files/figure-html/unnamed-chunk-13-2.png" width="768" style="display: block; margin: auto;" /></p>
<p>Notes: from the documentation for <code>after_stat()</code>:</p>
<blockquote>
<p>Most aesthetics are mapped from variables found in the data.
Sometimes, however, you want to delay the mapping until later in the
rendering process. ggplot2 has three stages of the data that you can map
aesthetics from. The default is to map at the beginning, using the layer
data provided by the user. The second stage is after the data has been
transformed by the layer stat. The third and last stage is after the
data has been transformed and mapped by the plot scales. The most common
example of mapping from stat transformed data is the height of bars in
<code>geom_histogram()</code>: the height does not come from a variable
in the underlying data, but is instead mapped to the count computed by
<code>stat_bin()</code>. An example of mapping from scaled data could be
to use a desaturated version of the stroke colour for fill. If you want
to map directly from the layer data you should not do anything special.
In order to map from stat transformed data you should use the
<code>after_stat()</code> function to flag that evaluation of the
aesthetic mapping should be postponed until after stat transformation.
Similarly, you should use <code>after_scale()</code> to flag evaluation
of mapping for after data has been scaled. If you want to map the same
aesthetic multiple times, e.g. map x to a data column for the stat, but
remap it for the geom, you can use the <code>stage()</code> function to
collect multiple mappings.</p>
</blockquote>
<p>GG Solutions answer not included here.</p>
<p>Note: after reading the <a
href="https://ggplot2-book.org/layers.html#generated-variables">Generated
Variables</a> section, there is an easier solution:</p>
<pre class="r"><code>ggplot(diamonds, aes(depth)) +
  geom_freqpoly(aes(y = after_stat(density)), binwidth = 1) +
  geom_density() +
  labs(y = &quot;&quot;)</code></pre>
<p><img src="ggplot2-2_files/figure-html/unnamed-chunk-14-1.png" width="768" style="display: block; margin: auto;" /></p>
<hr />
<p>Bonus: overlay a PDF and ECDF on a histogram.</p>
<pre class="r"><code>ggplot(diamonds, aes(price)) +
  geom_histogram(aes(y = after_stat(ncount)), binwidth = 50, fill = &quot;gray&quot;) +
  stat_ecdf() +
  labs(x = &quot;&quot;, y = &quot;&quot;) +
  theme_quo()</code></pre>
<p><img src="ggplot2-2_files/figure-html/unnamed-chunk-15-1.png" width="768" style="display: block; margin: auto;" /></p>
<pre class="r"><code>ggplot(diamonds, aes(price)) +
  geom_histogram(binwidth = 50, fill = &quot;gray&quot;) +
  # see https://stackoverflow.com/questions/27611438/density-curve-overlay-on-histogram-where-vertical-axis-is-frequency-aka-count # nolint
  geom_density(aes(y = after_stat(density * nrow(diamonds) * 50))) +
  labs(x = &quot;&quot;, y = &quot;&quot;) +
  theme_quo()</code></pre>
<p><img src="ggplot2-2_files/figure-html/unnamed-chunk-15-2.png" width="768" style="display: block; margin: auto;" /></p>
<pre class="r"><code>ggplot(diamonds, aes(price)) +
  geom_histogram(aes(y = after_stat(ncount)), binwidth = 50, fill = &quot;gray&quot;) +
  # TODO: the factor of 0.62 was determined by trial and error, find underlying formula
  #       the maximum density / the maximum count of the previous plot = 930.57 / 1503 = 0.62
  #       but that doesn&#39;t work here
  geom_density(aes(y = after_stat(ndensity * 0.62))) +
  stat_ecdf() +
  labs(x = &quot;&quot;, y = &quot;&quot;) +
  theme_quo()</code></pre>
<p><img src="ggplot2-2_files/figure-html/unnamed-chunk-15-3.png" width="768" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="maps" class="section level1">
<h1>6 Maps</h1>
<p>Plotting geospatial data is a common visualisation task, and one that
requires specialised tools. Typically the problem can be decomposed into
two problems: using one data source to draw a map, and adding metadata
from another information source to the map. This chapter will help you
tackle both problems.</p>
<div id="bonus" class="section level2">
<h2>Bonus</h2>
<p>There are no exercises, so let’s draw a map of Minnesota using
polygon maps!</p>
<pre class="r"><code>map_data(&quot;county&quot;, &quot;minnesota&quot;) |&gt;
  select(lon = long, lat, group) |&gt;
  ggplot(aes(lon, lat, group = group)) +
  geom_polygon(fill = &quot;white&quot;, colour = &quot;grey50&quot;) +
  coord_quickmap() +
  labs(x = &quot;&quot;, y = &quot;&quot;) +
  theme_quo()</code></pre>
<p><img src="ggplot2-2_files/figure-html/unnamed-chunk-16-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>Polygon maps are superseded by simple features maps, so let’s draw it
again, adding Minneapolis, in red:</p>
<pre class="r"><code>us_counties(resolution = &quot;high&quot;, states = &quot;MN&quot;) |&gt;
  ggplot() +
  geom_sf(fill = &quot;white&quot;) +
  geom_sf(data = filter(us_cities(states = &quot;MN&quot;), city == &quot;Minneapolis&quot;), color = &quot;red&quot;) +
  coord_sf() +
  theme_quo()</code></pre>
<p><img src="ggplot2-2_files/figure-html/unnamed-chunk-17-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>Side note: although it creates files in <code>/usr/local</code>,
which causes <a href="https://brew.sh">Homebrew</a> to complain, <a
href="https://github.com/r-lib/rig/"><code>rig</code></a>, <em>The R
Installation Manager</em>, supports multiple versions of R, and supports
installation of binary packages, which is substantially faster and
requires fewer local dependencies.</p>
</div>
</div>
<div id="networks" class="section level1">
<h1>7 Networks</h1>
<p>Like maps and spatial data, networks and graphs occupy a special part
of the visualization landscape, but whereas spatial data mostly differ
from regular plotting in their use of projections, networks bring their
own data structure as well as their own visualization paradigms to the
table. Because of these complications networks are not directly
supported in ggplot2. Several efforts over the years have tried to add
this missing piece and in this chapter we will see how to use <a
href="https://ggraph.data-imaginist.com"><code>ggraph</code></a> for
network visualization. Other packages that offer some of the same
functionality includes <a
href="http://sctyner.github.io/geomnet/"><code>geomnet</code></a>, <a
href="https://briatte.github.io/ggnetwork/"><code>ggnetwork</code></a>,
and <a href="https://ggobi.github.io/ggally/"><code>GGally</code></a>
for regular network plots, and <a
href="https://github.com/YuLab-SMU/ggtree"><code>ggtree</code></a> and
<a href="http://andrie.github.io/ggdendro/"><code>ggdendro</code></a>
for tree visualization specifically.</p>
<div id="notes" class="section level2">
<h2>Notes</h2>
<p>While ggplot2 has limited support for maps, it has no direct support
for networks and graphs. <code>ggraph</code> offers some interesting
visualizations that are useful for understanding social networks,
especially this one, which shows how friendships among high school boys
changed from 1957 to 1958:</p>
<pre class="r"><code>highschool |&gt;
  as_tbl_graph(directed = FALSE) |&gt;
  ggraph(layout = &quot;stress&quot;) +
  geom_edge_link() +
  geom_node_point() +
  facet_edges(~year)</code></pre>
<p><img src="ggplot2-2_files/figure-html/unnamed-chunk-18-1.png" width="768" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="annotations" class="section level1">
<h1>8 Annotations</h1>
<p>When constructing a data visualisation, it is often necessary to make
annotations to the data displayed. Conceptually, an annotation supplies
<em>metadata</em> for the plot: that is, it provides additional
information about the data being displayed. From a practical standpoint,
however, metadata is just another form of data. Because of this, the
annotation tools in ggplot2 reuse the same geoms that are used to create
other plots. However, to meet the specific needs that users often have
when annotating plots, there are some helper functions in ggplot2
itself, and a number of other packages have extended ggplot2 in ways you
may find helpful.</p>
<div id="notes-1" class="section level2">
<h2>Notes</h2>
<p>An important distinction on axis labels:</p>
<blockquote>
<p>There are two ways to remove the axis label. Setting
<code>labs(x = "")</code> omits the label but still allocates space;
setting <code>labs(x = NULL)</code> removes the label and its space.</p>
</blockquote>
<p>Consider adopting <a
href="https://github.com/yixuan/showtext"><code>showtext</code></a> for
non-standard fonts, with caveats for using it in <a
href="https://statr.me/2014/07/showtext-with-knitr/">R Markdown</a>.</p>
<p>One of the most useful alignments is “inward”. It aligns text towards
the middle of the plot, which ensures that labels remain within the plot
limits:</p>
<pre class="r"><code>df &lt;- data.frame(
  x = c(1, 1, 2, 2, 1.5),
  y = c(1, 2, 1, 2, 1.5),
  text = c(
    &quot;bottom-left&quot;, &quot;top-left&quot;,
    &quot;bottom-right&quot;, &quot;top-right&quot;, &quot;center&quot;
  ), stringsAsFactors = FALSE
)
ggplot(df, aes(x, y)) +
  geom_text(aes(label = text))</code></pre>
<p><img src="ggplot2-2_files/figure-html/unnamed-chunk-19-1.png" width="768" style="display: block; margin: auto;" /></p>
<pre class="r"><code>ggplot(df, aes(x, y)) +
  geom_text(aes(label = text), vjust = &quot;inward&quot;, hjust = &quot;inward&quot;)</code></pre>
<p><img src="ggplot2-2_files/figure-html/unnamed-chunk-19-2.png" width="768" style="display: block; margin: auto;" /></p>
<ul>
<li>The font size is controlled by the <code>size</code> aesthetic.
Unlike most tools, ggplot2 specifies the size in millimeters (mm),
rather than the usual points (pts). The reason for this choice is that
it makes it the units for font sizes consistent with how other sizes are
specified in ggplot2. (There are 72.27 pts in a inch, so to convert from
points to mm, just multiply by 72.27 / 25.4).</li>
</ul>
<p>Let’s assign blame to unemployment!</p>
<pre class="r"><code>presidential &lt;- subset(presidential, start &gt; economics$date[1] &amp; start &lt; max(economics$date))

ggplot(economics) +
  geom_rect(
    aes(xmin = start, xmax = end, fill = party),
    ymin = -Inf, ymax = Inf, alpha = 0.25,
    data = presidential
  ) +
  geom_vline(
    aes(xintercept = as.numeric(start)),
    data = presidential,
    colour = &quot;grey50&quot;, alpha = 0.5
  ) +
  geom_text(
    # themes only affect the non-data components of the plot, see:
    #   https://github.com/tidyverse/ggplot2/issues/1859
    aes(x = start, y = 0.0005, label = name, family = &quot;Lato&quot;),
    data = presidential,
    size = 3, vjust = 0, hjust = 0, nudge_x = 75
  ) +
  geom_line(aes(date, unemploy / pop)) +
  scale_fill_manual(values = c(&quot;blue&quot;, &quot;red&quot;)) +
  scale_y_continuous(labels = scales::percent, limits = c(0, NA)) +
  scale_x_date(breaks = presidential$start, date_labels = &quot;%Y&quot;) +
  guides(fill = &quot;none&quot;) +
  labs(title = &quot;Unemployment rate by presidential term&quot;, x = NULL, y = NULL) +
  theme_quo(minor.y = FALSE, x = FALSE)</code></pre>
<p><img src="ggplot2-2_files/figure-html/unnamed-chunk-20-1.png" width="768" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="arranging-plots" class="section level1">
<h1>9 Arranging plots</h1>
<p>The grammar presented in ggplot2 is concerned with creating single
plots. While the faceting system provides the means to produce several
subplots all of these are part of the same main visualization, sharing
layers, data, and scales. However, it is often necessary to use multiple
disparate plots to tell a story or make an argument. These can of course
be created individually and assembled in a layout program, but it is
beneficial to do this in code to avoid time consuming and
non-reproducible manual labor. A range of packages have risen to the
occasion and provide different approaches to arranging separate plots.
While this chapter will focus on the <code>patchwork</code> package you
may also find some of the same functionalities in the
<code>cowplot</code>, <code>gridExtra</code> and <code>ggpubr</code>
packages.</p>
</div>

<div id="rmd-source-code">LS0tCnRpdGxlOiBnZ3Bsb3QyIChMYXllcnMpCmRhdGU6ICcyMDIyLTExLTIwJwpvdXRwdXQ6CiAgaHRtbF9kb2N1bWVudDoKICAgIHRoZW1lOgogICAgICB2ZXJzaW9uOiA1CiAgICB0b2M6IHllcwogICAgdG9jX2Zsb2F0OgogICAgICBjb2xsYXBzZWQ6IHllcwogICAgICBzbW9vdGhfc2Nyb2xsOiBubwotLS0KCldvcmtib29rIGZvciBjb21wbGV0aW5nIHF1aXp6ZXMgYW5kIGV4ZXJjaXNlcyBmcm9tIHRoZSAiTGF5ZXJzIiBjaGFwdGVycyBvZiBbZ2dwbG90MjogRWxlZ2FudCBHcmFwaGljcyBmb3IgRGF0YSBBbmFseXNpc10oaHR0cHM6Ly9nZ3Bsb3QyLWJvb2sub3JnL2luZGV4Lmh0bWwpLCB0aGlyZCBlZGl0aW9uLCB3aXRoIGNvbXBhcmlzb25zIHRvIHNvbHV0aW9ucyBmcm9tIFtTb2x1dGlvbnMgdG8gZ2dwbG90MjogRWxlZ2FudCBHcmFwaGljcyBmb3IgRGF0YSBBbmFseXNpc10oaHR0cHM6Ly9nZ3Bsb3QyLWJvb2stc29sdXRpb25zLTNlZC5uZXRsaWZ5LmFwcCkuCgpgYGB7ciBzZXR1cCwgbWVzc2FnZSA9IEZBTFNFLCB3YXJuaW5nID0gRkFMU0V9CmxpYnJhcnkoZ2dwbG90MikKbGlicmFyeShkcGx5cikKbGlicmFyeShiYWJ5bmFtZXMpICMgbm9saW50OiB1bnVzZWRfaW1wb3J0X2xpbnRlci4gYXR0YWNoZWQgZm9yIGBiYWJ5bmFtZXNgIGRhdGEgZnJhbWUuCmxpYnJhcnkoamJwbG90KQpsaWJyYXJ5KG1vZGVscikKbGlicmFyeShtYXBzKSAjIG5vbGludDogdW51c2VkX2ltcG9ydF9saW50ZXIuIG1hcHMgaXMgcmVxdWlyZWQgYnkgbWFwX2RhdGEoKS4KbGlicmFyeShzZikKbGlicmFyeShVU0Fib3VuZGFyaWVzKQpsaWJyYXJ5KFVTQWJvdW5kYXJpZXNEYXRhKSAjIG5vbGludDogdW51c2VkX2ltcG9ydF9saW50ZXIuIE5lZWRlZCBieSBVU0Fib3VuZGFyaWVzLgpsaWJyYXJ5KGdncmFwaCkKbGlicmFyeSh0aWR5Z3JhcGgpCgprbml0cjo6b3B0c19jaHVuayRzZXQoCiAgY29tbWVudCA9ICIjPiIsCiAgZmlnLmFsaWduID0gImNlbnRlciIKKQpgYGAKCiMgSW50cm9kdWN0aW9uCgpUaGlzIHdvcmtib29rIGluY2x1ZGVzIGFuc3dlcnMgYW5kIHNvbHV0aW9ucyB0byB0aGUgcXVpenplcyBhbmQgZXhlcmNpc2VzIGZyb20gW2dncGxvdDI6IEVsZWdhbnQgR3JhcGhpY3MgZm9yIERhdGEgQW5hbHlzaXNdKGh0dHBzOi8vZ2dwbG90Mi1ib29rLm9yZy9pbmRleC5odG1sKSBhbmQgW1NvbHV0aW9ucyB0byBnZ3Bsb3QyOiBFbGVnYW50IEdyYXBoaWNzIGZvciBEYXRhIEFuYWx5c2lzXShodHRwczovL2dncGxvdDItYm9vay1zb2x1dGlvbnMtM2VkLm5ldGxpZnkuYXBwKSwgb3JnYW5pemVkIGJ5IGNoYXB0ZXIuIEl0IGluY2x1ZGVzIGV4Y2VycHRzIGZyb20gYm90aCBib29rcywgY29waWVkIGhlcmUuCgoqKldBUk5JTkcsIFNQT0lMRVJTISoqIElmIHlvdSBoYXZlbid0IHJlYWQgdGhlIGdncGxvdDIgYm9vayBhbmQgaW50ZW5kIHRvIGNvbXBsZXRlIHRoZSBxdWl6emVzIGFuZCBleGVyY2lzZXMsIGRvbid0IHJlYWQgdGhpcyBub3RlYm9vay4gSXQgY29udGFpbnMgbXkgKHBvdGVudGlhbGx5IHdyb25nKSBhbnN3ZXJzIHRvIGJvdGguCgojIDMgSW5kaXZpZHVhbCBnZW9tcwoKIyMgMy4xLjEgRXhlcmNpc2VzCgoxLiAgV2hhdCBnZW9tcyB3b3VsZCB5b3UgdXNlIHRvIGRyYXcgZWFjaCBvZiB0aGUgZm9sbG93aW5nIG5hbWVkIHBsb3RzPwogICAgCiAgICAxLiBTY2F0dGVycGxvdAogICAgMS4gTGluZSBjaGFydAogICAgMS4gSGlzdG9ncmFtCiAgICAxLiBCYXIgY2hhcnQKICAgIDEuIFBpZSBjaGFydAoKQW5zd2VyOgoKMS4gU2NhdHRlcnBsb3Q6IGBnZW9tX3BvaW50KClgCjEuIExpbmUgY2hhcnQ6IGBnZW9tX2xpbmUoKWAKMS4gSGlzdG9ncmFtOiBgZ2VvbV9oaXN0b2dyYW0oKWAKMS4gQmFyIGNoYXJ0OiBgZ2VvbV9iYXIoKWAKMS4gUGllIGNoYXJ0OiB0aGVyZSBpcyBubyBuYXRpdmUgZ2VvbSBmb3IgYSBwaWUgY2hhcnQsIGJ1dCwgYXMgdGhlCiAgIFtSIEdyYXBoIEdhbGxlcnldKGh0dHBzOi8vci1ncmFwaC1nYWxsZXJ5LmNvbS9waWVjaGFydC1nZ3Bsb3QyLmh0bWwpIGRlbW9uc3RyYXRlcywgaXQgaXMgcG9zc2libGUKICAgdG8gY3JlYXRlIGEgcGllIGNoYXJ0IHVzaW5nIGBnZW9tX2JhcigpYCBhbmQgYGNvb3JkX3BvbGFyKClgCgpHRyBTb2x1dGlvbnM6CgotIFNjYXR0ZXJwbG90OiBgZ2VvbV9wb2ludCgpYAotIExpbmUgY2hhcnQ6IGBnZW9tX2xpbmUoKWAKLSBIaXN0b2dyYW06IGBnZW9tX2hpc3RvZ3JhbSgpYAotIEJhciBjaGFydDogYGdlb21fYmFyKClgCi0gUGllIGNoYXJ0OiBnZ3Bsb3QyIGRvZXMgbm90IGhhdmUgYSBnZW9tIHRvIGRyYXcgcGllIGNoYXJ0cy4gT25lIHdvcmthcm91bmQsIGFjY29yZGluZyB0byB0aGUgW1IgR3JhcGggR2FsbGVyeV0oaHR0cHM6Ly93d3cuci1ncmFwaC1nYWxsZXJ5LmNvbS9waWVjaGFydC1nZ3Bsb3QyLmh0bWwpIGlzIHRvIGJ1aWxkIGEgc3RhY2tlZCBiYXIgY2hhcnQgd2l0aCBvbmUgYmFyIG9ubHkgdXNpbmcgdGhlIGBnZW9tX2JhcigpYCBmdW5jdGlvbiBhbmQgdGhlbiBtYWtlIGl0IGNpcmN1bGFyIHdpdGggYGNvb3JkX3BvbGFyKClgCgotLS0KCjIuICBXaGF0J3MgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiBgZ2VvbV9wYXRoKClgIGFuZCBgZ2VvbV9wb2x5Z29uKClgPwogICAgV2hhdCdzIHRoZSBkaWZmZXJlbmNlIGJldHdlZW4gYGdlb21fcGF0aCgpYCBhbmQgYGdlb21fbGluZSgpYD8KCkFuc3dlcjogYGdlb21fcGF0aCgpYCBjb25uZWN0cyBvYnNlcnZhdGlvbnMgd2l0aCBhIGxpbmUgaW4gdGhlIG9yZGVyIHRoZXkgYXBwZWFyIGluIHRoZSBkYXRhLCBgZ2VvbV9saW5lKClgIGNvbm5lY3RzIHRoZW0gaW4gb3JkZXIgYWxvbmcgdGhlIHggYXhpcywgYW5kIGBnZW9tX3BvbHlnb24oKWAgY29ubmVjdHMgdGhlIHN0YXJ0IGFuZCBlbmQgcG9pbnRzIG9mIGBnZW9tX3BhdGgoKWAgYW5kIGZpbGxzIGluIHRoZSBwbG90LgoKR0cgU29sdXRpb25zOgoKLSBgZ2VvbV9wb2x5Z29uYCBkcmF3cyB0aGUgc2FtZSBncmFwaCAobGluZXMpIGFzIGBnZW9tX3BhdGhgLCBidXQgaXQgZmlsbHMgdGhlc2UgbGluZXMgd2l0aCBjb2xvcgotIGBnZW9tX2xpbmUoKWAgY29ubmVjdHMgcG9pbnRzIGZyb20gbGVmdCB0byByaWdodCwgd2hlcmVhcyBgZ2VvbV9wYXRoKClgIGNvbm5lY3RzIHBvaW50cyBpbiB0aGUgb3JkZXIgdGhleSBhcHBlYXIgaW4gdGhlIGRhdGEKCi0tLQoKMy4gIFdoYXQgbG93LWxldmVsIGdlb21zIGFyZSB1c2VkIHRvIGRyYXcgYGdlb21fc21vb3RoKClgPyAKICAgIFdoYXQgYWJvdXQgYGdlb21fYm94cGxvdCgpYCBhbmQgYGdlb21fdmlvbGluKClgPyAKCkFuc3dlcjogcmV2aWV3aW5nIHRoZSBzb3VyY2UgY29kZToKCltgZ2VvbV9zbW9vdGgoKWBdKGh0dHBzOi8vZ2l0aHViLmNvbS90aWR5dmVyc2UvZ2dwbG90Mi9ibG9iL21haW4vUi9nZW9tLXNtb290aC5yKSB1c2VzOgoKLSBgZ2VvbV9wYXRoKClgIGJ5IHdheSBvZiBgZ2VvbV9saW5lKClgCi0gYGdlb21fYXJlYSgpYCBieSB3YXkgb2YgYGdlb21fcmliYm9uKClgCgpbYGdlb21fYm94cGxvdCgpYF0oaHR0cHM6Ly9naXRodWIuY29tL3RpZHl2ZXJzZS9nZ3Bsb3QyL2Jsb2IvbWFpbi9SL2dlb20tYm94cGxvdC5yKSB1c2VzOgoKLSBgZ2VvbV9wb2ludCgpYAotIGBnZW9tX3BhdGgoKWAgYnkgd2F5IG9mIGBnZW9tX3NlZ21lbnQoKWAgYW5kIGBnZW9tX2Nyb3NzYmFyKClgCi0gYGdlb21fcG9seWdvbigpYCBieSB3YXkgb2YgYGdlb21fY3Jvc3NiYXIoKWAKCltgZ2VvbV92aW9saW4oKWBdKGh0dHBzOi8vZ2l0aHViLmNvbS90aWR5dmVyc2UvZ2dwbG90Mi9ibG9iL21haW4vUi9nZW9tLXZpb2xpbi5yKSB1c2VzOgoKLSBgZ2VvbV9wYXRoKClgCi0gYGdlb21fcG9seWdvbigpYAoKR0cgU29sdXRpb25zOgoKKGthbmduYWRlKQoKLSBgZ2VvbV9wb2ludCgpYCwgYGdlb21fcGF0aCgpYCwgYW5kIGBnZW9tX2FyZWEoKWAgYXJlIHVzZWQgdG8gZHJhdyBgZ2VvbV9zbW9vdGgoKWAKLSBgZ2VvbV9yZWN0KClgLCBgZ2VvbV9saW5lKClgLCBgZ2VvbV9wb2ludCgpYCBhcmUgdXNlZCBmb3IgYGdlb21fYm94cGxvdCgpYAotIGBnZW9tX2FyZWEoKWAgYW5kIGBnZW9tX3BhdGgoKWAgYXJlIHVzZWQgZm9yIGBnZW9tX3Zpb2xpbigpYAoKTm90ZTogR0cgU29sdXRpb25zIGFuc3dlcnMgYXBwZWFyIHRvIGJlIGluY29ycmVjdCBndWVzc2VzLgoKLS0tCgojIDQgQ29sbGVjdGl2ZSBnZW9tcwoKR2VvbXMgY2FuIGJlIHJvdWdobHkgZGl2aWRlZCBpbnRvIGluZGl2aWR1YWwgYW5kIGNvbGxlY3RpdmUgZ2VvbXMuIEFuIF9faW5kaXZpZHVhbF9fIGdlb20gZHJhd3MgYSBkaXN0aW5jdCBncmFwaGljYWwgb2JqZWN0IGZvciBlYWNoIG9ic2VydmF0aW9uIChyb3cpLiBGb3IgZXhhbXBsZSwgdGhlIHBvaW50IGdlb20gZHJhd3Mgb25lIHBvaW50IHBlciByb3cuIEEgX19jb2xsZWN0aXZlX18gZ2VvbSBkaXNwbGF5cyBtdWx0aXBsZSBvYnNlcnZhdGlvbnMgd2l0aCBvbmUgZ2VvbWV0cmljIG9iamVjdC4gVGhpcyBtYXkgYmUgYSByZXN1bHQgb2YgYSBzdGF0aXN0aWNhbCBzdW1tYXJ5LCBsaWtlIGEgYm94cGxvdCwgb3IgbWF5IGJlIGZ1bmRhbWVudGFsIHRvIHRoZSBkaXNwbGF5IG9mIHRoZSBnZW9tLCBsaWtlIGEgcG9seWdvbi4gTGluZXMgYW5kIHBhdGhzIGZhbGwgc29tZXdoZXJlIGluIGJldHdlZW46IGVhY2ggbGluZSBpcyBjb21wb3NlZCBvZiBhIHNldCBvZiBzdHJhaWdodCBzZWdtZW50cywgYnV0IGVhY2ggc2VnbWVudCByZXByZXNlbnRzIHR3byBwb2ludHMuIEhvdyBkbyB3ZSBjb250cm9sIHRoZSBhc3NpZ25tZW50IG9mIG9ic2VydmF0aW9ucyB0byBncmFwaGljYWwgZWxlbWVudHM/ICBUaGlzIGlzIHRoZSBqb2Igb2YgdGhlIGBncm91cGAgYWVzdGhldGljLgoKIyMgNC41IEV4ZXJjaXNlcwoKR0cgU29sdXRpb25zIG9mZmVycyBubyBhbnN3ZXJzIGZvciB0aGlzIHNlY3Rpb24uCgoxLiAgRHJhdyBhIGJveHBsb3Qgb2YgYGh3eWAgZm9yIGVhY2ggdmFsdWUgb2YgYGN5bGAsIHdpdGhvdXQgdHVybmluZwogICAgYGN5bGAgaW50byBhIGZhY3Rvci4gV2hhdCBleHRyYSBhZXN0aGV0aWMgZG8geW91IG5lZWQgdG8gc2V0PwoKQW5zd2VyOiB0aGUgYGdyb3VwYCBhZXN0aGV0aWMgaXMgcmVxdWlyZWQuCgpgYGB7cn0KZ2dwbG90KGdncGxvdDI6Om1wZywgYWVzKGN5bCwgaHd5LCBncm91cCA9IGN5bCkpICsKICBnZW9tX2JveHBsb3QoKQpgYGAKCi0tLQoKMi4gIE1vZGlmeSB0aGUgZm9sbG93aW5nIHBsb3Qgc28gdGhhdCB5b3UgZ2V0IG9uZSBib3hwbG90IHBlciBpbnRlZ2VyIHZhbHVlIAogICAgb2YgYGRpc3BsYC4KCmBgYHtyLCBldmFsID0gRkFMU0V9CmdncGxvdChnZ3Bsb3QyOjptcGcsIGFlcyhkaXNwbCwgY3R5KSkgKwogIGdlb21fYm94cGxvdCgpCmBgYAoKQW5zd2VyOiBncm91cGluZyBieSB0aGUgZmxvb3Igb2YgZGlzcGxhY2VtZW50IHdvcmtzLCBidXQgaXMgYXJyYW5nZWQgc3RyYW5nZWx5LiBNdXRhdGluZyBkaXNwbGFjZW1lbnQgZmlyc3QgaXMgYSBiZXR0ZXIgc29sdXRpb246CgpgYGB7cn0KZ2dwbG90KGdncGxvdDI6Om1wZywgYWVzKGRpc3BsLCBjdHksIGdyb3VwID0gZmxvb3IoZGlzcGwpKSkgKwogIGdlb21fYm94cGxvdCgpCgpnZ3Bsb3QyOjptcGcgfD4KICBtdXRhdGUoZGlzcGwgPSBmbG9vcihkaXNwbCkpIHw+CiAgZ2dwbG90KGFlcyhkaXNwbCwgY3R5LCBncm91cCA9IGRpc3BsKSkgKwogIGdlb21fYm94cGxvdCgpCmBgYAoKLS0tCgozLiAgV2hlbiBpbGx1c3RyYXRpbmcgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiBtYXBwaW5nIGNvbnRpbnVvdXMgYW5kIGRpc2NyZXRlCiAgICBjb2xvdXJzIHRvIGEgbGluZSwgdGhlIGRpc2NyZXRlIGV4YW1wbGUgbmVlZGVkIGBhZXMoZ3JvdXAgPSAxKWAuIFdoeT8KICAgIFdoYXQgaGFwcGVucyBpZiB0aGF0IGlzIG9taXR0ZWQ/IFdoYXQncyB0aGUgZGlmZmVyZW5jZSBiZXR3ZWVuCiAgICBgYWVzKGdyb3VwID0gMSlgIGFuZCBgYWVzKGdyb3VwID0gMilgPyBXaHk/CgpBbnN3ZXI6IHVzaW5nIHRoZSBleGFtcGxlIGZyb20gdGhlIGJvb2ssIG9taXR0aW5nIHRoZSBncm91cCBhZXN0aGV0aWMgZ2VuZXJhdGVzIGFuIGVycm9yOgoKYGBgCmBnZW9tX2xpbmUoKWA6IEVhY2ggZ3JvdXAgY29uc2lzdHMgb2Ygb25seSBvbmUgb2JzZXJ2YXRpb24uCuKEuSBEbyB5b3UgbmVlZCB0byBhZGp1c3QgdGhlIGdyb3VwIGFlc3RoZXRpYz8KYGBgCgpUaGVyZSBpcyBubyBkaWZmZXJlbmNlIGJldHdlZW4gYGFlcyhncm91cCA9IDEpYCBhbmQgYGFlcyhncm91cCA9IDIpYCwgcHJlc3VtYWJseSBiZWNhdXNlIGJvdGggbWV0aG9kcyBwdXQgYWxsIG9ic2VydmF0aW9ucyBpbnRvIGEgc2luZ2xlIGdyb3VwLgoKYGBge3J9CmRmIDwtIGRhdGEuZnJhbWUoeCA9IDE6MywgeSA9IDE6MywgY29sb3VyID0gYygxLCAzLCA1KSkKCmdncGxvdChkZiwgYWVzKHgsIHksIGNvbG91ciA9IGZhY3Rvcihjb2xvdXIpKSkgKwogIGdlb21fbGluZShhZXMoZ3JvdXAgPSAxKSwgbGluZXdpZHRoID0gMikgKwogIGdlb21fcG9pbnQoc2l6ZSA9IDUpCgpnZ3Bsb3QoZGYsIGFlcyh4LCB5LCBjb2xvdXIgPSBmYWN0b3IoY29sb3VyKSkpICsKICBnZW9tX2xpbmUoYWVzKGdyb3VwID0gMiksIGxpbmV3aWR0aCA9IDIpICsKICBnZW9tX3BvaW50KHNpemUgPSA1KQpgYGAKCi0tLQoKNC4gIEhvdyBtYW55IGJhcnMgYXJlIGluIGVhY2ggb2YgdGhlIGZvbGxvd2luZyBwbG90cz8KICAgIChIaW50OiB0cnkgYWRkaW5nIGFuIG91dGxpbmUgYXJvdW5kIGVhY2ggYmFyIHdpdGggYGNvbG91ciA9ICJ3aGl0ZSJgKQoKYGBge3IsIGV2YWwgPSBGQUxTRX0KZ2dwbG90KGdncGxvdDI6Om1wZywgYWVzKGRydikpICsKICBnZW9tX2JhcigpCmdncGxvdChnZ3Bsb3QyOjptcGcsIGFlcyhkcnYsIGZpbGwgPSBod3ksIGdyb3VwID0gaHd5KSkgKwogIGdlb21fYmFyKCkKCm1wZzIgPC0gZ2dwbG90Mjo6bXBnICU+JQogIGFycmFuZ2UoaHd5KSAlPiUKICBtdXRhdGUoaWQgPSBzZXFfYWxvbmcoaHd5KSkKZ2dwbG90KG1wZzIsIGFlcyhkcnYsIGZpbGwgPSBod3ksIGdyb3VwID0gaWQpKSArCiAgZ2VvbV9iYXIoKQpgYGAKCkFuc3dlcjogaW4gdGhlIGZpcnN0IHBsb3QsIHRoZXJlIGFyZSB0aHJlZSBiYXJzLiBJbiB0aGUgc2Vjb25kLCB0aGVyZSBpcyBvbmUgYmFyIGZvciBlYWNoIHVuaXF1ZSB2YWx1ZSBmb3IgYGh3eWAgaW4gZWFjaCBjb2x1bW4uIEluIHRoZSB0aGlyZCwgdGhlcmUgaXMgb25lIGJhciBmb3IgZWFjaCBvYnNlcnZhdGlvbiBvZiBgaHd5YC4KCmBgYHtyfQpnZ3Bsb3QoZ2dwbG90Mjo6bXBnLCBhZXMoZHJ2KSkgKwogIGdlb21fYmFyKGNvbG9yID0gIndoaXRlIikKCmdncGxvdChnZ3Bsb3QyOjptcGcsIGFlcyhkcnYsIGZpbGwgPSBod3ksIGdyb3VwID0gaHd5KSkgKwogIGdlb21fYmFyKGNvbG9yID0gIndoaXRlIikKCmdncGxvdDI6Om1wZyB8PgogIGFycmFuZ2UoaHd5KSB8PgogIG11dGF0ZShpZCA9IHNlcV9hbG9uZyhod3kpKSB8PgogIGdncGxvdChhZXMoZHJ2LCBmaWxsID0gaHd5LCBncm91cCA9IGlkKSkgKwogIGdlb21fYmFyKGNvbG9yID0gIndoaXRlIikKYGBgCgotLS0KCjUuICBJbnN0YWxsIHRoZSBiYWJ5bmFtZXMgcGFja2FnZS4gSXQgY29udGFpbnMgZGF0YSBhYm91dCB0aGUgcG9wdWxhcml0eSBvZgogICAgYmFieW5hbWVzIGluIHRoZSBVUy4gUnVuIHRoZSBmb2xsb3dpbmcgY29kZSBhbmQgZml4IHRoZSByZXN1bHRpbmcgZ3JhcGguCiAgICBXaHkgZG9lcyB0aGlzIGdyYXBoIG1ha2UgbWUgdW5oYXBweT8KCmBgYHtyLCBldmFsID0gRkFMU0V9CmhhZGxleSA8LSBkcGx5cjo6ZmlsdGVyKGJhYnluYW1lcywgbmFtZSA9PSAiSGFkbGV5IikKZ2dwbG90KGhhZGxleSwgYWVzKHllYXIsIG4pKSArCiAgZ2VvbV9saW5lKCkKYGBgCgpBbnN3ZXI6IHRoZSBwb3B1bGFyaXR5IG9mICJIYWRsZXkiIGlzIHNhZGx5IGRlY2xpbmluZy4KCmBgYHtyfQpiYWJ5bmFtZXMgfD4KICBmaWx0ZXIobmFtZSA9PSAiSGFkbGV5IikgfD4KICBnZ3Bsb3QoYWVzKHllYXIsIG4sIGdyb3VwID0gc2V4LCBjb2xvciA9IHNleCkpICsKICBnZW9tX2xpbmUoKQpgYGAKCi0tLQoKQm9udXM6IGEgY29tcGFyaXNvbiBvZiB0aGUgcG9wdWxhcml0eSBvZiBteSBuYW1lIChKb2huKSBhbmQgSGFkbGV5OgoKYGBge3J9CmJhYnluYW1lcyB8PgogIGZpbHRlcihuYW1lICVpbiUgYygiSGFkbGV5IiwgIkpvaG4iKSkgfD4KICBnZ3Bsb3QoYWVzKHllYXIsIHByb3AsIGNvbG9yID0gaW50ZXJhY3Rpb24obmFtZSwgc2V4LCBzZXAgPSAiLCAiLCBsZXgub3JkZXIgPSBUUlVFKSkpICsKICBnZW9tX2xpbmUoKSArCiAgc2NhbGVfeV9sb2cxMCgpICsKICBzY2FsZV9jb2xvcl92aXJpZGlzX2QoKSArCiAgbGFicyh4ID0gIiIsIHkgPSAiIiwgY29sb3IgPSAiTmFtZSwgU2V4IikgKwogIGxhYnModGl0bGUgPSAiUmVsYXRpdmUgcG9wdWxhcml0eSBvZiB0aGUgbmFtZXMgSGFkbGV5IGFuZCBKb2huIikgKwogIHRoZW1lX3F1bygpCmBgYAoKTm90ZTogYGdyb3VwYCBpcyByZWR1bmRhbnQgZm9yIGBnZW9tX2xpbmUoKWAgd2hlbiB1c2luZyBgY29sb3JgLgoKLS0tCgojIDUgU3RhdGlzdGljYWwgc3VtbWFyaWVzCgojIyA1LjQuMSBFeGVyY2lzZXMKCjEuICBXaGF0IGBiaW53aWR0aGAgdGVsbHMgeW91IHRoZSBtb3N0IGludGVyZXN0aW5nIHN0b3J5IGFib3V0IHRoZSBkaXN0cmlidXRpb24KICAgIG9mIGBjYXJhdGA/CgpBbnN3ZXI6IGFzIGFuc3dlcmVkIGluIFsyLjYuNiBFeGVyY2lzZXNdKGdncGxvdDItMS5odG1sIzI2Nl9FeGVyY2lzZXMpOgoKQW5zd2VyOiB1c2luZyB0cmlhbCBhbmQgZXJyb3IsIGBiaW53aWR0aCA9IDAuMDFgIHJldmVhbHMgdGhhdCBjYXJhdCB3ZWlnaHQgaXMgc2tld2VkIHRvd2FyZHMgcm91bmQgbnVtYmVycyAoMSwgMS4yNSwgMS41LCAyLCBldGMuKS4gVXNpbmcgdGhlIHNtYWxsZXIgYGJpbndpZHRoID0gMC4wMDVgIGRvZXNuJ3QgaW1wcm92ZSB0aGUgcGF0dGVybiwgYW5kIG1ha2VzIGl0IGhhcmRlciB0byBzZWUuCgpgYGB7cn0KZ2dwbG90KGRpYW1vbmRzLCBhZXMoY2FyYXQpKSArCiAgZ2VvbV9oaXN0b2dyYW0oYmlud2lkdGggPSAwLjAxKQpgYGAKCkdHIFNvbHV0aW9uczoKCi0gSGlnaGx5IHN1YmplY3RpdmUgYW5zd2VyLCBidXQgSSB3b3VsZCBnbyB3aXRoIDAuMiBzaW5jZSBpdCBnaXZlcyB5b3UgdGhlIHJpZ2h0IGFtb3VudCBvZiBpbmZvcm1hdGlvbiBhYm91dCB0aGUgZGlzdHJpYnV0aW9uIG9mIGBjYXJhdGA6IHJpZ2h0LXNrZXdlZC4KCi0tLQoKMi4gIERyYXcgYSBoaXN0b2dyYW0gb2YgYHByaWNlYC4gV2hhdCBpbnRlcmVzdGluZyBwYXR0ZXJucyBkbyB5b3Ugc2VlPwoKQW5zd2VyOiBwcmljZSBoYXMgYSBtdWx0aS1tb2RhbCBkaXN0cmlidXRpb24gd2l0aCBhIGdhcC4gTG9va2luZyBhdCB0aGUgdW5kZXJseWluZyBkYXRhLCB0aGVyZSBhcmUgbm8gcHJpY2VzIGJldHdlZW4gXCQxNDU0IGFuZCBcJDE1NDYKCmBgYHtyfQpnZ3Bsb3QoZGlhbW9uZHMsIGFlcyhwcmljZSkpICsKICBnZW9tX2hpc3RvZ3JhbShiaW53aWR0aCA9IDUwKQoKZGlhbW9uZHMgfD4KICBmaWx0ZXIocHJpY2UgPj0gMTQ1NCAmIHByaWNlIDw9IDE1NDYpCmBgYAoKR0cgU29sdXRpb25zOgoKLSBJdCdzIHNrZXdlZCB0byB0aGUgcmlnaHQgYW5kIGhhcyBhIGxvbmcgdGFpbC4gQWxzbywgdGhlcmUgaXMgYSBzbWFsbCBwZWFrIGFyb3VuZCA1MDAwIGFuZCBhIGh1Z2UgcGVhayBhcm91bmQgMC4KCi0tLQoKMy4gIEhvdyBkb2VzIHRoZSBkaXN0cmlidXRpb24gb2YgYHByaWNlYCB2YXJ5IHdpdGggYGNsYXJpdHlgPwoKQW5zd2VyOiBhIGJveHBsb3Qgb2YgcHJpY2UgYnkgY2xhcml0eSBzaG93cyB0aGF0IGRpYW1vbmRzIHdpdGggYmV0dGVyIGNsYXJpdHkgYXJlbid0IG5lY2Vzc2FyaWx5IG1vcmUgZXhwZW5zaXZlLgoKSG93ZXZlciwgYXMgbm90ZWQgaW4gbXkgW1IgVHJhaW5pbmcgTG9nXShyLXRyYWluaW5nLWxvZy5odG1sKSBhbmQgYXMgYW5zd2VyZWQgaW4gWzIuNi42IEV4ZXJjaXNlc10oZ2dwbG90Mi0xLmh0bWwjMjY2X0V4ZXJjaXNlcyk6Cgo+IFs3LjYgUGF0dGVybnMgYW5kIG1vZGVsc10oaHR0cHM6Ly9yNGRzLmhhZC5jby5uei9leHBsb3JhdG9yeS1kYXRhLWFuYWx5c2lzLmh0bWwjcGF0dGVybnMtYW5kLW1vZGVscykgY292ZXJzIG1vZGVscyBhbmQgcmVzaWR1YWxzLCBoZXJlIHNob3dpbmcgaG93IHRvIHJldmVhbCB0aGUgZXhwZWN0ZWQgcmVsYXRpb25zaGlwIGJldHdlZW4gY3V0IGFuZCBwcmljZToKCldlIGNhbiByZW1vdmUgdGhlIHJlbGF0aW9uc2hpcCBiZXR3ZWVuIGNhcmF0cyBhbmQgcHJpY2UsIGFuZCByZWRvIHRoZSBib3hwbG90LCB3aGljaCBzaG93cyB0aGUgZXhwZWN0ZWQgcmVsYXRpb25zaGlwOgoKYGBge3J9CmdncGxvdChkaWFtb25kcywgYWVzKGNsYXJpdHksIHByaWNlKSkgKwogIGdlb21fYm94cGxvdCgpCgojIHJlbW92ZSBjYXJhdCB3ZWlnaHQgYXMgYSBjb25mb3VuZGluZyB2YXJpYWJsZQpkaWFtb25kcyB8PgogIGFkZF9yZXNpZHVhbHMobG0obG9nKHByaWNlKSB+IGxvZyhjYXJhdCksIGRhdGEgPSBkaWFtb25kcykpIHw+CiAgbXV0YXRlKHJlc2lkID0gZXhwKHJlc2lkKSkgfD4KICBnZ3Bsb3QoYWVzKGNsYXJpdHksIHJlc2lkKSkgKwogIGdlb21fYm94cGxvdCgpCmBgYAoKR0cgU29sdXRpb25zOgoKLSBUaGUgcmFuZ2Ugb2YgcHJpY2VzIGlzIHNpbWlsYXIgYWNyb3NzIGNsYXJpdHkgYW5kIHRoZSBtZWRpYW4gYW5kIElRUiB2YXJ5IGdyZWF0bHkgd2l0aCBjbGFyaXR5LiAgCgotLS0KCjQuICBPdmVybGF5IGEgZnJlcXVlbmN5IHBvbHlnb24gYW5kIGRlbnNpdHkgcGxvdCBvZiBgZGVwdGhgLiBXaGF0IGNvbXB1dGVkCiAgICB2YXJpYWJsZSBkbyB5b3UgbmVlZCB0byBtYXAgdG8gYHlgIHRvIG1ha2UgdGhlIHR3byBwbG90cyBjb21wYXJhYmxlPyAKICAgIChZb3UgY2FuIGVpdGhlciBtb2RpZnkgYGdlb21fZnJlcXBvbHkoKWAgb3IgYGdlb21fZGVuc2l0eSgpYC4pCgpBbnN3ZXI6IHlvdSBuZWVkIHRvIGVpdGhlciBkaXZpZGUgb3IgbXVsdGlwbHkgYHlgIGJ5IHRoZSB0b3RhbCBudW1iZXIgb2Ygb2JzZXJ2YXRpb25zLCBgbnJvdyhkaWFtb25kcylgIHVzaW5nIGBhZnRlcl9zdGF0KClgLgoKYGBge3J9CmdncGxvdChkaWFtb25kcywgYWVzKGRlcHRoKSkgKwogIGdlb21fZnJlcXBvbHkoYWVzKHkgPSBhZnRlcl9zdGF0KGNvdW50KSAvIG5yb3coZGlhbW9uZHMpKSwgYmlud2lkdGggPSAxKSArCiAgZ2VvbV9kZW5zaXR5KCkgKwogIGxhYnMoeSA9ICIiKQoKZ2dwbG90KGRpYW1vbmRzLCBhZXMoZGVwdGgpKSArCiAgZ2VvbV9mcmVxcG9seShiaW53aWR0aCA9IDEpICsKICBnZW9tX2RlbnNpdHkoYWVzKHkgPSBhZnRlcl9zdGF0KGRlbnNpdHkpICogbnJvdyhkaWFtb25kcykpKSArCiAgbGFicyh5ID0gIiIpCmBgYAoKTm90ZXM6IGZyb20gdGhlIGRvY3VtZW50YXRpb24gZm9yIGBhZnRlcl9zdGF0KClgOgoKPiBNb3N0IGFlc3RoZXRpY3MgYXJlIG1hcHBlZCBmcm9tIHZhcmlhYmxlcyBmb3VuZCBpbiB0aGUgZGF0YS4gU29tZXRpbWVzLCBob3dldmVyLCB5b3Ugd2FudCB0byBkZWxheSB0aGUgbWFwcGluZyB1bnRpbCBsYXRlciBpbiB0aGUgcmVuZGVyaW5nIHByb2Nlc3MuIGdncGxvdDIgaGFzIHRocmVlIHN0YWdlcyBvZiB0aGUgZGF0YSB0aGF0IHlvdSBjYW4gbWFwIGFlc3RoZXRpY3MgZnJvbS4gVGhlIGRlZmF1bHQgaXMgdG8gbWFwIGF0IHRoZSBiZWdpbm5pbmcsIHVzaW5nIHRoZSBsYXllciBkYXRhIHByb3ZpZGVkIGJ5IHRoZSB1c2VyLiBUaGUgc2Vjb25kIHN0YWdlIGlzIGFmdGVyIHRoZSBkYXRhIGhhcyBiZWVuIHRyYW5zZm9ybWVkIGJ5IHRoZSBsYXllciBzdGF0LiBUaGUgdGhpcmQgYW5kIGxhc3Qgc3RhZ2UgaXMgYWZ0ZXIgdGhlIGRhdGEgaGFzIGJlZW4gdHJhbnNmb3JtZWQgYW5kIG1hcHBlZCBieSB0aGUgcGxvdCBzY2FsZXMuIFRoZSBtb3N0IGNvbW1vbiBleGFtcGxlIG9mIG1hcHBpbmcgZnJvbSBzdGF0IHRyYW5zZm9ybWVkIGRhdGEgaXMgdGhlIGhlaWdodCBvZiBiYXJzIGluIGBnZW9tX2hpc3RvZ3JhbSgpYDogdGhlIGhlaWdodCBkb2VzIG5vdCBjb21lIGZyb20gYSB2YXJpYWJsZSBpbiB0aGUgdW5kZXJseWluZyBkYXRhLCBidXQgaXMgaW5zdGVhZCBtYXBwZWQgdG8gdGhlIGNvdW50IGNvbXB1dGVkIGJ5IGBzdGF0X2JpbigpYC4gQW4gZXhhbXBsZSBvZiBtYXBwaW5nIGZyb20gc2NhbGVkIGRhdGEgY291bGQgYmUgdG8gdXNlIGEgZGVzYXR1cmF0ZWQgdmVyc2lvbiBvZiB0aGUgc3Ryb2tlIGNvbG91ciBmb3IgZmlsbC4gSWYgeW91IHdhbnQgdG8gbWFwIGRpcmVjdGx5IGZyb20gdGhlIGxheWVyIGRhdGEgeW91IHNob3VsZCBub3QgZG8gYW55dGhpbmcgc3BlY2lhbC4gSW4gb3JkZXIgdG8gbWFwIGZyb20gc3RhdCB0cmFuc2Zvcm1lZCBkYXRhIHlvdSBzaG91bGQgdXNlIHRoZSBgYWZ0ZXJfc3RhdCgpYCBmdW5jdGlvbiB0byBmbGFnIHRoYXQgZXZhbHVhdGlvbiBvZiB0aGUgYWVzdGhldGljIG1hcHBpbmcgc2hvdWxkIGJlIHBvc3Rwb25lZCB1bnRpbCBhZnRlciBzdGF0IHRyYW5zZm9ybWF0aW9uLiBTaW1pbGFybHksIHlvdSBzaG91bGQgdXNlIGBhZnRlcl9zY2FsZSgpYCB0byBmbGFnIGV2YWx1YXRpb24gb2YgbWFwcGluZyBmb3IgYWZ0ZXIgZGF0YSBoYXMgYmVlbiBzY2FsZWQuIElmIHlvdSB3YW50IHRvIG1hcCB0aGUgc2FtZSBhZXN0aGV0aWMgbXVsdGlwbGUgdGltZXMsIGUuZy4gbWFwIHggdG8gYSBkYXRhIGNvbHVtbiBmb3IgdGhlIHN0YXQsIGJ1dCByZW1hcCBpdCBmb3IgdGhlIGdlb20sIHlvdSBjYW4gdXNlIHRoZSBgc3RhZ2UoKWAgZnVuY3Rpb24gdG8gY29sbGVjdCBtdWx0aXBsZSBtYXBwaW5ncy4KCkdHIFNvbHV0aW9ucyBhbnN3ZXIgbm90IGluY2x1ZGVkIGhlcmUuCgpOb3RlOiBhZnRlciByZWFkaW5nIHRoZSBbR2VuZXJhdGVkIFZhcmlhYmxlc10oaHR0cHM6Ly9nZ3Bsb3QyLWJvb2sub3JnL2xheWVycy5odG1sI2dlbmVyYXRlZC12YXJpYWJsZXMpIHNlY3Rpb24sIHRoZXJlIGlzIGFuIGVhc2llciBzb2x1dGlvbjoKCmBgYHtyfQpnZ3Bsb3QoZGlhbW9uZHMsIGFlcyhkZXB0aCkpICsKICBnZW9tX2ZyZXFwb2x5KGFlcyh5ID0gYWZ0ZXJfc3RhdChkZW5zaXR5KSksIGJpbndpZHRoID0gMSkgKwogIGdlb21fZGVuc2l0eSgpICsKICBsYWJzKHkgPSAiIikKYGBgCgotLS0KCkJvbnVzOiBvdmVybGF5IGEgUERGIGFuZCBFQ0RGIG9uIGEgaGlzdG9ncmFtLgoKYGBge3J9CmdncGxvdChkaWFtb25kcywgYWVzKHByaWNlKSkgKwogIGdlb21faGlzdG9ncmFtKGFlcyh5ID0gYWZ0ZXJfc3RhdChuY291bnQpKSwgYmlud2lkdGggPSA1MCwgZmlsbCA9ICJncmF5IikgKwogIHN0YXRfZWNkZigpICsKICBsYWJzKHggPSAiIiwgeSA9ICIiKSArCiAgdGhlbWVfcXVvKCkKCmdncGxvdChkaWFtb25kcywgYWVzKHByaWNlKSkgKwogIGdlb21faGlzdG9ncmFtKGJpbndpZHRoID0gNTAsIGZpbGwgPSAiZ3JheSIpICsKICAjIHNlZSBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8yNzYxMTQzOC9kZW5zaXR5LWN1cnZlLW92ZXJsYXktb24taGlzdG9ncmFtLXdoZXJlLXZlcnRpY2FsLWF4aXMtaXMtZnJlcXVlbmN5LWFrYS1jb3VudCAjIG5vbGludAogIGdlb21fZGVuc2l0eShhZXMoeSA9IGFmdGVyX3N0YXQoZGVuc2l0eSAqIG5yb3coZGlhbW9uZHMpICogNTApKSkgKwogIGxhYnMoeCA9ICIiLCB5ID0gIiIpICsKICB0aGVtZV9xdW8oKQoKZ2dwbG90KGRpYW1vbmRzLCBhZXMocHJpY2UpKSArCiAgZ2VvbV9oaXN0b2dyYW0oYWVzKHkgPSBhZnRlcl9zdGF0KG5jb3VudCkpLCBiaW53aWR0aCA9IDUwLCBmaWxsID0gImdyYXkiKSArCiAgIyBUT0RPOiB0aGUgZmFjdG9yIG9mIDAuNjIgd2FzIGRldGVybWluZWQgYnkgdHJpYWwgYW5kIGVycm9yLCBmaW5kIHVuZGVybHlpbmcgZm9ybXVsYQogICMgICAgICAgdGhlIG1heGltdW0gZGVuc2l0eSAvIHRoZSBtYXhpbXVtIGNvdW50IG9mIHRoZSBwcmV2aW91cyBwbG90ID0gOTMwLjU3IC8gMTUwMyA9IDAuNjIKICAjICAgICAgIGJ1dCB0aGF0IGRvZXNuJ3Qgd29yayBoZXJlCiAgZ2VvbV9kZW5zaXR5KGFlcyh5ID0gYWZ0ZXJfc3RhdChuZGVuc2l0eSAqIDAuNjIpKSkgKwogIHN0YXRfZWNkZigpICsKICBsYWJzKHggPSAiIiwgeSA9ICIiKSArCiAgdGhlbWVfcXVvKCkKYGBgCgojIDYgTWFwcwoKUGxvdHRpbmcgZ2Vvc3BhdGlhbCBkYXRhIGlzIGEgY29tbW9uIHZpc3VhbGlzYXRpb24gdGFzaywgYW5kIG9uZSB0aGF0IHJlcXVpcmVzIHNwZWNpYWxpc2VkIHRvb2xzLiBUeXBpY2FsbHkgdGhlIHByb2JsZW0gY2FuIGJlIGRlY29tcG9zZWQgaW50byB0d28gcHJvYmxlbXM6IHVzaW5nIG9uZSBkYXRhIHNvdXJjZSB0byBkcmF3IGEgbWFwLCBhbmQgYWRkaW5nIG1ldGFkYXRhIGZyb20gYW5vdGhlciBpbmZvcm1hdGlvbiBzb3VyY2UgdG8gdGhlIG1hcC4gVGhpcyBjaGFwdGVyIHdpbGwgaGVscCB5b3UgdGFja2xlIGJvdGggcHJvYmxlbXMuCgojIyBCb251cwoKVGhlcmUgYXJlIG5vIGV4ZXJjaXNlcywgc28gbGV0J3MgZHJhdyBhIG1hcCBvZiBNaW5uZXNvdGEgdXNpbmcgcG9seWdvbiBtYXBzIQoKYGBge3J9Cm1hcF9kYXRhKCJjb3VudHkiLCAibWlubmVzb3RhIikgfD4KICBzZWxlY3QobG9uID0gbG9uZywgbGF0LCBncm91cCkgfD4KICBnZ3Bsb3QoYWVzKGxvbiwgbGF0LCBncm91cCA9IGdyb3VwKSkgKwogIGdlb21fcG9seWdvbihmaWxsID0gIndoaXRlIiwgY29sb3VyID0gImdyZXk1MCIpICsKICBjb29yZF9xdWlja21hcCgpICsKICBsYWJzKHggPSAiIiwgeSA9ICIiKSArCiAgdGhlbWVfcXVvKCkKYGBgCgpQb2x5Z29uIG1hcHMgYXJlIHN1cGVyc2VkZWQgYnkgc2ltcGxlIGZlYXR1cmVzIG1hcHMsIHNvIGxldCdzIGRyYXcgaXQgYWdhaW4sIGFkZGluZyBNaW5uZWFwb2xpcywgaW4gcmVkOgoKYGBge3IsIG1lc3NhZ2UgPSBGQUxTRX0KdXNfY291bnRpZXMocmVzb2x1dGlvbiA9ICJoaWdoIiwgc3RhdGVzID0gIk1OIikgfD4KICBnZ3Bsb3QoKSArCiAgZ2VvbV9zZihmaWxsID0gIndoaXRlIikgKwogIGdlb21fc2YoZGF0YSA9IGZpbHRlcih1c19jaXRpZXMoc3RhdGVzID0gIk1OIiksIGNpdHkgPT0gIk1pbm5lYXBvbGlzIiksIGNvbG9yID0gInJlZCIpICsKICBjb29yZF9zZigpICsKICB0aGVtZV9xdW8oKQpgYGAKClNpZGUgbm90ZTogYWx0aG91Z2ggaXQgY3JlYXRlcyBmaWxlcyBpbiBgL3Vzci9sb2NhbGAsIHdoaWNoIGNhdXNlcyBbSG9tZWJyZXddKGh0dHBzOi8vYnJldy5zaCkgdG8gY29tcGxhaW4sIFtgcmlnYF0oaHR0cHM6Ly9naXRodWIuY29tL3ItbGliL3JpZy8pLCAqVGhlIFIgSW5zdGFsbGF0aW9uIE1hbmFnZXIqLCBzdXBwb3J0cyBtdWx0aXBsZSB2ZXJzaW9ucyBvZiBSLCBhbmQgc3VwcG9ydHMgaW5zdGFsbGF0aW9uIG9mIGJpbmFyeSBwYWNrYWdlcywgd2hpY2ggaXMgc3Vic3RhbnRpYWxseSBmYXN0ZXIgYW5kIHJlcXVpcmVzIGZld2VyIGxvY2FsIGRlcGVuZGVuY2llcy4KCiMgNyBOZXR3b3JrcwoKTGlrZSBtYXBzIGFuZCBzcGF0aWFsIGRhdGEsIG5ldHdvcmtzIGFuZCBncmFwaHMgb2NjdXB5IGEgc3BlY2lhbCBwYXJ0IG9mIHRoZSB2aXN1YWxpemF0aW9uIGxhbmRzY2FwZSwgYnV0IHdoZXJlYXMgc3BhdGlhbCBkYXRhIG1vc3RseSBkaWZmZXIgZnJvbSByZWd1bGFyIHBsb3R0aW5nIGluIHRoZWlyIHVzZSBvZiBwcm9qZWN0aW9ucywgbmV0d29ya3MgYnJpbmcgdGhlaXIgb3duIGRhdGEgc3RydWN0dXJlIGFzIHdlbGwgYXMgdGhlaXIgb3duIHZpc3VhbGl6YXRpb24gcGFyYWRpZ21zIHRvIHRoZSB0YWJsZS4gQmVjYXVzZSBvZiB0aGVzZSBjb21wbGljYXRpb25zIG5ldHdvcmtzIGFyZSBub3QgZGlyZWN0bHkgc3VwcG9ydGVkIGluIGdncGxvdDIuIFNldmVyYWwgZWZmb3J0cyBvdmVyIHRoZSB5ZWFycyBoYXZlIHRyaWVkIHRvIGFkZCB0aGlzIG1pc3NpbmcgcGllY2UgYW5kIGluIHRoaXMgY2hhcHRlciB3ZSB3aWxsIHNlZSBob3cgdG8gdXNlIFtgZ2dyYXBoYF0oaHR0cHM6Ly9nZ3JhcGguZGF0YS1pbWFnaW5pc3QuY29tKSBmb3IgbmV0d29yayB2aXN1YWxpemF0aW9uLiBPdGhlciBwYWNrYWdlcyB0aGF0IG9mZmVyIHNvbWUgb2YgdGhlIHNhbWUgZnVuY3Rpb25hbGl0eSBpbmNsdWRlcyBbYGdlb21uZXRgXShodHRwOi8vc2N0eW5lci5naXRodWIuaW8vZ2VvbW5ldC8pLCBbYGdnbmV0d29ya2BdKGh0dHBzOi8vYnJpYXR0ZS5naXRodWIuaW8vZ2duZXR3b3JrLyksIGFuZCBbYEdHYWxseWBdKGh0dHBzOi8vZ2dvYmkuZ2l0aHViLmlvL2dnYWxseS8pIGZvciByZWd1bGFyIG5ldHdvcmsgcGxvdHMsIGFuZCBbYGdndHJlZWBdKGh0dHBzOi8vZ2l0aHViLmNvbS9ZdUxhYi1TTVUvZ2d0cmVlKSBhbmQgW2BnZ2RlbmRyb2BdKGh0dHA6Ly9hbmRyaWUuZ2l0aHViLmlvL2dnZGVuZHJvLykgZm9yIHRyZWUgdmlzdWFsaXphdGlvbiBzcGVjaWZpY2FsbHkuCgojIyBOb3RlcwoKV2hpbGUgZ2dwbG90MiBoYXMgbGltaXRlZCBzdXBwb3J0IGZvciBtYXBzLCBpdCBoYXMgbm8gZGlyZWN0IHN1cHBvcnQgZm9yIG5ldHdvcmtzIGFuZCBncmFwaHMuIGBnZ3JhcGhgIG9mZmVycyBzb21lIGludGVyZXN0aW5nIHZpc3VhbGl6YXRpb25zIHRoYXQgYXJlIHVzZWZ1bCBmb3IgdW5kZXJzdGFuZGluZyBzb2NpYWwgbmV0d29ya3MsIGVzcGVjaWFsbHkgdGhpcyBvbmUsIHdoaWNoIHNob3dzIGhvdyBmcmllbmRzaGlwcyBhbW9uZyBoaWdoIHNjaG9vbCBib3lzIGNoYW5nZWQgZnJvbSAxOTU3IHRvIDE5NTg6CgpgYGB7ciwgd2FybmluZyA9IEZBTFNFfQpoaWdoc2Nob29sIHw+CiAgYXNfdGJsX2dyYXBoKGRpcmVjdGVkID0gRkFMU0UpIHw+CiAgZ2dyYXBoKGxheW91dCA9ICJzdHJlc3MiKSArCiAgZ2VvbV9lZGdlX2xpbmsoKSArCiAgZ2VvbV9ub2RlX3BvaW50KCkgKwogIGZhY2V0X2VkZ2VzKH55ZWFyKQpgYGAKCiMgOCBBbm5vdGF0aW9ucwoKV2hlbiBjb25zdHJ1Y3RpbmcgYSBkYXRhIHZpc3VhbGlzYXRpb24sIGl0IGlzIG9mdGVuIG5lY2Vzc2FyeSB0byBtYWtlIGFubm90YXRpb25zIHRvCnRoZSBkYXRhIGRpc3BsYXllZC4gQ29uY2VwdHVhbGx5LCBhbiBhbm5vdGF0aW9uIHN1cHBsaWVzICptZXRhZGF0YSogZm9yIHRoZSBwbG90OiB0aGF0IGlzLAppdCBwcm92aWRlcyBhZGRpdGlvbmFsIGluZm9ybWF0aW9uIGFib3V0IHRoZSBkYXRhIGJlaW5nIGRpc3BsYXllZC4gRnJvbSBhIHByYWN0aWNhbCAKc3RhbmRwb2ludCwgaG93ZXZlciwgbWV0YWRhdGEgaXMganVzdCBhbm90aGVyIGZvcm0gb2YgZGF0YS4gQmVjYXVzZSBvZiB0aGlzLCB0aGUgCmFubm90YXRpb24gdG9vbHMgaW4gZ2dwbG90MiByZXVzZSB0aGUgc2FtZSBnZW9tcyB0aGF0IGFyZSB1c2VkIHRvIGNyZWF0ZSBvdGhlciBwbG90cy4gCkhvd2V2ZXIsIHRvIG1lZXQgdGhlIHNwZWNpZmljIG5lZWRzIHRoYXQgdXNlcnMgb2Z0ZW4gaGF2ZSB3aGVuIGFubm90YXRpbmcgcGxvdHMsIHRoZXJlCmFyZSBzb21lIGhlbHBlciBmdW5jdGlvbnMgaW4gZ2dwbG90MiBpdHNlbGYsIGFuZCBhIG51bWJlciBvZiBvdGhlciBwYWNrYWdlcyBoYXZlIApleHRlbmRlZCBnZ3Bsb3QyIGluIHdheXMgeW91IG1heSBmaW5kIGhlbHBmdWwuCgojIyBOb3RlcwoKQW4gaW1wb3J0YW50IGRpc3RpbmN0aW9uIG9uIGF4aXMgbGFiZWxzOgoKPiBUaGVyZSBhcmUgdHdvIHdheXMgdG8gcmVtb3ZlIHRoZSBheGlzIGxhYmVsLiBTZXR0aW5nIGBsYWJzKHggPSAiIilgIG9taXRzIHRoZSBsYWJlbCBidXQgc3RpbGwgYWxsb2NhdGVzIHNwYWNlOyBzZXR0aW5nIGBsYWJzKHggPSBOVUxMKWAgcmVtb3ZlcyB0aGUgbGFiZWwgYW5kIGl0cyBzcGFjZS4gCgpDb25zaWRlciBhZG9wdGluZyBbYHNob3d0ZXh0YF0oaHR0cHM6Ly9naXRodWIuY29tL3lpeHVhbi9zaG93dGV4dCkgZm9yIG5vbi1zdGFuZGFyZCBmb250cywgd2l0aCBjYXZlYXRzIGZvciB1c2luZyBpdCBpbiBbUiBNYXJrZG93bl0oaHR0cHM6Ly9zdGF0ci5tZS8yMDE0LzA3L3Nob3d0ZXh0LXdpdGgta25pdHIvKS4KCk9uZSBvZiB0aGUgbW9zdCB1c2VmdWwgYWxpZ25tZW50cyBpcyDigJxpbndhcmTigJ0uIEl0IGFsaWducyB0ZXh0IHRvd2FyZHMgdGhlIG1pZGRsZSBvZiB0aGUgcGxvdCwgd2hpY2ggZW5zdXJlcyB0aGF0IGxhYmVscyByZW1haW4gd2l0aGluIHRoZSBwbG90IGxpbWl0czoKCmBgYHtyfQpkZiA8LSBkYXRhLmZyYW1lKAogIHggPSBjKDEsIDEsIDIsIDIsIDEuNSksCiAgeSA9IGMoMSwgMiwgMSwgMiwgMS41KSwKICB0ZXh0ID0gYygKICAgICJib3R0b20tbGVmdCIsICJ0b3AtbGVmdCIsCiAgICAiYm90dG9tLXJpZ2h0IiwgInRvcC1yaWdodCIsICJjZW50ZXIiCiAgKSwgc3RyaW5nc0FzRmFjdG9ycyA9IEZBTFNFCikKZ2dwbG90KGRmLCBhZXMoeCwgeSkpICsKICBnZW9tX3RleHQoYWVzKGxhYmVsID0gdGV4dCkpCmdncGxvdChkZiwgYWVzKHgsIHkpKSArCiAgZ2VvbV90ZXh0KGFlcyhsYWJlbCA9IHRleHQpLCB2anVzdCA9ICJpbndhcmQiLCBoanVzdCA9ICJpbndhcmQiKQpgYGAKCiogICBUaGUgZm9udCBzaXplIGlzIGNvbnRyb2xsZWQgYnkgdGhlIGBzaXplYCBhZXN0aGV0aWMuIFVubGlrZSBtb3N0IHRvb2xzLCAKICAgIGdncGxvdDIgc3BlY2lmaWVzIHRoZSBzaXplIGluIG1pbGxpbWV0ZXJzIChtbSksIHJhdGhlciB0aGFuIHRoZSB1c3VhbCAKICAgIHBvaW50cyAocHRzKS4gVGhlIHJlYXNvbiBmb3IgdGhpcyBjaG9pY2UgaXMgdGhhdCBpdCBtYWtlcyBpdCB0aGUgdW5pdHMgZm9yCiAgICBmb250IHNpemVzIGNvbnNpc3RlbnQgd2l0aCBob3cgb3RoZXIgc2l6ZXMgYXJlIHNwZWNpZmllZCBpbiBnZ3Bsb3QyLiAKICAgIChUaGVyZSBhcmUgNzIuMjcgcHRzIGluIGEgaW5jaCwgc28gdG8gY29udmVydCBmcm9tIHBvaW50cyB0byBtbSwganVzdCAKICAgIG11bHRpcGx5IGJ5IDcyLjI3IC8gMjUuNCkuCgpMZXQncyBhc3NpZ24gYmxhbWUgdG8gdW5lbXBsb3ltZW50IQoKYGBge3J9CnByZXNpZGVudGlhbCA8LSBzdWJzZXQocHJlc2lkZW50aWFsLCBzdGFydCA+IGVjb25vbWljcyRkYXRlWzFdICYgc3RhcnQgPCBtYXgoZWNvbm9taWNzJGRhdGUpKQoKZ2dwbG90KGVjb25vbWljcykgKwogIGdlb21fcmVjdCgKICAgIGFlcyh4bWluID0gc3RhcnQsIHhtYXggPSBlbmQsIGZpbGwgPSBwYXJ0eSksCiAgICB5bWluID0gLUluZiwgeW1heCA9IEluZiwgYWxwaGEgPSAwLjI1LAogICAgZGF0YSA9IHByZXNpZGVudGlhbAogICkgKwogIGdlb21fdmxpbmUoCiAgICBhZXMoeGludGVyY2VwdCA9IGFzLm51bWVyaWMoc3RhcnQpKSwKICAgIGRhdGEgPSBwcmVzaWRlbnRpYWwsCiAgICBjb2xvdXIgPSAiZ3JleTUwIiwgYWxwaGEgPSAwLjUKICApICsKICBnZW9tX3RleHQoCiAgICAjIHRoZW1lcyBvbmx5IGFmZmVjdCB0aGUgbm9uLWRhdGEgY29tcG9uZW50cyBvZiB0aGUgcGxvdCwgc2VlOgogICAgIyAgIGh0dHBzOi8vZ2l0aHViLmNvbS90aWR5dmVyc2UvZ2dwbG90Mi9pc3N1ZXMvMTg1OQogICAgYWVzKHggPSBzdGFydCwgeSA9IDAuMDAwNSwgbGFiZWwgPSBuYW1lLCBmYW1pbHkgPSAiTGF0byIpLAogICAgZGF0YSA9IHByZXNpZGVudGlhbCwKICAgIHNpemUgPSAzLCB2anVzdCA9IDAsIGhqdXN0ID0gMCwgbnVkZ2VfeCA9IDc1CiAgKSArCiAgZ2VvbV9saW5lKGFlcyhkYXRlLCB1bmVtcGxveSAvIHBvcCkpICsKICBzY2FsZV9maWxsX21hbnVhbCh2YWx1ZXMgPSBjKCJibHVlIiwgInJlZCIpKSArCiAgc2NhbGVfeV9jb250aW51b3VzKGxhYmVscyA9IHNjYWxlczo6cGVyY2VudCwgbGltaXRzID0gYygwLCBOQSkpICsKICBzY2FsZV94X2RhdGUoYnJlYWtzID0gcHJlc2lkZW50aWFsJHN0YXJ0LCBkYXRlX2xhYmVscyA9ICIlWSIpICsKICBndWlkZXMoZmlsbCA9ICJub25lIikgKwogIGxhYnModGl0bGUgPSAiVW5lbXBsb3ltZW50IHJhdGUgYnkgcHJlc2lkZW50aWFsIHRlcm0iLCB4ID0gTlVMTCwgeSA9IE5VTEwpICsKICB0aGVtZV9xdW8obWlub3IueSA9IEZBTFNFLCB4ID0gRkFMU0UpCmBgYAoKIyA5IEFycmFuZ2luZyBwbG90cwoKVGhlIGdyYW1tYXIgcHJlc2VudGVkIGluIGdncGxvdDIgaXMgY29uY2VybmVkIHdpdGggY3JlYXRpbmcgc2luZ2xlIHBsb3RzLiBXaGlsZSB0aGUgZmFjZXRpbmcgc3lzdGVtIHByb3ZpZGVzIHRoZSBtZWFucyB0byBwcm9kdWNlIHNldmVyYWwgc3VicGxvdHMgYWxsIG9mIHRoZXNlIGFyZSBwYXJ0IG9mIHRoZSBzYW1lIG1haW4gdmlzdWFsaXphdGlvbiwgc2hhcmluZyBsYXllcnMsIGRhdGEsIGFuZCBzY2FsZXMuIEhvd2V2ZXIsIGl0IGlzIG9mdGVuIG5lY2Vzc2FyeSB0byB1c2UgbXVsdGlwbGUgZGlzcGFyYXRlIHBsb3RzIHRvIHRlbGwgYSBzdG9yeSBvciBtYWtlIGFuIGFyZ3VtZW50LiBUaGVzZSBjYW4gb2YgY291cnNlIGJlIGNyZWF0ZWQgaW5kaXZpZHVhbGx5IGFuZCBhc3NlbWJsZWQgaW4gYSBsYXlvdXQgcHJvZ3JhbSwgYnV0IGl0IGlzIGJlbmVmaWNpYWwgdG8gZG8gdGhpcyBpbiBjb2RlIHRvIGF2b2lkIHRpbWUgY29uc3VtaW5nIGFuZCBub24tcmVwcm9kdWNpYmxlIG1hbnVhbCBsYWJvci4gQSByYW5nZSBvZiBwYWNrYWdlcyBoYXZlIHJpc2VuIHRvIHRoZSBvY2Nhc2lvbiBhbmQgcHJvdmlkZSBkaWZmZXJlbnQgYXBwcm9hY2hlcyB0byBhcnJhbmdpbmcgc2VwYXJhdGUgcGxvdHMuIFdoaWxlIHRoaXMgY2hhcHRlciB3aWxsIGZvY3VzIG9uIHRoZSBgcGF0Y2h3b3JrYCBwYWNrYWdlIHlvdSBtYXkgYWxzbyBmaW5kIHNvbWUgb2YgdGhlIHNhbWUgZnVuY3Rpb25hbGl0aWVzIGluIHRoZSBgY293cGxvdGAsIGBncmlkRXh0cmFgIGFuZCBgZ2dwdWJyYCBwYWNrYWdlcy4K</div>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeSourceEmbed("ggplot2-2.Rmd");
  window.initializeCodeFolding("show" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = false;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
