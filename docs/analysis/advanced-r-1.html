<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.552">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="John Benninghoff">
<meta name="dcterms.date" content="2022-06-12">

<title>rtraining - Advanced R (Foundations)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../analysis/advanced-r-2.html" rel="next">
<link href="../analysis/cond-prob.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">rtraining</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../changelog.html"> 
<span class="menu-text">Changelog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../TODO.html"> 
<span class="menu-text">TODO</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools tools-wide">
    <a href="../index.xml" title="" class="quarto-navigation-tool px-1" aria-label="rss"><i class="bi bi-rss"></i></a>
    <a href="https://github.com/jabenninghoff/rtraining" title="" class="quarto-navigation-tool px-1" aria-label="github"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../analysis/advanced-r-1.html">Advanced R (Foundations)</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/r-books.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R Books</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/r-training-log.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R Training Log</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/r-setup-log.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R Setup Log</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/FaultTree.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">FaultTree.widget Test</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/using-Rcpp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using Rcpp</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/cond-prob.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Conditional Probability</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/advanced-r-1.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Advanced R (Foundations)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/advanced-r-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced R (Functional programming)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/advanced-r-3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced R (Object-oriented programming)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/advanced-r-4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced R (Metaprogramming)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/ggplot2-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ggplot2 (Getting started)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/ggplot2-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ggplot2 (Layers)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/ggplot2-3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ggplot2 (Scales)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/ggplot2-4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ggplot2 (Grammar)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/ggplot2-5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ggplot2 (Extending)</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#names-and-values" id="toc-names-and-values" class="nav-link" data-scroll-target="#names-and-values">2 Names and values</a>
  <ul class="collapse">
  <li><a href="#quiz" id="toc-quiz" class="nav-link" data-scroll-target="#quiz">2 Quiz</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">2.2.2 Exercises</a></li>
  <li><a href="#exercises-1" id="toc-exercises-1" class="nav-link" data-scroll-target="#exercises-1">2.3.6 Exercises</a></li>
  <li><a href="#exercises-2" id="toc-exercises-2" class="nav-link" data-scroll-target="#exercises-2">2.4.1 Exercises</a></li>
  <li><a href="#exercises-3" id="toc-exercises-3" class="nav-link" data-scroll-target="#exercises-3">2.5.3 Exercises</a></li>
  </ul></li>
  <li><a href="#vectors" id="toc-vectors" class="nav-link" data-scroll-target="#vectors">3 Vectors</a>
  <ul class="collapse">
  <li><a href="#exercises-4" id="toc-exercises-4" class="nav-link" data-scroll-target="#exercises-4">3.2.5 Exercises</a></li>
  <li><a href="#exercises-5" id="toc-exercises-5" class="nav-link" data-scroll-target="#exercises-5">3.3.4 Exercises</a></li>
  <li><a href="#exercises-6" id="toc-exercises-6" class="nav-link" data-scroll-target="#exercises-6">3.4.5 Exercises</a></li>
  <li><a href="#exercises-7" id="toc-exercises-7" class="nav-link" data-scroll-target="#exercises-7">3.5.4 Exercises</a></li>
  <li><a href="#exercises-8" id="toc-exercises-8" class="nav-link" data-scroll-target="#exercises-8">3.6.8 Exercises</a></li>
  </ul></li>
  <li><a href="#subsetting" id="toc-subsetting" class="nav-link" data-scroll-target="#subsetting">4 Subsetting</a>
  <ul class="collapse">
  <li><a href="#exercises-9" id="toc-exercises-9" class="nav-link" data-scroll-target="#exercises-9">4.2.6 Exercises</a></li>
  <li><a href="#exercises-10" id="toc-exercises-10" class="nav-link" data-scroll-target="#exercises-10">4.3.5 Exercises</a></li>
  <li><a href="#exercises-11" id="toc-exercises-11" class="nav-link" data-scroll-target="#exercises-11">4.5.9 Exercises</a></li>
  </ul></li>
  <li><a href="#control-flow" id="toc-control-flow" class="nav-link" data-scroll-target="#control-flow">5 Control flow</a>
  <ul class="collapse">
  <li><a href="#exercises-12" id="toc-exercises-12" class="nav-link" data-scroll-target="#exercises-12">5.2.4 Exercises</a></li>
  <li><a href="#exercises-13" id="toc-exercises-13" class="nav-link" data-scroll-target="#exercises-13">5.3.3 Exercises</a></li>
  </ul></li>
  <li><a href="#functions" id="toc-functions" class="nav-link" data-scroll-target="#functions">6 Functions</a>
  <ul class="collapse">
  <li><a href="#quiz-1" id="toc-quiz-1" class="nav-link" data-scroll-target="#quiz-1">6 Quiz</a></li>
  <li><a href="#exercises-14" id="toc-exercises-14" class="nav-link" data-scroll-target="#exercises-14">6.2.5 Exercises</a></li>
  <li><a href="#exercises-15" id="toc-exercises-15" class="nav-link" data-scroll-target="#exercises-15">6.4.5 Exercises</a></li>
  <li><a href="#exercises-16" id="toc-exercises-16" class="nav-link" data-scroll-target="#exercises-16">6.5.4 Exercises</a></li>
  <li><a href="#exercises-17" id="toc-exercises-17" class="nav-link" data-scroll-target="#exercises-17">6.6.1 Exercises</a></li>
  <li><a href="#exercises-18" id="toc-exercises-18" class="nav-link" data-scroll-target="#exercises-18">6.7.5 Exercises</a></li>
  <li><a href="#exercises-19" id="toc-exercises-19" class="nav-link" data-scroll-target="#exercises-19">6.8.6 Exercises</a></li>
  </ul></li>
  <li><a href="#environments" id="toc-environments" class="nav-link" data-scroll-target="#environments">7 Environments</a>
  <ul class="collapse">
  <li><a href="#exercises-20" id="toc-exercises-20" class="nav-link" data-scroll-target="#exercises-20">7.2.7 Exercises</a></li>
  <li><a href="#exercises-21" id="toc-exercises-21" class="nav-link" data-scroll-target="#exercises-21">7.3.1 Exercises</a></li>
  <li><a href="#exercises-22" id="toc-exercises-22" class="nav-link" data-scroll-target="#exercises-22">7.4.5 Exercises</a></li>
  <li><a href="#exercises-23" id="toc-exercises-23" class="nav-link" data-scroll-target="#exercises-23">7.5.5 Exercises</a></li>
  </ul></li>
  <li><a href="#conditions" id="toc-conditions" class="nav-link" data-scroll-target="#conditions">8 Conditions</a>
  <ul class="collapse">
  <li><a href="#exercises-24" id="toc-exercises-24" class="nav-link" data-scroll-target="#exercises-24">8.2.4 Exercises</a></li>
  <li><a href="#exercises-25" id="toc-exercises-25" class="nav-link" data-scroll-target="#exercises-25">8.4.5 Exercises</a></li>
  <li><a href="#exercises-26" id="toc-exercises-26" class="nav-link" data-scroll-target="#exercises-26">8.5.4 Exercises</a></li>
  <li><a href="#exercises-27" id="toc-exercises-27" class="nav-link" data-scroll-target="#exercises-27">8.6.6 Exercises</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/jabenninghoff/rtraining/blob/main/analysis/advanced-r-1.Rmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/jabenninghoff/rtraining/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Advanced R (Foundations)</h1>
  <div class="quarto-categories">
    <div class="quarto-category">exercises</div>
    <div class="quarto-category">advanced-r</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>John Benninghoff </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 12, 2022</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">July 31, 2022</p>
    </div>
  </div>
    
  </div>
  


</header>


<p>Workbook for completing quizzes and exercises from the “Foundations” chapters of <a href="https://adv-r.hadley.nz/index.html">Advanced R</a>, second edition, with comparisons to solutions from <a href="https://advanced-r-solutions.rbind.io">Advanced R Solutions</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lobstr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bench)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rlang)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># from https://github.com/hadley/adv-r/blob/master/common.R</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">comment =</span> <span class="st">"#&gt;"</span>,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">fig.align =</span> <span class="st">"center"</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>knit_hooks<span class="sc">$</span><span class="fu">set</span>(</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">small_mar =</span> <span class="cf">function</span>(before, options, envir) {</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (before) {</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">4.1</span>, <span class="fl">4.1</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>))</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>This workbook includes answers and solutions to the quizzes and exercises from <a href="https://adv-r.hadley.nz/index.html">Advanced R</a> and <a href="https://advanced-r-solutions.rbind.io">Advanced R Solutions</a>, organized by chapter. It includes excerpts from both books, copied here.</p>
<p><strong>WARNING, SPOILERS!</strong> If you haven’t read Advanced R and intend to complete the quizzes and exercises, don’t read this notebook. It contains my (potentially wrong) answers to both.</p>
</section>
<section id="names-and-values" class="level2">
<h2 class="anchored" data-anchor-id="names-and-values">2 Names and values</h2>
<p>In R, it is important to understand the distinction between an object and its name. Doing so will help you:</p>
<ul>
<li>More accurately predict the performance and memory usage of your code.</li>
<li>Write faster code by avoiding accidental copies, a major source of slow code.</li>
<li>Better understand R’s functional programming tools.</li>
</ul>
<p>The goal of this chapter is to help you understand the distinction between names and values, and when R will copy an object.</p>
<section id="quiz" class="level3">
<h3 class="anchored" data-anchor-id="quiz">2 Quiz</h3>
<ol type="1">
<li>Given the following data frame, how do I create a new column called “3” that contains the sum of <code>1</code> and <code>2</code>? You may only use <code>$</code>, not <code>[[</code>. What makes <code>1</code>, <code>2</code>, and <code>3</code> challenging as variable names?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">runif</span>(<span class="dv">3</span>), <span class="fu">runif</span>(<span class="dv">3</span>))</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Answer: use the following code.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df, df<span class="sc">$</span><span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="sc">+</span> df<span class="sc">$</span><span class="st">`</span><span class="at">2</span><span class="st">`</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(df2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Using numbers as names is problematic due to them being interpreted as numeric constants by default.</p>
<hr>
<ol start="2" type="1">
<li>In the following code, how much memory does <code>y</code> occupy?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="fl">1e6</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">list</span>(x, x, x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Answer: 3 times the size of x, 24 MB. Note: this is incorrect, as shown by <code>obj_size</code> and <code>obj_addr</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">obj_size</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 8.00 MB</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">obj_size</span>(y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 8.00 MB</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">obj_addr</span>(y[[<span class="dv">1</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "0x138e20000"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">obj_addr</span>(y[[<span class="dv">2</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "0x138e20000"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">obj_addr</span>(y[[<span class="dv">3</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "0x138e20000"</code></pre>
</div>
</div>
<hr>
<ol start="3" type="1">
<li>On which line does <code>a</code> get copied in the following example?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">2</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">obj_addr</span>(a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "0x10ceeccf8"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> a</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">obj_addr</span>(b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "0x10ceeccf8"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>b[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">obj_addr</span>(b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "0x10cfcf248"</code></pre>
</div>
</div>
<p>Answer: the third line (copy-on-write). [copy-on-modify]</p>
</section>
<section id="exercises" class="level3">
<h3 class="anchored" data-anchor-id="exercises">2.2.2 Exercises</h3>
<ol type="1">
<li>Explain the relationship between <code>a</code>, <code>b</code>, <code>c</code> and <code>d</code> in the following code:</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> a</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> b</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Answer: a, b, and c all point to the same object (1:10). d points to an identical object at a different address.</p>
<p>AR Solutions: <code>a</code>, <code>b</code>, and <code>c</code> point to the same object (with the same address in memory). This object has the value <code>1:10</code>. <code>d</code> points to a different object with the same value.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">obj_addr</span>(a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "0x10caa6668"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">obj_addr</span>(b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "0x10caa6668"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">obj_addr</span>(c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "0x10caa6668"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">obj_addr</span>(d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "0x10cb9f388"</code></pre>
</div>
</div>
<hr>
<ol start="2" type="1">
<li>The following code accesses the mean function in multiple ways. Do they all point to the same underlying function object? Verify this with <code>lobstr::obj_addr()</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>mean</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>base<span class="sc">::</span>mean</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="fu">get</span>(<span class="st">"mean"</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="fu">evalq</span>(mean)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="fu">match.fun</span>(<span class="st">"mean"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Check the <code>obj_addr</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">obj_addr</span>(mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "0x133fc50a8"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">obj_addr</span>(base<span class="sc">::</span>mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "0x133fc50a8"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">obj_addr</span>(<span class="fu">get</span>(<span class="st">"mean"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "0x133fc50a8"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">obj_addr</span>(<span class="fu">evalq</span>(mean))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "0x133fc50a8"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">obj_addr</span>(<span class="fu">match.fun</span>(<span class="st">"mean"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "0x133fc50a8"</code></pre>
</div>
</div>
<p>Answer: they do.</p>
<p>AR Solutions: Yes, they point to the same object. We confirm this by inspecting the address of the underlying function object.</p>
<hr>
<ol start="3" type="1">
<li>By default, base R data import functions, like <code>read.csv()</code>, will automatically convert non-syntactic names to syntactic ones. Why might this be problematic? What option allows you to suppress this behaviour?</li>
</ol>
<p>Answer: this could introduce problematic names, like <code>1</code>. Setting <code>check.names = FALSE</code> suppresses this behavior.</p>
<p>AR Solutions: Column names are often data, and the underlying <code>make.names()</code> transformation is non-invertible, so the default behaviour corrupts data. To avoid this, set <code>check.names = FALSE</code>.</p>
<hr>
<ol start="4" type="1">
<li>What rules does <code>make.names()</code> use to convert non-syntactic names into syntactic ones?</li>
</ol>
<p>Answer: from <code>?make.names</code>:</p>
<blockquote class="blockquote">
<p>The character “X” is prepended if necessary. All invalid characters are translated to “.”. A missing value is translated to “NA”. Names which match R keywords have a dot appended to them. Duplicated values are altered by make.unique.</p>
</blockquote>
<p>AR Solutions: A valid name must start with a letter or a dot (not followed by a number) and may further contain numbers and underscores (<code>"_"</code>s are allowed since R version 1.9.0).</p>
<p>Three main mechanisms ensure syntactically valid names (see <code>?make.names</code>):</p>
<ol type="1">
<li>Names that do not start with a letter or a dot will be prepended with an <code>"X"</code>. The same holds for names that begin with a dot followed by a number.</li>
<li>Additionally, non-valid characters are replaced by a dot.</li>
<li>Reserved R keywords (see <code>?reserved</code>) are suffixed by a dot.</li>
</ol>
<p>Interestingly, some of these transformations are influenced by the current locale. From <code>?make.names</code>:</p>
<blockquote class="blockquote">
<p>The definition of a letter depends on the current locale, but only ASCII digits are considered to be digits.</p>
</blockquote>
<hr>
<ol start="5" type="1">
<li>I slightly simplified the rules that govern syntactic names. Why is <code>.123e1</code> not a syntactic name? Read <code>?make.names</code> for the full details.</li>
</ol>
<p>Answer: from <code>?make.names</code>:</p>
<blockquote class="blockquote">
<p>A syntactically valid name consists of letters, numbers and the dot or underline characters and starts with a letter or the dot not followed by a number. Names such as “.2way” are not valid, and neither are the reserved words.</p>
</blockquote>
<p>AR Solutions: <code>.123e1</code> is not a syntactic name, because it starts with one dot which is followed by a number. This makes it a double, <code>1.23</code>.</p>
<hr>
</section>
<section id="exercises-1" class="level3">
<h3 class="anchored" data-anchor-id="exercises-1">2.3.6 Exercises</h3>
<ol type="1">
<li>Why is <code>tracemem(1:10)</code> not useful?</li>
</ol>
<p>Answer: this is tracing an ‘immutable’ object which will always have the same address.</p>
<p>AR Solutions: When <code>1:10</code> is called an object with an address in memory is created, but it is not bound to a name. Therefore, the object cannot be called or manipulated from R. As no copies will be made, it is not useful to track the object for copying.</p>
<hr>
<ol start="2" type="1">
<li>Explain why <code>tracemem()</code> shows two copies when you run this code. Hint: carefully look at the difference between this code and the code shown earlier in the section.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">3</span>L)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tracemem</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "&lt;0x10dbb74c8&gt;"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>x[[<span class="dv">3</span>]] <span class="ot">&lt;-</span> <span class="dv">4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; tracemem[0x10dbb74c8 -&gt; 0x10dbba8c8]: eval eval eval_with_user_handlers withVisible withCallingHandlers handle timing_fn evaluate_call &lt;Anonymous&gt; evaluate in_dir in_input_dir eng_r block_exec call_block process_group.block process_group withCallingHandlers withCallingHandlers handle_error process_file &lt;Anonymous&gt; &lt;Anonymous&gt; execute .main 
#&gt; tracemem[0x10dbba8c8 -&gt; 0x10dc11578]: eval eval eval_with_user_handlers withVisible withCallingHandlers handle timing_fn evaluate_call &lt;Anonymous&gt; evaluate in_dir in_input_dir eng_r block_exec call_block process_group.block process_group withCallingHandlers withCallingHandlers handle_error process_file &lt;Anonymous&gt; &lt;Anonymous&gt; execute .main</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">untracemem</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Answer: unclear. The behavior in R 4.2.0 seems to have changed, since this code shows two copies:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tracemem</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "&lt;0x135da3f98&gt;"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> x</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>y[[<span class="dv">3</span>]] <span class="ot">&lt;-</span> <span class="dv">4</span>L</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; tracemem[0x135da3f98 -&gt; 0x135c7cd58]: eval eval eval_with_user_handlers withVisible withCallingHandlers handle timing_fn evaluate_call &lt;Anonymous&gt; evaluate in_dir in_input_dir eng_r block_exec call_block process_group.block process_group withCallingHandlers withCallingHandlers handle_error process_file &lt;Anonymous&gt; &lt;Anonymous&gt; execute .main</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>y[[<span class="dv">3</span>]] <span class="ot">&lt;-</span> <span class="dv">5</span>L</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">untracemem</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>AR Solutions: Initially the vector <code>x</code> has integer type. The replacement call assigns a double to the third element of <code>x</code>, which triggers copy-on-modify.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">3</span>L)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tracemem</span>(x)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;0x66a4a70&gt;</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>x[[<span class="dv">3</span>]] <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; tracemem[0x55eec7b3af38 -&gt; 0x55eec774cc18]:</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can avoid the copy by sub-assigning an integer instead of a double:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">3</span>L)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tracemem</span>(x)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;0x55eec6940ae0&gt;</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>x[[<span class="dv">3</span>]] <span class="ot">&lt;-</span> <span class="dv">4</span>L</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Please be aware that running this code in RStudio will result in additional copies because of the reference from the environment pane.</p>
<hr>
<ol start="3" type="1">
<li>Sketch out the relationship between the following objects:</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">list</span>(a, a)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="fu">list</span>(b, a, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"first object"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "first object"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">obj_addr</span>(a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "0x133215c40"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">obj_addr</span>(b[[<span class="dv">1</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "0x133215c40"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">obj_addr</span>(b[[<span class="dv">2</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "0x133215c40"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">obj_addr</span>(c[[<span class="dv">2</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "0x133215c40"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"second object"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "second object"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">obj_addr</span>(b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "0x134142948"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">obj_addr</span>(c[[<span class="dv">1</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "0x134142948"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"third object"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "third object"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">obj_addr</span>(c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "0x1339a29d8"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"fourth object (?)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "fourth object (?)"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">obj_addr</span>(c[[<span class="dv">3</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "0x1338089b0"</code></pre>
</div>
</div>
<p>Answer: four different objects with multiple names.</p>
<p>AR Solutions: <code>a</code> contains a reference to an address with the value <code>1:10</code>. <code>b</code> contains a list of two references to the same address as <code>a</code>. <code>c</code> contains a list of <code>b</code> (containing two references to <code>a</code>), <code>a</code> (containing the same reference again) and a reference pointing to a different address containing the same value (<code>1:10</code>).</p>
<hr>
<ol start="4" type="1">
<li>What happens when you run this code? Draw a picture.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>x[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> x</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ref</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; █ [1:0x11256ba88] &lt;list&gt; 
#&gt; ├─[2:0x10c1ab308] &lt;int&gt; 
#&gt; └─█ [3:0x10c1b5e40] &lt;list&gt; 
#&gt;   └─[2:0x10c1ab308]</code></pre>
</div>
</div>
<p>Initially x is a list of one element, an int vector 1:10. Then a second list element is added, which points to the original int vector.</p>
<p>AR Solutions: The initial reference tree of <code>x</code> shows that the name <code>x</code> binds to a list object. This object contains a reference to the integer vector <code>1:10</code>. When <code>x</code> is assigned to an element of itself, copy-on-modify takes place and the list is copied to a new address in memory. The list object previously bound to <code>x</code> is now referenced in the newly created list object. It is no longer bound to a name. The integer vector is referenced twice.</p>
<hr>
</section>
<section id="exercises-2" class="level3">
<h3 class="anchored" data-anchor-id="exercises-2">2.4.1 Exercises</h3>
<ol type="1">
<li>In the following example, why are <code>object.size(y)</code> and <code>obj_size(y)</code> so radically different? Consult the documentation of <code>object.size()</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">list</span>(<span class="fu">runif</span>(<span class="fl">1e4</span>)), <span class="dv">100</span>)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="fu">object.size</span>(y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 8005648 bytes</code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">obj_size</span>(y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 80.90 kB</code></pre>
</div>
</div>
<p>Answer: <code>object.size()</code> “does not detect if elements of a list are shared”, which is the case here. That is, it does not detect the list has been replicated 100 times, and overestimates by a factor of 100 compared to <code>object_size()</code>.</p>
<p>AR Solutions: <code>object.size()</code> doesn’t account for shared elements within lists. Therefore, the results differ by a factor of ~ 100.</p>
<hr>
<ol start="2" type="1">
<li>Take the following list. Why is its size somewhat misleading?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>funs <span class="ot">&lt;-</span> <span class="fu">list</span>(mean, sd, var)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">obj_size</span>(funs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 17.55 kB</code></pre>
</div>
</div>
<p>Answer: it doesn’t seem misleading to me, but the list includes the function objects, not the return values. Also, it calculates the size discarding the overlap between the functions. Per the code below, there is some:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">obj_size</span>(mean) <span class="sc">+</span> <span class="fu">obj_size</span>(sd) <span class="sc">+</span> <span class="fu">obj_size</span>(var)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 18.08 kB</code></pre>
</div>
</div>
<p>AR Solutions: All three functions are built-in to R as part of the <code>{base}</code> and <code>{stats}</code> packages and hence always available. So, what does it mean to measure the size of something that’s already included in R?</p>
<p>(There’s typically a more general question about what you want to know when you ask for the size of something — do you want to know how much data you’d need to send to communicate the object to someone else (e.g.&nbsp;serialise it), or do you want to know how much memory you’d free if you deleted it?)</p>
<hr>
<ol start="3" type="1">
<li>Predict the output of the following code:</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="fl">1e6</span>)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="fu">obj_size</span>(a) <span class="co"># 8,000,048 B ~ 8MB</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 8.00 MB</code></pre>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># correct: from example above, runif(1e6) ~= 8MB</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">list</span>(a, a)</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a><span class="fu">obj_size</span>(b) <span class="co"># slightly larger than obj_size(a)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 8.00 MB</code></pre>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># correct: two lists containing numeric vectors</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="fu">obj_size</span>(a, b) <span class="co"># slightly larger than obj_size(b)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 8.00 MB</code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># wrong: a is entirely contained within b</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>b[[<span class="dv">1</span>]][[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="fu">obj_size</span>(b) <span class="co"># copy of b, same size</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 16.00 MB</code></pre>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># wrong: double, since R copies an entire column, this adds the size of runif(1e6)</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="fu">obj_size</span>(a, b) <span class="co"># still mostly overlaps, slightly larger than previous obj_size(a, b)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 16.00 MB</code></pre>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># wrong: a is still entirely contained with b</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>b[[<span class="dv">2</span>]][[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a><span class="fu">obj_size</span>(b) <span class="co"># copy of b, same size</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 16.00 MB</code></pre>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># wrong: same size since it's still 2 numeric vectors of 1e6 length</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="fu">obj_size</span>(a, b) <span class="co"># still mostly overlaps, slightly larger than previous obj_size(a, b)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 24.00 MB</code></pre>
</div>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># wrong: there is no longer any overlap, so the size of obj_size(a, b) = obj_size(a) = obj_size(b)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Answer: answers inline.</p>
<p>AR Solutions:</p>
<p><code>a &lt;- runif(1e6)</code>:</p>
<ul>
<li>In R (on most platforms) a length-0 vector has 48 bytes of overhead.</li>
<li>A single double takes up an additional 8 bytes of memory.</li>
<li>So, a 1 million double should take up 8,000,048 bytes.</li>
</ul>
<p>For <code>b &lt;- list(a, a)</code> both list elements contain references to the same memory address. Therefore, no additional memory is required for the second list element. The list itself requires 64 bytes, 48 bytes for an empty list and 8 bytes for each element (<code>obj_size(vector("list", 2))</code>). This lets us predict 8,000,048 B + 64 B = 8,000,112 B.</p>
<p><code>b[[1]][[1]] &lt;- 10</code>: When we modify the first element of <code>b[[1]]</code> copy-on-modify occurs. Both elements will still have the same size (8,000,040 B), but the first one gets a new address in memory. As <code>b</code>’s elements don’t share references anymore, its object size adds up to the sum of the elements and the length-2 list: 8,000,048 B + 8,000,048 B + 64 B = 16,000,160 B (16 MB). The second element of <code>b</code> still references the same address as <code>a</code>, so the combined size of <code>a</code> and <code>b</code> is the same as <code>b</code>.</p>
<p><code>b[[2]][[1]] &lt;- 10</code>: When we modify the second element of <code>b</code>, this element will also point to a new memory address. This does not affect the size of the list. However, as <code>b</code> doesn’t share references with <code>a</code> anymore, the memory usage of the combined objects increases.</p>
<hr>
</section>
<section id="exercises-3" class="level3">
<h3 class="anchored" data-anchor-id="exercises-3">2.5.3 Exercises</h3>
<ol type="1">
<li>Explain why the following code doesn’t create a circular list.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>x[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Answer: the name x is assigned to the empty list, and then the first element of x is mapped to the object that x points to, the empty list.</p>
<p>AR Solutions: In this situation copy-on-modify prevents the creation of a circular list. Let us step through the details:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">list</span>() <span class="co"># creates initial object</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="fu">obj_addr</span>(x)</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "0x55862f23ab80"</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tracemem</span>(x)</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "&lt;0x55862f23ab80&gt;"</span></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>x[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> x <span class="co"># Copy-on-modify triggers new copy</span></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; tracemem[0x55862f23ab80 -&gt; 0x55862e8ce028]:</span></span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a><span class="fu">obj_addr</span>(x) <span class="co"># copied object has new memory address</span></span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "0x55862e8ce028"</span></span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a><span class="fu">obj_addr</span>(x[[<span class="dv">1</span>]]) <span class="co"># list element contains old memory address</span></span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "0x55862f23ab80"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ol start="2" type="1">
<li>Wrap the two methods for subtracting medians into two functions, then use the ‘bench’ package <span class="citation" data-cites="bench">[@bench]</span> to carefully compare their speeds. How does performance change as the number of columns increase?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>x_medians <span class="ot">&lt;-</span> <span class="cf">function</span>(ncol) {</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="fu">runif</span>(<span class="dv">5</span> <span class="sc">*</span> <span class="fl">1e4</span>), <span class="at">ncol =</span> ncol))</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>  medians <span class="ot">&lt;-</span> <span class="fu">vapply</span>(x, median, <span class="fu">numeric</span>(<span class="dv">1</span>))</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">x =</span> x, <span class="at">medians =</span> medians))</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>df_medians <span class="ot">&lt;-</span> <span class="cf">function</span>(x, medians) {</span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># subtract medians using data.frame method</span></span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(medians)) {</span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>    x[[i]] <span class="ot">&lt;-</span> x[[i]] <span class="sc">-</span> medians[[i]]</span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a>  x</span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-15"><a href="#cb104-15" aria-hidden="true" tabindex="-1"></a>ls_medians <span class="ot">&lt;-</span> <span class="cf">function</span>(x, medians) {</span>
<span id="cb104-16"><a href="#cb104-16" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">as.list</span>(x)</span>
<span id="cb104-17"><a href="#cb104-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-18"><a href="#cb104-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(medians)) {</span>
<span id="cb104-19"><a href="#cb104-19" aria-hidden="true" tabindex="-1"></a>    y[[i]] <span class="ot">&lt;-</span> y[[i]] <span class="sc">-</span> medians[[i]]</span>
<span id="cb104-20"><a href="#cb104-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb104-21"><a href="#cb104-21" aria-hidden="true" tabindex="-1"></a>  y</span>
<span id="cb104-22"><a href="#cb104-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb104-23"><a href="#cb104-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-24"><a href="#cb104-24" aria-hidden="true" tabindex="-1"></a><span class="co"># confirm they both work</span></span>
<span id="cb104-25"><a href="#cb104-25" aria-hidden="true" tabindex="-1"></a>xm <span class="ot">&lt;-</span> <span class="fu">x_medians</span>(<span class="dv">5</span>)</span>
<span id="cb104-26"><a href="#cb104-26" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">df_medians</span>(xm<span class="sc">$</span>x, xm<span class="sc">$</span>medians), <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;             X1           X2          X3         X4          X5
#&gt; 1  -0.31909169 -0.413144595 -0.35859574 -0.1204953 -0.43504827
#&gt; 2  -0.08093799  0.207107755  0.47311511  0.1770737  0.28367867
#&gt; 3   0.32596949 -0.437373091  0.34864762 -0.3722676  0.18585576
#&gt; 4  -0.11777362 -0.018022014 -0.29952187 -0.1543627 -0.15564994
#&gt; 5  -0.42514173 -0.327696993 -0.21917524 -0.1982858  0.09719632
#&gt; 6   0.07408300 -0.087990720  0.03123350  0.3809340 -0.18972684
#&gt; 7  -0.06706237  0.418502166 -0.10928116  0.2863259  0.03363580
#&gt; 8  -0.26989198  0.432441315  0.05770697  0.4900636 -0.09702116
#&gt; 9   0.02184134 -0.004379089  0.44892609  0.2579126  0.32683060
#&gt; 10  0.15364264 -0.471395641 -0.19426441 -0.3646747  0.09965263</code></pre>
</div>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">as.data.frame</span>(<span class="fu">ls_medians</span>(xm<span class="sc">$</span>x, xm<span class="sc">$</span>medians)), <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;             X1           X2          X3         X4          X5
#&gt; 1  -0.31909169 -0.413144595 -0.35859574 -0.1204953 -0.43504827
#&gt; 2  -0.08093799  0.207107755  0.47311511  0.1770737  0.28367867
#&gt; 3   0.32596949 -0.437373091  0.34864762 -0.3722676  0.18585576
#&gt; 4  -0.11777362 -0.018022014 -0.29952187 -0.1543627 -0.15564994
#&gt; 5  -0.42514173 -0.327696993 -0.21917524 -0.1982858  0.09719632
#&gt; 6   0.07408300 -0.087990720  0.03123350  0.3809340 -0.18972684
#&gt; 7  -0.06706237  0.418502166 -0.10928116  0.2863259  0.03363580
#&gt; 8  -0.26989198  0.432441315  0.05770697  0.4900636 -0.09702116
#&gt; 9   0.02184134 -0.004379089  0.44892609  0.2579126  0.32683060
#&gt; 10  0.15364264 -0.471395641 -0.19426441 -0.3646747  0.09965263</code></pre>
</div>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># benchmark</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mark</span>(<span class="fu">df_medians</span>(xm<span class="sc">$</span>x, xm<span class="sc">$</span>medians))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 1 × 6
#&gt;   expression                        min   median `itr/sec` mem_alloc `gc/sec`
#&gt;   &lt;bch:expr&gt;                   &lt;bch:tm&gt; &lt;bch:tm&gt;     &lt;dbl&gt; &lt;bch:byt&gt;    &lt;dbl&gt;
#&gt; 1 df_medians(xm$x, xm$medians)   32.1µs   48.2µs    20230.     391KB     305.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mark</span>(<span class="fu">ls_medians</span>(xm<span class="sc">$</span>x, xm<span class="sc">$</span>medians))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 1 × 6
#&gt;   expression                        min   median `itr/sec` mem_alloc `gc/sec`
#&gt;   &lt;bch:expr&gt;                   &lt;bch:tm&gt; &lt;bch:tm&gt;     &lt;dbl&gt; &lt;bch:byt&gt;    &lt;dbl&gt;
#&gt; 1 ls_medians(xm$x, xm$medians)   9.06µs   24.6µs    43623.     391KB     490.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mark</span>(<span class="fu">as.data.frame</span>(<span class="fu">ls_medians</span>(xm<span class="sc">$</span>x, xm<span class="sc">$</span>medians))) <span class="co"># as.data.frame introduces significant overhead</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 1 × 6
#&gt;   expression                             min median `itr/sec` mem_alloc `gc/sec`
#&gt;   &lt;bch:expr&gt;                           &lt;bch&gt; &lt;bch:&gt;     &lt;dbl&gt; &lt;bch:byt&gt;    &lt;dbl&gt;
#&gt; 1 as.data.frame(ls_medians(xm$x, xm$m… 108µs  126µs     8057.     391KB     94.4</code></pre>
</div>
</div>
<p>Answer: with 5 columns, the list method is about twice as fast.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>xm <span class="ot">&lt;-</span> <span class="fu">x_medians</span>(<span class="dv">10</span>)</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mark</span>(<span class="fu">df_medians</span>(xm<span class="sc">$</span>x, xm<span class="sc">$</span>medians))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 1 × 6
#&gt;   expression                        min   median `itr/sec` mem_alloc `gc/sec`
#&gt;   &lt;bch:expr&gt;                   &lt;bch:tm&gt; &lt;bch:tm&gt;     &lt;dbl&gt; &lt;bch:byt&gt;    &lt;dbl&gt;
#&gt; 1 df_medians(xm$x, xm$medians)   56.9µs   78.7µs    12729.     391KB     150.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mark</span>(<span class="fu">ls_medians</span>(xm<span class="sc">$</span>x, xm<span class="sc">$</span>medians))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 1 × 6
#&gt;   expression                        min   median `itr/sec` mem_alloc `gc/sec`
#&gt;   &lt;bch:expr&gt;                   &lt;bch:tm&gt; &lt;bch:tm&gt;     &lt;dbl&gt; &lt;bch:byt&gt;    &lt;dbl&gt;
#&gt; 1 ls_medians(xm$x, xm$medians)   10.7µs   30.7µs    33069.     391KB     368.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>xm <span class="ot">&lt;-</span> <span class="fu">x_medians</span>(<span class="dv">20</span>)</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mark</span>(<span class="fu">df_medians</span>(xm<span class="sc">$</span>x, xm<span class="sc">$</span>medians))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 1 × 6
#&gt;   expression                        min   median `itr/sec` mem_alloc `gc/sec`
#&gt;   &lt;bch:expr&gt;                   &lt;bch:tm&gt; &lt;bch:tm&gt;     &lt;dbl&gt; &lt;bch:byt&gt;    &lt;dbl&gt;
#&gt; 1 df_medians(xm$x, xm$medians)    109µs    134µs     7383.     400KB     87.6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mark</span>(<span class="fu">ls_medians</span>(xm<span class="sc">$</span>x, xm<span class="sc">$</span>medians))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 1 × 6
#&gt;   expression                        min   median `itr/sec` mem_alloc `gc/sec`
#&gt;   &lt;bch:expr&gt;                   &lt;bch:tm&gt; &lt;bch:tm&gt;     &lt;dbl&gt; &lt;bch:byt&gt;    &lt;dbl&gt;
#&gt; 1 ls_medians(xm$x, xm$medians)   12.7µs   28.1µs    36352.     392KB     404.</code></pre>
</div>
</div>
<p>With 10 columns, the list method is 3 times as fast. With 20, the list method is 5 times as fast. So, the list method is near constant time regardless of columns, whereas the data.frame method scales linearly with the number of columns.</p>
<p>AR Solutions:</p>
<p>When working directly with the data frame, the execution time grows quadratically with the number of columns in the input data. This is because (e.g.) the first column must be copied n times, the second column n-1 times, and so on. When working with a list, the execution time increases only linearly.</p>
<p>Obviously in the long run, linear growth creates shorter run-times, but there is some cost to this strategy — we have to convert between data structures with as.list() and list2DF(). Even though this is fast and probably doesn’t hurt much, the improved approach doesn’t really pay off in this scenario until we get to a data frame that is about 300 columns wide (with the exact value depending on the characteristics of the system running the code).</p>
<hr>
<ol start="3" type="1">
<li>What happens if you attempt to use <code>tracemem()</code> on an environment?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">env</span>()</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a><span class="fu">try</span>(<span class="fu">tracemem</span>(e))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Error in tracemem(e) : 
#&gt;   'tracemem' is not useful for promise and environment objects</code></pre>
</div>
</div>
<p>Answer: it throws an error!</p>
<p>AR Solutions: <code>tracemem()</code> cannot be used to mark and trace environments.</p>
<p>The error occurs because “it is not useful to trace NULL, environments, promises, weak references, or external pointer objects, as these are not duplicated” (see <code>?tracemem</code>). Environments are always modified in place.</p>
<hr>
</section>
</section>
<section id="vectors" class="level2">
<h2 class="anchored" data-anchor-id="vectors">3 Vectors</h2>
<p>This chapter discusses the most important family of data types in base R: vectors. While you’ve probably already used many (if not all) of the different types of vectors, you may not have thought deeply about how they’re interrelated. In this chapter, I won’t cover individual vectors types in too much detail, but I will show you how all the types fit together as a whole. If you need more details, you can find them in R’s documentation.</p>
<p>Vectors come in two flavours: atomic vectors and lists. They differ in terms of their elements’ types: for atomic vectors, all elements must have the same type; for lists, elements can have different types. While not a vector, <code>NULL</code> is closely related to vectors and often serves the role of a generic zero length vector. This diagram, which we’ll be expanding on throughout this chapter, illustrates the basic relationships:</p>
<p>Every vector can also have <strong>attributes</strong>, which you can think of as a named list of arbitrary metadata. Two attributes are particularly important. The <strong>dimension</strong> attribute turns vectors into matrices and arrays and the <strong>class</strong> attribute powers the S3 object system. While you’ll learn how to use S3 in Chapter 13, here you’ll learn about some of the most important S3 vectors: factors, date and times, data frames, and tibbles. And while 2D structures like matrices and data frames are not necessarily what come to mind when you think of vectors, you’ll also learn why R considers them to be vectors.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="exercises-4" class="level3">
<h3 class="anchored" data-anchor-id="exercises-4">3.2.5 Exercises</h3>
<ol type="1">
<li>How do you create raw and complex scalars? (See <code>?raw</code> and <code>?complex</code>.)</li>
</ol>
<p>Answer: using either <code>raw()</code>, <code>complex()</code>, or <code>as.raw()</code>, <code>as.complex()</code>.</p>
<p>AR Solutions: In R, scalars are represented as vectors of length one. However, there’s no built-in syntax like there is for logicals, integers, doubles, and character vectors to create individual raw and complex values. Instead, you have to create them by calling a function. For raw vectors you can use either <code>as.raw()</code> or <code>charToRaw()</code> to create them from numeric or character values.</p>
<p>In the case of complex numbers, real and imaginary parts may be provided directly to the <code>complex()</code> constructor. You can create purely imaginary numbers (e.g.) <code>1i</code>, but there is no way to create complex numbers without <code>+</code> (e.g.&nbsp;<code>1i + 1</code>).</p>
<hr>
<ol start="2" type="1">
<li>Test your knowledge of the vector coercion rules by predicting the output of the following uses of <code>c()</code>:</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="dv">1</span>, <span class="cn">FALSE</span>) <span class="co"># 1.0, 0.0 - double</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 1 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="st">"a"</span>, <span class="dv">1</span>) <span class="co"># "a", "1" - character</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "a" "1"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="dv">1</span>L) <span class="co"># 1L, 1L - integer</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 1 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "double"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(<span class="fu">c</span>(<span class="st">"a"</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "character"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(<span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="dv">1</span>L))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "integer"</code></pre>
</div>
</div>
<p>Answer: guesses inline. [correct!]</p>
<p>AR Solutions:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="dv">1</span>, <span class="cn">FALSE</span>) <span class="co"># will be coerced to double    -&gt; 1 0</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="st">"a"</span>, <span class="dv">1</span>) <span class="co"># will be coerced to character -&gt; "a" "1"</span></span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="dv">1</span>L) <span class="co"># will be coerced to integer   -&gt; 1 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ol start="3" type="1">
<li>Why is <code>1 == "1"</code> true? Why is <code>-1 &lt; FALSE</code> true? Why is <code>"one" &lt; 2</code> false?</li>
</ol>
<p>Answers:</p>
<ul>
<li><code>1 == "1"</code>: the 1 is coerced to “1”</li>
<li><code>-1 &lt; FALSE</code>: FALSE is coerced to 0</li>
<li>`“one” &lt; 2: the 2 is coerced to “2”</li>
</ul>
<p>AR Solutions: These comparisons are carried out by operator-functions (<code>==</code>, <code>&lt;</code>), which coerce their arguments to a common type. In the examples above, these types will be character, double and character: <code>1</code> will be coerced to <code>"1"</code>, <code>FALSE</code> is represented as <code>0</code> and <code>2</code> turns into <code>"2"</code> (and numbers precede letters in lexicographic order (may depend on locale)).</p>
<hr>
<ol start="4" type="1">
<li>Why is the default missing value, <code>NA</code>, a logical vector? What’s special about logical vectors? (Hint: think about <code>c(FALSE, NA_character_)</code>.)</li>
</ol>
<p>Answer: NA must be logical so that it can exist in a logical vector.</p>
<p>AR Solutions: The presence of missing values shouldn’t affect the type of an object. Recall that there is a type-hierarchy for coercion from character → double → integer → logical. When combining <code>NA</code>s with other atomic types, the <code>NA</code>s will be coerced to integer (<code>NA_integer_</code>), double (<code>NA_real_</code>) or character (<code>NA_character_</code>) and not the other way round. If <code>NA</code> were a character and added to a set of other values all of these would be coerced to character as well.</p>
<hr>
<ol start="5" type="1">
<li>Precisely what do <code>is.atomic()</code>, <code>is.numeric()</code>, and <code>is.vector()</code> test for?</li>
</ol>
<p>Answers:</p>
<ul>
<li><code>is.atomic(x)</code>: tests if x is an atomic vector (logical, integer, numeric, complex, character, and raw) - is <code>FALSE</code> for lists</li>
<li><code>is.numeric(x)</code>: tests if x is an atomic numeric vector</li>
<li><code>is.vector(x, mode = "any")</code>: tests if x is an atomic vector OR a list or expression</li>
</ul>
<p>AR Solutions: The documentation states that:</p>
<ul>
<li><code>is.atomic()</code> tests if an object is an atomic vector (as defined in <em>Advanced R</em>) or is <code>NULL</code> (!).</li>
<li><code>is.numeric()</code> tests if an object has type integer or double and is not of class <code>factor</code>, <code>Date</code>, <code>POSIXt</code> or <code>difftime</code>.</li>
<li><code>is.vector()</code> tests if an object is a vector (as defined in <em>Advanced R</em>) or an expression and has no attributes, apart from names.</li>
</ul>
<p>Atomic vectors are defined in <em>Advanced R</em> as objects of type logical, integer, double, complex, character or raw. Vectors are defined as atomic vectors or lists.</p>
<hr>
</section>
<section id="exercises-5" class="level3">
<h3 class="anchored" data-anchor-id="exercises-5">3.3.4 Exercises</h3>
<ol type="1">
<li>How is <code>setNames()</code> implemented? How is <code>unname()</code> implemented? Read the source code.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>setNames</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; function (object = nm, nm) 
#&gt; {
#&gt;     names(object) &lt;- nm
#&gt;     object
#&gt; }
#&gt; &lt;bytecode: 0x1331ec188&gt;
#&gt; &lt;environment: namespace:stats&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>unname</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; function (obj, force = FALSE) 
#&gt; {
#&gt;     if (!is.null(names(obj))) 
#&gt;         names(obj) &lt;- NULL
#&gt;     if (!is.null(dimnames(obj)) &amp;&amp; (force || !is.data.frame(obj))) 
#&gt;         dimnames(obj) &lt;- NULL
#&gt;     obj
#&gt; }
#&gt; &lt;bytecode: 0x132f9f8a0&gt;
#&gt; &lt;environment: namespace:base&gt;</code></pre>
</div>
</div>
<p>Answer: using <code>names()</code>, and <code>dimnames()</code> for <code>unname()</code>.</p>
<p>AR Solutions:</p>
<p>Because the data argument comes first, <code>setNames()</code> also works well with the magrittr-pipe operator. When no first argument is given, the result is a named vector (this is rather untypical as required arguments usually come first):</p>
<p><code>unname()</code> removes existing names (or dimnames) by setting them to <code>NULL</code>.</p>
<hr>
<ol start="2" type="1">
<li>What does <code>dim()</code> return when applied to a 1-dimensional vector? When might you use <code>NROW()</code> or <code>NCOL()</code>?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; NULL</code></pre>
</div>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; NULL</code></pre>
</div>
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">NROW</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 12</code></pre>
</div>
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ncol</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; NULL</code></pre>
</div>
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">NCOL</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 1</code></pre>
</div>
</div>
<p>Answers: <code>NULL</code>. <code>NROW</code> and <code>NCOL</code> are useful when comparing <code>NULL</code> dimensional vectors with matrices and arrays.</p>
<p>AR Solutions: From <code>?nrow</code>:</p>
<blockquote class="blockquote">
<p><code>dim()</code> will return <code>NULL</code> when applied to a 1d vector.</p>
</blockquote>
<p>One may want to use <code>NROW()</code> or <code>NCOL()</code> to handle atomic vectors, lists and NULL values in the same way as one column matrices or data frames.</p>
<hr>
<ol start="3" type="1">
<li>How would you describe the following three objects? What makes them different from <code>1:5</code>?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">5</span>))</span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">1</span>))</span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>x3 <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a>x1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; , , 1
#&gt; 
#&gt;      [,1]
#&gt; [1,]    1
#&gt; 
#&gt; , , 2
#&gt; 
#&gt;      [,1]
#&gt; [1,]    2
#&gt; 
#&gt; , , 3
#&gt; 
#&gt;      [,1]
#&gt; [1,]    3
#&gt; 
#&gt; , , 4
#&gt; 
#&gt;      [,1]
#&gt; [1,]    4
#&gt; 
#&gt; , , 5
#&gt; 
#&gt;      [,1]
#&gt; [1,]    5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>x2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; , , 1
#&gt; 
#&gt;      [,1] [,2] [,3] [,4] [,5]
#&gt; [1,]    1    2    3    4    5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>x3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; , , 1
#&gt; 
#&gt;      [,1]
#&gt; [1,]    1
#&gt; [2,]    2
#&gt; [3,]    3
#&gt; [4,]    4
#&gt; [5,]    5</code></pre>
</div>
</div>
<p>Answer: They have a 3-dimensional structure, arranged in different ways, along the z, x, and y axis.</p>
<p>AR Solutions: These are all “one dimensional”. If you imagine a 3d cube, <code>x1</code> is in the x-dimension, <code>x2</code> is in the y-dimension, and <code>x3</code> is in the z-dimension. In contrast to <code>1:5</code>, <code>x1</code>, <code>x2</code> and <code>x3</code> have a <code>dim</code> attribute.</p>
<hr>
<ol start="4" type="1">
<li>An early draft used this code to illustrate <code>structure()</code>:</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="fu">structure</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">comment =</span> <span class="st">"my attribute"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 1 2 3 4 5</code></pre>
</div>
</div>
<pre><code>But when you print that object you don't see the comment attribute.
Why? Is the attribute missing, or is there something else special about
it? (Hint: try using help.)</code></pre>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="fu">factor</span>(<span class="st">"green"</span>, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"amber"</span>, <span class="st">"green"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] green
#&gt; Levels: red amber green</code></pre>
</div>
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dput</span>(<span class="fu">factor</span>(<span class="st">"green"</span>, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"amber"</span>, <span class="st">"green"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; structure(3L, levels = c("red", "amber", "green"), class = "factor")</code></pre>
</div>
</div>
<p>Answer: print doesn’t display the attributes for arbitrary structures, only defined classes, like factors (for example, above).</p>
<p>AR Solutions: The documentation states (see <code>?comment</code>):</p>
<blockquote class="blockquote">
<p>Contrary to other attributes, the comment is not printed (by print or print.default).</p>
</blockquote>
<p>Also, from <code>?attributes</code>:</p>
<blockquote class="blockquote">
<p>Note that some attributes (namely class, comment, dim, dimnames, names, row.names and tsp) are treated specially and have restrictions on the values which can be set.</p>
</blockquote>
<hr>
</section>
<section id="exercises-6" class="level3">
<h3 class="anchored" data-anchor-id="exercises-6">3.4.5 Exercises</h3>
<ol type="1">
<li>What sort of object does <code>table()</code> return? What is its type? What attributes does it have? How does the dimensionality change as you tabulate more variables?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a>a_table <span class="ot">&lt;-</span> <span class="fu">table</span>(a, <span class="fu">sample</span>(a))</span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a>a_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;    
#&gt; a   a b c
#&gt;   a 0 1 0
#&gt;   b 1 0 0
#&gt;   c 0 0 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(a_table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "integer"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(a_table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; $dim
#&gt; [1] 3 3
#&gt; 
#&gt; $dimnames
#&gt; $dimnames$a
#&gt; [1] "a" "b" "c"
#&gt; 
#&gt; $dimnames[[2]]
#&gt; [1] "a" "b" "c"
#&gt; 
#&gt; 
#&gt; $class
#&gt; [1] "table"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a>b_table <span class="ot">&lt;-</span> <span class="fu">table</span>(b, <span class="fu">sample</span>(b))</span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a>b_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;    
#&gt; b   a b c d
#&gt;   a 0 0 1 0
#&gt;   b 0 0 0 1
#&gt;   c 1 0 0 0
#&gt;   d 0 1 0 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(b_table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; $dim
#&gt; [1] 4 4
#&gt; 
#&gt; $dimnames
#&gt; $dimnames$b
#&gt; [1] "a" "b" "c" "d"
#&gt; 
#&gt; $dimnames[[2]]
#&gt; [1] "a" "b" "c" "d"
#&gt; 
#&gt; 
#&gt; $class
#&gt; [1] "table"</code></pre>
</div>
</div>
<p>Answer: an object of class “table”, an array of integer values, with type “integer”. Attributes listed above, the dimensionality is always n by n, where n is the number of variables tabulated.</p>
<p>AR Solutions: <code>table()</code> returns a contingency table of its input variables. It is implemented as an integer vector with class <code>table</code> and dimensions (which makes it act like an array). Its attributes are <code>dim</code> (dimensions) and <code>dimnames</code> (one name for each input column). The dimensions correspond to the number of unique values (factor levels) in each input variable.</p>
<hr>
<ol start="2" type="1">
<li>What happens to a factor when you modify its levels?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>f1 <span class="ot">&lt;-</span> <span class="fu">factor</span>(letters)</span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>f1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  [1] a b c d e f g h i j k l m n o p q r s t u v w x y z
#&gt; Levels: a b c d e f g h i j k l m n o p q r s t u v w x y z</code></pre>
</div>
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(f1) <span class="ot">&lt;-</span> <span class="fu">rev</span>(<span class="fu">levels</span>(f1))</span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a>f1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  [1] z y x w v u t s r q p o n m l k j i h g f e d c b a
#&gt; Levels: z y x w v u t s r q p o n m l k j i h g f e d c b a</code></pre>
</div>
</div>
<p>Answer: <del>the factor will remain the same, but the attributes will change.</del> the factor and its levels are reversed.</p>
<p>AR Solutions: The underlying integer values stay the same, but the levels are changed, making it look like the data has changed.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>f1 <span class="ot">&lt;-</span> <span class="fu">factor</span>(letters)</span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a>f1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  [1] a b c d e f g h i j k l m n o p q r s t u v w x y z
#&gt; Levels: a b c d e f g h i j k l m n o p q r s t u v w x y z</code></pre>
</div>
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.integer</span>(f1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25
#&gt; [26] 26</code></pre>
</div>
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(f1) <span class="ot">&lt;-</span> <span class="fu">rev</span>(<span class="fu">levels</span>(f1))</span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a>f1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  [1] z y x w v u t s r q p o n m l k j i h g f e d c b a
#&gt; Levels: z y x w v u t s r q p o n m l k j i h g f e d c b a</code></pre>
</div>
</div>
<hr>
<ol start="3" type="1">
<li>What does this code do? How do <code>f2</code> and <code>f3</code> differ from <code>f1</code>?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a>f2 <span class="ot">&lt;-</span> <span class="fu">rev</span>(<span class="fu">factor</span>(letters))</span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a>f2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  [1] z y x w v u t s r q p o n m l k j i h g f e d c b a
#&gt; Levels: a b c d e f g h i j k l m n o p q r s t u v w x y z</code></pre>
</div>
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a>f3 <span class="ot">&lt;-</span> <span class="fu">factor</span>(letters, <span class="at">levels =</span> <span class="fu">rev</span>(letters))</span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>f3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  [1] a b c d e f g h i j k l m n o p q r s t u v w x y z
#&gt; Levels: z y x w v u t s r q p o n m l k j i h g f e d c b a</code></pre>
</div>
</div>
<p>Answer: both create a reversed list of letters. f3 also has reversed levels but f2 does not. (correct!)</p>
<p>AR Solutions: For <code>f2</code> and <code>f3</code> either the order of the factor elements <em>or</em> its levels are being reversed. For <code>f1</code> both transformations are occurring.</p>
<hr>
</section>
<section id="exercises-7" class="level3">
<h3 class="anchored" data-anchor-id="exercises-7">3.5.4 Exercises</h3>
<ol type="1">
<li>List all the ways that a list differs from an atomic vector.</li>
</ol>
<p>Answers:</p>
<ul>
<li>Each element can be a different type</li>
<li>Each element is a reference to an object</li>
<li>List size can be smaller since elements are references</li>
<li>Lists can contain other lists</li>
</ul>
<p>AR Solutions: To summarise:</p>
<ul>
<li>Atomic vectors are always homogeneous (all elements must be of the same type). Lists may be heterogeneous (the elements can be of different types) as described in the <a href="https://adv-r.hadley.nz/vectors-chap.html#introduction">introduction of the vectors chapter</a>.</li>
<li>Atomic vectors point to one address in memory, while lists contain a separate reference for each element. (This was described in the list sections of the <a href="https://adv-r.hadley.nz/vectors-chap.html#lists">vectors</a> and the <a href="https://adv-r.hadley.nz/names-values.html#list-references">names and values</a> chapters.)</li>
<li>Subsetting with out-of-bounds and <code>NA</code> values leads to different output. For example, <code>[</code> returns <code>NA</code> for atomics and <code>NULL</code> for lists. (This is described in more detail within the <a href="https://adv-r.hadley.nz/subsetting.html">subsetting chapter</a>.)</li>
</ul>
<hr>
<ol start="2" type="1">
<li>Why do you need to use <code>unlist()</code> to convert a list to an atomic vector? Why doesn’t <code>as.vector()</code> work?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.vector</span>(<span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dput</span>(<span class="fu">as.vector</span>(<span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; list(1:4)</code></pre>
</div>
</div>
<p>Answer: a list is considered a vector by <code>as.vector()</code>.</p>
<p>AR Solutions: A list is already a vector, though not an atomic one!</p>
<hr>
<ol start="3" type="1">
<li>Compare and contrast <code>c()</code> and <code>unlist()</code> when combining a date and date-time into a single vector.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(<span class="st">"2022-06-25"</span>), <span class="at">datetime =</span> <span class="fu">as.POSIXct</span>(<span class="st">"2022-06-25 09:59:40 CDT"</span>))</span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dput</span>(d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; list(date = structure(19168, class = "Date"), datetime = structure(1656169180, class = c("POSIXct", 
#&gt; "POSIXt"), tzone = ""))</code></pre>
</div>
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dput</span>(<span class="fu">c</span>(d))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; list(date = structure(19168, class = "Date"), datetime = structure(1656169180, class = c("POSIXct", 
#&gt; "POSIXt"), tzone = ""))</code></pre>
</div>
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dput</span>(<span class="fu">unlist</span>(d))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; c(date = 19168, datetime = 1656169180)</code></pre>
</div>
</div>
<p>Answer: <code>c()</code> preserves the list structure. <code>unlist()</code> converts both to <code>double</code>.</p>
<p>AR Solutions: Date and date-time objects are both built upon doubles. While dates store the number of days since the reference date 1970-01-01 (also known as “the Epoch”) in days, date-time-objects (POSIXct) store the time difference to this date in seconds.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"1970-01-02"</span>)</span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a>dttm_ct <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(<span class="st">"1970-01-01 01:00"</span>, <span class="at">tz =</span> <span class="st">"UTC"</span>)</span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Internal representations</span></span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a><span class="fu">unclass</span>(date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unclass</span>(dttm_ct)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 3600
#&gt; attr(,"tzone")
#&gt; [1] "UTC"</code></pre>
</div>
</div>
<p>As the <code>c()</code> generic only dispatches on its first argument, combining date and date-time objects via <code>c()</code> could lead to surprising results in older R versions (pre R 4.0.0):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Output in R version 3.6.2</span></span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(date, dttm_ct) <span class="co"># equal to c.Date(date, dttm_ct)</span></span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "1970-01-02" "1979-11-10"</span></span>
<span id="cb203-4"><a href="#cb203-4" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(dttm_ct, date) <span class="co"># equal to c.POSIXct(date, dttm_ct)</span></span>
<span id="cb203-5"><a href="#cb203-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "1970-01-01 02:00:00 CET" "1970-01-01 01:00:01 CET"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the first statement above <code>c.Date()</code> is executed, which incorrectly treats the underlying double of <code>dttm_ct</code> (3600) as days instead of seconds. Conversely, when <code>c.POSIXct()</code> is called on a date, one day is counted as one second only.</p>
<p>We can highlight these mechanics by the following code:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Output in R version 3.6.2</span></span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unclass</span>(<span class="fu">c</span>(date, dttm_ct)) <span class="co"># internal representation</span></span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1 3600</span></span>
<span id="cb204-4"><a href="#cb204-4" aria-hidden="true" tabindex="-1"></a>date <span class="sc">+</span> <span class="dv">3599</span></span>
<span id="cb204-5"><a href="#cb204-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; "1979-11-10"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As of R 4.0.0 these issues have been resolved and both methods now convert their input first into <code>POSIXct</code> and <code>Date</code>, respectively.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(dttm_ct, date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "1970-01-01 01:00:00 UTC" "1970-01-02 00:00:00 UTC"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unclass</span>(<span class="fu">c</span>(dttm_ct, date))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1]  3600 86400
#&gt; attr(,"tzone")
#&gt; [1] "UTC"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(date, dttm_ct)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "1970-01-02" "1970-01-01"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unclass</span>(<span class="fu">c</span>(date, dttm_ct))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 1 0</code></pre>
</div>
</div>
<p>However, as <code>c()</code> strips the time zone (and other attributes) of <code>POSIXct</code> objects, some caution is still recommended.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a>(dttm_ct <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(<span class="st">"1970-01-01 01:00"</span>, <span class="at">tz =</span> <span class="st">"HST"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "1970-01-01 01:00:00 HST"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(<span class="fu">c</span>(dttm_ct))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; $class
#&gt; [1] "POSIXct" "POSIXt" 
#&gt; 
#&gt; $tzone
#&gt; [1] "HST"</code></pre>
</div>
</div>
<p>A package that deals with these kinds of problems in more depth and provides a structural solution for them is the <a href="https://github.com/r-lib/vctrs"><code>vctrs</code> package</a> which is also used throughout the tidyverse.</p>
<p>Let’s look at <code>unlist()</code>, which operates on list input.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb217"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Attributes are stripped</span></span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unlist</span>(<span class="fu">list</span>(date, dttm_ct))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1]     1 39600</code></pre>
</div>
</div>
<p>We see again that dates and date-times are internally stored as doubles. Unfortunately, this is all we are left with, when unlist strips the attributes of the list.</p>
<p>To summarise: <code>c()</code> coerces types and strips time zones. Errors may have occurred in older R versions because of inappropriate method dispatch/immature methods. <code>unlist()</code> strips attributes.</p>
<hr>
</section>
<section id="exercises-8" class="level3">
<h3 class="anchored" data-anchor-id="exercises-8">3.6.8 Exercises</h3>
<ol type="1">
<li>Can you have a data frame with zero rows? What about zero columns?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb219"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="co"># from data.frame() examples:</span></span>
<span id="cb219-2"><a href="#cb219-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">y =</span> <span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">z =</span> <span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>)</span>
<span id="cb219-3"><a href="#cb219-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-4"><a href="#cb219-4" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;   x y z
#&gt; 1 1 4 7
#&gt; 2 2 5 8
#&gt; 3 3 6 9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a>df[, <span class="cn">FALSE</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; data frame with 0 columns and 3 rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb223"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a>df[<span class="cn">FALSE</span>, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] x y z
#&gt; &lt;0 rows&gt; (or 0-length row.names)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb225"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a>df[<span class="cn">FALSE</span>, <span class="cn">FALSE</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; data frame with 0 columns and 0 rows</code></pre>
</div>
</div>
<p>Answer: yes!</p>
<p>AR Solutions: Yes, you can create these data frames easily; either during creation or via subsetting. Even both dimensions can be zero.</p>
<hr>
<ol start="2" type="1">
<li>What happens if you attempt to set rownames that are not unique?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "1" "2" "3"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="fu">try</span>(<span class="fu">rownames</span>(df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; Warning: non-unique value when setting 'row.names': 'a'</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Error in `.rowNamesDF&lt;-`(x, value = value) : 
#&gt;   duplicate 'row.names' are not allowed</code></pre>
</div>
</div>
<p>Answer: error, duplicates not allowed.</p>
<p>AR Solutions: Matrices can have duplicated row names, so this does not cause problems.</p>
<p>Data frames, however, require unique rownames and you get different results depending on how you attempt to set them. If you set them directly or via <code>row.names()</code>, you get an error. If you use subsetting, <code>[</code> automatically deduplicates.</p>
<hr>
<ol start="3" type="1">
<li>If <code>df</code> is a data frame, what can you say about <code>t(df)</code>, and <code>t(t(df))</code>? Perform some experiments, making sure to try different column types.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;   [,1] [,2] [,3]
#&gt; x    1    2    3
#&gt; y    4    5    6
#&gt; z    7    8    9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t</span>(<span class="fu">t</span>(df))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;      x y z
#&gt; [1,] 1 4 7
#&gt; [2,] 2 5 8
#&gt; [3,] 3 6 9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb236"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">y =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>), <span class="at">z =</span> <span class="dv">4</span>L<span class="sc">:</span><span class="dv">6</span>L, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a>df2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;   x y z
#&gt; 1 1 a 4
#&gt; 2 2 b 5
#&gt; 3 3 c 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb238"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t</span>(df2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;   [,1] [,2] [,3]
#&gt; x "1"  "2"  "3" 
#&gt; y "a"  "b"  "c" 
#&gt; z "4"  "5"  "6"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb240"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t</span>(<span class="fu">t</span>(df2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;      x   y   z  
#&gt; [1,] "1" "a" "4"
#&gt; [2,] "2" "b" "5"
#&gt; [3,] "3" "c" "6"</code></pre>
</div>
</div>
<p>Answer: <code>t()</code> coerces the vector types, so <code>t(t(df))</code> is the same as <code>df</code> only when all columns are the same type.</p>
<p>AR Solutions: Both of <code>t(df)</code> and <code>t(t(df))</code> will return matrices:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb242"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">y =</span> letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])</span>
<span id="cb242-2"><a href="#cb242-2" aria-hidden="true" tabindex="-1"></a><span class="fu">is.matrix</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb244"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.matrix</span>(<span class="fu">t</span>(df))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb246"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.matrix</span>(<span class="fu">t</span>(<span class="fu">t</span>(df)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] TRUE</code></pre>
</div>
</div>
<p>The dimensions will respect the typical transposition rules:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb248"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 3 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb250"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(<span class="fu">t</span>(df))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 2 3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb252"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(<span class="fu">t</span>(<span class="fu">t</span>(df)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 3 2</code></pre>
</div>
</div>
<p>Because the output is a matrix, every column is coerced to the same type. (It is implemented within <code>t.data.frame()</code> via <code>as.matrix()</code> which is described below).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb254"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;   x y
#&gt; 1 1 a
#&gt; 2 2 b
#&gt; 3 3 c</code></pre>
</div>
<div class="sourceCode cell-code" id="cb256"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;   [,1] [,2] [,3]
#&gt; x "1"  "2"  "3" 
#&gt; y "a"  "b"  "c"</code></pre>
</div>
</div>
<hr>
<ol start="4" type="1">
<li>What does <code>as.matrix()</code> do when applied to a data frame with columns of different types? How does it differ from <code>data.matrix()</code>?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb258"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.matrix</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;      x   y  
#&gt; [1,] "1" "a"
#&gt; [2,] "2" "b"
#&gt; [3,] "3" "c"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb260"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.matrix</span>(df2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;      x   y   z  
#&gt; [1,] "1" "a" "4"
#&gt; [2,] "2" "b" "5"
#&gt; [3,] "3" "c" "6"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb262"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.matrix</span>(df2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;      x y z
#&gt; [1,] 1 1 4
#&gt; [2,] 2 2 5
#&gt; [3,] 3 3 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb264"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(<span class="fu">data.matrix</span>(df2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;   x y z
#&gt; 1 1 1 4
#&gt; 2 2 2 5
#&gt; 3 3 3 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb266"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(<span class="fu">data.matrix</span>(<span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span>), <span class="at">z =</span> <span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;   x   y z
#&gt; 1 1 0.0 4
#&gt; 2 2 0.5 5
#&gt; 3 3 1.0 6</code></pre>
</div>
</div>
<p>Answer: <code>as.matrix()</code> coerces all elements to the same type. <code>data.matrix()</code> coerces elements to either integer (when possible) or double (when not).</p>
<p>AR Solutions: The type of the result of <code>as.matrix</code> depends on the types of the input columns (see <code>?as.matrix</code>):</p>
<blockquote class="blockquote">
<p>The method for data frames will return a character matrix if there is only atomic columns and any non-(numeric/logical/complex) column, applying as.vector to factors and format to other non-character columns. Otherwise the usual coercion hierarchy (logical &lt; integer &lt; double &lt; complex) will be used, e.g.&nbsp;all-logical data frames will be coerced to a logical matrix, mixed logical-integer will give an integer matrix, etc.</p>
</blockquote>
<p>On the other hand, <code>data.matrix</code> will always return a numeric matrix (see <code>?data.matrix()</code>).</p>
<blockquote class="blockquote">
<p>Return the matrix obtained by converting all the variables in a data frame to numeric mode and then binding them together as the columns of a matrix. Factors and ordered factors are replaced by their internal codes. […] Character columns are first converted to factors and then to integers.</p>
</blockquote>
<p>We can illustrate and compare the mechanics of these functions using a concrete example. <code>as.matrix()</code> makes it possible to retrieve most of the original information from the data frame but leaves us with characters. To retrieve all information from <code>data.matrix()</code>’s output, we would need a lookup table for each column.</p>
<hr>
</section>
</section>
<section id="subsetting" class="level2">
<h2 class="anchored" data-anchor-id="subsetting">4 Subsetting</h2>
<p>R’s subsetting operators are fast and powerful. Mastering them allows you to succinctly perform complex operations in a way that few other languages can match. Subsetting in R is easy to learn but hard to master because you need to internalise a number of interrelated concepts:</p>
<ul>
<li><p>There are six ways to subset atomic vectors.</p></li>
<li><p>There are three subsetting operators, <code>[[</code>, <code>[</code>, and <code>$</code>.</p></li>
<li><p>Subsetting operators interact differently with different vector types (e.g., atomic vectors, lists, factors, matrices, and data frames).</p></li>
<li><p>Subsetting can be combined with assignment.</p></li>
</ul>
<p>Subsetting is a natural complement to <code>str()</code>. While <code>str()</code> shows you all the pieces of any object (its structure), subsetting allows you to pull out the pieces that you’re interested in. For large, complex objects, I highly recommend using the interactive RStudio Viewer, which you can activate with <code>View(my_object)</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb268"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="exercises-9" class="level3">
<h3 class="anchored" data-anchor-id="exercises-9">4.2.6 Exercises</h3>
<ol type="1">
<li>Fix each of the following common data frame subsetting errors:</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb269"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mtcars[mtcars$cyl = 4, ]</span></span>
<span id="cb269-2"><a href="#cb269-2" aria-hidden="true" tabindex="-1"></a>mtcars[mtcars<span class="sc">$</span>cyl <span class="sc">==</span> <span class="dv">4</span>, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;                 mpg cyl  disp  hp drat    wt  qsec vs am gear carb
#&gt; Datsun 710     22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1
#&gt; Merc 240D      24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2
#&gt; Merc 230       22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2
#&gt; Fiat 128       32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1
#&gt; Honda Civic    30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2
#&gt; Toyota Corolla 33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1
#&gt; Toyota Corona  21.5   4 120.1  97 3.70 2.465 20.01  1  0    3    1
#&gt; Fiat X1-9      27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1
#&gt; Porsche 914-2  26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2
#&gt; Lotus Europa   30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2
#&gt; Volvo 142E     21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb271"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use `==`              (instead of `=`)</span></span>
<span id="cb271-2"><a href="#cb271-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-3"><a href="#cb271-3" aria-hidden="true" tabindex="-1"></a><span class="co"># mtcars[-1:4, ]</span></span>
<span id="cb271-4"><a href="#cb271-4" aria-hidden="true" tabindex="-1"></a>mtcars[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>), ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;                      mpg cyl  disp  hp drat    wt  qsec vs am gear carb
#&gt; Hornet Sportabout   18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2
#&gt; Valiant             18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1
#&gt; Duster 360          14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4
#&gt; Merc 240D           24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2
#&gt; Merc 230            22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2
#&gt; Merc 280            19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4
#&gt; Merc 280C           17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4
#&gt; Merc 450SE          16.4   8 275.8 180 3.07 4.070 17.40  0  0    3    3
#&gt; Merc 450SL          17.3   8 275.8 180 3.07 3.730 17.60  0  0    3    3
#&gt; Merc 450SLC         15.2   8 275.8 180 3.07 3.780 18.00  0  0    3    3
#&gt; Cadillac Fleetwood  10.4   8 472.0 205 2.93 5.250 17.98  0  0    3    4
#&gt; Lincoln Continental 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4
#&gt; Chrysler Imperial   14.7   8 440.0 230 3.23 5.345 17.42  0  0    3    4
#&gt; Fiat 128            32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1
#&gt; Honda Civic         30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2
#&gt; Toyota Corolla      33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1
#&gt; Toyota Corona       21.5   4 120.1  97 3.70 2.465 20.01  1  0    3    1
#&gt; Dodge Challenger    15.5   8 318.0 150 2.76 3.520 16.87  0  0    3    2
#&gt; AMC Javelin         15.2   8 304.0 150 3.15 3.435 17.30  0  0    3    2
#&gt; Camaro Z28          13.3   8 350.0 245 3.73 3.840 15.41  0  0    3    4
#&gt; Pontiac Firebird    19.2   8 400.0 175 3.08 3.845 17.05  0  0    3    2
#&gt; Fiat X1-9           27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1
#&gt; Porsche 914-2       26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2
#&gt; Lotus Europa        30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2
#&gt; Ford Pantera L      15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4
#&gt; Ferrari Dino        19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6
#&gt; Maserati Bora       15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8
#&gt; Volvo 142E          21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb273"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb273-1"><a href="#cb273-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use `-(1:4)`          (instead of `-1:4`)</span></span>
<span id="cb273-2"><a href="#cb273-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-3"><a href="#cb273-3" aria-hidden="true" tabindex="-1"></a><span class="co"># mtcars[mtcars$cyl &lt;= 5]</span></span>
<span id="cb273-4"><a href="#cb273-4" aria-hidden="true" tabindex="-1"></a>mtcars[mtcars<span class="sc">$</span>cyl <span class="sc">&lt;=</span> <span class="dv">5</span>, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;                 mpg cyl  disp  hp drat    wt  qsec vs am gear carb
#&gt; Datsun 710     22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1
#&gt; Merc 240D      24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2
#&gt; Merc 230       22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2
#&gt; Fiat 128       32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1
#&gt; Honda Civic    30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2
#&gt; Toyota Corolla 33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1
#&gt; Toyota Corona  21.5   4 120.1  97 3.70 2.465 20.01  1  0    3    1
#&gt; Fiat X1-9      27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1
#&gt; Porsche 914-2  26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2
#&gt; Lotus Europa   30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2
#&gt; Volvo 142E     21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb275"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a><span class="co"># `,` is missing</span></span>
<span id="cb275-2"><a href="#cb275-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-3"><a href="#cb275-3" aria-hidden="true" tabindex="-1"></a><span class="co"># mtcars[mtcars$cyl == 4 | 6, ]</span></span>
<span id="cb275-4"><a href="#cb275-4" aria-hidden="true" tabindex="-1"></a>mtcars[mtcars<span class="sc">$</span>cyl <span class="sc">==</span> <span class="dv">4</span> <span class="sc">|</span> mtcars<span class="sc">$</span>cyl <span class="sc">==</span> <span class="dv">6</span>, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;                 mpg cyl  disp  hp drat    wt  qsec vs am gear carb
#&gt; Mazda RX4      21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4
#&gt; Mazda RX4 Wag  21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4
#&gt; Datsun 710     22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1
#&gt; Hornet 4 Drive 21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1
#&gt; Valiant        18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1
#&gt; Merc 240D      24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2
#&gt; Merc 230       22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2
#&gt; Merc 280       19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4
#&gt; Merc 280C      17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4
#&gt; Fiat 128       32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1
#&gt; Honda Civic    30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2
#&gt; Toyota Corolla 33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1
#&gt; Toyota Corona  21.5   4 120.1  97 3.70 2.465 20.01  1  0    3    1
#&gt; Fiat X1-9      27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1
#&gt; Porsche 914-2  26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2
#&gt; Lotus Europa   30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2
#&gt; Ferrari Dino   19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6
#&gt; Volvo 142E     21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb277"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use `mtcars$cyl == 6` (instead of `6`)</span></span>
<span id="cb277-2"><a href="#cb277-2" aria-hidden="true" tabindex="-1"></a><span class="co">#  or `%in% c(4, 6)`    (instead of `== 4 | 6`)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Answer: fixed!</p>
<p>AR solutions: see the comments below the fixed code.</p>
<hr>
<ol start="2" type="1">
<li>Why does the following code yield five missing values? (Hint: why is it different from <code>x[NA_real_]</code>?)</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb278"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span></span>
<span id="cb278-2"><a href="#cb278-2" aria-hidden="true" tabindex="-1"></a>x[<span class="cn">NA</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] NA NA NA NA NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb280"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a>x[<span class="cn">NA_real_</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb282"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a>x[<span class="cn">TRUE</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 1 2 3 4 5</code></pre>
</div>
</div>
<p>Answer: NA is a logical constant of length 1.</p>
<p>AR Solutions: In contrast to <code>NA_real</code>, <code>NA</code> has logical type and logical vectors are recycled to the same length as the vector being subset, i.e.&nbsp;<code>x[NA]</code> is recycled to <code>x[c(NA, NA, NA, NA, NA)]</code>.</p>
<hr>
<ol start="3" type="1">
<li>What does <code>upper.tri()</code> return? How does subsetting a matrix with it work? Do we need any additional subsetting rules to describe its behaviour?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb284"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">outer</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">FUN =</span> <span class="st">"*"</span>)</span>
<span id="cb284-2"><a href="#cb284-2" aria-hidden="true" tabindex="-1"></a>x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;      [,1] [,2] [,3] [,4] [,5]
#&gt; [1,]    1    2    3    4    5
#&gt; [2,]    2    4    6    8   10
#&gt; [3,]    3    6    9   12   15
#&gt; [4,]    4    8   12   16   20
#&gt; [5,]    5   10   15   20   25</code></pre>
</div>
<div class="sourceCode cell-code" id="cb286"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a>x[<span class="fu">upper.tri</span>(x)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  [1]  2  3  6  4  8 12  5 10 15 20</code></pre>
</div>
</div>
<p>Answer: <code>upper.tri()</code> returns a matrix of logicals, which can be used to subset the upper triangle. This is subsetting by matrix, which is new.</p>
<p>AR Solutions: <code>upper.tri(x)</code> returns a logical matrix, which contains <code>TRUE</code> values above the diagonal and <code>FALSE</code> values everywhere else. In <code>upper.tri()</code> the positions for <code>TRUE</code> and <code>FALSE</code> values are determined by comparing <code>x</code>’s row and column indices via <code>.row(dim(x)) &lt; .col(dim(x))</code>.</p>
<p>When subsetting with logical matrices, all elements that correspond to <code>TRUE</code> will be selected. Matrices extend vectors with a dimension attribute, so the vector forms of subsetting can be used (including logical subsetting). We should take care, that the dimensions of the subsetting matrix match the object of interest — otherwise unintended selections due to vector recycling may occur. Please also note, that this form of subsetting returns a vector instead of a matrix, as the subsetting alters the dimensions of the object.</p>
<hr>
<ol start="4" type="1">
<li>Why does <code>mtcars[1:20]</code> return an error? How does it differ from the similar <code>mtcars[1:20, ]</code>?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb288"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a><span class="fu">try</span>(mtcars[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Error in `[.data.frame`(mtcars, 1:20) : undefined columns selected</code></pre>
</div>
<div class="sourceCode cell-code" id="cb290"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a>mtcars[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;                      mpg cyl  disp  hp drat    wt  qsec vs am gear carb
#&gt; Mazda RX4           21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4
#&gt; Mazda RX4 Wag       21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4
#&gt; Datsun 710          22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1
#&gt; Hornet 4 Drive      21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1
#&gt; Hornet Sportabout   18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2
#&gt; Valiant             18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1
#&gt; Duster 360          14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4
#&gt; Merc 240D           24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2
#&gt; Merc 230            22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2
#&gt; Merc 280            19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4
#&gt; Merc 280C           17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4
#&gt; Merc 450SE          16.4   8 275.8 180 3.07 4.070 17.40  0  0    3    3
#&gt; Merc 450SL          17.3   8 275.8 180 3.07 3.730 17.60  0  0    3    3
#&gt; Merc 450SLC         15.2   8 275.8 180 3.07 3.780 18.00  0  0    3    3
#&gt; Cadillac Fleetwood  10.4   8 472.0 205 2.93 5.250 17.98  0  0    3    4
#&gt; Lincoln Continental 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4
#&gt; Chrysler Imperial   14.7   8 440.0 230 3.23 5.345 17.42  0  0    3    4
#&gt; Fiat 128            32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1
#&gt; Honda Civic         30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2
#&gt; Toyota Corolla      33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1</code></pre>
</div>
</div>
<p>Answer: <code>mtcars[1:20]</code> selects the first 20 columns, but there are only 11. <code>mtcars[1:20, ]</code> selects the first 20 rows of 32.</p>
<p>AR Solutions: When subsetting a data frame with a single vector, it behaves the same way as subsetting a list of columns. So, <code>mtcars[1:20]</code> would return a data frame containing the first 20 columns of the dataset. However, as <code>mtcars</code> has only 11 columns, the index will be out of bounds and an error is thrown. <code>mtcars[1:20, ]</code> is subsetted with two vectors, so 2d subsetting kicks in, and the first index refers to rows.</p>
<hr>
<ol start="5" type="1">
<li>Implement your own function that extracts the diagonal entries from a matrix (it should behave like <code>diag(x)</code> where <code>x</code> is a matrix).</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb292"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb292-1"><a href="#cb292-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>, <span class="fu">c</span>(</span>
<span id="cb292-2"><a href="#cb292-2" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span>,</span>
<span id="cb292-3"><a href="#cb292-3" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">8</span>,</span>
<span id="cb292-4"><a href="#cb292-4" aria-hidden="true" tabindex="-1"></a>  <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span></span>
<span id="cb292-5"><a href="#cb292-5" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb292-6"><a href="#cb292-6" aria-hidden="true" tabindex="-1"></a>m</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;      [,1] [,2] [,3]
#&gt; [1,]    1    4    7
#&gt; [2,]    2    5    8
#&gt; [3,]    3    6    9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb294"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb294-1"><a href="#cb294-1" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 1 5 9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb296"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb296-1"><a href="#cb296-1" aria-hidden="true" tabindex="-1"></a>my_diag <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb296-2"><a href="#cb296-2" aria-hidden="true" tabindex="-1"></a>  diag_element <span class="ot">&lt;-</span> <span class="cf">function</span>(n, x) {</span>
<span id="cb296-3"><a href="#cb296-3" aria-hidden="true" tabindex="-1"></a>    x[n, n]</span>
<span id="cb296-4"><a href="#cb296-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb296-5"><a href="#cb296-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">vapply</span>(<span class="fu">seq_len</span>(<span class="fu">nrow</span>(m)), diag_element, <span class="dv">1</span>, x)</span>
<span id="cb296-6"><a href="#cb296-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb296-7"><a href="#cb296-7" aria-hidden="true" tabindex="-1"></a><span class="fu">my_diag</span>(m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 1 5 9</code></pre>
</div>
</div>
<p>Answer: code above.</p>
<p>AR Solutions: The elements in the diagonal of a matrix have the same row- and column indices. This characteristic can be used to create a suitable numeric matrix used for subsetting.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb298"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb298-1"><a href="#cb298-1" aria-hidden="true" tabindex="-1"></a>diag2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb298-2"><a href="#cb298-2" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="fu">nrow</span>(x), <span class="fu">ncol</span>(x))</span>
<span id="cb298-3"><a href="#cb298-3" aria-hidden="true" tabindex="-1"></a>  idx <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">seq_len</span>(n), <span class="fu">seq_len</span>(n))</span>
<span id="cb298-4"><a href="#cb298-4" aria-hidden="true" tabindex="-1"></a>  x[idx]</span>
<span id="cb298-5"><a href="#cb298-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb298-6"><a href="#cb298-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's check if it works</span></span>
<span id="cb298-7"><a href="#cb298-7" aria-hidden="true" tabindex="-1"></a>(x <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>, <span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;      [,1] [,2] [,3] [,4] [,5] [,6]
#&gt; [1,]    1    6   11   16   21   26
#&gt; [2,]    2    7   12   17   22   27
#&gt; [3,]    3    8   13   18   23   28
#&gt; [4,]    4    9   14   19   24   29
#&gt; [5,]    5   10   15   20   25   30</code></pre>
</div>
<div class="sourceCode cell-code" id="cb300"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb300-1"><a href="#cb300-1" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1]  1  7 13 19 25</code></pre>
</div>
<div class="sourceCode cell-code" id="cb302"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true" tabindex="-1"></a><span class="fu">diag2</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1]  1  7 13 19 25</code></pre>
</div>
</div>
<hr>
<ol start="5" type="1">
<li>What does <code>df[is.na(df)] &lt;- 0</code> do? How does it work?</li>
</ol>
<p>Answer: sets the <code>NA</code> values in <code>df</code> to <code>0</code>, by first selecting <code>NA</code> values then assigning <code>0</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb304"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb304-1"><a href="#cb304-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="cn">NA</span>), <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="cn">NA</span>, <span class="dv">6</span>), <span class="at">z =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">8</span>, <span class="dv">9</span>))</span>
<span id="cb304-2"><a href="#cb304-2" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;    x  y  z
#&gt; 1  1  4 NA
#&gt; 2  2 NA  8
#&gt; 3 NA  6  9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb306"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb306-1"><a href="#cb306-1" aria-hidden="true" tabindex="-1"></a>df[<span class="fu">is.na</span>(df)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb306-2"><a href="#cb306-2" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;   x y z
#&gt; 1 1 4 0
#&gt; 2 2 0 8
#&gt; 3 0 6 9</code></pre>
</div>
</div>
<p>Correct!</p>
<p>AR Solutions: This expression replaces the <code>NA</code>s in <code>df</code> with <code>0</code>. Here <code>is.na(df)</code> returns a logical matrix that encodes the position of the missing values in <code>df</code>. Subsetting and assignment are then combined to replace only the missing values.</p>
<hr>
</section>
<section id="exercises-10" class="level3">
<h3 class="anchored" data-anchor-id="exercises-10">4.3.5 Exercises</h3>
<ol type="1">
<li>Brainstorm as many ways as possible to extract the third value from the <code>cyl</code> variable in the <code>mtcars</code> dataset.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb308"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb308-1"><a href="#cb308-1" aria-hidden="true" tabindex="-1"></a>mtcars<span class="sc">$</span>cyl[<span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb310"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb310-1"><a href="#cb310-1" aria-hidden="true" tabindex="-1"></a>mtcars<span class="sc">$</span>cyl[[<span class="dv">3</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb312"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb312-1"><a href="#cb312-1" aria-hidden="true" tabindex="-1"></a>mtcars[[<span class="st">"cyl"</span>]][[<span class="dv">3</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb314"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb314-1"><a href="#cb314-1" aria-hidden="true" tabindex="-1"></a>mtcars[<span class="dv">3</span>, <span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb316"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb316-1"><a href="#cb316-1" aria-hidden="true" tabindex="-1"></a>mtcars[[<span class="dv">3</span>, <span class="dv">2</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb318"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb318-1"><a href="#cb318-1" aria-hidden="true" tabindex="-1"></a>mtcars[[<span class="st">"Datsun 710"</span>, <span class="st">"cyl"</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb320"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb320-1"><a href="#cb320-1" aria-hidden="true" tabindex="-1"></a>mtcars[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">4</span><span class="sc">:</span><span class="dv">32</span>), <span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">11</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 4</code></pre>
</div>
</div>
<p>Answer: code above (some variations omitted). There are many more.</p>
<p>AR Solutions: Base R already provides an abundance of possibilities:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb322"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb322-1"><a href="#cb322-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select column first</span></span>
<span id="cb322-2"><a href="#cb322-2" aria-hidden="true" tabindex="-1"></a>mtcars<span class="sc">$</span>cyl[[<span class="dv">3</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb324"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb324-1"><a href="#cb324-1" aria-hidden="true" tabindex="-1"></a>mtcars[, <span class="st">"cyl"</span>][[<span class="dv">3</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb326"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb326-1"><a href="#cb326-1" aria-hidden="true" tabindex="-1"></a>mtcars[[<span class="st">"cyl"</span>]][[<span class="dv">3</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb328"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb328-1"><a href="#cb328-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(mtcars, cyl[[<span class="dv">3</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb330"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb330-1"><a href="#cb330-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select row first</span></span>
<span id="cb330-2"><a href="#cb330-2" aria-hidden="true" tabindex="-1"></a>mtcars[<span class="dv">3</span>, ]<span class="sc">$</span>cyl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb332"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb332-1"><a href="#cb332-1" aria-hidden="true" tabindex="-1"></a>mtcars[<span class="dv">3</span>, <span class="st">"cyl"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb334"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb334-1"><a href="#cb334-1" aria-hidden="true" tabindex="-1"></a>mtcars[<span class="dv">3</span>, ][, <span class="st">"cyl"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb336"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb336-1"><a href="#cb336-1" aria-hidden="true" tabindex="-1"></a>mtcars[<span class="dv">3</span>, ][[<span class="st">"cyl"</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb338"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb338-1"><a href="#cb338-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select simultaneously</span></span>
<span id="cb338-2"><a href="#cb338-2" aria-hidden="true" tabindex="-1"></a>mtcars[<span class="dv">3</span>, <span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb340"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb340-1"><a href="#cb340-1" aria-hidden="true" tabindex="-1"></a>mtcars[[<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>)]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 4</code></pre>
</div>
</div>
<hr>
<ol start="2" type="1">
<li>Given a linear model, e.g., <code>mod &lt;- lm(mpg ~ wt, data = mtcars)</code>, extract the residual degrees of freedom. Then extract the R squared from the model summary (<code>summary(mod)</code>)</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb342"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb342-1"><a href="#cb342-1" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> wt, <span class="at">data =</span> mtcars)</span>
<span id="cb342-2"><a href="#cb342-2" aria-hidden="true" tabindex="-1"></a>mod<span class="sc">$</span>df.residual</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 30</code></pre>
</div>
<div class="sourceCode cell-code" id="cb344"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb344-1"><a href="#cb344-1" aria-hidden="true" tabindex="-1"></a>mod_sum <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod)</span>
<span id="cb344-2"><a href="#cb344-2" aria-hidden="true" tabindex="-1"></a>mod_sum<span class="sc">$</span>r.squared</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 0.7528328</code></pre>
</div>
<div class="sourceCode cell-code" id="cb346"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb346-1"><a href="#cb346-1" aria-hidden="true" tabindex="-1"></a>mod_sum</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt; Call:
#&gt; lm(formula = mpg ~ wt, data = mtcars)
#&gt; 
#&gt; Residuals:
#&gt;     Min      1Q  Median      3Q     Max 
#&gt; -4.5432 -2.3647 -0.1252  1.4096  6.8727 
#&gt; 
#&gt; Coefficients:
#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    
#&gt; (Intercept)  37.2851     1.8776  19.858  &lt; 2e-16 ***
#&gt; wt           -5.3445     0.5591  -9.559 1.29e-10 ***
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; 
#&gt; Residual standard error: 3.046 on 30 degrees of freedom
#&gt; Multiple R-squared:  0.7528, Adjusted R-squared:  0.7446 
#&gt; F-statistic: 91.38 on 1 and 30 DF,  p-value: 1.294e-10</code></pre>
</div>
</div>
<p>Answer: code above.</p>
<p>AR Solutions: <code>mod</code> is of type list, which opens up several possibilities. We use <code>$</code> or <code>[[</code> to extract a single element:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb348"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb348-1"><a href="#cb348-1" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> wt, <span class="at">data =</span> mtcars)</span>
<span id="cb348-2"><a href="#cb348-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb348-3"><a href="#cb348-3" aria-hidden="true" tabindex="-1"></a>mod<span class="sc">$</span>df.residual</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 30</code></pre>
</div>
<div class="sourceCode cell-code" id="cb350"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb350-1"><a href="#cb350-1" aria-hidden="true" tabindex="-1"></a>mod[[<span class="st">"df.residual"</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 30</code></pre>
</div>
</div>
<p>The same also applies to <code>summary(mod)</code>, so we could use, e.g.:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb352"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb352-1"><a href="#cb352-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod)<span class="sc">$</span>r.squared</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 0.7528328</code></pre>
</div>
</div>
<p>(Tip: The <a href="https://github.com/tidymodels/broom"><code>broom</code> package</a> provides a very useful approach to work with models in a tidy way.)</p>
<hr>
</section>
<section id="exercises-11" class="level3">
<h3 class="anchored" data-anchor-id="exercises-11">4.5.9 Exercises</h3>
<ol type="1">
<li>How would you randomly permute the columns of a data frame? (This is an important technique in random forests.) Can you simultaneously permute the rows and columns in one step?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb354"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb354-1"><a href="#cb354-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">y =</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">z =</span> letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>], <span class="at">row.names =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb354-2"><a href="#cb354-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb354-3"><a href="#cb354-3" aria-hidden="true" tabindex="-1"></a>df[, <span class="fu">sample</span>(<span class="fu">ncol</span>(df))]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;   x y z
#&gt; 1 1 5 a
#&gt; 2 2 4 b
#&gt; 3 3 3 c
#&gt; 4 4 2 d
#&gt; 5 5 1 e</code></pre>
</div>
<div class="sourceCode cell-code" id="cb356"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb356-1"><a href="#cb356-1" aria-hidden="true" tabindex="-1"></a>df[<span class="fu">sample</span>(<span class="fu">nrow</span>(df)), <span class="fu">sample</span>(<span class="fu">ncol</span>(df))]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;   y x z
#&gt; 3 3 3 c
#&gt; 2 4 2 b
#&gt; 4 2 4 d
#&gt; 5 1 5 e
#&gt; 1 5 1 a</code></pre>
</div>
</div>
<p>Answer: using <code>sample()</code>. Yes!</p>
<p>AR Solutions: This can be achieved by combining <code>[</code> and <code>sample()</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb358"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb358-1"><a href="#cb358-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Permute columns</span></span>
<span id="cb358-2"><a href="#cb358-2" aria-hidden="true" tabindex="-1"></a>mtcars[<span class="fu">sample</span>(<span class="fu">ncol</span>(mtcars))]</span>
<span id="cb358-3"><a href="#cb358-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb358-4"><a href="#cb358-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Permute columns and rows in one step</span></span>
<span id="cb358-5"><a href="#cb358-5" aria-hidden="true" tabindex="-1"></a>mtcars[<span class="fu">sample</span>(<span class="fu">nrow</span>(mtcars)), <span class="fu">sample</span>(<span class="fu">ncol</span>(mtcars))]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ol start="2" type="1">
<li>How would you select a random sample of <code>m</code> rows from a data frame? What if the sample had to be contiguous (i.e., with an initial row, a final row, and every row in between)?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb359"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb359-1"><a href="#cb359-1" aria-hidden="true" tabindex="-1"></a>sample_rows <span class="ot">&lt;-</span> <span class="cf">function</span>(df, m, <span class="at">contiguous =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb359-2"><a href="#cb359-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (m <span class="sc">&gt;</span> <span class="fu">nrow</span>(df)) {</span>
<span id="cb359-3"><a href="#cb359-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"sample size '"</span>, m, <span class="st">"' is larger than the number of rows, '"</span>, <span class="fu">nrow</span>(df), <span class="st">"'"</span>)</span>
<span id="cb359-4"><a href="#cb359-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb359-5"><a href="#cb359-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (contiguous) {</span>
<span id="cb359-6"><a href="#cb359-6" aria-hidden="true" tabindex="-1"></a>    first_row <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(df) <span class="sc">-</span> m <span class="sc">+</span> <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb359-7"><a href="#cb359-7" aria-hidden="true" tabindex="-1"></a>    last_row <span class="ot">&lt;-</span> first_row <span class="sc">+</span> m <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb359-8"><a href="#cb359-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(df[first_row<span class="sc">:</span>last_row, ])</span>
<span id="cb359-9"><a href="#cb359-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb359-10"><a href="#cb359-10" aria-hidden="true" tabindex="-1"></a>  df[<span class="fu">sample</span>(<span class="fu">nrow</span>(df), m), ]</span>
<span id="cb359-11"><a href="#cb359-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb359-12"><a href="#cb359-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb359-13"><a href="#cb359-13" aria-hidden="true" tabindex="-1"></a><span class="fu">sample_rows</span>(df, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;   x y z
#&gt; 4 4 2 d
#&gt; 1 1 5 a
#&gt; 3 3 3 c</code></pre>
</div>
<div class="sourceCode cell-code" id="cb361"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb361-1"><a href="#cb361-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample_rows</span>(df, <span class="dv">3</span>, <span class="at">contiguous =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;   x y z
#&gt; 2 2 4 b
#&gt; 3 3 3 c
#&gt; 4 4 2 d</code></pre>
</div>
<div class="sourceCode cell-code" id="cb363"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb363-1"><a href="#cb363-1" aria-hidden="true" tabindex="-1"></a><span class="fu">try</span>(<span class="fu">sample_rows</span>(df, <span class="dv">6</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Error in sample_rows(df, 6) : 
#&gt;   sample size '6' is larger than the number of rows, '5'</code></pre>
</div>
</div>
<p>Answer: code above.</p>
<p>AR Solutions: Selecting <code>m</code> random rows from a data frame can be achieved through subsetting.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb365"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb365-1"><a href="#cb365-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb365-2"><a href="#cb365-2" aria-hidden="true" tabindex="-1"></a>mtcars[<span class="fu">sample</span>(<span class="fu">nrow</span>(mtcars), m), ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Holding successive lines together as a blocked sample requires only a certain amount of caution in order to obtain the correct start and end index.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb366"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb366-1"><a href="#cb366-1" aria-hidden="true" tabindex="-1"></a>start <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(mtcars) <span class="sc">-</span> m <span class="sc">+</span> <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb366-2"><a href="#cb366-2" aria-hidden="true" tabindex="-1"></a>end <span class="ot">&lt;-</span> start <span class="sc">+</span> m <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb366-3"><a href="#cb366-3" aria-hidden="true" tabindex="-1"></a>mtcars[start<span class="sc">:</span>end, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ol start="3" type="1">
<li>How could you put the columns in a data frame in alphabetical order?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb367"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb367-1"><a href="#cb367-1" aria-hidden="true" tabindex="-1"></a>mtcars[<span class="fu">sort</span>(<span class="fu">colnames</span>(mtcars))]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;                     am carb cyl  disp drat gear  hp  mpg  qsec vs    wt
#&gt; Mazda RX4            1    4   6 160.0 3.90    4 110 21.0 16.46  0 2.620
#&gt; Mazda RX4 Wag        1    4   6 160.0 3.90    4 110 21.0 17.02  0 2.875
#&gt; Datsun 710           1    1   4 108.0 3.85    4  93 22.8 18.61  1 2.320
#&gt; Hornet 4 Drive       0    1   6 258.0 3.08    3 110 21.4 19.44  1 3.215
#&gt; Hornet Sportabout    0    2   8 360.0 3.15    3 175 18.7 17.02  0 3.440
#&gt; Valiant              0    1   6 225.0 2.76    3 105 18.1 20.22  1 3.460
#&gt; Duster 360           0    4   8 360.0 3.21    3 245 14.3 15.84  0 3.570
#&gt; Merc 240D            0    2   4 146.7 3.69    4  62 24.4 20.00  1 3.190
#&gt; Merc 230             0    2   4 140.8 3.92    4  95 22.8 22.90  1 3.150
#&gt; Merc 280             0    4   6 167.6 3.92    4 123 19.2 18.30  1 3.440
#&gt; Merc 280C            0    4   6 167.6 3.92    4 123 17.8 18.90  1 3.440
#&gt; Merc 450SE           0    3   8 275.8 3.07    3 180 16.4 17.40  0 4.070
#&gt; Merc 450SL           0    3   8 275.8 3.07    3 180 17.3 17.60  0 3.730
#&gt; Merc 450SLC          0    3   8 275.8 3.07    3 180 15.2 18.00  0 3.780
#&gt; Cadillac Fleetwood   0    4   8 472.0 2.93    3 205 10.4 17.98  0 5.250
#&gt; Lincoln Continental  0    4   8 460.0 3.00    3 215 10.4 17.82  0 5.424
#&gt; Chrysler Imperial    0    4   8 440.0 3.23    3 230 14.7 17.42  0 5.345
#&gt; Fiat 128             1    1   4  78.7 4.08    4  66 32.4 19.47  1 2.200
#&gt; Honda Civic          1    2   4  75.7 4.93    4  52 30.4 18.52  1 1.615
#&gt; Toyota Corolla       1    1   4  71.1 4.22    4  65 33.9 19.90  1 1.835
#&gt; Toyota Corona        0    1   4 120.1 3.70    3  97 21.5 20.01  1 2.465
#&gt; Dodge Challenger     0    2   8 318.0 2.76    3 150 15.5 16.87  0 3.520
#&gt; AMC Javelin          0    2   8 304.0 3.15    3 150 15.2 17.30  0 3.435
#&gt; Camaro Z28           0    4   8 350.0 3.73    3 245 13.3 15.41  0 3.840
#&gt; Pontiac Firebird     0    2   8 400.0 3.08    3 175 19.2 17.05  0 3.845
#&gt; Fiat X1-9            1    1   4  79.0 4.08    4  66 27.3 18.90  1 1.935
#&gt; Porsche 914-2        1    2   4 120.3 4.43    5  91 26.0 16.70  0 2.140
#&gt; Lotus Europa         1    2   4  95.1 3.77    5 113 30.4 16.90  1 1.513
#&gt; Ford Pantera L       1    4   8 351.0 4.22    5 264 15.8 14.50  0 3.170
#&gt; Ferrari Dino         1    6   6 145.0 3.62    5 175 19.7 15.50  0 2.770
#&gt; Maserati Bora        1    8   8 301.0 3.54    5 335 15.0 14.60  0 3.570
#&gt; Volvo 142E           1    2   4 121.0 4.11    4 109 21.4 18.60  1 2.780</code></pre>
</div>
</div>
<p>Answer: using <code>sort(colnames)</code>.</p>
<p>AR Solutions: We combine <code>[</code> with <code>order()</code> or <code>sort()</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb369"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb369-1"><a href="#cb369-1" aria-hidden="true" tabindex="-1"></a>mtcars[<span class="fu">order</span>(<span class="fu">names</span>(mtcars))]</span>
<span id="cb369-2"><a href="#cb369-2" aria-hidden="true" tabindex="-1"></a>mtcars[<span class="fu">sort</span>(<span class="fu">names</span>(mtcars))]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
</section>
<section id="control-flow" class="level2">
<h2 class="anchored" data-anchor-id="control-flow">5 Control flow</h2>
<p>There are two primary tools of control flow: choices and loops. Choices, like <code>if</code> statements and <code>switch()</code> calls, allow you to run different code depending on the input. Loops, like <code>for</code> and <code>while</code>, allow you to repeatedly run code, typically with changing options. I’d expect that you’re already familiar with the basics of these functions so I’ll briefly cover some technical details and then introduce some useful, but lesser known, features.</p>
<p>The condition system (messages, warnings, and errors), which you’ll learn about in Chapter 8, also provides non-local control flow.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb370"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb370-1"><a href="#cb370-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="exercises-12" class="level3">
<h3 class="anchored" data-anchor-id="exercises-12">5.2.4 Exercises</h3>
<ol type="1">
<li>What type of vector does each of the following calls to <code>ifelse()</code> return? Read the documentation and write down the rules in your own words.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb371"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb371-1"><a href="#cb371-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ifelse</span>(<span class="cn">TRUE</span>, <span class="dv">1</span>, <span class="st">"no"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb373"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb373-1"><a href="#cb373-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(<span class="fu">ifelse</span>(<span class="cn">TRUE</span>, <span class="dv">1</span>, <span class="st">"no"</span>)) <span class="co"># double</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "double"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb375"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb375-1"><a href="#cb375-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ifelse</span>(<span class="cn">FALSE</span>, <span class="dv">1</span>, <span class="st">"no"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "no"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb377"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb377-1"><a href="#cb377-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(<span class="fu">ifelse</span>(<span class="cn">FALSE</span>, <span class="dv">1</span>, <span class="st">"no"</span>)) <span class="co"># character</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "character"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb379"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb379-1"><a href="#cb379-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ifelse</span>(<span class="cn">NA</span>, <span class="dv">1</span>, <span class="st">"no"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb381"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb381-1"><a href="#cb381-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(<span class="fu">ifelse</span>(<span class="cn">NA</span>, <span class="dv">1</span>, <span class="st">"no"</span>)) <span class="co"># logical</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "logical"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb383"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb383-1"><a href="#cb383-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ifelse</span>(<span class="cn">NULL</span>, <span class="dv">1</span>, <span class="st">"no"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; logical(0)</code></pre>
</div>
</div>
<p>Answer:</p>
<ul>
<li>if <code>test</code> is true, return a vector of the same length as <code>test</code> (1) populated with “yes” - here 1 is a double, 1L would be integer</li>
<li>if <code>test</code> is false, return a vector of the same length as <code>test</code> (1) populated with “no” - here “no” is a character</li>
<li>if <code>test</code> is <code>NA</code>, return <code>NA</code>, and if <code>test</code> is <code>NULL</code>, return <code>logical(0)</code></li>
</ul>
<p>AR Solutions: The arguments of <code>ifelse()</code> are named <code>test</code>, <code>yes</code> and <code>no</code>. In general, <code>ifelse()</code> returns the entry for <code>yes</code> when <code>test</code> is <code>TRUE</code>, the entry for <code>no</code> when <code>test</code> is <code>FALSE</code> and <code>NA</code> when <code>test</code> is <code>NA</code>. Therefore, the expressions above return vectors of type <code>double</code> (<code>1</code>), <code>character</code> (<code>"no"</code>) and <code>logical</code> (<code>NA</code>).</p>
<p>To be a little more precise, we will cite the part of the documentation on the return value of <code>ifelse()</code>:</p>
<blockquote class="blockquote">
<p>A vector of the same length and attributes (including dimensions and “class”) as test and data values from the values of yes or no. The mode of the answer will be coerced from logical to accommodate first any values taken from yes and then any values taken from no.</p>
</blockquote>
<p>This is surprising because it uses the type of <code>test</code>. In practice this means, that <code>test</code> is first converted to logical and if the result is neither <code>TRUE</code> nor <code>FALSE</code>, simply <code>as.logical(test)</code> is returned.</p>
<hr>
<ol start="2" type="1">
<li>Why does the following code work?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb385"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb385-1"><a href="#cb385-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb385-2"><a href="#cb385-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(x)) <span class="st">"not empty"</span> <span class="cf">else</span> <span class="st">"empty"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "not empty"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb387"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb387-1"><a href="#cb387-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb387-2"><a href="#cb387-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(x)) <span class="st">"not empty"</span> <span class="cf">else</span> <span class="st">"empty"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "empty"</code></pre>
</div>
</div>
<p>Answer: in the first example, <code>length(x)</code> is nonzero, which evaluates to <code>TRUE</code>. In the second example, <code>numeric()</code> returns a vector of length 0 (the default), <code>length(x)</code> is zero, which evaluates to <code>FALSE</code>.</p>
<p>AR Solutions: <code>if()</code> expects a logical condition, but also accepts a numeric vector where <code>0</code> is treated as <code>FALSE</code> and all other numbers are treated as <code>TRUE</code>. Numerical missing values (including <code>NaN</code>) lead to an error in the same way that a logical missing, <code>NA</code>, does.</p>
<hr>
</section>
<section id="exercises-13" class="level3">
<h3 class="anchored" data-anchor-id="exercises-13">5.3.3 Exercises</h3>
<ol type="1">
<li>Why does this code succeed without errors or warnings?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb389"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb389-1"><a href="#cb389-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">numeric</span>() <span class="co"># x is numeric(0)</span></span>
<span id="cb389-2"><a href="#cb389-2" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, <span class="fu">length</span>(x)) <span class="co"># out is list(0)</span></span>
<span id="cb389-3"><a href="#cb389-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x)) { <span class="co"># nolint: seq_linter. i is 1, then 0.</span></span>
<span id="cb389-4"><a href="#cb389-4" aria-hidden="true" tabindex="-1"></a>  out[i] <span class="ot">&lt;-</span> x[i]<span class="sc">^</span><span class="dv">2</span> <span class="co"># when i = 1 x[1] is NA, sets out[1] to NA. when i = 0 nothing happens</span></span>
<span id="cb389-5"><a href="#cb389-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb389-6"><a href="#cb389-6" aria-hidden="true" tabindex="-1"></a>out</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [[1]]
#&gt; [1] NA</code></pre>
</div>
</div>
<p>Answer: in addition to notes above, <code>out[0]</code> and <code>x[0]</code> return a zero-length vector.</p>
<p>AR Solutions: This loop is a delicate issue, and we have to consider a few points to explain why it is evaluated without raising any errors or warnings.</p>
<p>The beginning of this code smell is the statement <code>1:length(x)</code> which creates the index of the for loop. As <code>x</code> has length 0 <code>1:length(x)</code> counts down from 1 to 0. This issue is typically avoided via usage of <code>seq_along(x)</code> or similar helpers which would just generate <code>integer(0)</code> in this case.</p>
<p>As we use <code>[&lt;-</code> and <code>[</code> for indexing 0-length vectors at their first and zeroth position, we need to be aware of their subsetting behaviour for out-of-bounds and zero indices.</p>
<p>During the first iteration <code>x[1]</code> will generate an <code>NA</code> (out-of-bounds indexing for atomics). The resulting <code>NA</code> (from squaring) will be assigned to the empty length-1 list <code>out[1]</code> (out-of-bounds indexing for lists).</p>
<p>In the next iteration, <code>x[0]</code> will return <code>numeric(0)</code> (zero indexing for atomics). Again, squaring doesn’t change the value and <code>numeric(0)</code> is assigned to <code>out[0]</code> (zero indexing for lists). Assigning a 0-length vector to a 0-length subset works but doesn’t change the object.</p>
<p>Overall, the code works, because each step includes valid R operations (even though the result may not be what the user intended).</p>
<hr>
<ol start="2" type="1">
<li>When the following code is evaluated, what can you say about the vector being iterated?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb391"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb391-1"><a href="#cb391-1" aria-hidden="true" tabindex="-1"></a>xs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb391-2"><a href="#cb391-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (x <span class="cf">in</span> xs) {</span>
<span id="cb391-3"><a href="#cb391-3" aria-hidden="true" tabindex="-1"></a>  xs <span class="ot">&lt;-</span> <span class="fu">c</span>(xs, x <span class="sc">*</span> <span class="dv">2</span>)</span>
<span id="cb391-4"><a href="#cb391-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb391-5"><a href="#cb391-5" aria-hidden="true" tabindex="-1"></a>xs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 1 2 3 2 4 6</code></pre>
</div>
</div>
<p>Answer: <code>x</code> iterates from 1 to 3, and is not affected by changes to <code>xs</code> during the loop, while <code>xs</code> is updated.</p>
<p>AR Solution: In this loop <code>x</code> takes on the values of the initial <code>xs</code> (<code>1</code>, <code>2</code> and <code>3</code>), indicating that it is evaluated just once in the beginning of the loop, not after each iteration. (Otherwise, we would run into an infinite loop.)</p>
<hr>
<ol start="3" type="1">
<li>What does the following code tell you about when the index is updated?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb393"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb393-1"><a href="#cb393-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) {</span>
<span id="cb393-2"><a href="#cb393-2" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> i <span class="sc">*</span> <span class="dv">2</span></span>
<span id="cb393-3"><a href="#cb393-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(i)</span>
<span id="cb393-4"><a href="#cb393-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 2
#&gt; [1] 4
#&gt; [1] 6</code></pre>
</div>
</div>
<p>Answer: the index is updated at the beginning of each loop.</p>
<p>AR Solutions: In a for loop the index is updated in the beginning of each iteration. Therefore, reassigning the index symbol during one iteration doesn’t affect the following iterations. (Again, we would otherwise run into an infinite loop.)</p>
<hr>
</section>
</section>
<section id="functions" class="level2">
<h2 class="anchored" data-anchor-id="functions">6 Functions</h2>
<p>If you’re reading this book, you’ve probably already created many R functions and know how to use them to reduce duplication in your code. In this chapter, you’ll learn how to turn that informal, working knowledge into more rigorous, theoretical understanding. And while you’ll see some interesting tricks and techniques along the way, keep in mind that what you’ll learn here will be important for understanding the more advanced topics discussed later in the book.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb395"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb395-1"><a href="#cb395-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="quiz-1" class="level3">
<h3 class="anchored" data-anchor-id="quiz-1">6 Quiz</h3>
<p>Answer the following questions to see if you can safely skip this chapter.</p>
<ol type="1">
<li><p>What are the three components of a function? a: arguments, code, return value [body, arguments, environment]</p></li>
<li><p>What does the following code return? a: 11 [correct!]</p></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb396"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb396-1"><a href="#cb396-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb396-2"><a href="#cb396-2" aria-hidden="true" tabindex="-1"></a>f1 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb396-3"><a href="#cb396-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>() {</span>
<span id="cb396-4"><a href="#cb396-4" aria-hidden="true" tabindex="-1"></a>    x <span class="sc">+</span> <span class="dv">10</span></span>
<span id="cb396-5"><a href="#cb396-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb396-6"><a href="#cb396-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb396-7"><a href="#cb396-7" aria-hidden="true" tabindex="-1"></a><span class="fu">f1</span>(<span class="dv">1</span>)()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 11</code></pre>
</div>
</div>
<ol start="3" type="1">
<li>How would you usually write this code? a: <code>1 + 2 * 3</code> [correct! … <code>1 + (2 * 3)</code>]</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb398"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb398-1"><a href="#cb398-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">+</span><span class="st">`</span>(<span class="dv">1</span>, <span class="st">`</span><span class="at">*</span><span class="st">`</span>(<span class="dv">2</span>, <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="4" type="1">
<li>How could you make this call easier to read? <code>mean(c(1:10, NA), na.rm = TRUE)</code> [correct!]</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb399"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb399-1"><a href="#cb399-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(, <span class="cn">TRUE</span>, <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="cn">NA</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="5" type="1">
<li>Does the following code throw an error when executed? Why or why not? a: no, due to lazy evaluation, the <code>stop()</code> is never run [correct! … second argument is never used]</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb400"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb400-1"><a href="#cb400-1" aria-hidden="true" tabindex="-1"></a>f2 <span class="ot">&lt;-</span> <span class="cf">function</span>(a, b) {</span>
<span id="cb400-2"><a href="#cb400-2" aria-hidden="true" tabindex="-1"></a>  a <span class="sc">*</span> <span class="dv">10</span></span>
<span id="cb400-3"><a href="#cb400-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb400-4"><a href="#cb400-4" aria-hidden="true" tabindex="-1"></a><span class="fu">f2</span>(<span class="dv">10</span>, <span class="fu">stop</span>(<span class="st">"This is an error!"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 100</code></pre>
</div>
</div>
<ol start="6" type="1">
<li><p>What is an infix function? How do you write it? What’s a replacement function? How do you write it? a: <code>function(x) x</code>. ??? [see 6.8.3 and 6.8.4]</p></li>
<li><p>How do you ensure that cleanup action occurs regardless of how a function exits? a: ??? [<code>on.exit()</code>]</p></li>
</ol>
</section>
<section id="exercises-14" class="level3">
<h3 class="anchored" data-anchor-id="exercises-14">6.2.5 Exercises</h3>
<ol type="1">
<li>Given a name, like <code>"mean"</code>, <code>match.fun()</code> lets you find a function. Given a function, can you find its name? Why doesn’t that make sense in R?</li>
</ol>
<p>Answer: a function is an object and could have multiple names pointing to it.</p>
<p>AR Solutions: In R there is no one-to-one mapping between functions and names. A name always points to a single object, but an object may have zero, one or many names.</p>
<hr>
<ol start="2" type="1">
<li>It’s possible (although typically not useful) to call an anonymous function. Which of the two approaches below is correct? Why?</li>
</ol>
<div class="cell" data-layout-align="center" data-result="hide">
<div class="sourceCode cell-code" id="cb402"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb402-1"><a href="#cb402-1" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span>(x) <span class="dv">3</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; function(x) 3()</code></pre>
</div>
<div class="sourceCode cell-code" id="cb404"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb404-1"><a href="#cb404-1" aria-hidden="true" tabindex="-1"></a>(<span class="cf">function</span>(x) <span class="dv">3</span>)()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 3</code></pre>
</div>
</div>
<p>Answer: The second is correct, as the first is the form of defining a function.</p>
<p>AR Solutions: The second approach is correct.</p>
<p>The anonymous function <code>function(x) 3</code> is surrounded by a pair of parentheses before it is called by <code>()</code>. These extra parentheses separate the function call from the anonymous function’s body. Without them a function with the invalid body <code>3()</code> is returned, which throws an error when we call it.</p>
<hr>
<ol start="3" type="1">
<li>A good rule of thumb is that an anonymous function should fit on one line and shouldn’t need to use <code>{}</code>. Review your code. Where could you have used an anonymous function instead of a named function? Where should you have used a named function instead of an anonymous function?</li>
</ol>
<p>Answer: in <code>rdev::build_analysis_site()</code>, <code>analysis_menu_item()</code> is properly written as a named function, where <code>get_component()</code> could be written as an anonymous function, with <code>dir_check_copy()</code> and <code>dir_check_delete()</code> potentially either.</p>
<p>AR Solutions: The use of anonymous functions allows concise and elegant code in certain situations. However, they miss a descriptive name and when re-reading the code, it can take a while to figure out what they do. That’s why it’s helpful to give long and complex functions a descriptive name. It may be worthwhile to take a look at your own projects or other people’s code to reflect on this part of your coding style.</p>
<hr>
<ol start="4" type="1">
<li>What function allows you to tell if an object is a function? What function allows you to tell if a function is a primitive function?</li>
</ol>
<p>Answer: <code>is.function()</code> and <code>is.primitive()</code>.</p>
<p>AR Solutions: Use <code>is.function()</code> to test if an object is a function. Consider using <code>is.primitive()</code> to test specifically for primitive functions.</p>
<hr>
<ol start="5" type="1">
<li>This code makes a list of all functions in the base package.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb406"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb406-1"><a href="#cb406-1" aria-hidden="true" tabindex="-1"></a>objs <span class="ot">&lt;-</span> <span class="fu">mget</span>(<span class="fu">ls</span>(<span class="st">"package:base"</span>, <span class="at">all =</span> <span class="cn">TRUE</span>), <span class="at">inherits =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; Warning in ls("package:base", all = TRUE): partial argument match of 'all' to
#&gt; 'all.names'</code></pre>
</div>
<div class="sourceCode cell-code" id="cb408"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb408-1"><a href="#cb408-1" aria-hidden="true" tabindex="-1"></a>funs <span class="ot">&lt;-</span> <span class="fu">Filter</span>(is.function, objs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Use it to answer the following questions:</p>
<ol type="a">
<li>Which base function has the most arguments?</li>
<li>How many base functions have no arguments? What’s special about those functions?</li>
<li>How could you adapt the code to find all primitive functions?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb409"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb409-1"><a href="#cb409-1" aria-hidden="true" tabindex="-1"></a>fun_args <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb409-2"><a href="#cb409-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">names</span>(funs),</span>
<span id="cb409-3"><a href="#cb409-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">args =</span> <span class="fu">unname</span>(<span class="fu">vapply</span>(funs, <span class="cf">function</span>(x) <span class="fu">length</span>(<span class="fu">formals</span>(x)), <span class="dv">1</span>L))</span>
<span id="cb409-4"><a href="#cb409-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb409-5"><a href="#cb409-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(fun_args[<span class="fu">order</span>(fun_args<span class="sc">$</span>args, <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ], <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;                  name args
#&gt; 1070             scan   22
#&gt; 570    format.default   16
#&gt; 1123           source   16
#&gt; 583           formatC   15
#&gt; 764           library   13
#&gt; 821  merge.data.frame   13
#&gt; 920         prettyNum   13
#&gt; 1233          system2   11
#&gt; 928     print.default   10
#&gt; 1065             save   10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb411"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb411-1"><a href="#cb411-1" aria-hidden="true" tabindex="-1"></a>fun_args[fun_args<span class="sc">$</span>args <span class="sc">==</span> <span class="dv">0</span>, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;                          name args
#&gt; 1                           -    0
#&gt; 4                           :    0
#&gt; 5                          ::    0
#&gt; 6                         :::    0
#&gt; 7                           !    0
#&gt; 10                         !=    0
#&gt; 13                     ...elt    0
#&gt; 14                  ...length    0
#&gt; 15                   ...names    0
#&gt; 20                         .C    0
#&gt; 21               .cache_class    0
#&gt; 22                      .Call    0
#&gt; 23             .Call.graphics    0
#&gt; 25                    .class2    0
#&gt; 42                  .External    0
#&gt; 43         .External.graphics    0
#&gt; 44                 .External2    0
#&gt; 45                 .First.sys    0
#&gt; 48                   .Fortran    0
#&gt; 56                  .Internal    0
#&gt; 57       .isMethodsDispatchOn    0
#&gt; 68         .NotYetImplemented    0
#&gt; 70         .OptRequireMethods    0
#&gt; 76                 .Primitive    0
#&gt; 77                 .primTrace    0
#&gt; 78               .primUntrace    0
#&gt; 89          .standard_regexps    0
#&gt; 90                    .subset    0
#&gt; 91                   .subset2    0
#&gt; 94        .tryResumeInterrupt    0
#&gt; 96                          (    0
#&gt; 97                          [    0
#&gt; 115                        [[    0
#&gt; 122                      [[&lt;-    0
#&gt; 127                       [&lt;-    0
#&gt; 135                         {    0
#&gt; 136                         @    0
#&gt; 137                       @&lt;-    0
#&gt; 138                         *    0
#&gt; 140                         /    0
#&gt; 142                         &amp;    0
#&gt; 145                        &amp;&amp;    0
#&gt; 146                       %*%    0
#&gt; 147                       %/%    0
#&gt; 148                        %%    0
#&gt; 152                         ^    0
#&gt; 153                         +    0
#&gt; 156                         &lt;    0
#&gt; 157                        &lt;-    0
#&gt; 158                       &lt;&lt;-    0
#&gt; 159                        &lt;=    0
#&gt; 160                         =    0
#&gt; 161                        ==    0
#&gt; 162                         &gt;    0
#&gt; 163                        &gt;=    0
#&gt; 164                         |    0
#&gt; 167                        ||    0
#&gt; 168                         ~    0
#&gt; 169                         $    0
#&gt; 172                       $&lt;-    0
#&gt; 176                       abs    0
#&gt; 177                      acos    0
#&gt; 178                     acosh    0
#&gt; 185                       all    0
#&gt; 202                       any    0
#&gt; 208                     anyNA    0
#&gt; 217                       Arg    0
#&gt; 224                   as.call    0
#&gt; 225              as.character    0
#&gt; 236                as.complex    0
#&gt; 270                 as.double    0
#&gt; 273            as.environment    0
#&gt; 280                as.integer    0
#&gt; 292                as.logical    0
#&gt; 302                as.numeric    0
#&gt; 321                    as.raw    0
#&gt; 331                      asin    0
#&gt; 332                     asinh    0
#&gt; 338                      atan    0
#&gt; 340                     atanh    0
#&gt; 343                      attr    0
#&gt; 345                    attr&lt;-    0
#&gt; 346                attributes    0
#&gt; 347              attributes&lt;-    0
#&gt; 352                   baseenv    0
#&gt; 371                     break    0
#&gt; 372                   browser    0
#&gt; 381                         c    0
#&gt; 390                      call    0
#&gt; 397                   ceiling    0
#&gt; 410                     class    0
#&gt; 411                   class&lt;-    0
#&gt; 417       closeAllConnections    0
#&gt; 434                      Conj    0
#&gt; 435              contributors    0
#&gt; 436                       cos    0
#&gt; 437                      cosh    0
#&gt; 438                     cospi    0
#&gt; 440               Cstack_info    0
#&gt; 441                    cummax    0
#&gt; 442                    cummin    0
#&gt; 443                   cumprod    0
#&gt; 444                    cumsum    0
#&gt; 453                      date    0
#&gt; 457  default.stringsAsFactors    0
#&gt; 474                   digamma    0
#&gt; 475                       dim    0
#&gt; 477                     dim&lt;-    0
#&gt; 478                  dimnames    0
#&gt; 480                dimnames&lt;-    0
#&gt; 509                  emptyenv    0
#&gt; 510                enc2native    0
#&gt; 511                  enc2utf8    0
#&gt; 519             environment&lt;-    0
#&gt; 527                       exp    0
#&gt; 529                     expm1    0
#&gt; 530                expression    0
#&gt; 531            extSoftVersion    0
#&gt; 558                     floor    0
#&gt; 561                       for    0
#&gt; 563              forceAndCall    0
#&gt; 586                  function    0
#&gt; 587                     gamma    0
#&gt; 589                   gc.time    0
#&gt; 595         getAllConnections    0
#&gt; 603             geterrmessage    0
#&gt; 606             getLoadedDLLs    0
#&gt; 616               getRversion    0
#&gt; 618      getTaskCallbackNames    0
#&gt; 621                     getwd    0
#&gt; 624                 globalenv    0
#&gt; 636                 iconvlist    0
#&gt; 641                        if    0
#&gt; 643                        Im    0
#&gt; 649               interactive    0
#&gt; 654                 invisible    0
#&gt; 657                  is.array    0
#&gt; 658                 is.atomic    0
#&gt; 659                   is.call    0
#&gt; 660              is.character    0
#&gt; 661                is.complex    0
#&gt; 663                 is.double    0
#&gt; 665            is.environment    0
#&gt; 666             is.expression    0
#&gt; 668                 is.finite    0
#&gt; 670               is.function    0
#&gt; 671               is.infinite    0
#&gt; 673                is.integer    0
#&gt; 674               is.language    0
#&gt; 675                   is.list    0
#&gt; 677                is.logical    0
#&gt; 678                 is.matrix    0
#&gt; 679                     is.na    0
#&gt; 687                   is.name    0
#&gt; 688                    is.nan    0
#&gt; 690                   is.null    0
#&gt; 691                is.numeric    0
#&gt; 696                 is.object    0
#&gt; 699               is.pairlist    0
#&gt; 702                      is.R    0
#&gt; 703                    is.raw    0
#&gt; 704              is.recursive    0
#&gt; 705                 is.single    0
#&gt; 706                 is.symbol    0
#&gt; 722                      isS4    0
#&gt; 736                 l10n_info    0
#&gt; 737                La_library    0
#&gt; 738                La_version    0
#&gt; 745           lazyLoadDBfetch    0
#&gt; 748                    length    0
#&gt; 750                  length&lt;-    0
#&gt; 759                  levels&lt;-    0
#&gt; 762                    lgamma    0
#&gt; 763            libcurlVersion    0
#&gt; 767                   licence    0
#&gt; 768                   license    0
#&gt; 769                      list    0
#&gt; 775          loadedNamespaces    0
#&gt; 776      loadingNamespaceInfo    0
#&gt; 781                       log    0
#&gt; 782                     log10    0
#&gt; 783                     log1p    0
#&gt; 784                      log2    0
#&gt; 807                       max    0
#&gt; 819            memory.profile    0
#&gt; 825                       min    0
#&gt; 826                   missing    0
#&gt; 827                       Mod    0
#&gt; 840                     names    0
#&gt; 842                   names&lt;-    0
#&gt; 849                     nargs    0
#&gt; 855                      next    0
#&gt; 864                  nullfile    0
#&gt; 869                    nzchar    0
#&gt; 871                  oldClass    0
#&gt; 872                oldClass&lt;-    0
#&gt; 874                   on.exit    0
#&gt; 907               pcre_config    0
#&gt; 916                pos.to.env    0
#&gt; 959                 proc.time    0
#&gt; 960                      prod    0
#&gt; 983                     quote    0
#&gt; 984             R_compiled_by    0
#&gt; 987                 R.Version    0
#&gt; 988                     range    0
#&gt; 1001                       Re    0
#&gt; 1020                      rep    0
#&gt; 1029                   repeat    0
#&gt; 1036               retracemem    0
#&gt; 1037                   return    0
#&gt; 1045                    round    0
#&gt; 1071                   search    0
#&gt; 1072              searchpaths    0
#&gt; 1076                seq_along    0
#&gt; 1077                  seq_len    0
#&gt; 1080                  seq.int    0
#&gt; 1096                     sign    0
#&gt; 1098                   signif    0
#&gt; 1104                      sin    0
#&gt; 1106                     sinh    0
#&gt; 1109                    sinpi    0
#&gt; 1133                     sqrt    0
#&gt; 1139          standardGeneric    0
#&gt; 1141                   stderr    0
#&gt; 1142                    stdin    0
#&gt; 1143                   stdout    0
#&gt; 1147           storage.mode&lt;-    0
#&gt; 1163               substitute    0
#&gt; 1168                      sum    0
#&gt; 1197                   switch    0
#&gt; 1199                sys.calls    0
#&gt; 1201                 Sys.Date    0
#&gt; 1203               sys.frames    0
#&gt; 1207               Sys.getpid    0
#&gt; 1209                 Sys.info    0
#&gt; 1211           Sys.localeconv    0
#&gt; 1212               sys.nframe    0
#&gt; 1213              sys.on.exit    0
#&gt; 1215              sys.parents    0
#&gt; 1224               sys.status    0
#&gt; 1225                 Sys.time    0
#&gt; 1239                      tan    0
#&gt; 1240                     tanh    0
#&gt; 1241                    tanpi    0
#&gt; 1256                 tracemem    0
#&gt; 1261                 trigamma    0
#&gt; 1263                    trunc    0
#&gt; 1272           unCfillPOSIXlt    0
#&gt; 1273                  unclass    0
#&gt; 1297               untracemem    0
#&gt; 1301                UseMethod    0
#&gt; 1317                    while    0
#&gt; 1334                    xtfrm    0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb413"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb413-1"><a href="#cb413-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check if all functions with 0 arguments are primitive</span></span>
<span id="cb413-2"><a href="#cb413-2" aria-hidden="true" tabindex="-1"></a>fun_args2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb413-3"><a href="#cb413-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">names</span>(funs),</span>
<span id="cb413-4"><a href="#cb413-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">args =</span> <span class="fu">unname</span>(<span class="fu">vapply</span>(funs, <span class="cf">function</span>(x) <span class="fu">length</span>(<span class="fu">formals</span>(x)), <span class="dv">1</span>L)),</span>
<span id="cb413-5"><a href="#cb413-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prim =</span> <span class="fu">unname</span>(<span class="fu">vapply</span>(funs, is.primitive, <span class="cn">TRUE</span>))</span>
<span id="cb413-6"><a href="#cb413-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb413-7"><a href="#cb413-7" aria-hidden="true" tabindex="-1"></a>fun_args2[fun_args2<span class="sc">$</span>args <span class="sc">==</span> <span class="dv">0</span>, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;                          name args  prim
#&gt; 1                           -    0  TRUE
#&gt; 4                           :    0  TRUE
#&gt; 5                          ::    0  TRUE
#&gt; 6                         :::    0  TRUE
#&gt; 7                           !    0  TRUE
#&gt; 10                         !=    0  TRUE
#&gt; 13                     ...elt    0  TRUE
#&gt; 14                  ...length    0  TRUE
#&gt; 15                   ...names    0  TRUE
#&gt; 20                         .C    0  TRUE
#&gt; 21               .cache_class    0  TRUE
#&gt; 22                      .Call    0  TRUE
#&gt; 23             .Call.graphics    0  TRUE
#&gt; 25                    .class2    0  TRUE
#&gt; 42                  .External    0  TRUE
#&gt; 43         .External.graphics    0  TRUE
#&gt; 44                 .External2    0  TRUE
#&gt; 45                 .First.sys    0 FALSE
#&gt; 48                   .Fortran    0  TRUE
#&gt; 56                  .Internal    0  TRUE
#&gt; 57       .isMethodsDispatchOn    0  TRUE
#&gt; 68         .NotYetImplemented    0 FALSE
#&gt; 70         .OptRequireMethods    0 FALSE
#&gt; 76                 .Primitive    0  TRUE
#&gt; 77                 .primTrace    0  TRUE
#&gt; 78               .primUntrace    0  TRUE
#&gt; 89          .standard_regexps    0 FALSE
#&gt; 90                    .subset    0  TRUE
#&gt; 91                   .subset2    0  TRUE
#&gt; 94        .tryResumeInterrupt    0 FALSE
#&gt; 96                          (    0  TRUE
#&gt; 97                          [    0  TRUE
#&gt; 115                        [[    0  TRUE
#&gt; 122                      [[&lt;-    0  TRUE
#&gt; 127                       [&lt;-    0  TRUE
#&gt; 135                         {    0  TRUE
#&gt; 136                         @    0  TRUE
#&gt; 137                       @&lt;-    0  TRUE
#&gt; 138                         *    0  TRUE
#&gt; 140                         /    0  TRUE
#&gt; 142                         &amp;    0  TRUE
#&gt; 145                        &amp;&amp;    0  TRUE
#&gt; 146                       %*%    0  TRUE
#&gt; 147                       %/%    0  TRUE
#&gt; 148                        %%    0  TRUE
#&gt; 152                         ^    0  TRUE
#&gt; 153                         +    0  TRUE
#&gt; 156                         &lt;    0  TRUE
#&gt; 157                        &lt;-    0  TRUE
#&gt; 158                       &lt;&lt;-    0  TRUE
#&gt; 159                        &lt;=    0  TRUE
#&gt; 160                         =    0  TRUE
#&gt; 161                        ==    0  TRUE
#&gt; 162                         &gt;    0  TRUE
#&gt; 163                        &gt;=    0  TRUE
#&gt; 164                         |    0  TRUE
#&gt; 167                        ||    0  TRUE
#&gt; 168                         ~    0  TRUE
#&gt; 169                         $    0  TRUE
#&gt; 172                       $&lt;-    0  TRUE
#&gt; 176                       abs    0  TRUE
#&gt; 177                      acos    0  TRUE
#&gt; 178                     acosh    0  TRUE
#&gt; 185                       all    0  TRUE
#&gt; 202                       any    0  TRUE
#&gt; 208                     anyNA    0  TRUE
#&gt; 217                       Arg    0  TRUE
#&gt; 224                   as.call    0  TRUE
#&gt; 225              as.character    0  TRUE
#&gt; 236                as.complex    0  TRUE
#&gt; 270                 as.double    0  TRUE
#&gt; 273            as.environment    0  TRUE
#&gt; 280                as.integer    0  TRUE
#&gt; 292                as.logical    0  TRUE
#&gt; 302                as.numeric    0  TRUE
#&gt; 321                    as.raw    0  TRUE
#&gt; 331                      asin    0  TRUE
#&gt; 332                     asinh    0  TRUE
#&gt; 338                      atan    0  TRUE
#&gt; 340                     atanh    0  TRUE
#&gt; 343                      attr    0  TRUE
#&gt; 345                    attr&lt;-    0  TRUE
#&gt; 346                attributes    0  TRUE
#&gt; 347              attributes&lt;-    0  TRUE
#&gt; 352                   baseenv    0  TRUE
#&gt; 371                     break    0  TRUE
#&gt; 372                   browser    0  TRUE
#&gt; 381                         c    0  TRUE
#&gt; 390                      call    0  TRUE
#&gt; 397                   ceiling    0  TRUE
#&gt; 410                     class    0  TRUE
#&gt; 411                   class&lt;-    0  TRUE
#&gt; 417       closeAllConnections    0 FALSE
#&gt; 434                      Conj    0  TRUE
#&gt; 435              contributors    0 FALSE
#&gt; 436                       cos    0  TRUE
#&gt; 437                      cosh    0  TRUE
#&gt; 438                     cospi    0  TRUE
#&gt; 440               Cstack_info    0 FALSE
#&gt; 441                    cummax    0  TRUE
#&gt; 442                    cummin    0  TRUE
#&gt; 443                   cumprod    0  TRUE
#&gt; 444                    cumsum    0  TRUE
#&gt; 453                      date    0 FALSE
#&gt; 457  default.stringsAsFactors    0 FALSE
#&gt; 474                   digamma    0  TRUE
#&gt; 475                       dim    0  TRUE
#&gt; 477                     dim&lt;-    0  TRUE
#&gt; 478                  dimnames    0  TRUE
#&gt; 480                dimnames&lt;-    0  TRUE
#&gt; 509                  emptyenv    0  TRUE
#&gt; 510                enc2native    0  TRUE
#&gt; 511                  enc2utf8    0  TRUE
#&gt; 519             environment&lt;-    0  TRUE
#&gt; 527                       exp    0  TRUE
#&gt; 529                     expm1    0  TRUE
#&gt; 530                expression    0  TRUE
#&gt; 531            extSoftVersion    0 FALSE
#&gt; 558                     floor    0  TRUE
#&gt; 561                       for    0  TRUE
#&gt; 563              forceAndCall    0  TRUE
#&gt; 586                  function    0  TRUE
#&gt; 587                     gamma    0  TRUE
#&gt; 589                   gc.time    0  TRUE
#&gt; 595         getAllConnections    0 FALSE
#&gt; 603             geterrmessage    0 FALSE
#&gt; 606             getLoadedDLLs    0 FALSE
#&gt; 616               getRversion    0 FALSE
#&gt; 618      getTaskCallbackNames    0 FALSE
#&gt; 621                     getwd    0 FALSE
#&gt; 624                 globalenv    0  TRUE
#&gt; 636                 iconvlist    0 FALSE
#&gt; 641                        if    0  TRUE
#&gt; 643                        Im    0  TRUE
#&gt; 649               interactive    0  TRUE
#&gt; 654                 invisible    0  TRUE
#&gt; 657                  is.array    0  TRUE
#&gt; 658                 is.atomic    0  TRUE
#&gt; 659                   is.call    0  TRUE
#&gt; 660              is.character    0  TRUE
#&gt; 661                is.complex    0  TRUE
#&gt; 663                 is.double    0  TRUE
#&gt; 665            is.environment    0  TRUE
#&gt; 666             is.expression    0  TRUE
#&gt; 668                 is.finite    0  TRUE
#&gt; 670               is.function    0  TRUE
#&gt; 671               is.infinite    0  TRUE
#&gt; 673                is.integer    0  TRUE
#&gt; 674               is.language    0  TRUE
#&gt; 675                   is.list    0  TRUE
#&gt; 677                is.logical    0  TRUE
#&gt; 678                 is.matrix    0  TRUE
#&gt; 679                     is.na    0  TRUE
#&gt; 687                   is.name    0  TRUE
#&gt; 688                    is.nan    0  TRUE
#&gt; 690                   is.null    0  TRUE
#&gt; 691                is.numeric    0  TRUE
#&gt; 696                 is.object    0  TRUE
#&gt; 699               is.pairlist    0  TRUE
#&gt; 702                      is.R    0 FALSE
#&gt; 703                    is.raw    0  TRUE
#&gt; 704              is.recursive    0  TRUE
#&gt; 705                 is.single    0  TRUE
#&gt; 706                 is.symbol    0  TRUE
#&gt; 722                      isS4    0  TRUE
#&gt; 736                 l10n_info    0 FALSE
#&gt; 737                La_library    0 FALSE
#&gt; 738                La_version    0 FALSE
#&gt; 745           lazyLoadDBfetch    0  TRUE
#&gt; 748                    length    0  TRUE
#&gt; 750                  length&lt;-    0  TRUE
#&gt; 759                  levels&lt;-    0  TRUE
#&gt; 762                    lgamma    0  TRUE
#&gt; 763            libcurlVersion    0 FALSE
#&gt; 767                   licence    0 FALSE
#&gt; 768                   license    0 FALSE
#&gt; 769                      list    0  TRUE
#&gt; 775          loadedNamespaces    0 FALSE
#&gt; 776      loadingNamespaceInfo    0 FALSE
#&gt; 781                       log    0  TRUE
#&gt; 782                     log10    0  TRUE
#&gt; 783                     log1p    0  TRUE
#&gt; 784                      log2    0  TRUE
#&gt; 807                       max    0  TRUE
#&gt; 819            memory.profile    0 FALSE
#&gt; 825                       min    0  TRUE
#&gt; 826                   missing    0  TRUE
#&gt; 827                       Mod    0  TRUE
#&gt; 840                     names    0  TRUE
#&gt; 842                   names&lt;-    0  TRUE
#&gt; 849                     nargs    0  TRUE
#&gt; 855                      next    0  TRUE
#&gt; 864                  nullfile    0 FALSE
#&gt; 869                    nzchar    0  TRUE
#&gt; 871                  oldClass    0  TRUE
#&gt; 872                oldClass&lt;-    0  TRUE
#&gt; 874                   on.exit    0  TRUE
#&gt; 907               pcre_config    0 FALSE
#&gt; 916                pos.to.env    0  TRUE
#&gt; 959                 proc.time    0  TRUE
#&gt; 960                      prod    0  TRUE
#&gt; 983                     quote    0  TRUE
#&gt; 984             R_compiled_by    0 FALSE
#&gt; 987                 R.Version    0 FALSE
#&gt; 988                     range    0  TRUE
#&gt; 1001                       Re    0  TRUE
#&gt; 1020                      rep    0  TRUE
#&gt; 1029                   repeat    0  TRUE
#&gt; 1036               retracemem    0  TRUE
#&gt; 1037                   return    0  TRUE
#&gt; 1045                    round    0  TRUE
#&gt; 1071                   search    0 FALSE
#&gt; 1072              searchpaths    0 FALSE
#&gt; 1076                seq_along    0  TRUE
#&gt; 1077                  seq_len    0  TRUE
#&gt; 1080                  seq.int    0  TRUE
#&gt; 1096                     sign    0  TRUE
#&gt; 1098                   signif    0  TRUE
#&gt; 1104                      sin    0  TRUE
#&gt; 1106                     sinh    0  TRUE
#&gt; 1109                    sinpi    0  TRUE
#&gt; 1133                     sqrt    0  TRUE
#&gt; 1139          standardGeneric    0  TRUE
#&gt; 1141                   stderr    0 FALSE
#&gt; 1142                    stdin    0 FALSE
#&gt; 1143                   stdout    0 FALSE
#&gt; 1147           storage.mode&lt;-    0  TRUE
#&gt; 1163               substitute    0  TRUE
#&gt; 1168                      sum    0  TRUE
#&gt; 1197                   switch    0  TRUE
#&gt; 1199                sys.calls    0 FALSE
#&gt; 1201                 Sys.Date    0 FALSE
#&gt; 1203               sys.frames    0 FALSE
#&gt; 1207               Sys.getpid    0 FALSE
#&gt; 1209                 Sys.info    0 FALSE
#&gt; 1211           Sys.localeconv    0 FALSE
#&gt; 1212               sys.nframe    0 FALSE
#&gt; 1213              sys.on.exit    0 FALSE
#&gt; 1215              sys.parents    0 FALSE
#&gt; 1224               sys.status    0 FALSE
#&gt; 1225                 Sys.time    0 FALSE
#&gt; 1239                      tan    0  TRUE
#&gt; 1240                     tanh    0  TRUE
#&gt; 1241                    tanpi    0  TRUE
#&gt; 1256                 tracemem    0  TRUE
#&gt; 1261                 trigamma    0  TRUE
#&gt; 1263                    trunc    0  TRUE
#&gt; 1272           unCfillPOSIXlt    0  TRUE
#&gt; 1273                  unclass    0  TRUE
#&gt; 1297               untracemem    0  TRUE
#&gt; 1301                UseMethod    0  TRUE
#&gt; 1317                    while    0  TRUE
#&gt; 1334                    xtfrm    0  TRUE</code></pre>
</div>
</div>
<p>Answers:</p>
<ol type="a">
<li><code>scan()</code> has the most arguments, 22</li>
<li>most (but not all) are primitive functions (204 of 254)</li>
<li>the <code>ls()</code> in the original code could be expanded to search all packages</li>
</ol>
<p>AR Solutions: Let’s look at each sub-question separately:</p>
<ol type="a">
<li>To find the function with the most arguments, we first compute the length of <code>formals()</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb415"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb415-1"><a href="#cb415-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb415-2"><a href="#cb415-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb415-3"><a href="#cb415-3" aria-hidden="true" tabindex="-1"></a>n_args <span class="ot">&lt;-</span> funs <span class="sc">%&gt;%</span></span>
<span id="cb415-4"><a href="#cb415-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(formals) <span class="sc">%&gt;%</span></span>
<span id="cb415-5"><a href="#cb415-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_int</span>(length)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then we sort <code>n_args</code> in decreasing order and look at its first entries.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb416"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb416-1"><a href="#cb416-1" aria-hidden="true" tabindex="-1"></a>n_args <span class="sc">%&gt;%</span></span>
<span id="cb416-2"><a href="#cb416-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>(<span class="at">decreasing =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb416-3"><a href="#cb416-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span>
<span id="cb416-4"><a href="#cb416-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; scan format.default source</span></span>
<span id="cb416-5"><a href="#cb416-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 22 16 16</span></span>
<span id="cb416-6"><a href="#cb416-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; formatC library merge.data.frame</span></span>
<span id="cb416-7"><a href="#cb416-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 15 13 13</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="a">
<li>We can further use <code>n_args</code> to find the number of functions with no arguments:</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb417"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb417-1"><a href="#cb417-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(n_args <span class="sc">==</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 253</code></pre>
</div>
</div>
<p>However, this over counts because <code>formals()</code> returns <code>NULL</code> for primitive functions, and <code>length(NULL)</code> is 0. To fix this, we can first remove the primitive functions:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb419"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb419-1"><a href="#cb419-1" aria-hidden="true" tabindex="-1"></a>n_args2 <span class="ot">&lt;-</span> funs <span class="sc">%&gt;%</span></span>
<span id="cb419-2"><a href="#cb419-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">discard</span>(is.primitive) <span class="sc">%&gt;%</span></span>
<span id="cb419-3"><a href="#cb419-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(formals) <span class="sc">%&gt;%</span></span>
<span id="cb419-4"><a href="#cb419-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_int</span>(length)</span>
<span id="cb419-5"><a href="#cb419-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb419-6"><a href="#cb419-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(n_args2 <span class="sc">==</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 48</code></pre>
</div>
</div>
<p>Indeed, most of the functions with no arguments are actually primitive functions.</p>
<ol start="3" type="a">
<li>To find all primitive functions, we can change the predicate in <code>Filter()</code> from <code>is.function()</code> to <code>is.primitive()</code>:</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb421"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb421-1"><a href="#cb421-1" aria-hidden="true" tabindex="-1"></a>funs <span class="ot">&lt;-</span> <span class="fu">Filter</span>(is.primitive, objs)</span>
<span id="cb421-2"><a href="#cb421-2" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(funs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 205</code></pre>
</div>
</div>
<hr>
<ol start="6" type="1">
<li>What are the three important components of a function?</li>
</ol>
<p>Answer: the <code>formals()</code>, <code>body()</code> and <code>environment()</code>.</p>
<p>AR Solutions: These components are the function’s <code>body()</code>, <code>formals()</code> and <code>environment()</code>. However, as mentioned in <em>Advanced R</em>:</p>
<blockquote class="blockquote">
<p>There is one exception to the rule that functions have three components. Primitive functions, like <code>sum()</code>, call C code directly with <code>.Primitive()</code> and contain no R code. Therefore, their <code>formals()</code>, <code>body()</code>, and <code>environment()</code> are all <code>NULL</code>.</p>
</blockquote>
<hr>
<ol start="7" type="1">
<li>When does printing a function not show the environment it was created in?</li>
</ol>
<p>Answer: when it is created in the global environment.</p>
<p>AR Solutions: Primitive functions and functions created in the global environment do not print their environment.</p>
<hr>
</section>
<section id="exercises-15" class="level3">
<h3 class="anchored" data-anchor-id="exercises-15">6.4.5 Exercises</h3>
<ol type="1">
<li>What does the following code return? Why? Describe how each of the three <code>c</code>’s is interpreted.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb423"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb423-1"><a href="#cb423-1" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb423-2"><a href="#cb423-2" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="at">c =</span> c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  c 
#&gt; 10</code></pre>
</div>
</div>
<p>Answer: a named vector, <code>c 10</code>. The first and final c is a variable. The second c is a function name. the third c is a name.</p>
<p>AR Solutions: This code returns a named numeric vector of length one — with one element of the value <code>10</code> and the name <code>"c"</code>. The first <code>c</code> represents the <code>c()</code> function, the second <code>c</code> is interpreted as a (quoted) name and the third <code>c</code> as a value.</p>
<hr>
<ol start="2" type="1">
<li>What are the four principles that govern how R looks for values?</li>
</ol>
<p>Answer: name masking, functions versus variables, a fresh start, dynamic lookup.</p>
<p>AR Solutions: R’s <a href="https://adv-r.hadley.nz/functions.html#lexical-scoping">lexical scoping</a> rules are based on these four principles: - <a href="https://adv-r.hadley.nz/functions.html#name-masking">Name masking</a> - <a href="https://adv-r.hadley.nz/functions.html#functions-versus-variables">Functions vs.&nbsp;variables</a> - <a href="https://adv-r.hadley.nz/functions.html#fresh-start">A fresh start</a> - <a href="https://adv-r.hadley.nz/functions.html#dynamic-lookup">Dynamic lookup</a></p>
<hr>
<ol start="3" type="1">
<li>What does the following function return? Make a prediction before running the code yourself.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb425"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb425-1"><a href="#cb425-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb425-2"><a href="#cb425-2" aria-hidden="true" tabindex="-1"></a>  f <span class="ot">&lt;-</span> <span class="cf">function</span>(x) { <span class="co"># return value of this is 101</span></span>
<span id="cb425-3"><a href="#cb425-3" aria-hidden="true" tabindex="-1"></a>    f <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb425-4"><a href="#cb425-4" aria-hidden="true" tabindex="-1"></a>      x<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb425-5"><a href="#cb425-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb425-6"><a href="#cb425-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">f</span>() <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb425-7"><a href="#cb425-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb425-8"><a href="#cb425-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(x) <span class="sc">*</span> <span class="dv">2</span></span>
<span id="cb425-9"><a href="#cb425-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb425-10"><a href="#cb425-10" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 202</code></pre>
</div>
</div>
<p>Answer: 202. Correct!</p>
<p>AR Solutions: Within this nested function two more functions also named <code>f</code> are defined and called. Because the functions are each executed in their own environment R will look up and use the functions defined last in these environments. The innermost <code>f()</code> is called last, though it is the first function to return a value. Therefore, the order of the calculation passes “from the inside to the outside” and the function returns <code>((10 ^ 2) + 1) * 2</code>, i.e.&nbsp;202.</p>
<hr>
</section>
<section id="exercises-16" class="level3">
<h3 class="anchored" data-anchor-id="exercises-16">6.5.4 Exercises</h3>
<ol type="1">
<li>What important property of <code>&amp;&amp;</code> makes <code>x_ok()</code> work?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb427"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb427-1"><a href="#cb427-1" aria-hidden="true" tabindex="-1"></a>x_ok <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb427-2"><a href="#cb427-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.null</span>(x) <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(x) <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> x <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb427-3"><a href="#cb427-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb427-4"><a href="#cb427-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb427-5"><a href="#cb427-5" aria-hidden="true" tabindex="-1"></a><span class="fu">x_ok</span>(<span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb429"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb429-1"><a href="#cb429-1" aria-hidden="true" tabindex="-1"></a><span class="fu">x_ok</span>(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb431"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb431-1"><a href="#cb431-1" aria-hidden="true" tabindex="-1"></a><span class="fu">x_ok</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] FALSE</code></pre>
</div>
</div>
<p>Answer: From the <code>&amp;&amp;</code> docs, “The longer forms evaluates left to right, proceeding only until the result is determined.”</p>
<p>What is different with this code? Why is this behaviour undesirable here?</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb433"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb433-1"><a href="#cb433-1" aria-hidden="true" tabindex="-1"></a>x_ok <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb433-2"><a href="#cb433-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.null</span>(x) <span class="sc">&amp;</span> <span class="fu">length</span>(x) <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> x <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb433-3"><a href="#cb433-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb433-4"><a href="#cb433-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb433-5"><a href="#cb433-5" aria-hidden="true" tabindex="-1"></a><span class="fu">x_ok</span>(<span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; logical(0)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb435"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb435-1"><a href="#cb435-1" aria-hidden="true" tabindex="-1"></a><span class="fu">x_ok</span>(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb437"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb437-1"><a href="#cb437-1" aria-hidden="true" tabindex="-1"></a><span class="fu">x_ok</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] FALSE FALSE FALSE</code></pre>
</div>
</div>
<p>Answer: “The shorter forms performs elementwise comparisons in much the same way as arithmetic operators.” This is undesirable because the intent of the function is to return <code>TRUE</code> or <code>FALSE</code>.</p>
<p>AR Solutions: In summary: <code>&amp;&amp;</code> short-circuits which means that if the left-hand side is <code>FALSE</code> it doesn’t evaluate the right-hand side (because it doesn’t matter). Similarly, if the left-hand side of <code>||</code> is <code>TRUE</code> it doesn’t evaluate the right-hand side.</p>
<p>We expect <code>x_ok()</code> to validate its input via certain criteria: it must not be <code>NULL</code>, have length <code>1</code> and be greater than <code>0</code>. Meaningful outcomes for this assertion will be <code>TRUE</code>, <code>FALSE</code> or <code>NA</code>. The desired behaviour is reached by combining the assertions through <code>&amp;&amp;</code> instead of <code>&amp;</code>.</p>
<p><code>&amp;&amp;</code> does not perform elementwise comparisons; instead it uses the first element of each value only. It also uses lazy evaluation, in the sense that evaluation “proceeds only until the result is determined” (from <code>?Logic</code>). This means that the RHS of <code>&amp;&amp;</code> won’t be evaluated if the LHS already determines the outcome of the comparison (e.g.&nbsp;evaluate to <code>FALSE</code>). This behaviour is also known as “short-circuiting”. For some situations (<code>x = 1</code>) both operators will lead to the same result. But this is not always the case. For <code>x = NULL</code>, the <code>&amp;&amp;</code>-operator will stop after the <code>!is.null</code> statement and return the result. The following conditions won’t even be evaluated! (If the other conditions are also evaluated (by the use of <code>&amp;</code>), the outcome would change. <code>NULL &gt; 0</code> returns <code>logical(0)</code>, which is not helpful in this case.)</p>
<p>We can also see the difference in behaviour, when we set <code>x = 1:3</code>. The <code>&amp;&amp;</code>-operator returns the result from <code>length(x) == 1</code>, which is <code>FALSE</code>. Using <code>&amp;</code> as the logical operator leads to the (vectorised) <code>x &gt; 0</code> condition being evaluated and also returned.</p>
<hr>
<ol start="2" type="1">
<li>What does this function return? Why? Which principle does it illustrate?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb439"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb439-1"><a href="#cb439-1" aria-hidden="true" tabindex="-1"></a>f2 <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">x =</span> z) {</span>
<span id="cb439-2"><a href="#cb439-2" aria-hidden="true" tabindex="-1"></a>  z <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb439-3"><a href="#cb439-3" aria-hidden="true" tabindex="-1"></a>  x</span>
<span id="cb439-4"><a href="#cb439-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb439-5"><a href="#cb439-5" aria-hidden="true" tabindex="-1"></a><span class="fu">f2</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 100</code></pre>
</div>
</div>
<p>Answer: 100, lazy evaluation. <code>x = z</code> isn’t evaluated until <code>x</code>.</p>
<p>AR Solutions: The function returns 100. The default argument (<code>x = z</code>) gets lazily evaluated within the function environment when <code>x</code> gets accessed. At this time <code>z</code> has already been bound to the value <code>100</code>. The illustrated principle here is <em>lazy evaluation</em>.</p>
<hr>
<ol start="3" type="1">
<li>What does this function return? Why? Which principle does it illustrate?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb441"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb441-1"><a href="#cb441-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb441-2"><a href="#cb441-2" aria-hidden="true" tabindex="-1"></a><span class="co"># styler: off</span></span>
<span id="cb441-3"><a href="#cb441-3" aria-hidden="true" tabindex="-1"></a>f1 <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">x =</span> {y <span class="ot">&lt;-</span> <span class="dv">1</span>; <span class="dv">2</span>}, <span class="at">y =</span> <span class="dv">0</span>) { <span class="co"># nolint: semicolon_linter.</span></span>
<span id="cb441-4"><a href="#cb441-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># styler: on</span></span>
<span id="cb441-5"><a href="#cb441-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(x, y)</span>
<span id="cb441-6"><a href="#cb441-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb441-7"><a href="#cb441-7" aria-hidden="true" tabindex="-1"></a><span class="fu">f1</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 2 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb443"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb443-1"><a href="#cb443-1" aria-hidden="true" tabindex="-1"></a>y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 10</code></pre>
</div>
</div>
<p>Answer: <code>c(2, 1)</code>. default arguments.</p>
<p>AR Solutions: The function returns <code>c(2, 1)</code> which is due to <em>name masking</em>. When <code>x</code> is accessed within <code>c()</code>, the promise <code>x = {y &lt;- 1; 2}</code> is evaluated inside <code>f1()</code>’s environment. <code>y</code> gets bound to the value <code>1</code> and the return value of <code>{()</code> (<code>2</code>) gets assigned to <code>x</code>. When <code>y</code> gets accessed next within <code>c()</code>, it has already the value <code>1</code> and R doesn’t need to look it up any further. Therefore, the promise <code>y = 0</code> won’t be evaluated. Also, as <code>y</code> is assigned within <code>f1()</code>’s environment, the value of the global variable <code>y</code> is left untouched.</p>
<hr>
<ol start="4" type="1">
<li>In <code>hist()</code>, the default value of <code>xlim</code> is <code>range(breaks)</code>, the default value for <code>breaks</code> is <code>"Sturges"</code>, and</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb445"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb445-1"><a href="#cb445-1" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(<span class="st">"Sturges"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "Sturges" "Sturges"</code></pre>
</div>
</div>
<p>Explain how <code>hist()</code> works to get a correct <code>xlim</code> value.</p>
<p>Answer: from the docs, “Note that <code>xlim</code> is <em>not</em> used to define the histogram (breaks), but only for plotting (when <code>plot = TRUE</code>).” So, the breakpoints are calculated when the object is created, and <code>xlim</code> is calculated when the histogram is plotted, in the second step.</p>
<p>AR Solutions: The <code>xlim</code> argument of <code>hist()</code> defines the range of the histogram’s x-axis. In order to provide a valid axis <code>xlim</code> must contain a numeric vector of exactly two unique values. Consequently, for the default <code>xlim = range(breaks)</code>), <code>breaks</code> must evaluate to a vector with at least two unique values.</p>
<p>During execution <code>hist()</code> overwrites the <code>breaks</code> argument. The <code>breaks</code> argument is quite flexible and allows the users to provide the breakpoints directly or compute them in several ways. Therefore, the specific behaviour depends highly on the input. But <code>hist</code> ensures that <code>breaks</code> evaluates to a numeric vector containing at least two unique elements before <code>xlim</code> is computed.</p>
<hr>
<ol start="5" type="1">
<li>Explain why this function works. Why is it confusing?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb447"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb447-1"><a href="#cb447-1" aria-hidden="true" tabindex="-1"></a>show_time <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">x =</span> <span class="fu">stop</span>(<span class="st">"Error!"</span>)) {</span>
<span id="cb447-2"><a href="#cb447-2" aria-hidden="true" tabindex="-1"></a>  stop <span class="ot">&lt;-</span> <span class="cf">function</span>(...) <span class="fu">Sys.time</span>()</span>
<span id="cb447-3"><a href="#cb447-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(x)</span>
<span id="cb447-4"><a href="#cb447-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb447-5"><a href="#cb447-5" aria-hidden="true" tabindex="-1"></a><span class="fu">show_time</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "2024-03-10 11:03:07 CDT"</code></pre>
</div>
</div>
<p>Answer: <code>stop</code> is redefined before <code>x</code> is evaluated. This is a confusing use of lazy evaluation.</p>
<p>AR Solutions: Before <code>show_time()</code> accesses <code>x</code> (default <code>stop("Error")</code>), the <code>stop()</code> function is masked by <code>function(...) Sys.time()</code>. As default arguments are evaluated in the function environment, <code>print(x)</code> will be evaluated as <code>print(Sys.time())</code>.</p>
<p>This function is confusing because its behaviour changes when <code>x</code>’s value is supplied directly. Now the value from the calling environment will be used and the overwriting of <code>stop()</code> won’t affect <code>x</code> anymore.</p>
<hr>
<ol start="6" type="1">
<li>How many arguments are required when calling <code>library()</code>?</li>
</ol>
<p>Answer: zero. <code>library()</code> uses <code>missing()</code> to return the list of available packages if there are no arguments.</p>
<p>AR Solutions: <code>library()</code> doesn’t require any arguments. When called without arguments <code>library()</code> invisibly returns a list of class <code>libraryIQR</code>, which contains a results matrix with one row and three columns per installed package. These columns contain entries for the name of the package (“Package”), the path to the package (“LibPath”) and the title of the package (“Title”). <code>library()</code> also has its own print method (<code>print.libraryIQR()</code>), which displays this information conveniently in its own window.</p>
<p>This behaviour is also documented under the details section of <code>library()</code>’s help page (<code>?library</code>):</p>
<blockquote class="blockquote">
<p>If library is called with no package or help argument, it lists all available packages in the libraries specified by lib.loc, and returns the corresponding information in an object of class “libraryIQR”. (The structure of this class may change in future versions.) Use .packages(all = TRUE) to obtain just the names of all available packages, and installed.packages() for even more information.</p>
</blockquote>
<p>Because the <code>package</code> and <code>help</code> argument from <code>library()</code> do not show a default value, it’s easy to overlook the possibility to call <code>library()</code> without these arguments. (Instead of providing <code>NULL</code>s as default values <code>library()</code> uses <code>missing()</code> to check if these arguments were provided.)</p>
<hr>
</section>
<section id="exercises-17" class="level3">
<h3 class="anchored" data-anchor-id="exercises-17">6.6.1 Exercises</h3>
<ol type="1">
<li>Explain the following results:</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb449"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb449-1"><a href="#cb449-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb451"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb451-1"><a href="#cb451-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb453"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb453-1"><a href="#cb453-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="at">na.omit =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 7</code></pre>
</div>
<div class="sourceCode cell-code" id="cb455"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb455-1"><a href="#cb455-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="at">na.omit =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 1</code></pre>
</div>
</div>
<p>Answer:</p>
<ul>
<li>“<code>sum()</code> returns the sum of all the values present in its arguments.” The first example is straightforward. In the second sum example, <code>na.omit</code> isn’t a valid argument (<code>na.rm</code> is), so the <code>TRUE</code> value is passed to <code>...</code>, coerced to 1, and included in the sum.</li>
<li><code>mean()</code> takes a single parameter, and passes on remaining arguments to <code>...</code>. In both cases, the arguments after the <code>1</code> are silently dropped. The correct form would be <code>mean(c(1, 2, 3))</code>.</li>
</ul>
<p>AR Solutions: Let’s inspect the arguments and their order for both functions. For <code>sum()</code> these are <code>...</code> and <code>na.rm</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb457"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb457-1"><a href="#cb457-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(sum)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; function (..., na.rm = FALSE)</code></pre>
</div>
</div>
<p>For the <code>...</code> argument <code>sum()</code> expects numeric, complex, or logical vector input (see <code>?sum</code>). Unfortunately, when <code>...</code> is used, misspelled arguments (!) like <code>na.omit</code> won’t raise an error (in case of no further input checks). So instead, <code>na.omit</code> is treated as a logical and becomes part of the <code>...</code> argument. It will be coerced to <code>1</code> and be part of the sum. All other arguments are left unchanged. Therefore <code>sum(1, 2, 3)</code> returns <code>6</code> and <code>sum(1, 2, 3, na.omit = TRUE)</code> returns <code>7</code>.</p>
<p>In contrast, the generic function <code>mean()</code> expects <code>x</code>, <code>trim</code>, <code>na.rm</code> and <code>...</code> for its default method.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb459"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb459-1"><a href="#cb459-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(mean.default)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; function (x, trim = 0, na.rm = FALSE, ...)</code></pre>
</div>
</div>
<p>As <code>na.omit</code> is not one of <code>mean()</code>’s named arguments (<code>x</code>; and no candidate for partial matching), <code>na.omit</code> again becomes part of the <code>...</code> argument. However, in contrast to <code>sum()</code> the elements of <code>...</code> are not “part” of the mean. The other supplied arguments are matched by their order, i.e.&nbsp;<code>x = 1</code>, <code>trim = 2</code> and <code>na.rm = 3</code>. As <code>x</code> is of length 1 and not <code>NA</code>, the settings of <code>trim</code> and <code>na.rm</code> do not affect the calculation of the mean. Both calls (<code>mean(1, 2, 3)</code> and <code>mean(1, 2, 3, na.omit = TRUE)</code>) return <code>1</code>.</p>
<hr>
<ol start="2" type="1">
<li>Explain how to find the documentation for the named arguments in the following function call:</li>
</ol>
<!-- TODO: bugfix: the figure below renders incorrectly,
     possibly due to https://github.com/rstudio/rstudio/issues/4521
     see also: https://github.com/hadley/adv-r/blob/master/common.R
     and: https://yihui.org/knitr/options/#plots
     workaround: use {r, fig.asp = 1}.
     {r, fig.asp = 1, fig.width = 3} looks correct in RStudio, but doesn't render properly for
     build_analysis_site(). {r, fig.asp = 1} works with build_analysis_site() but is not sized
     properly in RStudio. {r, fig.asp = 1} is the best option for now.
  -->
<div class="cell" data-layout-align="center" data-small_mar="true">
<div class="sourceCode cell-code" id="cb461"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb461-1"><a href="#cb461-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">xlab =</span> <span class="st">"x"</span>, <span class="at">col.lab =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="advanced-r-1_files/figure-html/unnamed-chunk-102-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="816"></p>
</figure>
</div>
</div>
</div>
<p>Answer: in other functions, specifically <code>par()</code> and <code>plot.default()</code>.</p>
<p>AR Solutions: First we type <code>?plot</code> in the console and check the “Usage” section which contains:</p>
<div class="sourceCode" id="cb462"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb462-1"><a href="#cb462-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, y, ...)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The arguments we want to learn more about (<code>col</code>, <code>pch</code>, <code>xlab</code>, <code>col.lab</code>) are part of the <code>...</code> argument. There we can find information for the <code>xlab</code> argument and a recommendation to visit <code>?par</code> for the other arguments. Under <code>?par</code> we type “col” into the search bar, which leads us to the section “Color Specification”. We also search for the <code>pch</code> argument, which leads to the recommendation to check <code>?points</code>. Finally, <code>col.lab</code> is also directly documented within <code>?par</code>.</p>
<hr>
<ol start="3" type="1">
<li>Why does <code>plot(1:10, col = "red")</code> only colour the points, not the axes or labels? Read the source code of <code>plot.default()</code> to find out.</li>
</ol>
<div class="sourceCode" id="cb463"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb463-1"><a href="#cb463-1" aria-hidden="true" tabindex="-1"></a>localAxis <span class="ot">&lt;-</span> <span class="cf">function</span>(..., col, bg, pch, cex, lty, lwd) <span class="fu">Axis</span>(...)</span>
<span id="cb463-2"><a href="#cb463-2" aria-hidden="true" tabindex="-1"></a>localBox <span class="ot">&lt;-</span> <span class="cf">function</span>(..., col, bg, pch, cex, lty, lwd) <span class="fu">box</span>(...)</span>
<span id="cb463-3"><a href="#cb463-3" aria-hidden="true" tabindex="-1"></a>localWindow <span class="ot">&lt;-</span> <span class="cf">function</span>(..., col, bg, pch, cex, lty, lwd) <span class="fu">plot.window</span>(...)</span>
<span id="cb463-4"><a href="#cb463-4" aria-hidden="true" tabindex="-1"></a>localTitle <span class="ot">&lt;-</span> <span class="cf">function</span>(..., col, bg, pch, cex, lty, lwd) <span class="fu">title</span>(...)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Answer: <code>plot.default()</code> discards <code>col</code> and several other arguments when calling <code>Axis()</code>, <code>box()</code>, <code>plot.window()</code>, and <code>title()</code>.</p>
<p>AR Solutions: To learn about the internals of <code>plot.default()</code> we add <code>browser()</code> to the first line of the code and interactively run <code>plot(1:10, col = "red")</code>. This way we can see how the plot is built and learn where the axes are added. This leads us to the function call</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb464"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb464-1"><a href="#cb464-1" aria-hidden="true" tabindex="-1"></a><span class="fu">localTitle</span>(<span class="at">main =</span> main, <span class="at">sub =</span> sub, <span class="at">xlab =</span> xlab, <span class="at">ylab =</span> ylab, ...)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>localTitle()</code> function was defined in the first lines of <code>plot.default()</code> as:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb465"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb465-1"><a href="#cb465-1" aria-hidden="true" tabindex="-1"></a>localTitle <span class="ot">&lt;-</span> <span class="cf">function</span>(..., col, bg, pch, cex, lty, lwd) <span class="fu">title</span>(...)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The call to <code>localTitle()</code> passes the <code>col</code> parameter as part of the <code>...</code> argument to <code>title()</code>. <code>?title</code> tells us that the <code>title()</code> function specifies four parts of the plot: Main (title of the plot), sub (sub-title of the plot) and both axis labels. Therefore, it would introduce ambiguity inside <code>title()</code> to use <code>col</code> directly. Instead, one has the option to supply <code>col</code> via the <code>...</code> argument, via <code>col.lab</code> or as part of <code>xlab</code> in the form <code>xlab = list(c("index"), col = "red")</code> (similar for <code>ylab</code>).</p>
<hr>
</section>
<section id="exercises-18" class="level3">
<h3 class="anchored" data-anchor-id="exercises-18">6.7.5 Exercises</h3>
<ol type="1">
<li>What does <code>load()</code> return? Why don’t you normally see these values?</li>
</ol>
<p>Answer: from the docs, <code>load()</code> returns “A character vector of the names of objects created, invisibly.”</p>
<p>AR Solutions: <code>load()</code> loads objects saved to disk in <code>.Rdata</code> files by <code>save()</code>. When run successfully, <code>load()</code> invisibly returns a character vector containing the names of the newly loaded objects. To print these names to the console, one can set the argument <code>verbose</code> to <code>TRUE</code> or surround the call in parentheses to trigger R’s auto-printing mechanism.</p>
<hr>
<ol start="2" type="1">
<li>What does <code>write.table()</code> return? What would be more useful?</li>
</ol>
<p>Answer: it returns <code>invisible(NULL)</code>. Returning the written table or the argument <code>x</code> would be more useful.</p>
<p>AR Solutions: <code>write.table()</code> writes an object, usually a data frame or a matrix, to disk. The function invisibly returns <code>NULL</code>. It would be more useful if <code>write.table()</code> would (invisibly) return the input data, <code>x</code>. This would allow to save intermediate results and directly take on further processing steps without breaking the flow of the code (i.e.&nbsp;breaking it into different lines). One package which uses this pattern is the <code>{readr}</code> package, which is part of the <a href="https://www.tidyverse.org/">tidyverse-ecosystem</a>.</p>
<hr>
<ol start="3" type="1">
<li>How does the <code>chdir</code> parameter of <code>source()</code> compare to <code>with_dir()</code>? Why might you prefer one to the other?</li>
</ol>
<p>Answer: both temporarily change the working directory. <code>chdir</code> is preferable since this is expected behavior for the function, unless you need to set a working directory other than the directory containing <code>file</code>.</p>
<p>AR Solutions: <code>with_dir()</code> takes a path for a working directory (<code>dir</code>) as its first argument. This is the directory where the provided code (<code>code</code>) should be executed. Therefore, the current working directory is changed in <code>with_dir()</code> via <code>setwd()</code>. Then, <code>on.exit()</code> ensures that the modification of the working directory is reset to the initial value when the function exits. By passing the path explicitly, the user has full control over the directory to execute the code in.</p>
<p>In <code>source()</code> the code is passed via the <code>file</code> argument (a path to a file). The <code>chdir</code> argument specifies if the working directory should be changed to the directory containing the file. The default for <code>chdir</code> is <code>FALSE</code>, so you don’t have to provide a value. However, as you can only provide <code>TRUE</code> or <code>FALSE</code>, you are also less flexible in choosing the working directory for the code execution.</p>
<hr>
<ol start="4" type="1">
<li>Write a function that opens a graphics device, runs the supplied code, and closes the graphics device (always, regardless of whether or not the plotting code works).</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb466"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb466-1"><a href="#cb466-1" aria-hidden="true" tabindex="-1"></a>with_png <span class="ot">&lt;-</span> <span class="cf">function</span>(code, ...) {</span>
<span id="cb466-2"><a href="#cb466-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">png</span>(...)</span>
<span id="cb466-3"><a href="#cb466-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">on.exit</span>(<span class="fu">dev.off</span>(), <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">after =</span> <span class="cn">TRUE</span>)</span>
<span id="cb466-4"><a href="#cb466-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">force</span>(code)</span>
<span id="cb466-5"><a href="#cb466-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb466-6"><a href="#cb466-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb466-7"><a href="#cb466-7" aria-hidden="true" tabindex="-1"></a><span class="fu">with_png</span>(</span>
<span id="cb466-8"><a href="#cb466-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>),</span>
<span id="cb466-9"><a href="#cb466-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="st">"rendered/withpng-example.png"</span>,</span>
<span id="cb466-10"><a href="#cb466-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># use 3 times default resolution which is close to retina display ppi (218-254 depending on model)</span></span>
<span id="cb466-11"><a href="#cb466-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># https://support.apple.com/en-us/HT202471</span></span>
<span id="cb466-12"><a href="#cb466-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">480</span> <span class="sc">*</span> <span class="dv">3</span>, <span class="at">height =</span> <span class="dv">480</span> <span class="sc">*</span> <span class="dv">3</span>, <span class="at">res =</span> <span class="dv">72</span> <span class="sc">*</span> <span class="dv">3</span></span>
<span id="cb466-13"><a href="#cb466-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="rendered/withpng-example.png" class="img-fluid figure-img"></p>
<figcaption>with_png output</figcaption>
</figure>
</div>
<p>Answer: code example above.</p>
<p>AR Solutions: To control the graphics device we use <code>pdf()</code> and <code>dev.off()</code>. To ensure a clean termination <code>on.exit()</code> is used.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb467"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb467-1"><a href="#cb467-1" aria-hidden="true" tabindex="-1"></a>plot_pdf <span class="ot">&lt;-</span> <span class="cf">function</span>(code) {</span>
<span id="cb467-2"><a href="#cb467-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pdf</span>(<span class="st">"test.pdf"</span>)</span>
<span id="cb467-3"><a href="#cb467-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">on.exit</span>(<span class="fu">dev.off</span>(), <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb467-4"><a href="#cb467-4" aria-hidden="true" tabindex="-1"></a>  code</span>
<span id="cb467-5"><a href="#cb467-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ol start="5" type="1">
<li>We can use <code>on.exit()</code> to implement a simple version of <code>capture.output()</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb468"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb468-1"><a href="#cb468-1" aria-hidden="true" tabindex="-1"></a>capture.output2 <span class="ot">&lt;-</span> <span class="cf">function</span>(code) {</span>
<span id="cb468-2"><a href="#cb468-2" aria-hidden="true" tabindex="-1"></a>  temp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb468-3"><a href="#cb468-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">on.exit</span>(<span class="fu">file.remove</span>(temp), <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">after =</span> <span class="cn">TRUE</span>)</span>
<span id="cb468-4"><a href="#cb468-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sink</span>(temp)</span>
<span id="cb468-5"><a href="#cb468-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">on.exit</span>(<span class="fu">sink</span>(), <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">after =</span> <span class="cn">TRUE</span>)</span>
<span id="cb468-6"><a href="#cb468-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">force</span>(code)</span>
<span id="cb468-7"><a href="#cb468-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">readLines</span>(temp)</span>
<span id="cb468-8"><a href="#cb468-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb468-9"><a href="#cb468-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb468-10"><a href="#cb468-10" aria-hidden="true" tabindex="-1"></a><span class="fu">capture.output2</span>(<span class="fu">cat</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "a" "b" "c"</code></pre>
</div>
</div>
<p>Compare <code>capture.output()</code> to <code>capture.output2()</code>. How do the functions differ? What features have I removed to make the key ideas easier to see? How have I rewritten the key ideas so they’re easier to understand?</p>
<p>Answer: <code>capture.output2()</code> has fewer features and uses two separate calls to <code>on.exit()</code>. It simply returns the output (by line) from the executed code, and highlights the key idea, using <code>sink()</code> to capture output to a temporary file.</p>
<p>AR Solutions: Using <code>body(capture.output)</code> we inspect the source code of the original <code>capture.output()</code> function: The implementation for <code>capture.output()</code> is quite a bit longer (39 lines vs.&nbsp;7 lines).</p>
<p>In <code>capture_output2()</code> the code is simply forced, and the output is caught via <code>sink()</code> in a temporary file. An additional feature of <code>capture_output()</code> is that one can also capture messages by setting <code>type = "message"</code>. As this is internally forwarded to <code>sink()</code>, this behaviour (and also <code>sink()</code>’s <code>split</code> argument) could be easily introduced within <code>capture_output2()</code> as well.</p>
<p>The main difference is that <code>capture.output()</code> calls print.</p>
<hr>
</section>
<section id="exercises-19" class="level3">
<h3 class="anchored" data-anchor-id="exercises-19">6.8.6 Exercises</h3>
<ol type="1">
<li>Rewrite the following code snippets into prefix form:</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb470"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb470-1"><a href="#cb470-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb472"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb472-1"><a href="#cb472-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">+</span><span class="st">`</span>(<span class="st">`</span><span class="at">+</span><span class="st">`</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb474"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb474-1"><a href="#cb474-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">+</span> (<span class="dv">2</span> <span class="sc">+</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb476"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb476-1"><a href="#cb476-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">+</span><span class="st">`</span>(<span class="dv">1</span>, <span class="st">`</span><span class="at">+</span><span class="st">`</span>(<span class="dv">2</span>, <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb478"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb478-1"><a href="#cb478-1" aria-hidden="true" tabindex="-1"></a>fxn <span class="ot">&lt;-</span> <span class="cf">function</span>(x, n) <span class="cf">if</span> (<span class="fu">length</span>(x) <span class="sc">&lt;=</span> <span class="dv">5</span>) x[[<span class="dv">5</span>]] <span class="cf">else</span> x[[n]]</span>
<span id="cb478-2"><a href="#cb478-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fxn</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb480"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb480-1"><a href="#cb480-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fxn</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb482"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb482-1"><a href="#cb482-1" aria-hidden="true" tabindex="-1"></a>fxn2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x, n) <span class="st">`</span><span class="at">if</span><span class="st">`</span>(<span class="st">`</span><span class="at">&lt;=</span><span class="st">`</span>(<span class="fu">length</span>(x), <span class="dv">5</span>), <span class="st">`</span><span class="at">[[</span><span class="st">`</span>(x, <span class="dv">5</span>), <span class="st">`</span><span class="at">[[</span><span class="st">`</span>(x, n))</span>
<span id="cb482-2"><a href="#cb482-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fxn2</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb484"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb484-1"><a href="#cb484-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fxn2</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 2</code></pre>
</div>
</div>
<p>Answer: inline above.</p>
<p>AR Solutions: Let’s rewrite the expressions to match the exact syntax from the code above. Because prefix functions already define the execution order, we may omit the parentheses in the second expression.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb486"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb486-1"><a href="#cb486-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">+</span><span class="st">`</span>(<span class="st">`</span><span class="at">+</span><span class="st">`</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dv">3</span>)</span>
<span id="cb486-2"><a href="#cb486-2" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">+</span><span class="st">`</span>(<span class="dv">1</span>, <span class="st">`</span><span class="at">(</span><span class="st">`</span>(<span class="st">`</span><span class="at">+</span><span class="st">`</span>(<span class="dv">2</span>, <span class="dv">3</span>)))</span>
<span id="cb486-3"><a href="#cb486-3" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">+</span><span class="st">`</span>(<span class="dv">1</span>, <span class="st">`</span><span class="at">+</span><span class="st">`</span>(<span class="dv">2</span>, <span class="dv">3</span>))</span>
<span id="cb486-4"><a href="#cb486-4" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">if</span><span class="st">`</span>(<span class="st">`</span><span class="at">&lt;=</span><span class="st">`</span>(<span class="fu">length</span>(x), <span class="dv">5</span>), <span class="st">`</span><span class="at">[[</span><span class="st">`</span>(x, <span class="dv">5</span>), <span class="st">`</span><span class="at">[[</span><span class="st">`</span>(x, n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ol start="2" type="1">
<li>Clarify the following list of odd function calls:</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb487"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb487-1"><a href="#cb487-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="dv">20</span>, <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="cn">NA</span>))</span>
<span id="cb487-2"><a href="#cb487-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">1</span>, <span class="dv">20</span>)</span>
<span id="cb487-3"><a href="#cb487-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(<span class="at">m =</span> <span class="st">"k"</span>, <span class="at">y =</span> y, <span class="at">u =</span> <span class="st">"p"</span>, <span class="at">x =</span> x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Answers: improved code below.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb488"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb488-1"><a href="#cb488-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="cn">NA</span>), <span class="dv">20</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb488-2"><a href="#cb488-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">20</span>)</span>
<span id="cb488-3"><a href="#cb488-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(x, y, <span class="at">use =</span> <span class="st">"pairwise.complete.obs"</span>, <span class="at">method =</span> <span class="st">"kendall"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] -0.1891968</code></pre>
</div>
</div>
<p>AR Solutions: None of these functions provides a <code>...</code> argument. Therefore, the function arguments are first matched exactly, then via partial matching and finally by position. This leads us to the following explicit function calls:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb490"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb490-1"><a href="#cb490-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="cn">NA</span>), <span class="at">size =</span> <span class="dv">20</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb490-2"><a href="#cb490-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">20</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">1</span>)</span>
<span id="cb490-3"><a href="#cb490-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(x, y, <span class="at">use =</span> <span class="st">"pairwise.complete.obs"</span>, <span class="at">method =</span> <span class="st">"kendall"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ol start="3" type="1">
<li>Explain why the following code fails:</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb491"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb491-1"><a href="#cb491-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">modify&lt;-</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(x, position, value) {</span>
<span id="cb491-2"><a href="#cb491-2" aria-hidden="true" tabindex="-1"></a>  x[position] <span class="ot">&lt;-</span> value</span>
<span id="cb491-3"><a href="#cb491-3" aria-hidden="true" tabindex="-1"></a>  x</span>
<span id="cb491-4"><a href="#cb491-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb491-5"><a href="#cb491-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb491-6"><a href="#cb491-6" aria-hidden="true" tabindex="-1"></a><span class="fu">try</span>(<span class="fu">modify</span>(<span class="fu">get</span>(<span class="st">"x"</span>), <span class="dv">1</span>) <span class="ot">&lt;-</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Error in modify(get("x"), 1) &lt;- 10 : 
#&gt;   target of assignment expands to non-language object</code></pre>
</div>
<div class="sourceCode cell-code" id="cb493"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb493-1"><a href="#cb493-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Error: target of assignment expands to non-language object</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Answer: as explained on <a href="https://stackoverflow.com/questions/27662162/error-in-my-code-target-of-assignment-expands-to-non-language-object">stack overflow</a>, the error is caused when assigning to an object directly, instead of a name that refers to the object (like <code>x</code>).</p>
<p>AR Solutions: First, let’s define <code>x</code> and recall the definition of <code>modify()</code> from <em>Advanced R</em>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb494"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb494-1"><a href="#cb494-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span></span>
<span id="cb494-2"><a href="#cb494-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb494-3"><a href="#cb494-3" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">modify&lt;-</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(x, position, value) {</span>
<span id="cb494-4"><a href="#cb494-4" aria-hidden="true" tabindex="-1"></a>  x[position] <span class="ot">&lt;-</span> value</span>
<span id="cb494-5"><a href="#cb494-5" aria-hidden="true" tabindex="-1"></a>  x</span>
<span id="cb494-6"><a href="#cb494-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>R internally transforms the code, and the transformed code reproduces the error above:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb495"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb495-1"><a href="#cb495-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get</span>(<span class="st">"x"</span>) <span class="ot">&lt;-</span> <span class="st">`</span><span class="at">modify&lt;-</span><span class="st">`</span>(<span class="fu">get</span>(<span class="st">"x"</span>), <span class="dv">1</span>, <span class="dv">10</span>)</span>
<span id="cb495-2"><a href="#cb495-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Error in get("x") &lt;- `modify&lt;-`(get("x"), 1, 10) :</span></span>
<span id="cb495-3"><a href="#cb495-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   target of assignment expands to non-language object</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The error occurs during the assignment because no corresponding replacement function, i.e.&nbsp;<code>get&lt;-</code>, exists for <code>get()</code>. To confirm this, we reproduce the error via the following simplified example.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb496"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb496-1"><a href="#cb496-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get</span>(<span class="st">"x"</span>) <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb496-2"><a href="#cb496-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Error in get("x") &lt;- 2 :</span></span>
<span id="cb496-3"><a href="#cb496-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   target of assignment expands to non-language object</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ol start="4" type="1">
<li>Create a replacement function that modifies a random location in a vector.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb497"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb497-1"><a href="#cb497-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">modrand&lt;-</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(x, value) {</span>
<span id="cb497-2"><a href="#cb497-2" aria-hidden="true" tabindex="-1"></a>  x[<span class="fu">sample</span>(<span class="fu">length</span>(x), <span class="dv">1</span>)] <span class="ot">&lt;-</span> value</span>
<span id="cb497-3"><a href="#cb497-3" aria-hidden="true" tabindex="-1"></a>  x</span>
<span id="cb497-4"><a href="#cb497-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb497-5"><a href="#cb497-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb497-6"><a href="#cb497-6" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span></span>
<span id="cb497-7"><a href="#cb497-7" aria-hidden="true" tabindex="-1"></a><span class="fu">modrand</span>(v) <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb497-8"><a href="#cb497-8" aria-hidden="true" tabindex="-1"></a>v</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  [1] NA  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20</code></pre>
</div>
</div>
<p>Answer: code above.</p>
<p>AR Solutions: Let’s define <code>random&lt;-</code> like this:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb499"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb499-1"><a href="#cb499-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">random&lt;-</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(x, value) {</span>
<span id="cb499-2"><a href="#cb499-2" aria-hidden="true" tabindex="-1"></a>  idx <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">length</span>(x), <span class="dv">1</span>)</span>
<span id="cb499-3"><a href="#cb499-3" aria-hidden="true" tabindex="-1"></a>  x[idx] <span class="ot">&lt;-</span> value</span>
<span id="cb499-4"><a href="#cb499-4" aria-hidden="true" tabindex="-1"></a>  x</span>
<span id="cb499-5"><a href="#cb499-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ol start="5" type="1">
<li>Write your own version of <code>+</code> that pastes its inputs together if they are character vectors but behaves as usual otherwise. In other words, make this code work:</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb500"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb500-1"><a href="#cb500-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">+</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb500-2"><a href="#cb500-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.character</span>(x) <span class="sc">&amp;&amp;</span> <span class="fu">is.character</span>(y)) {</span>
<span id="cb500-3"><a href="#cb500-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">paste0</span>(x, y))</span>
<span id="cb500-4"><a href="#cb500-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb500-5"><a href="#cb500-5" aria-hidden="true" tabindex="-1"></a>  base<span class="sc">::</span><span class="st">`</span><span class="at">+</span><span class="st">`</span>(x, y)</span>
<span id="cb500-6"><a href="#cb500-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb500-7"><a href="#cb500-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb500-8"><a href="#cb500-8" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb502"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb502-1"><a href="#cb502-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 3</span></span>
<span id="cb502-2"><a href="#cb502-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb502-3"><a href="#cb502-3" aria-hidden="true" tabindex="-1"></a><span class="st">"a"</span> <span class="sc">+</span> <span class="st">"b"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "ab"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb504"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb504-1"><a href="#cb504-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "ab"</span></span>
<span id="cb504-2"><a href="#cb504-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb504-3"><a href="#cb504-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="st">`</span><span class="at">+</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Answer: code above.</p>
<p>AR Solutions: To achieve this behaviour, we need to override the <code>+</code> operator. We need to take care to not use the <code>+</code> operator itself inside of the function definition, as this would lead to an undesired infinite recursion. We also add <code>b = 0L</code> as a default value to keep the behaviour of <code>+</code> as a unary operator, i.e.&nbsp;to keep <code>+ 1</code> working and not throwing an error.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb505"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb505-1"><a href="#cb505-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">+</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(a, <span class="at">b =</span> <span class="dv">0</span>L) {</span>
<span id="cb505-2"><a href="#cb505-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.character</span>(a) <span class="sc">&amp;&amp;</span> <span class="fu">is.character</span>(b)) {</span>
<span id="cb505-3"><a href="#cb505-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste0</span>(a, b)</span>
<span id="cb505-4"><a href="#cb505-4" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb505-5"><a href="#cb505-5" aria-hidden="true" tabindex="-1"></a>    base<span class="sc">::</span><span class="st">`</span><span class="at">+</span><span class="st">`</span>(a, b)</span>
<span id="cb505-6"><a href="#cb505-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb505-7"><a href="#cb505-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb505-8"><a href="#cb505-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Test</span></span>
<span id="cb505-9"><a href="#cb505-9" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span><span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb507"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb507-1"><a href="#cb507-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb509"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb509-1"><a href="#cb509-1" aria-hidden="true" tabindex="-1"></a><span class="st">"a"</span> <span class="sc">+</span> <span class="st">"b"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "ab"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb511"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb511-1"><a href="#cb511-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Return back to the original `+` operator</span></span>
<span id="cb511-2"><a href="#cb511-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="st">`</span><span class="at">+</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ol start="6" type="1">
<li>Create a list of all the replacement functions found in the base package. Which ones are primitive functions? (Hint: use <code>apropos()</code>.)</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb512"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb512-1"><a href="#cb512-1" aria-hidden="true" tabindex="-1"></a><span class="co"># all replacement functions in base</span></span>
<span id="cb512-2"><a href="#cb512-2" aria-hidden="true" tabindex="-1"></a>fun_args2[<span class="fu">endsWith</span>(fun_args2<span class="sc">$</span>name, <span class="st">"&lt;-"</span>), ]<span class="sc">$</span>name</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  [1] ".rowNamesDF&lt;-"    "[[&lt;-"             "[&lt;-"              "@&lt;-"             
#&gt;  [5] "&lt;-"               "&lt;&lt;-"              "$&lt;-"              "attr&lt;-"          
#&gt;  [9] "attributes&lt;-"     "body&lt;-"           "class&lt;-"          "colnames&lt;-"      
#&gt; [13] "comment&lt;-"        "diag&lt;-"           "dim&lt;-"            "dimnames&lt;-"      
#&gt; [17] "Encoding&lt;-"       "environment&lt;-"    "formals&lt;-"        "is.na&lt;-"         
#&gt; [21] "length&lt;-"         "levels&lt;-"         "mode&lt;-"           "mostattributes&lt;-"
#&gt; [25] "names&lt;-"          "oldClass&lt;-"       "parent.env&lt;-"     "regmatches&lt;-"    
#&gt; [29] "row.names&lt;-"      "rownames&lt;-"       "split&lt;-"          "storage.mode&lt;-"  
#&gt; [33] "substr&lt;-"         "substring&lt;-"      "units&lt;-"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb514"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb514-1"><a href="#cb514-1" aria-hidden="true" tabindex="-1"></a><span class="co"># all replacement primitive functions in base</span></span>
<span id="cb514-2"><a href="#cb514-2" aria-hidden="true" tabindex="-1"></a>fun_args2[<span class="fu">endsWith</span>(fun_args2<span class="sc">$</span>name, <span class="st">"&lt;-"</span>) <span class="sc">&amp;</span> fun_args2<span class="sc">$</span>prim, ]<span class="sc">$</span>name</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  [1] "[[&lt;-"           "[&lt;-"            "@&lt;-"            "&lt;-"            
#&gt;  [5] "&lt;&lt;-"            "$&lt;-"            "attr&lt;-"         "attributes&lt;-"  
#&gt;  [9] "class&lt;-"        "dim&lt;-"          "dimnames&lt;-"     "environment&lt;-" 
#&gt; [13] "length&lt;-"       "levels&lt;-"       "names&lt;-"        "oldClass&lt;-"    
#&gt; [17] "storage.mode&lt;-"</code></pre>
</div>
</div>
<p>Answer: while you could use <code>apropos("&lt;-")</code>, I leveraged the existing code from 6.2.5 #5.</p>
<p>AR Solutions: The hint suggests to look for functions with a specific naming pattern: Replacement functions conventionally end on “&lt;-”. We can search for these objects by supplying the regular expression <code>"&lt;-$"</code> to <code>apropos()</code>. <code>apropos()</code> also allows to return the position on the search path (<code>search()</code>) for each of its matches via setting <code>where = TRUE</code>. Finally, we can set <code>mode = function</code> to narrow down our search to relevant objects only. This gives us the following statement to begin with:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb516"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb516-1"><a href="#cb516-1" aria-hidden="true" tabindex="-1"></a>repls <span class="ot">&lt;-</span> <span class="fu">apropos</span>(<span class="st">"&lt;-"</span>, <span class="at">where =</span> <span class="cn">TRUE</span>, <span class="at">mode =</span> <span class="st">"function"</span>)</span>
<span id="cb516-2"><a href="#cb516-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(repls, <span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;                     14                     14                     14 
#&gt;        ".rowNamesDF&lt;-"                 "[[&lt;-"      "[[&lt;-.data.frame" 
#&gt;                     14                     14                     14 
#&gt;          "[[&lt;-.factor" "[[&lt;-.numeric_version"         "[[&lt;-.POSIXlt" 
#&gt;                     14                     14                     14 
#&gt;                  "[&lt;-"       "[&lt;-.data.frame"             "[&lt;-.Date" 
#&gt;                     14                     14                     14 
#&gt;         "[&lt;-.difftime"           "[&lt;-.factor"  "[&lt;-.numeric_version" 
#&gt;                     14                     14                     14 
#&gt;          "[&lt;-.POSIXct"          "[&lt;-.POSIXlt"                  "@&lt;-" 
#&gt;                      3                     14                     14 
#&gt;                "%@%&lt;-"                   "&lt;-"                  "&lt;&lt;-" 
#&gt;                     14                     14                     14 
#&gt;                  "$&lt;-"       "$&lt;-.data.frame"          "$&lt;-.POSIXlt" 
#&gt;                     12                     14                     14 
#&gt;                 "as&lt;-"               "attr&lt;-"         "attributes&lt;-" 
#&gt;                     12                     14                     14 
#&gt;               "body&lt;-"               "body&lt;-"              "class&lt;-" 
#&gt;                     12                     14                     14 
#&gt;             "coerce&lt;-"           "colnames&lt;-"            "comment&lt;-"</code></pre>
</div>
</div>
<p>To restrict <code>repl</code> to names of replacement functions from the <code>{base}</code> package, we select only matches containing the relevant position on the search path.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb518"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb518-1"><a href="#cb518-1" aria-hidden="true" tabindex="-1"></a>repls_base <span class="ot">&lt;-</span> repls[<span class="fu">names</span>(repls) <span class="sc">==</span> <span class="fu">length</span>(<span class="fu">search</span>())]</span>
<span id="cb518-2"><a href="#cb518-2" aria-hidden="true" tabindex="-1"></a>repls_base</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;                        14                        14                        14 
#&gt;           ".rowNamesDF&lt;-"                    "[[&lt;-"         "[[&lt;-.data.frame" 
#&gt;                        14                        14                        14 
#&gt;             "[[&lt;-.factor"    "[[&lt;-.numeric_version"            "[[&lt;-.POSIXlt" 
#&gt;                        14                        14                        14 
#&gt;                     "[&lt;-"          "[&lt;-.data.frame"                "[&lt;-.Date" 
#&gt;                        14                        14                        14 
#&gt;            "[&lt;-.difftime"              "[&lt;-.factor"     "[&lt;-.numeric_version" 
#&gt;                        14                        14                        14 
#&gt;             "[&lt;-.POSIXct"             "[&lt;-.POSIXlt"                     "@&lt;-" 
#&gt;                        14                        14                        14 
#&gt;                      "&lt;-"                     "&lt;&lt;-"                     "$&lt;-" 
#&gt;                        14                        14                        14 
#&gt;          "$&lt;-.data.frame"             "$&lt;-.POSIXlt"                  "attr&lt;-" 
#&gt;                        14                        14                        14 
#&gt;            "attributes&lt;-"                  "body&lt;-"                 "class&lt;-" 
#&gt;                        14                        14                        14 
#&gt;              "colnames&lt;-"               "comment&lt;-"                  "diag&lt;-" 
#&gt;                        14                        14                        14 
#&gt;                   "dim&lt;-"              "dimnames&lt;-"   "dimnames&lt;-.data.frame" 
#&gt;                        14                        14                        14 
#&gt;              "Encoding&lt;-"           "environment&lt;-"               "formals&lt;-" 
#&gt;                        14                        14                        14 
#&gt;                 "is.na&lt;-"         "is.na&lt;-.default"          "is.na&lt;-.factor" 
#&gt;                        14                        14                        14 
#&gt; "is.na&lt;-.numeric_version"                "length&lt;-"           "length&lt;-.Date" 
#&gt;                        14                        14                        14 
#&gt;       "length&lt;-.difftime"         "length&lt;-.factor"        "length&lt;-.POSIXct" 
#&gt;                        14                        14                        14 
#&gt;        "length&lt;-.POSIXlt"                "levels&lt;-"         "levels&lt;-.factor" 
#&gt;                        14                        14                        14 
#&gt;                  "mode&lt;-"        "mostattributes&lt;-"                 "names&lt;-" 
#&gt;                        14                        14                        14 
#&gt;         "names&lt;-.POSIXlt"              "oldClass&lt;-"            "parent.env&lt;-" 
#&gt;                        14                        14                        14 
#&gt;            "regmatches&lt;-"             "row.names&lt;-"  "row.names&lt;-.data.frame" 
#&gt;                        14                        14                        14 
#&gt;     "row.names&lt;-.default"              "rownames&lt;-"                 "split&lt;-" 
#&gt;                        14                        14                        14 
#&gt;      "split&lt;-.data.frame"         "split&lt;-.default"          "storage.mode&lt;-" 
#&gt;                        14                        14                        14 
#&gt;                "substr&lt;-"             "substring&lt;-"                 "units&lt;-" 
#&gt;                        14 
#&gt;        "units&lt;-.difftime"</code></pre>
</div>
</div>
<p>To find out which of these functions are primitives, we first search for these functions via <code>mget()</code> and then subset the result using <code>Filter()</code> and <code>is.primitive()</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb520"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb520-1"><a href="#cb520-1" aria-hidden="true" tabindex="-1"></a>repls_base_prim <span class="ot">&lt;-</span> <span class="fu">mget</span>(repls_base, <span class="at">envir =</span> <span class="fu">baseenv</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb520-2"><a href="#cb520-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Filter</span>(is.primitive, .) <span class="sc">%&gt;%</span></span>
<span id="cb520-3"><a href="#cb520-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>()</span>
<span id="cb520-4"><a href="#cb520-4" aria-hidden="true" tabindex="-1"></a>repls_base_prim</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  [1] "[[&lt;-"           "[&lt;-"            "@&lt;-"            "&lt;-"            
#&gt;  [5] "&lt;&lt;-"            "$&lt;-"            "attr&lt;-"         "attributes&lt;-"  
#&gt;  [9] "class&lt;-"        "dim&lt;-"          "dimnames&lt;-"     "environment&lt;-" 
#&gt; [13] "length&lt;-"       "levels&lt;-"       "names&lt;-"        "oldClass&lt;-"    
#&gt; [17] "storage.mode&lt;-"</code></pre>
</div>
</div>
<p>Overall the <code>base</code> package contains 63 replacement functions of which 17 are primitive functions.</p>
<hr>
<ol start="7" type="1">
<li>What are valid names for user-created infix functions?</li>
</ol>
<p>Answer: they must begin and end with <code>%</code>, and can contain any sequence of characters except <code>%</code>.</p>
<hr>
<ol start="8" type="1">
<li>Create an infix <code>xor()</code> operator.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb522"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb522-1"><a href="#cb522-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">%xor%</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) <span class="fu">xor</span>(x, y)</span>
<span id="cb522-2"><a href="#cb522-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb522-3"><a href="#cb522-3" aria-hidden="true" tabindex="-1"></a><span class="fu">xor</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb524"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb524-1"><a href="#cb524-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xor</span>(<span class="dv">1</span>, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb526"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb526-1"><a href="#cb526-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xor</span>(<span class="dv">1</span>, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb528"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb528-1"><a href="#cb528-1" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span> <span class="sc">%xor%</span> <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb530"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb530-1"><a href="#cb530-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">%xor%</span> <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb532"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb532-1"><a href="#cb532-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">%xor%</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] FALSE</code></pre>
</div>
</div>
<p>Answer: code above.</p>
<p>AR Solutions: We could create an infix <code>%xor%</code> like this:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb534"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb534-1"><a href="#cb534-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">%xor%</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(a, b) {</span>
<span id="cb534-2"><a href="#cb534-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xor</span>(a, b)</span>
<span id="cb534-3"><a href="#cb534-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb534-4"><a href="#cb534-4" aria-hidden="true" tabindex="-1"></a><span class="cn">TRUE</span> <span class="sc">%xor%</span> <span class="cn">TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb536"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb536-1"><a href="#cb536-1" aria-hidden="true" tabindex="-1"></a><span class="cn">FALSE</span> <span class="sc">%xor%</span> <span class="cn">TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] TRUE</code></pre>
</div>
</div>
<hr>
<ol start="9" type="1">
<li>Create infix versions of the set functions <code>intersect()</code>, <code>union()</code>, and <code>setdiff()</code>. You might call them <code>%n%</code>, <code>%u%</code>, and <code>%/%</code> to match conventions from mathematics.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb538"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb538-1"><a href="#cb538-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">%n%</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) <span class="fu">intersect</span>(x, y)</span>
<span id="cb538-2"><a href="#cb538-2" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">%u%</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) <span class="fu">union</span>(x, y)</span>
<span id="cb538-3"><a href="#cb538-3" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">%s%</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) <span class="fu">setdiff</span>(x, y)</span>
<span id="cb538-4"><a href="#cb538-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb538-5"><a href="#cb538-5" aria-hidden="true" tabindex="-1"></a><span class="co"># taken from docs examples</span></span>
<span id="cb538-6"><a href="#cb538-6" aria-hidden="true" tabindex="-1"></a>(x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">sort</span>(<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>, <span class="dv">9</span>)), <span class="cn">NA</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  [1]  2  6 10 11 12 13 14 17 19 NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb540"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb540-1"><a href="#cb540-1" aria-hidden="true" tabindex="-1"></a>(y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">sort</span>(<span class="fu">sample</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">23</span>, <span class="dv">7</span>)), <span class="cn">NA</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1]  3  8  9 10 11 19 21 NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb542"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb542-1"><a href="#cb542-1" aria-hidden="true" tabindex="-1"></a>x <span class="sc">%u%</span> y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  [1]  2  6 10 11 12 13 14 17 19 NA  3  8  9 21</code></pre>
</div>
<div class="sourceCode cell-code" id="cb544"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb544-1"><a href="#cb544-1" aria-hidden="true" tabindex="-1"></a>x <span class="sc">%n%</span> y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 10 11 19 NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb546"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb546-1"><a href="#cb546-1" aria-hidden="true" tabindex="-1"></a>x <span class="sc">%s%</span> y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1]  2  6 12 13 14 17</code></pre>
</div>
<div class="sourceCode cell-code" id="cb548"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb548-1"><a href="#cb548-1" aria-hidden="true" tabindex="-1"></a>y <span class="sc">%s%</span> x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1]  3  8  9 21</code></pre>
</div>
</div>
<p>Answer: code above.</p>
<p>AR Solutions: These infix operators could be defined in the following way. (<code>%/%</code> is chosen instead of <code>%\%</code>, because <code>\</code> serves as an escape character.)</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb550"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb550-1"><a href="#cb550-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">%n%</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(a, b) {</span>
<span id="cb550-2"><a href="#cb550-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">intersect</span>(a, b)</span>
<span id="cb550-3"><a href="#cb550-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb550-4"><a href="#cb550-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb550-5"><a href="#cb550-5" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">%u%</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(a, b) {</span>
<span id="cb550-6"><a href="#cb550-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">union</span>(a, b)</span>
<span id="cb550-7"><a href="#cb550-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb550-8"><a href="#cb550-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb550-9"><a href="#cb550-9" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">%/%</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(a, b) {</span>
<span id="cb550-10"><a href="#cb550-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setdiff</span>(a, b)</span>
<span id="cb550-11"><a href="#cb550-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb550-12"><a href="#cb550-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb550-13"><a href="#cb550-13" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"d"</span>)</span>
<span id="cb550-14"><a href="#cb550-14" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>)</span>
<span id="cb550-15"><a href="#cb550-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb550-16"><a href="#cb550-16" aria-hidden="true" tabindex="-1"></a>x <span class="sc">%u%</span> y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "a" "b" "d" "c"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb552"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb552-1"><a href="#cb552-1" aria-hidden="true" tabindex="-1"></a>x <span class="sc">%n%</span> y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "a" "d"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb554"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb554-1"><a href="#cb554-1" aria-hidden="true" tabindex="-1"></a>x <span class="sc">%/%</span> y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "b"</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="environments" class="level2">
<h2 class="anchored" data-anchor-id="environments">7 Environments</h2>
<p>The environment is the data structure that powers scoping. This chapter dives deep into environments, describing their structure in depth, and using them to improve your understanding of the four scoping rules described in Section 6.4. Understanding environments is not necessary for day-to-day use of R. But they are important to understand because they power many important R features like lexical scoping, namespaces, and R6 classes, and interact with evaluation to give you powerful tools for making domain specific languages, like dplyr and ggplot2.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb556"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb556-1"><a href="#cb556-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="exercises-20" class="level3">
<h3 class="anchored" data-anchor-id="exercises-20">7.2.7 Exercises</h3>
<ol type="1">
<li>List three ways in which an environment differs from a list.</li>
</ol>
<p>Answer:</p>
<ul>
<li>Every name in an environment must be unique</li>
<li>Environment names are not ordered</li>
<li>Environments have parents (except the empty environment)</li>
<li>Environments are not copied when modified</li>
</ul>
<p>AR Solutions: The most important differences between environments and lists are:</p>
<ul>
<li>environments have reference semantics (i.e.&nbsp;they don’t copy-on-modify)</li>
<li>environments have parents</li>
<li>the contents of an environment must have unique names</li>
<li>the contents of an environment are not ordered</li>
<li>(environments can only be compared via <code>identical()</code>; not with <code>==</code>)</li>
<li>(environments can contain themselves)</li>
</ul>
<hr>
<ol start="2" type="1">
<li>Create an environment as illustrated by this picture.</li>
</ol>
<p><img src="assets/recursive-1.png" class="img-fluid"></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb557"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb557-1"><a href="#cb557-1" aria-hidden="true" tabindex="-1"></a>e1 <span class="ot">&lt;-</span> <span class="fu">env</span>()</span>
<span id="cb557-2"><a href="#cb557-2" aria-hidden="true" tabindex="-1"></a>e1<span class="sc">$</span>loop <span class="ot">&lt;-</span> e1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Answer: code above.</p>
<p>AR Solutions: Let’s create an environment that contains itself.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb558"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb558-1"><a href="#cb558-1" aria-hidden="true" tabindex="-1"></a>e1 <span class="ot">&lt;-</span> <span class="fu">env</span>()</span>
<span id="cb558-2"><a href="#cb558-2" aria-hidden="true" tabindex="-1"></a>e1<span class="sc">$</span>loop <span class="ot">&lt;-</span> e1</span>
<span id="cb558-3"><a href="#cb558-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb558-4"><a href="#cb558-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the environment</span></span>
<span id="cb558-5"><a href="#cb558-5" aria-hidden="true" tabindex="-1"></a><span class="fu">env_print</span>(e1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; &lt;environment: 0x10f496458&gt;
#&gt; Parent: &lt;environment: global&gt;
#&gt; Bindings:
#&gt; • loop: &lt;env&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb560"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb560-1"><a href="#cb560-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify that it contains itself</span></span>
<span id="cb560-2"><a href="#cb560-2" aria-hidden="true" tabindex="-1"></a>lobstr<span class="sc">::</span><span class="fu">ref</span>(e1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; █ [1:0x10f496458] &lt;env&gt; 
#&gt; └─loop = [1:0x10f496458]</code></pre>
</div>
</div>
<hr>
<ol start="3" type="1">
<li>Create a pair of environments as illustrated by this picture.</li>
</ol>
<p><img src="assets/recursive-2.png" class="img-fluid"></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb562"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb562-1"><a href="#cb562-1" aria-hidden="true" tabindex="-1"></a>e2 <span class="ot">&lt;-</span> <span class="fu">env</span>()</span>
<span id="cb562-2"><a href="#cb562-2" aria-hidden="true" tabindex="-1"></a>e3 <span class="ot">&lt;-</span> <span class="fu">env</span>()</span>
<span id="cb562-3"><a href="#cb562-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb562-4"><a href="#cb562-4" aria-hidden="true" tabindex="-1"></a>e2<span class="sc">$</span>loop <span class="ot">&lt;-</span> e3</span>
<span id="cb562-5"><a href="#cb562-5" aria-hidden="true" tabindex="-1"></a>e3<span class="sc">$</span>dedoop <span class="ot">&lt;-</span> e2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Answer: code above.</p>
<p>AR Solutions: These two environments contain each other:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb563"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb563-1"><a href="#cb563-1" aria-hidden="true" tabindex="-1"></a>e1 <span class="ot">&lt;-</span> <span class="fu">env</span>()</span>
<span id="cb563-2"><a href="#cb563-2" aria-hidden="true" tabindex="-1"></a>e2 <span class="ot">&lt;-</span> <span class="fu">env</span>()</span>
<span id="cb563-3"><a href="#cb563-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb563-4"><a href="#cb563-4" aria-hidden="true" tabindex="-1"></a>e1<span class="sc">$</span>loop <span class="ot">&lt;-</span> e2</span>
<span id="cb563-5"><a href="#cb563-5" aria-hidden="true" tabindex="-1"></a>e2<span class="sc">$</span>dedoop <span class="ot">&lt;-</span> e1</span>
<span id="cb563-6"><a href="#cb563-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb563-7"><a href="#cb563-7" aria-hidden="true" tabindex="-1"></a>lobstr<span class="sc">::</span><span class="fu">ref</span>(e1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; █ [1:0x1335dc0e0] &lt;env&gt; 
#&gt; └─loop = █ [2:0x1120256a8] &lt;env&gt; 
#&gt;          └─dedoop = [1:0x1335dc0e0]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb565"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb565-1"><a href="#cb565-1" aria-hidden="true" tabindex="-1"></a>lobstr<span class="sc">::</span><span class="fu">ref</span>(e2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; █ [1:0x1120256a8] &lt;env&gt; 
#&gt; └─dedoop = █ [2:0x1335dc0e0] &lt;env&gt; 
#&gt;            └─loop = [1:0x1120256a8]</code></pre>
</div>
</div>
<hr>
<ol start="4" type="1">
<li>Explain why <code>e[[1]]</code> and <code>e[c("a", "b")]</code> don’t make sense when <code>e</code> is an environment.</li>
</ol>
<p>Answer: environment names are not ordered, and aren’t copied when modified, so they aren’t subsettable.</p>
<p>AR Solutions: The first option doesn’t make sense, because elements of an environment are not ordered. The second option would return two objects at the same time. What data structure would they be contained inside?</p>
<hr>
<ol start="5" type="1">
<li>Create a version of <code>env_poke()</code> that will only bind new names, never re-bind old names. Some programming languages only do this, and are known as <a href="https://en.wikipedia.org/wiki/Assignment_(computer_science)#Single_assignment">single assignment languages</a>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb567"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb567-1"><a href="#cb567-1" aria-hidden="true" tabindex="-1"></a>env_poke_new <span class="ot">&lt;-</span> <span class="cf">function</span>(env, nm, value) {</span>
<span id="cb567-2"><a href="#cb567-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.environment</span>(env)) <span class="fu">stop</span>(<span class="st">"env is not an enviornment"</span>)</span>
<span id="cb567-3"><a href="#cb567-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (nm <span class="sc">%in%</span> <span class="fu">names</span>(env)) <span class="fu">stop</span>(<span class="st">"nm '"</span>, nm, <span class="st">"' already bound"</span>)</span>
<span id="cb567-4"><a href="#cb567-4" aria-hidden="true" tabindex="-1"></a>  env[[nm]] <span class="ot">&lt;-</span> value</span>
<span id="cb567-5"><a href="#cb567-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb567-6"><a href="#cb567-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb567-7"><a href="#cb567-7" aria-hidden="true" tabindex="-1"></a>e_test <span class="ot">&lt;-</span> <span class="fu">env</span>(<span class="at">a =</span> <span class="cn">NULL</span>, <span class="at">b =</span> <span class="dv">2</span>, <span class="at">c =</span> <span class="st">"three"</span>)</span>
<span id="cb567-8"><a href="#cb567-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb567-9"><a href="#cb567-9" aria-hidden="true" tabindex="-1"></a><span class="fu">env_poke_new</span>(e_test, <span class="st">"d"</span>, <span class="st">"success"</span>)</span>
<span id="cb567-10"><a href="#cb567-10" aria-hidden="true" tabindex="-1"></a><span class="fu">try</span>(<span class="fu">env_poke_new</span>(e_test, <span class="st">"a"</span>, <span class="st">"fail"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Error in env_poke_new(e_test, "a", "fail") : nm 'a' already bound</code></pre>
</div>
<div class="sourceCode cell-code" id="cb569"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb569-1"><a href="#cb569-1" aria-hidden="true" tabindex="-1"></a><span class="fu">env_print</span>(e_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; &lt;environment: 0x133299948&gt;
#&gt; Parent: &lt;environment: global&gt;
#&gt; Bindings:
#&gt; • a: &lt;NULL&gt;
#&gt; • b: &lt;dbl&gt;
#&gt; • c: &lt;chr&gt;
#&gt; • d: &lt;chr&gt;</code></pre>
</div>
</div>
<p>Answer: code above.</p>
<p>AR Solutions: As described in <em>Advanced R</em> <code>rlang::env_poke()</code> takes a name (as string) and a value to assign (or reassign) a binding in an environment.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb571"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb571-1"><a href="#cb571-1" aria-hidden="true" tabindex="-1"></a>e3 <span class="ot">&lt;-</span> <span class="fu">new.env</span>()</span>
<span id="cb571-2"><a href="#cb571-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb571-3"><a href="#cb571-3" aria-hidden="true" tabindex="-1"></a><span class="fu">env_poke</span>(e3, <span class="st">"a"</span>, <span class="dv">100</span>)</span>
<span id="cb571-4"><a href="#cb571-4" aria-hidden="true" tabindex="-1"></a>e3<span class="sc">$</span>a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 100</code></pre>
</div>
<div class="sourceCode cell-code" id="cb573"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb573-1"><a href="#cb573-1" aria-hidden="true" tabindex="-1"></a><span class="fu">env_poke</span>(e3, <span class="st">"a"</span>, <span class="dv">200</span>)</span>
<span id="cb573-2"><a href="#cb573-2" aria-hidden="true" tabindex="-1"></a>e3<span class="sc">$</span>a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 200</code></pre>
</div>
</div>
<p>So, we want <code>env_poke2()</code> to test, if the supplied name is already present in the given environment. This can be checked via <code>env_has()</code>. If this is the case, an (informative) error is thrown.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb575"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb575-1"><a href="#cb575-1" aria-hidden="true" tabindex="-1"></a>env_poke2 <span class="ot">&lt;-</span> <span class="cf">function</span>(env, name, value) {</span>
<span id="cb575-2"><a href="#cb575-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">env_has</span>(env, name)) {</span>
<span id="cb575-3"><a href="#cb575-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">abort</span>(<span class="fu">paste0</span>(<span class="st">"</span><span class="sc">\"</span><span class="st">"</span>, name, <span class="st">"</span><span class="sc">\"</span><span class="st"> is already assigned to a value."</span>))</span>
<span id="cb575-4"><a href="#cb575-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb575-5"><a href="#cb575-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb575-6"><a href="#cb575-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">env_poke</span>(env, name, value)</span>
<span id="cb575-7"><a href="#cb575-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">invisible</span>(env)</span>
<span id="cb575-8"><a href="#cb575-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb575-9"><a href="#cb575-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb575-10"><a href="#cb575-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Test</span></span>
<span id="cb575-11"><a href="#cb575-11" aria-hidden="true" tabindex="-1"></a><span class="fu">env_poke2</span>(e3, <span class="st">"b"</span>, <span class="dv">100</span>)</span>
<span id="cb575-12"><a href="#cb575-12" aria-hidden="true" tabindex="-1"></a>e3<span class="sc">$</span>b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 100</code></pre>
</div>
<div class="sourceCode cell-code" id="cb577"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb577-1"><a href="#cb577-1" aria-hidden="true" tabindex="-1"></a><span class="fu">try</span>(<span class="fu">env_poke2</span>(e3, <span class="st">"b"</span>, <span class="dv">200</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Error in env_poke2(e3, "b", 200) : "b" is already assigned to a value.</code></pre>
</div>
</div>
<hr>
<ol start="6" type="1">
<li>What does this function do? How does it differ from <code>&lt;&lt;-</code> and why might you prefer it?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb579"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb579-1"><a href="#cb579-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; Warning in rm(a): object 'a' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb581"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb581-1"><a href="#cb581-1" aria-hidden="true" tabindex="-1"></a>rebind <span class="ot">&lt;-</span> <span class="cf">function</span>(name, value, <span class="at">env =</span> <span class="fu">caller_env</span>()) {</span>
<span id="cb581-2"><a href="#cb581-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">identical</span>(env, <span class="fu">empty_env</span>())) {</span>
<span id="cb581-3"><a href="#cb581-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Can't find `"</span>, name, <span class="st">"`"</span>, <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb581-4"><a href="#cb581-4" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">env_has</span>(env, name)) {</span>
<span id="cb581-5"><a href="#cb581-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">env_poke</span>(env, name, value)</span>
<span id="cb581-6"><a href="#cb581-6" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb581-7"><a href="#cb581-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rebind</span>(name, value, <span class="fu">env_parent</span>(env))</span>
<span id="cb581-8"><a href="#cb581-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb581-9"><a href="#cb581-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb581-10"><a href="#cb581-10" aria-hidden="true" tabindex="-1"></a><span class="fu">try</span>(<span class="fu">rebind</span>(<span class="st">"a"</span>, <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Error : Can't find `a`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb583"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb583-1"><a href="#cb583-1" aria-hidden="true" tabindex="-1"></a>(a <span class="ot">&lt;-</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb585"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb585-1"><a href="#cb585-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rebind</span>(<span class="st">"a"</span>, <span class="dv">10</span>)</span>
<span id="cb585-2"><a href="#cb585-2" aria-hidden="true" tabindex="-1"></a>a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 10</code></pre>
</div>
</div>
<p>Answer: <code>&lt;&lt;-</code> will assign a value to the name in the global environment if the name is not found, <code>rebind()</code> does not.</p>
<p>AR Solutions: The primary difference between <code>rebind()</code> and <code>&lt;&lt;-</code> is that <code>rebind()</code> will only carry out an assignment when it finds an existing binding; unlike <code>&lt;&lt;-</code> it will never create a new one in the global environment. This behaviour of <code>&lt;&lt;-</code> is usually undesirable because global variables introduce non-obvious dependencies between functions.</p>
<hr>
</section>
<section id="exercises-21" class="level3">
<h3 class="anchored" data-anchor-id="exercises-21">7.3.1 Exercises</h3>
<ol type="1">
<li>Modify <code>where()</code> to return <em>all</em> environments that contain a binding for <code>name</code>. Carefully think through what type of object the function will need to return.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb587"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb587-1"><a href="#cb587-1" aria-hidden="true" tabindex="-1"></a>where <span class="ot">&lt;-</span> <span class="cf">function</span>(name, <span class="at">env =</span> <span class="fu">caller_env</span>()) {</span>
<span id="cb587-2"><a href="#cb587-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">identical</span>(env, <span class="fu">empty_env</span>())) {</span>
<span id="cb587-3"><a href="#cb587-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Base case</span></span>
<span id="cb587-4"><a href="#cb587-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Can't find "</span>, name, <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb587-5"><a href="#cb587-5" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">env_has</span>(env, name)) {</span>
<span id="cb587-6"><a href="#cb587-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Success case</span></span>
<span id="cb587-7"><a href="#cb587-7" aria-hidden="true" tabindex="-1"></a>    env</span>
<span id="cb587-8"><a href="#cb587-8" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb587-9"><a href="#cb587-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Recursive case</span></span>
<span id="cb587-10"><a href="#cb587-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">where</span>(name, <span class="fu">env_parent</span>(env))</span>
<span id="cb587-11"><a href="#cb587-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb587-12"><a href="#cb587-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb587-13"><a href="#cb587-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb587-14"><a href="#cb587-14" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb587-15"><a href="#cb587-15" aria-hidden="true" tabindex="-1"></a><span class="fu">try</span>(<span class="fu">where</span>(<span class="st">"yyy"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Error : Can't find yyy</code></pre>
</div>
<div class="sourceCode cell-code" id="cb589"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb589-1"><a href="#cb589-1" aria-hidden="true" tabindex="-1"></a><span class="fu">where</span>(<span class="st">"x"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; &lt;environment: R_GlobalEnv&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb591"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb591-1"><a href="#cb591-1" aria-hidden="true" tabindex="-1"></a><span class="fu">where</span>(<span class="st">"mean"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; &lt;environment: base&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb593"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb593-1"><a href="#cb593-1" aria-hidden="true" tabindex="-1"></a>all_where <span class="ot">&lt;-</span> <span class="cf">function</span>(name, <span class="at">env =</span> <span class="fu">caller_env</span>(), <span class="at">found =</span> <span class="fu">list</span>()) {</span>
<span id="cb593-2"><a href="#cb593-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">identical</span>(env, <span class="fu">empty_env</span>())) {</span>
<span id="cb593-3"><a href="#cb593-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Base case</span></span>
<span id="cb593-4"><a href="#cb593-4" aria-hidden="true" tabindex="-1"></a>    found</span>
<span id="cb593-5"><a href="#cb593-5" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">env_has</span>(env, name)) {</span>
<span id="cb593-6"><a href="#cb593-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Success case</span></span>
<span id="cb593-7"><a href="#cb593-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">all_where</span>(name, <span class="fu">env_parent</span>(env), <span class="fu">append</span>(env, found, <span class="at">after =</span> <span class="dv">0</span>))</span>
<span id="cb593-8"><a href="#cb593-8" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb593-9"><a href="#cb593-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Recursive case</span></span>
<span id="cb593-10"><a href="#cb593-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">all_where</span>(name, <span class="fu">env_parent</span>(env), found)</span>
<span id="cb593-11"><a href="#cb593-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb593-12"><a href="#cb593-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb593-13"><a href="#cb593-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb593-14"><a href="#cb593-14" aria-hidden="true" tabindex="-1"></a><span class="fu">all_where</span>(<span class="st">"x"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [[1]]
#&gt; &lt;environment: R_GlobalEnv&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb595"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb595-1"><a href="#cb595-1" aria-hidden="true" tabindex="-1"></a><span class="fu">local</span>({</span>
<span id="cb595-2"><a href="#cb595-2" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb595-3"><a href="#cb595-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">all_where</span>(<span class="st">"x"</span>)</span>
<span id="cb595-4"><a href="#cb595-4" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [[1]]
#&gt; &lt;environment: 0x133ee5de8&gt;
#&gt; 
#&gt; [[2]]
#&gt; &lt;environment: R_GlobalEnv&gt;</code></pre>
</div>
</div>
<p>Answer: code above.</p>
<p>AR Solutions: <code>where()</code> searches (recursively) for a given name within a given environment and its ancestors. If <code>where()</code> finds the name in one of these environments, it returns the environment’s name. Otherwise, it throws an error.</p>
<p>Our modified version of <code>where()</code> will always recurse until it reaches the empty environment. No matter if it has already found the name or not. Along the way, it will check each environment for the given <code>name</code>. Finally, it will return a list of environments where the binding was found; if no binding was found, the list will be empty.</p>
<p>Please also note how the list is initialised via the default argument, when the function is called for the first time. This is a bit confusing, which is why it’s common to wrap a recursive function inside another, more user friendly, function.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb597"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb597-1"><a href="#cb597-1" aria-hidden="true" tabindex="-1"></a>where2 <span class="ot">&lt;-</span> <span class="cf">function</span>(name, <span class="at">env =</span> <span class="fu">caller_env</span>(), <span class="at">results =</span> <span class="fu">list</span>()) {</span>
<span id="cb597-2"><a href="#cb597-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">identical</span>(env, <span class="fu">empty_env</span>())) {</span>
<span id="cb597-3"><a href="#cb597-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Base case</span></span>
<span id="cb597-4"><a href="#cb597-4" aria-hidden="true" tabindex="-1"></a>    results</span>
<span id="cb597-5"><a href="#cb597-5" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb597-6"><a href="#cb597-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Recursive case</span></span>
<span id="cb597-7"><a href="#cb597-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">env_has</span>(env, name)) {</span>
<span id="cb597-8"><a href="#cb597-8" aria-hidden="true" tabindex="-1"></a>      results <span class="ot">&lt;-</span> <span class="fu">c</span>(results, env)</span>
<span id="cb597-9"><a href="#cb597-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb597-10"><a href="#cb597-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">where2</span>(name, <span class="fu">env_parent</span>(env), results)</span>
<span id="cb597-11"><a href="#cb597-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb597-12"><a href="#cb597-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb597-13"><a href="#cb597-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Test</span></span>
<span id="cb597-14"><a href="#cb597-14" aria-hidden="true" tabindex="-1"></a>e1a <span class="ot">&lt;-</span> <span class="fu">env</span>(<span class="fu">empty_env</span>(), <span class="at">a =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">2</span>)</span>
<span id="cb597-15"><a href="#cb597-15" aria-hidden="true" tabindex="-1"></a>e1b <span class="ot">&lt;-</span> <span class="fu">env</span>(e1a, <span class="at">b =</span> <span class="dv">10</span>, <span class="at">c =</span> <span class="dv">11</span>)</span>
<span id="cb597-16"><a href="#cb597-16" aria-hidden="true" tabindex="-1"></a>e1c <span class="ot">&lt;-</span> <span class="fu">env</span>(e1b, <span class="at">a =</span> <span class="dv">12</span>, <span class="at">d =</span> <span class="dv">13</span>)</span>
<span id="cb597-17"><a href="#cb597-17" aria-hidden="true" tabindex="-1"></a><span class="fu">where2</span>(<span class="st">"a"</span>, e1c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [[1]]
#&gt; &lt;environment: 0x144cc8420&gt;
#&gt; 
#&gt; [[2]]
#&gt; &lt;environment: 0x13230a500&gt;</code></pre>
</div>
</div>
<hr>
<ol start="2" type="1">
<li>Write a function called <code>fget()</code> that finds only function objects. It should have two arguments, <code>name</code> and <code>env</code>, and should obey the regular scoping rules for functions: if there’s an object with a matching name that’s not a function, look in the parent. For an added challenge, also add an <code>inherits</code> argument which controls whether the function recurses up the parents or only looks in one environment.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb599"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb599-1"><a href="#cb599-1" aria-hidden="true" tabindex="-1"></a>fget <span class="ot">&lt;-</span> <span class="cf">function</span>(name, <span class="at">env =</span> <span class="fu">caller_env</span>(), <span class="at">inherits =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb599-2"><a href="#cb599-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">identical</span>(env, <span class="fu">empty_env</span>())) {</span>
<span id="cb599-3"><a href="#cb599-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Base case</span></span>
<span id="cb599-4"><a href="#cb599-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Can't find "</span>, name, <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb599-5"><a href="#cb599-5" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">env_has</span>(env, name) <span class="sc">&amp;&amp;</span> <span class="fu">is.function</span>(env[[name]])) {</span>
<span id="cb599-6"><a href="#cb599-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Success case</span></span>
<span id="cb599-7"><a href="#cb599-7" aria-hidden="true" tabindex="-1"></a>    env</span>
<span id="cb599-8"><a href="#cb599-8" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (inherits) {</span>
<span id="cb599-9"><a href="#cb599-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Recursive case</span></span>
<span id="cb599-10"><a href="#cb599-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fget</span>(name, <span class="fu">env_parent</span>(env))</span>
<span id="cb599-11"><a href="#cb599-11" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb599-12"><a href="#cb599-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Can't find "</span>, name, <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb599-13"><a href="#cb599-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb599-14"><a href="#cb599-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb599-15"><a href="#cb599-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb599-16"><a href="#cb599-16" aria-hidden="true" tabindex="-1"></a><span class="fu">try</span>(<span class="fu">fget</span>(<span class="st">"x"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Error : Can't find x</code></pre>
</div>
<div class="sourceCode cell-code" id="cb601"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb601-1"><a href="#cb601-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fget</span>(<span class="st">"print"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; &lt;environment: base&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb603"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb603-1"><a href="#cb603-1" aria-hidden="true" tabindex="-1"></a><span class="fu">try</span>(<span class="fu">fget</span>(<span class="st">"print"</span>, <span class="at">inherits =</span> <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Error : Can't find print</code></pre>
</div>
<div class="sourceCode cell-code" id="cb605"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb605-1"><a href="#cb605-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fget</span>(<span class="st">"all_where"</span>, <span class="at">inherits =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; &lt;environment: R_GlobalEnv&gt;</code></pre>
</div>
</div>
<p>Answer: code above.</p>
<p>AR Solutions: We follow a similar approach to the previous exercise. This time we additionally check if the found object is a function and implement an argument to turn off the recursion, if desired.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb607"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb607-1"><a href="#cb607-1" aria-hidden="true" tabindex="-1"></a>fget <span class="ot">&lt;-</span> <span class="cf">function</span>(name, <span class="at">env =</span> <span class="fu">caller_env</span>(), <span class="at">inherits =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb607-2"><a href="#cb607-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Base case</span></span>
<span id="cb607-3"><a href="#cb607-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">env_has</span>(env, name)) {</span>
<span id="cb607-4"><a href="#cb607-4" aria-hidden="true" tabindex="-1"></a>    obj <span class="ot">&lt;-</span> <span class="fu">env_get</span>(env, name)</span>
<span id="cb607-5"><a href="#cb607-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.function</span>(obj)) {</span>
<span id="cb607-6"><a href="#cb607-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(obj)</span>
<span id="cb607-7"><a href="#cb607-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb607-8"><a href="#cb607-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb607-9"><a href="#cb607-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">identical</span>(env, <span class="fu">emptyenv</span>()) <span class="sc">||</span> <span class="sc">!</span>inherits) {</span>
<span id="cb607-10"><a href="#cb607-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Could not find a function called </span><span class="sc">\"</span><span class="st">"</span>, name, <span class="st">"</span><span class="sc">\"</span><span class="st">."</span>,</span>
<span id="cb607-11"><a href="#cb607-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">call. =</span> <span class="cn">FALSE</span></span>
<span id="cb607-12"><a href="#cb607-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb607-13"><a href="#cb607-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb607-14"><a href="#cb607-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb607-15"><a href="#cb607-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Recursive Case</span></span>
<span id="cb607-16"><a href="#cb607-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fget</span>(name, <span class="fu">env_parent</span>(env))</span>
<span id="cb607-17"><a href="#cb607-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb607-18"><a href="#cb607-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb607-19"><a href="#cb607-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Test</span></span>
<span id="cb607-20"><a href="#cb607-20" aria-hidden="true" tabindex="-1"></a>mean <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb607-21"><a href="#cb607-21" aria-hidden="true" tabindex="-1"></a><span class="fu">fget</span>(<span class="st">"mean"</span>, <span class="at">inherits =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; function (x, ...) 
#&gt; UseMethod("mean")
#&gt; &lt;bytecode: 0x133fc4fc8&gt;
#&gt; &lt;environment: namespace:base&gt;</code></pre>
</div>
</div>
<hr>
</section>
<section id="exercises-22" class="level3">
<h3 class="anchored" data-anchor-id="exercises-22">7.4.5 Exercises</h3>
<ol type="1">
<li>How is <code>search_envs()</code> different from <code>env_parents(global_env())</code>?</li>
</ol>
<p>Answer: <code>search_envs()</code> includes the global environment. <code>env_parents(global_env())</code> doesn’t include the global environment and also returns the empty environment (the top parent).</p>
<p>AR Solutions: <code>search_envs()</code> returns all the environments on the search path, which is “a chain of environments containing exported functions of attached packages” (from <code>?search_envs</code>). Every time you attach a new package, this search path will grow. The search path ends with the base-environment. The global environment is included, because functions present in the global environment will always be part of the search path.</p>
<p><code>env_parents(global_env())</code> will list all the ancestors of the global environment, therefore the global environment itself is not included. This also includes the “ultimate ancestor”, the empty environment. This environment is not considered part of the search path because it contains no objects.</p>
<hr>
<ol start="2" type="1">
<li>Draw a diagram that shows the enclosing environments of this function:</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb609"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb609-1"><a href="#cb609-1" aria-hidden="true" tabindex="-1"></a>f1 <span class="ot">&lt;-</span> <span class="cf">function</span>(x1) {</span>
<span id="cb609-2"><a href="#cb609-2" aria-hidden="true" tabindex="-1"></a>  f2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x2) {</span>
<span id="cb609-3"><a href="#cb609-3" aria-hidden="true" tabindex="-1"></a>    f3 <span class="ot">&lt;-</span> <span class="cf">function</span>(x3) {</span>
<span id="cb609-4"><a href="#cb609-4" aria-hidden="true" tabindex="-1"></a>      x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3</span>
<span id="cb609-5"><a href="#cb609-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb609-6"><a href="#cb609-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">f3</span>(<span class="dv">3</span>)</span>
<span id="cb609-7"><a href="#cb609-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb609-8"><a href="#cb609-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f2</span>(<span class="dv">2</span>)</span>
<span id="cb609-9"><a href="#cb609-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb609-10"><a href="#cb609-10" aria-hidden="true" tabindex="-1"></a><span class="fu">f1</span>(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Answer: No.</p>
<hr>
<ol start="3" type="1">
<li>Write an enhanced version of <code>str()</code> that provides more information about functions. Show where the function was found and what environment it was defined in.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb610"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb610-1"><a href="#cb610-1" aria-hidden="true" tabindex="-1"></a>e_str <span class="ot">&lt;-</span> <span class="cf">function</span>(object, ...) {</span>
<span id="cb610-2"><a href="#cb610-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str</span>(object, ...)</span>
<span id="cb610-3"><a href="#cb610-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.function</span>(object)) {</span>
<span id="cb610-4"><a href="#cb610-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"fn_env():"</span>)</span>
<span id="cb610-5"><a href="#cb610-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">fn_env</span>(object))</span>
<span id="cb610-6"><a href="#cb610-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"environment():"</span>)</span>
<span id="cb610-7"><a href="#cb610-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">environment</span>(object))</span>
<span id="cb610-8"><a href="#cb610-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb610-9"><a href="#cb610-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb610-10"><a href="#cb610-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb610-11"><a href="#cb610-11" aria-hidden="true" tabindex="-1"></a><span class="fu">e_str</span>(print)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; function (x, ...)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; fn_env():</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; &lt;environment: namespace:base&gt;</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; environment():</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; &lt;environment: namespace:base&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb616"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb616-1"><a href="#cb616-1" aria-hidden="true" tabindex="-1"></a><span class="fu">e_str</span>(fget)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; function (name, env = caller_env(), inherits = TRUE)  
#&gt;  - attr(*, "srcref")= 'srcref' int [1:8] 1 9 17 1 9 1 1 17
#&gt;   ..- attr(*, "srcfile")=Classes 'srcfilecopy', 'srcfile' &lt;environment: 0x10ba63f90&gt;</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; fn_env():</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; &lt;environment: R_GlobalEnv&gt;</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; environment():</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; &lt;environment: R_GlobalEnv&gt;</code></pre>
</div>
</div>
<p>Answer: code above.</p>
<p>AR Solutions: To solve this problem, we need to write a function that takes the name of a function and looks for that function returning both the function and the environment that it was found in.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb622"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb622-1"><a href="#cb622-1" aria-hidden="true" tabindex="-1"></a>fget2 <span class="ot">&lt;-</span> <span class="cf">function</span>(name, <span class="at">env =</span> <span class="fu">caller_env</span>()) {</span>
<span id="cb622-2"><a href="#cb622-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Base case</span></span>
<span id="cb622-3"><a href="#cb622-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">env_has</span>(env, name)) {</span>
<span id="cb622-4"><a href="#cb622-4" aria-hidden="true" tabindex="-1"></a>    obj <span class="ot">&lt;-</span> <span class="fu">env_get</span>(env, name)</span>
<span id="cb622-5"><a href="#cb622-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.function</span>(obj)) {</span>
<span id="cb622-6"><a href="#cb622-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">fun =</span> obj, <span class="at">env =</span> env))</span>
<span id="cb622-7"><a href="#cb622-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb622-8"><a href="#cb622-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb622-9"><a href="#cb622-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">identical</span>(env, <span class="fu">emptyenv</span>())) {</span>
<span id="cb622-10"><a href="#cb622-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Could not find a function called </span><span class="sc">\"</span><span class="st">"</span>, name, <span class="st">"</span><span class="sc">\"</span><span class="st">"</span>,</span>
<span id="cb622-11"><a href="#cb622-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">call. =</span> <span class="cn">FALSE</span></span>
<span id="cb622-12"><a href="#cb622-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb622-13"><a href="#cb622-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb622-14"><a href="#cb622-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Recursive Case</span></span>
<span id="cb622-15"><a href="#cb622-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fget2</span>(name, <span class="fu">env_parent</span>(env))</span>
<span id="cb622-16"><a href="#cb622-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb622-17"><a href="#cb622-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb622-18"><a href="#cb622-18" aria-hidden="true" tabindex="-1"></a>fstr <span class="ot">&lt;-</span> <span class="cf">function</span>(fun_name, <span class="at">env =</span> <span class="fu">caller_env</span>()) {</span>
<span id="cb622-19"><a href="#cb622-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.character</span>(fun_name) <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(fun_name) <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb622-20"><a href="#cb622-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"`fun_name` must be a string."</span>, <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb622-21"><a href="#cb622-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb622-22"><a href="#cb622-22" aria-hidden="true" tabindex="-1"></a>  fun_env <span class="ot">&lt;-</span> <span class="fu">fget2</span>(fun_name, env)</span>
<span id="cb622-23"><a href="#cb622-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb622-24"><a href="#cb622-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">where =</span> fun_env<span class="sc">$</span>env,</span>
<span id="cb622-25"><a href="#cb622-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">enclosing =</span> <span class="fu">fn_env</span>(fun_env<span class="sc">$</span>fun)</span>
<span id="cb622-26"><a href="#cb622-26" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb622-27"><a href="#cb622-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb622-28"><a href="#cb622-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb622-29"><a href="#cb622-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Test</span></span>
<span id="cb622-30"><a href="#cb622-30" aria-hidden="true" tabindex="-1"></a><span class="fu">fstr</span>(<span class="st">"mean"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; $where
#&gt; &lt;environment: base&gt;
#&gt; 
#&gt; $enclosing
#&gt; &lt;environment: namespace:base&gt;</code></pre>
</div>
</div>
<p>Once you have learned about tidy evaluation, you could rewrite <code>fstr()</code> to use <code>enquo()</code> so that you’d call it more like <code>str()</code>, i.e.&nbsp;<code>fstr(sum)</code>.</p>
<hr>
</section>
<section id="exercises-23" class="level3">
<h3 class="anchored" data-anchor-id="exercises-23">7.5.5 Exercises</h3>
<ol type="1">
<li>Write a function that lists all the variables defined in the environment in which it was called. It should return the same results as <code>ls()</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb624"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb624-1"><a href="#cb624-1" aria-hidden="true" tabindex="-1"></a>my_ls <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb624-2"><a href="#cb624-2" aria-hidden="true" tabindex="-1"></a>  vars <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">names</span>(<span class="fu">parent.frame</span>()))</span>
<span id="cb624-3"><a href="#cb624-3" aria-hidden="true" tabindex="-1"></a>  vars[<span class="sc">!</span><span class="fu">startsWith</span>(vars, <span class="st">"."</span>)]</span>
<span id="cb624-4"><a href="#cb624-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb624-5"><a href="#cb624-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb624-6"><a href="#cb624-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  [1] "a"            "all_where"    "e_str"        "e_test"       "e1"          
#&gt;  [6] "e1a"          "e1b"          "e1c"          "e2"           "e3"          
#&gt; [11] "env_poke_new" "env_poke2"    "fget"         "fget2"        "fstr"        
#&gt; [16] "mean"         "my_ls"        "rebind"       "where"        "where2"      
#&gt; [21] "x"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb626"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb626-1"><a href="#cb626-1" aria-hidden="true" tabindex="-1"></a><span class="fu">my_ls</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  [1] "a"            "all_where"    "e_str"        "e_test"       "e1"          
#&gt;  [6] "e1a"          "e1b"          "e1c"          "e2"           "e3"          
#&gt; [11] "env_poke_new" "env_poke2"    "fget"         "fget2"        "fstr"        
#&gt; [16] "mean"         "my_ls"        "rebind"       "where"        "where2"      
#&gt; [21] "x"</code></pre>
</div>
</div>
<p>Answer: code above.</p>
<p>AR Solutions: We can implement this dynamic scoping behaviour by explicitly referencing the caller environment. Please note that this approach returns also variables starting with a dot, an option that <code>ls()</code> usually requires.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb628"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb628-1"><a href="#cb628-1" aria-hidden="true" tabindex="-1"></a>ls2 <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">env =</span> <span class="fu">caller_env</span>()) {</span>
<span id="cb628-2"><a href="#cb628-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>(<span class="fu">env_names</span>(env))</span>
<span id="cb628-3"><a href="#cb628-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb628-4"><a href="#cb628-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb628-5"><a href="#cb628-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Test in global environment</span></span>
<span id="cb628-6"><a href="#cb628-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span>(<span class="at">all.names =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  [1] ".main"               ".QuartoInlineRender" ".Random.seed"       
#&gt;  [4] "a"                   "all_where"           "e_str"              
#&gt;  [7] "e_test"              "e1"                  "e1a"                
#&gt; [10] "e1b"                 "e1c"                 "e2"                 
#&gt; [13] "e3"                  "env_poke_new"        "env_poke2"          
#&gt; [16] "fget"                "fget2"               "fstr"               
#&gt; [19] "ls2"                 "mean"                "my_ls"              
#&gt; [22] "rebind"              "where"               "where2"             
#&gt; [25] "x"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb630"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb630-1"><a href="#cb630-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ls2</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  [1] ".main"               ".QuartoInlineRender" ".Random.seed"       
#&gt;  [4] "a"                   "all_where"           "e_str"              
#&gt;  [7] "e_test"              "e1"                  "e1a"                
#&gt; [10] "e1b"                 "e1c"                 "e2"                 
#&gt; [13] "e3"                  "env_poke_new"        "env_poke2"          
#&gt; [16] "fget"                "fget2"               "fstr"               
#&gt; [19] "ls2"                 "mean"                "my_ls"              
#&gt; [22] "rebind"              "where"               "where2"             
#&gt; [25] "x"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb632"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb632-1"><a href="#cb632-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test in "sandbox" environment</span></span>
<span id="cb632-2"><a href="#cb632-2" aria-hidden="true" tabindex="-1"></a>e1 <span class="ot">&lt;-</span> <span class="fu">env</span>(<span class="at">a =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">2</span>)</span>
<span id="cb632-3"><a href="#cb632-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span>(e1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "a" "b"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb634"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb634-1"><a href="#cb634-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ls2</span>(e1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "a" "b"</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="conditions" class="level2">
<h2 class="anchored" data-anchor-id="conditions">8 Conditions</h2>
<p>The <strong>condition</strong> system provides a paired set of tools that allow the author of a function to indicate that something unusual is happening, and the user of that function to deal with it. The function author <strong>signals</strong> conditions with functions like <code>stop()</code> (for errors), <code>warning()</code> (for warnings), and <code>message()</code> (for messages), then the function user can handle them with functions like <code>tryCatch()</code> and <code>withCallingHandlers()</code>. Understanding the condition system is important because you’ll often need to play both roles: signalling conditions from the functions you create, and handle conditions signalled by the functions you call.</p>
<p>R offers a very powerful condition system based on ideas from Common Lisp. Like R’s approach to object-oriented programming, it is rather different to currently popular programming languages so it is easy to misunderstand, and there has been relatively little written about how to use it effectively. Historically, this has meant that few people (myself included) have taken full advantage of its power. The goal of this chapter is to remedy that situation. Here you will learn about the big ideas of R’s condition system, as well as learning a bunch of practical tools that will make your code stronger.</p>
<p>I found two resources particularly useful when writing this chapter. You may also want to read them if you want to learn more about the inspirations and motivations for the system:</p>
<ul>
<li><p><a href="https://homepage.stat.uiowa.edu/~luke/R/exceptions/simpcond.html"><em>A prototype of a condition system for R</em></a> by Robert Gentleman and Luke Tierney. This describes an early version of R’s condition system. While the implementation has changed somewhat since this document was written, it provides a good overview of how the pieces fit together, and some motivation for its design.</p></li>
<li><p><a href="https://gigamonkeys.com/book/beyond-exception-handling-conditions-and-restarts.html"><em>Beyond exception handling: conditions and restarts</em></a> by Peter Seibel. This describes exception handling in Lisp, which happens to be very similar to R’s approach. It provides useful motivation and more sophisticated examples. I have provided an R translation of the chapter at <a href="http://adv-r.had.co.nz/beyond-exception-handling.html" class="uri">http://adv-r.had.co.nz/beyond-exception-handling.html</a>.</p></li>
</ul>
<p>I also found it helpful to work through the underlying C code that implements these ideas. If you’re interested in understanding how it all works, you might find <a href="https://gist.github.com/hadley/4278d0a6d3a10e42533d59905fbed0ac">my notes</a> to be useful.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb636"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb636-1"><a href="#cb636-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="exercises-24" class="level3">
<h3 class="anchored" data-anchor-id="exercises-24">8.2.4 Exercises</h3>
<ol type="1">
<li>Write a wrapper around <code>file.remove()</code> that throws an error if the file to be deleted does not exist.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb637"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb637-1"><a href="#cb637-1" aria-hidden="true" tabindex="-1"></a>safe_file_remove <span class="ot">&lt;-</span> <span class="cf">function</span>(...) {</span>
<span id="cb637-2"><a href="#cb637-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(...)) <span class="fu">stop</span>(<span class="st">"file '"</span>, ..., <span class="st">"' does not exist"</span>)</span>
<span id="cb637-3"><a href="#cb637-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">file.remove</span>(...)</span>
<span id="cb637-4"><a href="#cb637-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb637-5"><a href="#cb637-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb637-6"><a href="#cb637-6" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb637-7"><a href="#cb637-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb637-8"><a href="#cb637-8" aria-hidden="true" tabindex="-1"></a><span class="fu">file.create</span>(tmp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb639"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb639-1"><a href="#cb639-1" aria-hidden="true" tabindex="-1"></a><span class="fu">safe_file_remove</span>(tmp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb641"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb641-1"><a href="#cb641-1" aria-hidden="true" tabindex="-1"></a><span class="fu">file.remove</span>(tmp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; Warning in file.remove(tmp): cannot remove file
#&gt; '/var/folders/vn/cw5f9gws42v9m8mdsds_zbl00000gp/T//RtmpouGMI4/filee7dc60afc74e',
#&gt; reason 'No such file or directory'</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb644"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb644-1"><a href="#cb644-1" aria-hidden="true" tabindex="-1"></a><span class="fu">try</span>(<span class="fu">safe_file_remove</span>(tmp))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Error in safe_file_remove(tmp) : 
#&gt;   file '/var/folders/vn/cw5f9gws42v9m8mdsds_zbl00000gp/T//RtmpouGMI4/filee7dc60afc74e' does not exist</code></pre>
</div>
</div>
<p>Answer: code above.</p>
<p>AR Solutions: We prefer the following solution for its clarity and simplicity:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb646"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb646-1"><a href="#cb646-1" aria-hidden="true" tabindex="-1"></a>file_remove_strict <span class="ot">&lt;-</span> <span class="cf">function</span>(path) {</span>
<span id="cb646-2"><a href="#cb646-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(path)) {</span>
<span id="cb646-3"><a href="#cb646-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Can't delete the file </span><span class="sc">\"</span><span class="st">"</span>, path,</span>
<span id="cb646-4"><a href="#cb646-4" aria-hidden="true" tabindex="-1"></a>      <span class="st">"</span><span class="sc">\"</span><span class="st"> because it doesn't exist."</span>,</span>
<span id="cb646-5"><a href="#cb646-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">call. =</span> <span class="cn">FALSE</span></span>
<span id="cb646-6"><a href="#cb646-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb646-7"><a href="#cb646-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb646-8"><a href="#cb646-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">file.remove</span>(path)</span>
<span id="cb646-9"><a href="#cb646-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb646-10"><a href="#cb646-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb646-11"><a href="#cb646-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Test</span></span>
<span id="cb646-12"><a href="#cb646-12" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(mtcars, <span class="st">"mtcars.rds"</span>)</span>
<span id="cb646-13"><a href="#cb646-13" aria-hidden="true" tabindex="-1"></a><span class="fu">file_remove_strict</span>(<span class="st">"mtcars.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb648"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb648-1"><a href="#cb648-1" aria-hidden="true" tabindex="-1"></a><span class="fu">try</span>(<span class="fu">file_remove_strict</span>(<span class="st">"mtcars.rds"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Error : Can't delete the file "mtcars.rds" because it doesn't exist.</code></pre>
</div>
</div>
<hr>
<ol start="2" type="1">
<li>What does the <code>appendLF</code> argument to <code>message()</code> do? How is it related to <code>cat()</code>?</li>
</ol>
<p>Answer: <code>appendLF</code> controls whether or not a newline is added to the message; by default, <code>cat()</code> does not add a newline.</p>
<p>AR Solutions: The <code>appendLF</code> argument automatically appends a new line to the message.</p>
<p>Comparable behaviour regarding line breaks for <code>cat()</code> can be achieved via setting its <code>sep</code> argument to <code>"\n"</code>.</p>
<hr>
</section>
<section id="exercises-25" class="level3">
<h3 class="anchored" data-anchor-id="exercises-25">8.4.5 Exercises</h3>
<ol type="1">
<li>What extra information does the condition generated by <code>abort()</code> contain compared to the condition generated by <code>stop()</code> i.e.&nbsp;what’s the difference between these two objects? Read the help for <code>?abort</code> to learn more.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb650"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb650-1"><a href="#cb650-1" aria-hidden="true" tabindex="-1"></a><span class="fu">catch_cnd</span>(<span class="fu">stop</span>(<span class="st">"An error"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; &lt;simpleError in force(expr): An error&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb652"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb652-1"><a href="#cb652-1" aria-hidden="true" tabindex="-1"></a><span class="fu">catch_cnd</span>(<span class="fu">abort</span>(<span class="st">"An error"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; &lt;error/rlang_error&gt;
#&gt; Error:
#&gt; ! An error
#&gt; ---
#&gt; Backtrace:
#&gt; ▆</code></pre>
</div>
</div>
<p>Answer: <code>abort()</code> includes the error message and backtrace in the condition object. <code>abort()</code> uses the custom class <code>rlang_error</code>.</p>
<p>AR Solutions: In contrast to <code>stop()</code>, which contains the call, <code>abort()</code> stores the whole backtrace generated by <code>rlang::trace_back()</code>. This is a lot of extra data!</p>
<hr>
<ol start="2" type="1">
<li>Predict the results of evaluating the following code</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb654"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb654-1"><a href="#cb654-1" aria-hidden="true" tabindex="-1"></a>show_condition <span class="ot">&lt;-</span> <span class="cf">function</span>(code) {</span>
<span id="cb654-2"><a href="#cb654-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tryCatch</span>(</span>
<span id="cb654-3"><a href="#cb654-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">error =</span> <span class="cf">function</span>(cnd) <span class="st">"error"</span>,</span>
<span id="cb654-4"><a href="#cb654-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">warning =</span> <span class="cf">function</span>(cnd) <span class="st">"warning"</span>,</span>
<span id="cb654-5"><a href="#cb654-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">message =</span> <span class="cf">function</span>(cnd) <span class="st">"message"</span>,</span>
<span id="cb654-6"><a href="#cb654-6" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb654-7"><a href="#cb654-7" aria-hidden="true" tabindex="-1"></a>      code</span>
<span id="cb654-8"><a href="#cb654-8" aria-hidden="true" tabindex="-1"></a>      <span class="cn">NULL</span></span>
<span id="cb654-9"><a href="#cb654-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb654-10"><a href="#cb654-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb654-11"><a href="#cb654-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb654-12"><a href="#cb654-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb654-13"><a href="#cb654-13" aria-hidden="true" tabindex="-1"></a><span class="fu">show_condition</span>(<span class="fu">stop</span>(<span class="st">"!"</span>)) <span class="co">#&gt; "error"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "error"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb656"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb656-1"><a href="#cb656-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_condition</span>(<span class="dv">10</span>) <span class="co">#&gt; 10 [NULL]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; NULL</code></pre>
</div>
<div class="sourceCode cell-code" id="cb658"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb658-1"><a href="#cb658-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_condition</span>(<span class="fu">warning</span>(<span class="st">"?!"</span>)) <span class="co">#&gt; "warning"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "warning"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb660"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb660-1"><a href="#cb660-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_condition</span>({</span>
<span id="cb660-2"><a href="#cb660-2" aria-hidden="true" tabindex="-1"></a>  <span class="dv">10</span></span>
<span id="cb660-3"><a href="#cb660-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"?"</span>)</span>
<span id="cb660-4"><a href="#cb660-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">warning</span>(<span class="st">"?!"</span>)</span>
<span id="cb660-5"><a href="#cb660-5" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "message"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb662"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb662-1"><a href="#cb662-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10</span></span>
<span id="cb662-2"><a href="#cb662-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; "message"</span></span>
<span id="cb662-3"><a href="#cb662-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; "warning"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Answer: predictions in comments. The prediction for <code>show_condition(10)</code> was incorrect; the correct answer is <code>NULL</code> as that’s what’s returned when there is no condition. The final prediction was also incorrect; the <code>tryCatch()</code> call stops further execution when the <code>message()</code> is caught.</p>
<p>AR Solutions: The first three examples are straightforward:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb663"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb663-1"><a href="#cb663-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_condition</span>(<span class="fu">stop</span>(<span class="st">"!"</span>)) <span class="co"># stop raises an error</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "error"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb665"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb665-1"><a href="#cb665-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_condition</span>(<span class="dv">10</span>) <span class="co"># no condition is signalled</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; NULL</code></pre>
</div>
<div class="sourceCode cell-code" id="cb667"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb667-1"><a href="#cb667-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_condition</span>(<span class="fu">warning</span>(<span class="st">"?!"</span>)) <span class="co"># warning raises a warning</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "warning"</code></pre>
</div>
</div>
<p>The last example is the most interesting and makes us aware of the exiting qualities of <code>tryCatch()</code>; it will terminate the evaluation of the code as soon as it is called.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb669"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb669-1"><a href="#cb669-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_condition</span>({</span>
<span id="cb669-2"><a href="#cb669-2" aria-hidden="true" tabindex="-1"></a>  <span class="dv">10</span></span>
<span id="cb669-3"><a href="#cb669-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"?"</span>)</span>
<span id="cb669-4"><a href="#cb669-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">warning</span>(<span class="st">"?!"</span>)</span>
<span id="cb669-5"><a href="#cb669-5" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "message"</code></pre>
</div>
</div>
<hr>
<ol start="3" type="1">
<li>Explain the results of running this code:</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb671"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb671-1"><a href="#cb671-1" aria-hidden="true" tabindex="-1"></a><span class="fu">withCallingHandlers</span>(</span>
<span id="cb671-2"><a href="#cb671-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">message =</span> <span class="cf">function</span>(cnd) <span class="fu">message</span>(<span class="st">"b"</span>), <span class="co"># handler 1</span></span>
<span id="cb671-3"><a href="#cb671-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">withCallingHandlers</span>(</span>
<span id="cb671-4"><a href="#cb671-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">message =</span> <span class="cf">function</span>(cnd) <span class="fu">message</span>(<span class="st">"a"</span>), <span class="co"># handler 2</span></span>
<span id="cb671-5"><a href="#cb671-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"c"</span>)</span>
<span id="cb671-6"><a href="#cb671-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb671-7"><a href="#cb671-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; b</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; a</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; b</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; c</code></pre>
</div>
</div>
<p>Answer:</p>
<ol type="1">
<li><code>message("c")</code> is caught, handler 2 is called</li>
<li>in handler 2, <code>message("a")</code> is caught and handler 1 is called</li>
<li>handler 1 writes message <code>b</code></li>
<li>code resumes and handler 2 writes message <code>a</code></li>
<li><code>message("c")</code> propagates to the parent, is caught, and handler 1 is called</li>
<li>handler 1 writes message <code>b</code></li>
<li>code resumes and the code writes message <code>c</code></li>
</ol>
<p>AR Solutions: It’s a little tricky to untangle the flow here: First, <code>message("c")</code> is run, and it’s caught by (1). It then calls <code>message("a")</code>, which is caught by (2), which calls <code>message("b")</code>. <code>message("b")</code> isn’t caught by anything, so we see a <code>b</code> on the console, followed by <code>a</code>. But why do we get another <code>b</code> before we see <code>c</code>? That’s because we haven’t handled the message, so it bubbles up to the outer calling handler.</p>
<hr>
<ol start="4" type="1">
<li>Read the source code for <code>catch_cnd()</code> and explain how it works.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb676"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb676-1"><a href="#cb676-1" aria-hidden="true" tabindex="-1"></a>catch_cnd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; function (expr, classes = "condition") 
#&gt; {
#&gt;     stopifnot(is_character(classes))
#&gt;     handlers &lt;- rep_named(classes, list(identity))
#&gt;     eval_bare(rlang::expr(tryCatch(!!!handlers, {
#&gt;         force(expr)
#&gt;         return(NULL)
#&gt;     })))
#&gt; }
#&gt; &lt;bytecode: 0x10bd30b68&gt;
#&gt; &lt;environment: namespace:rlang&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb678"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb678-1"><a href="#cb678-1" aria-hidden="true" tabindex="-1"></a><span class="fu">catch_cnd</span>(<span class="fu">stop</span>(<span class="st">"error"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; &lt;simpleError in force(expr): error&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb680"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb680-1"><a href="#cb680-1" aria-hidden="true" tabindex="-1"></a><span class="co"># replicate the core functionality</span></span>
<span id="cb680-2"><a href="#cb680-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tryCatch</span>(<span class="at">condition =</span> <span class="cf">function</span>(x) x, <span class="fu">force</span>(<span class="fu">stop</span>(<span class="st">"error"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; &lt;simpleError in force(stop("error")): error&gt;</code></pre>
</div>
</div>
<p>Answer: <code>catch_cnd()</code> uses <code>tryCatch()</code> to catch any condition and return itself using <code>identity()</code>.</p>
<p>AR Solutions: At the time <em>Advanced R</em> was written, the source for <code>catch_cnd()</code> was a little simpler:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb682"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb682-1"><a href="#cb682-1" aria-hidden="true" tabindex="-1"></a>catch_cnd <span class="ot">&lt;-</span> <span class="cf">function</span>(expr) {</span>
<span id="cb682-2"><a href="#cb682-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tryCatch</span>(</span>
<span id="cb682-3"><a href="#cb682-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">condition =</span> <span class="cf">function</span>(cnd) cnd,</span>
<span id="cb682-4"><a href="#cb682-4" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb682-5"><a href="#cb682-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">force</span>(expr)</span>
<span id="cb682-6"><a href="#cb682-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb682-7"><a href="#cb682-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb682-8"><a href="#cb682-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb682-9"><a href="#cb682-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>catch_cnd()</code> is a simple wrapper around <code>tryCatch()</code>. If a condition is signalled, it’s caught and returned. If no condition is signalled, execution proceeds sequentially and the function returns <code>NULL</code>.</p>
<p>The current version of <code>catch_cnd()</code> is a little more complex because it allows you to specify which classes of condition you want to capture. This requires some manual code generation because the interface of <code>tryCatch()</code> provides condition classes as argument names.</p>
<hr>
<ol start="5" type="1">
<li>How could you rewrite <code>show_condition()</code> to use a single handler?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb683"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb683-1"><a href="#cb683-1" aria-hidden="true" tabindex="-1"></a>show_condition2 <span class="ot">&lt;-</span> <span class="cf">function</span>(code) {</span>
<span id="cb683-2"><a href="#cb683-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tryCatch</span>(</span>
<span id="cb683-3"><a href="#cb683-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">condition =</span> <span class="cf">function</span>(cnd) {</span>
<span id="cb683-4"><a href="#cb683-4" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">is_error</span>(cnd)) {</span>
<span id="cb683-5"><a href="#cb683-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(<span class="st">"error"</span>)</span>
<span id="cb683-6"><a href="#cb683-6" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb683-7"><a href="#cb683-7" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">is_warning</span>(cnd)) {</span>
<span id="cb683-8"><a href="#cb683-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(<span class="st">"warning"</span>)</span>
<span id="cb683-9"><a href="#cb683-9" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb683-10"><a href="#cb683-10" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">is_message</span>(cnd)) {</span>
<span id="cb683-11"><a href="#cb683-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(<span class="st">"message"</span>)</span>
<span id="cb683-12"><a href="#cb683-12" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb683-13"><a href="#cb683-13" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb683-14"><a href="#cb683-14" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb683-15"><a href="#cb683-15" aria-hidden="true" tabindex="-1"></a>      code</span>
<span id="cb683-16"><a href="#cb683-16" aria-hidden="true" tabindex="-1"></a>      <span class="cn">NULL</span></span>
<span id="cb683-17"><a href="#cb683-17" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb683-18"><a href="#cb683-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb683-19"><a href="#cb683-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb683-20"><a href="#cb683-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb683-21"><a href="#cb683-21" aria-hidden="true" tabindex="-1"></a><span class="fu">show_condition2</span>(<span class="fu">stop</span>(<span class="st">"!"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "error"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb685"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb685-1"><a href="#cb685-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_condition2</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; NULL</code></pre>
</div>
<div class="sourceCode cell-code" id="cb687"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb687-1"><a href="#cb687-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_condition2</span>(<span class="fu">warning</span>(<span class="st">"?!"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "warning"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb689"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb689-1"><a href="#cb689-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_condition2</span>({</span>
<span id="cb689-2"><a href="#cb689-2" aria-hidden="true" tabindex="-1"></a>  <span class="dv">10</span></span>
<span id="cb689-3"><a href="#cb689-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"?"</span>)</span>
<span id="cb689-4"><a href="#cb689-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">warning</span>(<span class="st">"?!"</span>)</span>
<span id="cb689-5"><a href="#cb689-5" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "message"</code></pre>
</div>
</div>
<p>Answer: code above.</p>
<p>AR Solutions: <code>show_condition()</code> was defined in one of the previous questions. Let’s use the <code>condition</code> argument of <code>tryCatch()</code> as shown in <code>rlang::catch_cond()</code> above for our re-implementation:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb691"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb691-1"><a href="#cb691-1" aria-hidden="true" tabindex="-1"></a>show_condition2 <span class="ot">&lt;-</span> <span class="cf">function</span>(code) {</span>
<span id="cb691-2"><a href="#cb691-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tryCatch</span>(</span>
<span id="cb691-3"><a href="#cb691-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">condition =</span> <span class="cf">function</span>(cnd) {</span>
<span id="cb691-4"><a href="#cb691-4" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">inherits</span>(cnd, <span class="st">"error"</span>)) {</span>
<span id="cb691-5"><a href="#cb691-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(<span class="st">"error"</span>)</span>
<span id="cb691-6"><a href="#cb691-6" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb691-7"><a href="#cb691-7" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">inherits</span>(cnd, <span class="st">"warning"</span>)) {</span>
<span id="cb691-8"><a href="#cb691-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(<span class="st">"warning"</span>)</span>
<span id="cb691-9"><a href="#cb691-9" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb691-10"><a href="#cb691-10" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">inherits</span>(cnd, <span class="st">"message"</span>)) {</span>
<span id="cb691-11"><a href="#cb691-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(<span class="st">"message"</span>)</span>
<span id="cb691-12"><a href="#cb691-12" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb691-13"><a href="#cb691-13" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb691-14"><a href="#cb691-14" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb691-15"><a href="#cb691-15" aria-hidden="true" tabindex="-1"></a>      code</span>
<span id="cb691-16"><a href="#cb691-16" aria-hidden="true" tabindex="-1"></a>      <span class="cn">NULL</span></span>
<span id="cb691-17"><a href="#cb691-17" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb691-18"><a href="#cb691-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb691-19"><a href="#cb691-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb691-20"><a href="#cb691-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb691-21"><a href="#cb691-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Test</span></span>
<span id="cb691-22"><a href="#cb691-22" aria-hidden="true" tabindex="-1"></a><span class="fu">show_condition2</span>(<span class="fu">stop</span>(<span class="st">"!"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "error"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb693"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb693-1"><a href="#cb693-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_condition2</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; NULL</code></pre>
</div>
<div class="sourceCode cell-code" id="cb695"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb695-1"><a href="#cb695-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_condition2</span>(<span class="fu">warning</span>(<span class="st">"?!"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "warning"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb697"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb697-1"><a href="#cb697-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_condition2</span>({</span>
<span id="cb697-2"><a href="#cb697-2" aria-hidden="true" tabindex="-1"></a>  <span class="dv">10</span></span>
<span id="cb697-3"><a href="#cb697-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"?"</span>)</span>
<span id="cb697-4"><a href="#cb697-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">warning</span>(<span class="st">"?!"</span>)</span>
<span id="cb697-5"><a href="#cb697-5" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "message"</code></pre>
</div>
</div>
<p><code>tryCatch()</code> executes the code and captures any condition raised. The function provided as the <code>condition</code> handles this condition. In this case it dispatches on the class of the condition.</p>
<hr>
</section>
<section id="exercises-26" class="level3">
<h3 class="anchored" data-anchor-id="exercises-26">8.5.4 Exercises</h3>
<ol type="1">
<li>Inside a package, it’s occasionally useful to check that a package is installed before using it. Write a function that checks if a package is installed (with <code>requireNamespace("pkg", quietly = FALSE))</code> and if not, throws a custom condition that includes the package name in the metadata.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb699"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb699-1"><a href="#cb699-1" aria-hidden="true" tabindex="-1"></a>my_check_installed <span class="ot">&lt;-</span> <span class="cf">function</span>(pkg) {</span>
<span id="cb699-2"><a href="#cb699-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(pkg, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb699-3"><a href="#cb699-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">abort</span>(</span>
<span id="cb699-4"><a href="#cb699-4" aria-hidden="true" tabindex="-1"></a>      <span class="st">"error_not_found"</span>,</span>
<span id="cb699-5"><a href="#cb699-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">message =</span> <span class="fu">paste0</span>(<span class="st">"package '"</span>, pkg, <span class="st">"' not found"</span>),</span>
<span id="cb699-6"><a href="#cb699-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">pkg =</span> pkg</span>
<span id="cb699-7"><a href="#cb699-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb699-8"><a href="#cb699-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb699-9"><a href="#cb699-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb699-10"><a href="#cb699-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb699-11"><a href="#cb699-11" aria-hidden="true" tabindex="-1"></a><span class="fu">my_check_installed</span>(<span class="st">"rlang"</span>)</span>
<span id="cb699-12"><a href="#cb699-12" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: this code causes renv::dependencies() to mistakenly report package 'pkg' as a dependency</span></span>
<span id="cb699-13"><a href="#cb699-13" aria-hidden="true" tabindex="-1"></a><span class="co"># requireNamespace("pkg", quietly = FALSE)</span></span>
<span id="cb699-14"><a href="#cb699-14" aria-hidden="true" tabindex="-1"></a><span class="co"># err &lt;- catch_cnd(my_check_installed("pkg"))</span></span>
<span id="cb699-15"><a href="#cb699-15" aria-hidden="true" tabindex="-1"></a><span class="co"># err</span></span>
<span id="cb699-16"><a href="#cb699-16" aria-hidden="true" tabindex="-1"></a><span class="co"># err$pkg</span></span>
<span id="cb699-17"><a href="#cb699-17" aria-hidden="true" tabindex="-1"></a><span class="fu">try</span>(<span class="fu">my_check_installed</span>(<span class="st">"pkg"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Error in my_check_installed("pkg") : package 'pkg' not found</code></pre>
</div>
</div>
<p>Answer: code above. The question specifies to use <code>quietly = FALSE</code>, but this approach makes more sense (to me). The alternative is to catch the ‘Failed with error:’ message which seems less reliable.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb701"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb701-1"><a href="#cb701-1" aria-hidden="true" tabindex="-1"></a>my_check_installed2 <span class="ot">&lt;-</span> <span class="cf">function</span>(pkg) {</span>
<span id="cb701-2"><a href="#cb701-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tryCatch</span>(</span>
<span id="cb701-3"><a href="#cb701-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">condition =</span> <span class="cf">function</span>(cnd) {</span>
<span id="cb701-4"><a href="#cb701-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">abort</span>(</span>
<span id="cb701-5"><a href="#cb701-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"error_not_found"</span>,</span>
<span id="cb701-6"><a href="#cb701-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">message =</span> <span class="fu">paste0</span>(<span class="st">"package '"</span>, pkg, <span class="st">"' not found"</span>),</span>
<span id="cb701-7"><a href="#cb701-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">pkg =</span> pkg</span>
<span id="cb701-8"><a href="#cb701-8" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb701-9"><a href="#cb701-9" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb701-10"><a href="#cb701-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">requireNamespace</span>(pkg, <span class="at">quietly =</span> <span class="cn">FALSE</span>)</span>
<span id="cb701-11"><a href="#cb701-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb701-12"><a href="#cb701-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb701-13"><a href="#cb701-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb701-14"><a href="#cb701-14" aria-hidden="true" tabindex="-1"></a><span class="fu">my_check_installed2</span>(<span class="st">"rlang"</span>)</span>
<span id="cb701-15"><a href="#cb701-15" aria-hidden="true" tabindex="-1"></a><span class="fu">try</span>(<span class="fu">my_check_installed2</span>(<span class="st">"pkg"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Error in value[[3L]](cond) : package 'pkg' not found</code></pre>
</div>
</div>
<p>The alternative version, <code>my_check_installed2()</code> works but its Backtrace is harder to read.</p>
<p>AR Solutions: We use <code>rlang::abort()</code> to supply error metadata:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb703"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb703-1"><a href="#cb703-1" aria-hidden="true" tabindex="-1"></a>check_installed <span class="ot">&lt;-</span> <span class="cf">function</span>(package) {</span>
<span id="cb703-2"><a href="#cb703-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(package, <span class="at">quietly =</span> <span class="cn">FALSE</span>)) {</span>
<span id="cb703-3"><a href="#cb703-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">abort</span>(</span>
<span id="cb703-4"><a href="#cb703-4" aria-hidden="true" tabindex="-1"></a>      <span class="st">"error_pkg_not_found"</span>,</span>
<span id="cb703-5"><a href="#cb703-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">message =</span> <span class="fu">paste0</span>(<span class="st">"package '"</span>, package, <span class="st">"' not installed."</span>),</span>
<span id="cb703-6"><a href="#cb703-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">package =</span> package</span>
<span id="cb703-7"><a href="#cb703-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb703-8"><a href="#cb703-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb703-9"><a href="#cb703-9" aria-hidden="true" tabindex="-1"></a>  <span class="cn">TRUE</span></span>
<span id="cb703-10"><a href="#cb703-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb703-11"><a href="#cb703-11" aria-hidden="true" tabindex="-1"></a><span class="fu">check_installed</span>(<span class="st">"rlang"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb705"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb705-1"><a href="#cb705-1" aria-hidden="true" tabindex="-1"></a><span class="fu">try</span>(<span class="fu">check_installed</span>(<span class="st">"ggplot3"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; Loading required namespace: ggplot3</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Error in check_installed("ggplot3") : package 'ggplot3' not installed.</code></pre>
</div>
</div>
<hr>
<ol start="2" type="1">
<li>Inside a package you often need to stop with an error when something is not right. Other packages that depend on your package might be tempted to check these errors in their unit tests. How could you help these packages to avoid relying on the error message which is part of the user interface rather than the API and might change without notice?</li>
</ol>
<p>Answer: return custom error objects that aren’t dependent on the error text (like in 8.5.3)</p>
<p>AR Solutions: Instead of returning an error it might be preferable to throw a customised condition and place a standardised error message inside the metadata. Then the downstream package could check for the class of the condition, rather than inspecting the message.</p>
<hr>
</section>
<section id="exercises-27" class="level3">
<h3 class="anchored" data-anchor-id="exercises-27">8.6.6 Exercises</h3>
<ol type="1">
<li>Create <code>suppressConditions()</code> that works like <code>suppressMessages()</code> and <code>suppressWarnings()</code> but suppresses everything. Think carefully about how you should handle errors.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb708"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb708-1"><a href="#cb708-1" aria-hidden="true" tabindex="-1"></a>suppressConditions <span class="ot">&lt;-</span> <span class="cf">function</span>(expr) {</span>
<span id="cb708-2"><a href="#cb708-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tryCatch</span>(</span>
<span id="cb708-3"><a href="#cb708-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">error =</span> <span class="cf">function</span>(cnd) <span class="fu">invisible</span>(cnd),</span>
<span id="cb708-4"><a href="#cb708-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">withCallingHandlers</span>(</span>
<span id="cb708-5"><a href="#cb708-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">condition =</span> <span class="cf">function</span>(cnd) {</span>
<span id="cb708-6"><a href="#cb708-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cnd_muffle</span>(cnd)</span>
<span id="cb708-7"><a href="#cb708-7" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb708-8"><a href="#cb708-8" aria-hidden="true" tabindex="-1"></a>      expr</span>
<span id="cb708-9"><a href="#cb708-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb708-10"><a href="#cb708-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb708-11"><a href="#cb708-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb708-12"><a href="#cb708-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb708-13"><a href="#cb708-13" aria-hidden="true" tabindex="-1"></a>sup <span class="ot">&lt;-</span> <span class="fu">suppressConditions</span>({</span>
<span id="cb708-14"><a href="#cb708-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"processing..."</span>)</span>
<span id="cb708-15"><a href="#cb708-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">warning</span>(<span class="st">"something went wrong"</span>)</span>
<span id="cb708-16"><a href="#cb708-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"still running"</span>)</span>
<span id="cb708-17"><a href="#cb708-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"error"</span>)</span>
<span id="cb708-18"><a href="#cb708-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"this shouldn't run"</span>)</span>
<span id="cb708-19"><a href="#cb708-19" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "still running"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb710"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb710-1"><a href="#cb710-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(sup)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; List of 2
#&gt;  $ message: chr "error"
#&gt;  $ call   : language withCallingHandlers(condition = function(cnd) {     cnd_muffle(cnd) ...
#&gt;  - attr(*, "class")= chr [1:3] "simpleError" "error" "condition"</code></pre>
</div>
</div>
<p>Answer: code above. Errors are not printed, but are returned, invisibly.</p>
<p>AR Solutions: In general, we would like to catch errors, since they contain important information for debugging. To suppress the error message and hide the returned error object from the console, we handle errors within a <code>tryCatch()</code> and return the error object invisibly:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb712"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb712-1"><a href="#cb712-1" aria-hidden="true" tabindex="-1"></a>suppressErrors <span class="ot">&lt;-</span> <span class="cf">function</span>(expr) {</span>
<span id="cb712-2"><a href="#cb712-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tryCatch</span>(</span>
<span id="cb712-3"><a href="#cb712-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">error =</span> <span class="cf">function</span>(cnd) <span class="fu">invisible</span>(cnd),</span>
<span id="cb712-4"><a href="#cb712-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">interrupt =</span> <span class="cf">function</span>(cnd) {</span>
<span id="cb712-5"><a href="#cb712-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="st">"Terminated by the user."</span>,</span>
<span id="cb712-6"><a href="#cb712-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">call. =</span> <span class="cn">FALSE</span></span>
<span id="cb712-7"><a href="#cb712-7" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb712-8"><a href="#cb712-8" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb712-9"><a href="#cb712-9" aria-hidden="true" tabindex="-1"></a>    expr</span>
<span id="cb712-10"><a href="#cb712-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb712-11"><a href="#cb712-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After we defined the error handling, we can just combine it with the other handlers to create <code>suppressConditions()</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb713"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb713-1"><a href="#cb713-1" aria-hidden="true" tabindex="-1"></a>suppressConditions <span class="ot">&lt;-</span> <span class="cf">function</span>(expr) {</span>
<span id="cb713-2"><a href="#cb713-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">suppressErrors</span>(<span class="fu">suppressWarnings</span>(<span class="fu">suppressMessages</span>(expr)))</span>
<span id="cb713-3"><a href="#cb713-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To test the new function, we apply it to a set of conditions and inspect the returned error object.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb714"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb714-1"><a href="#cb714-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The messages/warnings/conditions are suppressed successfully</span></span>
<span id="cb714-2"><a href="#cb714-2" aria-hidden="true" tabindex="-1"></a>error_obj <span class="ot">&lt;-</span> <span class="fu">suppressConditions</span>({</span>
<span id="cb714-3"><a href="#cb714-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"message"</span>)</span>
<span id="cb714-4"><a href="#cb714-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">warning</span>(<span class="st">"warning"</span>)</span>
<span id="cb714-5"><a href="#cb714-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abort</span>(<span class="st">"error"</span>)</span>
<span id="cb714-6"><a href="#cb714-6" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb714-7"><a href="#cb714-7" aria-hidden="true" tabindex="-1"></a>error_obj</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; &lt;error/rlang_error&gt;
#&gt; Error:
#&gt; ! error
#&gt; ---
#&gt; Backtrace:
#&gt; ▆</code></pre>
</div>
</div>
<hr>
<ol start="2" type="1">
<li>Compare the following two implementations of <code>message2error()</code>. What is the main advantage of <code>withCallingHandlers()</code> in this scenario? (Hint: look carefully at the traceback.)</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb716"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb716-1"><a href="#cb716-1" aria-hidden="true" tabindex="-1"></a>message2error <span class="ot">&lt;-</span> <span class="cf">function</span>(code) {</span>
<span id="cb716-2"><a href="#cb716-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">withCallingHandlers</span>(code, <span class="at">message =</span> <span class="cf">function</span>(e) <span class="fu">stop</span>(e))</span>
<span id="cb716-3"><a href="#cb716-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb716-4"><a href="#cb716-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb716-5"><a href="#cb716-5" aria-hidden="true" tabindex="-1"></a>message2error2 <span class="ot">&lt;-</span> <span class="cf">function</span>(code) {</span>
<span id="cb716-6"><a href="#cb716-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tryCatch</span>(code, <span class="at">message =</span> <span class="cf">function</span>(e) <span class="fu">stop</span>(e))</span>
<span id="cb716-7"><a href="#cb716-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Answer: <code>message2error()</code> shows the invocation of <code>message()</code> in the traceback, but <code>message2error2()</code> does not.</p>
<p>AR Solutions: Both functions differ in the way conditions are handled. <code>withCallingHandlers()</code> creates a <em>calling handler</em>, which is executed from within the signalling function. This makes it possible to record a detailed call stack, which helps us identify the signalling condition.</p>
<p><code>tryCatch()</code> defines an <em>exiting handler</em>, which means that the signalling function is terminated as soon as a condition is raised. It also returns control to the context where <code>tryCatch()</code> was called.</p>
<p>In this example the use of <code>withCallingHandlers()</code> returns more information than the use of <code>tryCatch()</code>. This allows us to determine the exact call that raised the condition.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb717"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb717-1"><a href="#cb717-1" aria-hidden="true" tabindex="-1"></a>message2error1 <span class="ot">&lt;-</span> <span class="cf">function</span>(code) {</span>
<span id="cb717-2"><a href="#cb717-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">withCallingHandlers</span>(code, <span class="at">message =</span> <span class="cf">function</span>(e) <span class="fu">stop</span>(<span class="st">"error"</span>))</span>
<span id="cb717-3"><a href="#cb717-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb717-4"><a href="#cb717-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb717-5"><a href="#cb717-5" aria-hidden="true" tabindex="-1"></a><span class="fu">message2error1</span>({</span>
<span id="cb717-6"><a href="#cb717-6" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span></span>
<span id="cb717-7"><a href="#cb717-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"hidden error"</span>)</span>
<span id="cb717-8"><a href="#cb717-8" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NULL</span></span>
<span id="cb717-9"><a href="#cb717-9" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb717-10"><a href="#cb717-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Error in (function (e) : error</span></span>
<span id="cb717-11"><a href="#cb717-11" aria-hidden="true" tabindex="-1"></a><span class="fu">traceback</span>()</span>
<span id="cb717-12"><a href="#cb717-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 9: stop("error") at #2</span></span>
<span id="cb717-13"><a href="#cb717-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 8: (function (e)</span></span>
<span id="cb717-14"><a href="#cb717-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    stop("error"))(list(message = "hidden error\n",</span></span>
<span id="cb717-15"><a href="#cb717-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      call = message("hidden error")))</span></span>
<span id="cb717-16"><a href="#cb717-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 7: signalCondition(cond)</span></span>
<span id="cb717-17"><a href="#cb717-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6: doWithOneRestart(return(expr), restart)</span></span>
<span id="cb717-18"><a href="#cb717-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5: withOneRestart(expr, restarts[[1L]])</span></span>
<span id="cb717-19"><a href="#cb717-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4: withRestarts({</span></span>
<span id="cb717-20"><a href="#cb717-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        signalCondition(cond)</span></span>
<span id="cb717-21"><a href="#cb717-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        defaultHandler(cond)</span></span>
<span id="cb717-22"><a href="#cb717-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    }, muffleMessage = function() NULL)</span></span>
<span id="cb717-23"><a href="#cb717-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3: message("hidden error") at #1</span></span>
<span id="cb717-24"><a href="#cb717-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2: withCallingHandlers(code,</span></span>
<span id="cb717-25"><a href="#cb717-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      message = function(e) stop("error")) at #2</span></span>
<span id="cb717-26"><a href="#cb717-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1: message2error1({</span></span>
<span id="cb717-27"><a href="#cb717-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        1</span></span>
<span id="cb717-28"><a href="#cb717-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        message("hidden error")</span></span>
<span id="cb717-29"><a href="#cb717-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        NULL</span></span>
<span id="cb717-30"><a href="#cb717-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    })</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb718"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb718-1"><a href="#cb718-1" aria-hidden="true" tabindex="-1"></a>message2error2 <span class="ot">&lt;-</span> <span class="cf">function</span>(code) {</span>
<span id="cb718-2"><a href="#cb718-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tryCatch</span>(code, <span class="at">message =</span> <span class="cf">function</span>(e) (<span class="fu">stop</span>(<span class="st">"error"</span>)))</span>
<span id="cb718-3"><a href="#cb718-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb718-4"><a href="#cb718-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb718-5"><a href="#cb718-5" aria-hidden="true" tabindex="-1"></a><span class="fu">message2error2</span>({</span>
<span id="cb718-6"><a href="#cb718-6" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span></span>
<span id="cb718-7"><a href="#cb718-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"hidden error"</span>)</span>
<span id="cb718-8"><a href="#cb718-8" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NULL</span></span>
<span id="cb718-9"><a href="#cb718-9" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb718-10"><a href="#cb718-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Error in value[[3L]](cond) : error</span></span>
<span id="cb718-11"><a href="#cb718-11" aria-hidden="true" tabindex="-1"></a><span class="fu">traceback</span>()</span>
<span id="cb718-12"><a href="#cb718-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6: stop("error") at #2</span></span>
<span id="cb718-13"><a href="#cb718-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5: value[[3L]](cond)</span></span>
<span id="cb718-14"><a href="#cb718-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4: tryCatchOne(expr, names, parentenv, handlers[[1L]])</span></span>
<span id="cb718-15"><a href="#cb718-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3: tryCatchList(expr, classes, parentenv, handlers)</span></span>
<span id="cb718-16"><a href="#cb718-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2: tryCatch(code, message = function(e) (stop("error"))) at #2</span></span>
<span id="cb718-17"><a href="#cb718-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1: message2error2({</span></span>
<span id="cb718-18"><a href="#cb718-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        1</span></span>
<span id="cb718-19"><a href="#cb718-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        message("hidden error")</span></span>
<span id="cb718-20"><a href="#cb718-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        NULL</span></span>
<span id="cb718-21"><a href="#cb718-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    })</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ol start="3" type="1">
<li>How would you modify the <code>catch_cnds()</code> definition if you wanted to recreate the original intermingling of warnings and messages?</li>
</ol>
<p>Answer: as noted in <a href="https://advanced-r-solutions.rbind.io/conditions.html#applications-1">Advanced R Solutions</a>, “It looks like Hadley wrote a part of the chapter after the exercises, as the <code>catch_cnds()</code> function defined in the chapter already solves this problem by storing all messages and warnings in their original order within a list.”</p>
<hr>
<ol start="4" type="1">
<li>Why is catching interrupts dangerous? Run this code to find out.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb719"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb719-1"><a href="#cb719-1" aria-hidden="true" tabindex="-1"></a>bottles_of_beer <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">i =</span> <span class="dv">99</span>) {</span>
<span id="cb719-2"><a href="#cb719-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(</span>
<span id="cb719-3"><a href="#cb719-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"There are "</span>, i, <span class="st">" bottles of beer on the wall, "</span>,</span>
<span id="cb719-4"><a href="#cb719-4" aria-hidden="true" tabindex="-1"></a>    i, <span class="st">" bottles of beer."</span></span>
<span id="cb719-5"><a href="#cb719-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb719-6"><a href="#cb719-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (i <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb719-7"><a href="#cb719-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tryCatch</span>(</span>
<span id="cb719-8"><a href="#cb719-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">Sys.sleep</span>(<span class="dv">1</span>),</span>
<span id="cb719-9"><a href="#cb719-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">interrupt =</span> <span class="cf">function</span>(err) {</span>
<span id="cb719-10"><a href="#cb719-10" aria-hidden="true" tabindex="-1"></a>        i <span class="ot">&lt;&lt;-</span> i <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb719-11"><a href="#cb719-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (i <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb719-12"><a href="#cb719-12" aria-hidden="true" tabindex="-1"></a>          <span class="fu">message</span>(</span>
<span id="cb719-13"><a href="#cb719-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Take one down, pass it around, "</span>, i,</span>
<span id="cb719-14"><a href="#cb719-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">" bottle"</span>, <span class="cf">if</span> (i <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="st">"s"</span>, <span class="st">" of beer on the wall."</span></span>
<span id="cb719-15"><a href="#cb719-15" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb719-16"><a href="#cb719-16" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb719-17"><a href="#cb719-17" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb719-18"><a href="#cb719-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb719-19"><a href="#cb719-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb719-20"><a href="#cb719-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(</span>
<span id="cb719-21"><a href="#cb719-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"No more bottles of beer on the wall, "</span>,</span>
<span id="cb719-22"><a href="#cb719-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"no more bottles of beer."</span></span>
<span id="cb719-23"><a href="#cb719-23" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb719-24"><a href="#cb719-24" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Answer: this prevents user interrupts (control-c) from halting the code, which in this case can be pretty annoying if run with the defaults, requiring 99 interrupts (or just “Restart R”).</p>
<p>AR Solutions: When running the <code>bottles_of_beer()</code> function in your console, the output should look somehow like the following:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb720"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb720-1"><a href="#cb720-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bottles_of_beer</span>()</span>
<span id="cb720-2"><a href="#cb720-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; There are 99 bottles of beer on the wall, 99 bottles of beer.</span></span>
<span id="cb720-3"><a href="#cb720-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Take one down, pass it around, 98 bottles of beer on the wall.</span></span>
<span id="cb720-4"><a href="#cb720-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Take one down, pass it around, 97 bottles of beer on the wall.</span></span>
<span id="cb720-5"><a href="#cb720-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Take one down, pass it around, 96 bottles of beer on the wall.</span></span>
<span id="cb720-6"><a href="#cb720-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Take one down, pass it around, 95 bottles of beer on the wall.</span></span>
<span id="cb720-7"><a href="#cb720-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>At this point you’ll probably recognise how hard it is to get the number of bottles down from <code>99</code> to <code>0</code>. There’s no way to break out of the function because we’re capturing the interrupt that you’d usually use!</p>
<hr>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/jabenninghoff\.github\.io\/rtraining\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../analysis/cond-prob.html" class="pagination-link" aria-label="Conditional Probability">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Conditional Probability</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../analysis/advanced-r-2.html" class="pagination-link" aria-label="Advanced R (Functional programming)">
        <span class="nav-page-text">Advanced R (Functional programming)</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2024, John Benninghoff</p>
</div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="../LICENSE.html">
<p>License</p>
</a>
  </li>  
</ul>
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/jabenninghoff/rtraining/blob/main/analysis/advanced-r-1.Rmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/jabenninghoff/rtraining/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jabenninghoff/rtraining">
      <i class="bi bi-github" role="img" aria-label="github">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>