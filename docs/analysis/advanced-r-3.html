<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="John Benninghoff">
<meta name="dcterms.date" content="2022-08-15">

<title>rtraining - Advanced R (Object-oriented programming)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../analysis/advanced-r-4.html" rel="next">
<link href="../analysis/advanced-r-2.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">rtraining</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../changelog.html"> 
<span class="menu-text">Changelog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../TODO.html"> 
<span class="menu-text">TODO</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools tools-wide">
    <a href="../index.xml" title="" class="quarto-navigation-tool px-1" aria-label="rss"><i class="bi bi-rss"></i></a>
    <a href="https://github.com/jabenninghoff/rtraining" title="" class="quarto-navigation-tool px-1" aria-label="github"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../analysis/advanced-r-3.html">Advanced R (Object-oriented programming)</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/r-books.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R Books</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/r-training-log.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R Training Log</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/r-setup-log.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R Setup Log</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/FaultTree.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">FaultTree.widget Test</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/using-Rcpp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using Rcpp</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/cond-prob.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Conditional Probability</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/hockey-cards.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hockey Cards Analysis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/constraints.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Constraints vs Performance</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/advanced-r-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced R (Foundations)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/advanced-r-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced R (Functional programming)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/advanced-r-3.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Advanced R (Object-oriented programming)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/advanced-r-4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced R (Metaprogramming)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/ggplot2-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ggplot2 (Getting started)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/ggplot2-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ggplot2 (Layers)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/ggplot2-3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ggplot2 (Scales)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/ggplot2-4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ggplot2 (Grammar)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/ggplot2-5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ggplot2 (Extending)</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#base-types" id="toc-base-types" class="nav-link" data-scroll-target="#base-types">12 Base types</a></li>
  <li><a href="#s3" id="toc-s3" class="nav-link" data-scroll-target="#s3">13 S3</a>
  <ul class="collapse">
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">13.2.1 Exercises</a></li>
  <li><a href="#exercises-1" id="toc-exercises-1" class="nav-link" data-scroll-target="#exercises-1">13.3.4 Exercises</a></li>
  <li><a href="#exercises-2" id="toc-exercises-2" class="nav-link" data-scroll-target="#exercises-2">13.4.4 Exercises</a></li>
  <li><a href="#exercises-3" id="toc-exercises-3" class="nav-link" data-scroll-target="#exercises-3">13.5.1 Exercises</a></li>
  <li><a href="#exercises-4" id="toc-exercises-4" class="nav-link" data-scroll-target="#exercises-4">13.6.3 Exercises</a></li>
  <li><a href="#exercises-5" id="toc-exercises-5" class="nav-link" data-scroll-target="#exercises-5">13.7.5 Exercises</a></li>
  </ul></li>
  <li><a href="#r6" id="toc-r6" class="nav-link" data-scroll-target="#r6">14 R6</a>
  <ul class="collapse">
  <li><a href="#exercises-6" id="toc-exercises-6" class="nav-link" data-scroll-target="#exercises-6">14.2.6 Exercises</a></li>
  <li><a href="#exercises-7" id="toc-exercises-7" class="nav-link" data-scroll-target="#exercises-7">14.3.3 Exercises</a></li>
  <li><a href="#exercises-8" id="toc-exercises-8" class="nav-link" data-scroll-target="#exercises-8">14.4.4 Exercises</a></li>
  </ul></li>
  <li><a href="#s4" id="toc-s4" class="nav-link" data-scroll-target="#s4">15 S4</a>
  <ul class="collapse">
  <li><a href="#exercises-9" id="toc-exercises-9" class="nav-link" data-scroll-target="#exercises-9">15.2.1 Exercises</a></li>
  <li><a href="#exercises-10" id="toc-exercises-10" class="nav-link" data-scroll-target="#exercises-10">15.3.6 Exercises</a></li>
  <li><a href="#exercises-11" id="toc-exercises-11" class="nav-link" data-scroll-target="#exercises-11">15.4.5 Exercises</a></li>
  <li><a href="#exercises-12" id="toc-exercises-12" class="nav-link" data-scroll-target="#exercises-12">15.5.5 Exercises</a></li>
  <li><a href="#exercises-13" id="toc-exercises-13" class="nav-link" data-scroll-target="#exercises-13">15.6.3 Exercises</a></li>
  </ul></li>
  <li><a href="#trade-offs" id="toc-trade-offs" class="nav-link" data-scroll-target="#trade-offs">16 Trade-offs</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/jabenninghoff/rtraining/blob/main/analysis/advanced-r-3.Rmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/jabenninghoff/rtraining/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Advanced R (Object-oriented programming)</h1>
  <div class="quarto-categories">
    <div class="quarto-category">exercises</div>
    <div class="quarto-category">advanced-r</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>John Benninghoff </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 15, 2022</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">November 11, 2023</p>
    </div>
  </div>
    
  </div>
  


</header>


<p>Workbook for completing quizzes and exercises from the “Object-oriented programming” chapters of <a href="https://adv-r.hadley.nz/index.html">Advanced R</a>, second edition, with comparisons to solutions from <a href="https://advanced-r-solutions.rbind.io">Advanced R Solutions</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sloop)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(R6)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(methods)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># from https://github.com/hadley/adv-r/blob/master/common.R</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">comment =</span> <span class="st">"#&gt;"</span>,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">fig.align =</span> <span class="st">"center"</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>knit_hooks<span class="sc">$</span><span class="fu">set</span>(</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">small_mar =</span> <span class="cf">function</span>(before, options, envir) {</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (before) {</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">4.1</span>, <span class="fl">4.1</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>))</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>This workbook includes answers and solutions to the quizzes and exercises from <a href="https://adv-r.hadley.nz/index.html">Advanced R</a> and <a href="https://advanced-r-solutions.rbind.io">Advanced R Solutions</a>, organized by chapter. It includes excerpts from both books, copied here.</p>
<p><strong>WARNING, SPOILERS!</strong> If you haven’t read Advanced R and intend to complete the quizzes and exercises, don’t read this notebook. It contains my (potentially wrong) answers to both.</p>
</section>
<section id="base-types" class="level2">
<h2 class="anchored" data-anchor-id="base-types">12 Base types</h2>
<p>To talk about objects and OOP in R we first need to clear up a fundamental confusion about two uses of the word “object”. So far in this book, we’ve used the word in the general sense captured by John Chambers’ pithy quote: “Everything that exists in R is an object”. However, while everything <em>is</em> an object, not everything is object-oriented. This confusion arises because the base objects come from S, and were developed before anyone thought that S might need an OOP system. The tools and nomenclature evolved organically over many years without a single guiding principle.</p>
<p>Most of the time, the distinction between objects and object-oriented objects is not important. But here we need to get into the nitty gritty details so we’ll use the terms <strong>base objects</strong> and <strong>OO objects</strong> to distinguish them.</p>
</section>
<section id="s3" class="level2">
<h2 class="anchored" data-anchor-id="s3">13 S3</h2>
<p>S3 is R’s first and simplest OO system. S3 is informal and ad hoc, but there is a certain elegance in its minimalism: you can’t take away any part of it and still have a useful OO system. For these reasons, you should use it, unless you have a compelling reason to do otherwise. S3 is the only OO system used in the base and stats packages, and it’s the most commonly used system in CRAN packages.</p>
<p>S3 is very flexible, which means it allows you to do things that are quite ill-advised. If you’re coming from a strict environment like Java this will seem pretty frightening, but it gives R programmers a tremendous amount of freedom. It may be very difficult to prevent people from doing something you don’t want them to do, but your users will never be held back because there is something you haven’t implemented yet. Since S3 has few built-in constraints, the key to its successful use is applying the constraints yourself. This chapter will therefore teach you the conventions you should (almost) always follow.</p>
<p>The goal of this chapter is to show you how the S3 system works, not how to use it effectively to create new classes and generics. I’d recommend coupling the theoretical knowledge from this chapter with the practical knowledge encoded in the <a href="https://vctrs.r-lib.org">vctrs package</a>.</p>
<section id="exercises" class="level3">
<h3 class="anchored" data-anchor-id="exercises">13.2.1 Exercises</h3>
<ol type="1">
<li>Describe the difference between <code>t.test()</code> and <code>t.data.frame()</code>. When is each function called?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ftype</span>(t.test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "S3"      "generic"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ftype</span>(t.data.frame)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "S3"     "method"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">s3_dispatch</span>(<span class="fu">t.test</span>(<span class="fu">formula</span>()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; =&gt; t.test.formula
#&gt;  * t.test.default</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">s3_dispatch</span>(<span class="fu">t</span>(<span class="fu">data.frame</span>()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; =&gt; t.data.frame
#&gt; -&gt; t.default</code></pre>
</div>
</div>
<p>Answer: As noted by <code>sloop::ftype()</code> and the docs, <code>t.test()</code> is a S3 generic, and <code>t.data.frame()</code> is an S3 method for <code>t()</code> (transpose). <code>t.data.frame()</code> is called as a method when calling <code>t(x)</code> when <code>x</code> is a <code>data.frame</code>. <code>t.test()</code> calls either <code>t.test.default</code> or <code>t.test.formula</code>.</p>
<p>AR Solutions: Because of S3’s <code>generic.class()</code> naming scheme, both functions may initially look similar, while they are in fact unrelated.</p>
<ul>
<li><code>t.test()</code> is a <em>generic</em> function that performs a t-test.</li>
<li><code>t.data.frame()</code> is a <em>method</em> that gets called by the generic <code>t()</code> to transpose data frame input.</li>
</ul>
<p>Due to R’s S3 dispatch rules, <code>t.test()</code> would also get called when <code>t()</code> is applied to an object of class <code>test</code></p>
<hr>
<ol start="2" type="1">
<li>Make a list of commonly used base R functions that contain <code>.</code> in their name but are not S3 methods.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ftype</span>(as.character)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "primitive" "generic"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ftype</span>(as.data.frame)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "S3"      "generic"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ftype</span>(data.frame)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "function"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ftype</span>(eval.parent)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "function"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ftype</span>(file.path)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "internal"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ftype</span>(file.copy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "internal"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ftype</span>(is.null)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "primitive"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ftype</span>(is.data.frame)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "function"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ftype</span>(Sys.localeconv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "internal"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ftype</span>(Sys.time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "internal"</code></pre>
</div>
</div>
<p>Answer:</p>
<ul>
<li>All of the <code>as.</code> functions</li>
<li><code>data.frame</code></li>
<li>All of the <code>file.</code> functions</li>
<li>All of the <code>is.</code> functions</li>
<li>All of the <code>Sys.</code> functions</li>
</ul>
<p>AR Solutions: In recent years “snake_case”-style has become increasingly common when naming functions and variables in R. But many functions in base R will continue to be “point.separated”, which is why some inconsistency in your R code most likely cannot be avoided. (<code>install.packages(), read.csv(), list.files(), download.file(), data.frame(), as.character(), Sys.Date(), all.equal(), do.call(), on.exit()</code>)</p>
<hr>
<ol start="3" type="1">
<li>What does the <code>as.data.frame.data.frame()</code> method do? Why is it confusing? How could you avoid this confusion in your own code?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">s3_dispatch</span>(<span class="fu">as.data.frame</span>(<span class="fu">data.frame</span>()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; =&gt; as.data.frame.data.frame
#&gt;  * as.data.frame.default</code></pre>
</div>
</div>
<p>Answer: <code>as.data.frame.data.frame()</code> is the method used to coerce a <code>data.frame</code> to a <code>data.frame</code>. This is confusing because the class contains a period (as does the function call); avoiding periods improves readability: <code>as_dataframe.dataframe</code> makes the generic and method clear.</p>
<p>AR Solutions: The function <code>as.data.frame.data.frame()</code> implements the <code>data.frame()</code> <em>method</em> for the <code>as.data.frame()</code> <em>generic</em>, which coerces objects to data frames.</p>
<p>The name is confusing, because it does not clearly communicate the type of the function, which could be a regular function, a generic or a method. Even if we assume a method, the amount of <code>.</code>’s makes it difficult to separate the generic- and the class-part of the name. Is it the <code>data.frame.data.frame()</code> method for the <code>as()</code> generic? Is it the <code>frame.data.frame()</code> method for the <code>as.data()</code> generic?</p>
<p>We could avoid this confusion by applying a different naming convention (e.g.&nbsp;“snake_case”) for our class and function names.</p>
<hr>
<ol start="4" type="1">
<li>Describe the difference in behaviour in these two calls.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1014</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>some_days <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2017-01-31"</span>) <span class="sc">+</span> <span class="fu">sample</span>(<span class="dv">10</span>, <span class="dv">5</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(some_days)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "2017-02-06"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">unclass</span>(some_days))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 17203.4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">s3_dispatch</span>(<span class="fu">mean</span>(some_days))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; =&gt; mean.Date
#&gt;  * mean.default</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">s3_dispatch</span>(<span class="fu">mean</span>(<span class="fu">unclass</span>(some_days)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;    mean.double
#&gt;    mean.numeric
#&gt; =&gt; mean.default</code></pre>
</div>
</div>
<p>Answer: the first call calculates the mean using <code>mean.Date()</code>, and so returns a date. using <code>unclass()</code> changes the date to its underlying value (double) which calculates the mean using <code>mean.default()</code>.</p>
<p>AR Solutions: <code>mean()</code> is a generic function, which will select the appropriate method based on the class of the input. <code>some_days</code> has the class <code>Date</code> and <code>mean.Date(some_days)</code> will be used to calculate the mean date of <code>some_days</code>.</p>
<p>After <code>unclass()</code> has removed the class attribute from <code>some_date</code>, the default method is chosen. <code>mean.default(unclass(some_days))</code> then calculates the mean of the underlying double.</p>
<hr>
<ol start="5" type="1">
<li>What class of object does the following code return? What base type is it built on? What attributes does it use?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">ecdf</span>(<span class="fu">rpois</span>(<span class="dv">100</span>, <span class="dv">10</span>))</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Empirical CDF 
#&gt; Call: ecdf(rpois(100, 10))
#&gt;  x[1:18] =      2,      3,      4,  ...,     18,     19</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; function (v)  
#&gt;  - attr(*, "class")= chr [1:3] "ecdf" "stepfun" "function"
#&gt;  - attr(*, "call")= language ecdf(rpois(100, 10))</code></pre>
</div>
</div>
<p>Answer: the code returns an object of class <code>ecdf</code>, which is build on the <code>stepfun</code> object, and the <code>function</code> base type. It additionally includes the <code>call</code> attribute.</p>
<p>AR Solutions: It returns an object of the class <code>ecdf</code> (empirical cumulative distribution function) with the superclasses <code>stepfun</code> and <code>function</code>. The <code>ecdf</code> object is built on the base type <code>closure</code> (a function). The expression, which was used to create it (<code>rpois(100, 10)</code>), is stored in the <code>call</code> attribute.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "closure"</code></pre>
</div>
</div>
<hr>
<ol start="6" type="1">
<li>What class of object does the following code return? What base type is it built on? What attributes does it use?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="fu">rpois</span>(<span class="dv">100</span>, <span class="dv">5</span>))</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt;  1  2  3  4  5  6  7  8  9 10 
#&gt;  7  5 18 14 15 15 14  4  5  3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  'table' int [1:10(1d)] 7 5 18 14 15 15 14 4 5 3
#&gt;  - attr(*, "dimnames")=List of 1
#&gt;   ..$ : chr [1:10] "1" "2" "3" "4" ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(<span class="fu">unclass</span>(x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  int [1:10(1d)] 7 5 18 14 15 15 14 4 5 3
#&gt;  - attr(*, "dimnames")=List of 1
#&gt;   ..$ : chr [1:10] "1" "2" "3" "4" ...</code></pre>
</div>
</div>
<p>Answer: per the docs, the code returns an object of class <code>table</code>, which is built on <code>array</code>, which uses the <code>dimnames</code> attribute in combination with a vector.</p>
<p>AR Solutions: This code returns a <code>table</code> object, which is built upon the <code>integer</code> type. The attribute <code>dimnames</code> is used to name the elements of the integer vector.</p>
<hr>
</section>
<section id="exercises-1" class="level3">
<h3 class="anchored" data-anchor-id="exercises-1">13.3.4 Exercises</h3>
<ol type="1">
<li>Write a constructor for <code>data.frame</code> objects. What base type is a data frame built on? What attributes does it use? What are the restrictions placed on the individual elements? What about the names?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dput</span>(<span class="fu">data.frame</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; structure(list(), names = character(0), row.names = integer(0), class = "data.frame")</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dput</span>(<span class="fu">data.frame</span>(<span class="at">a =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">b =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; structure(list(a = 1:2, b = 3:4), class = "data.frame", row.names = c(NA, 
#&gt; -2L))</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unclass</span>(<span class="fu">data.frame</span>(<span class="at">a =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">b =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; $a
#&gt; [1] 1 2
#&gt; 
#&gt; $b
#&gt; [1] 3 4
#&gt; 
#&gt; attr(,"row.names")
#&gt; [1] 1 2</code></pre>
</div>
</div>
<p>Answer: code below. The data frame is built on the list base type, and includes the names, row.names, and class attributes. This implementation requires values to be a list, names to be a character, and row.names to be an integer.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>new_data.frame <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">values =</span> <span class="fu">list</span>(),</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>                           <span class="at">names =</span> <span class="fu">character</span>(<span class="fu">length</span>(values)),</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">row.names =</span> <span class="fu">integer</span>(<span class="fu">length</span>(values))) {</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.list</span>(values),</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.character</span>(names),</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.integer</span>(row.names)</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">structure</span>(values, <span class="at">names =</span> names, <span class="at">row.names =</span> row.names, <span class="at">class =</span> <span class="st">"data.frame"</span>)</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a><span class="fu">new_data.frame</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; data frame with 0 columns and 0 rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">new_data.frame</span>(<span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>, <span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;        
#&gt; 0 1 4 7
#&gt; 0 2 5 8
#&gt; 0 3 6 9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">new_data.frame</span>(<span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>, <span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>), <span class="at">names =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>), <span class="at">row.names =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;   a b c
#&gt; 1 1 4 7
#&gt; 2 2 5 8
#&gt; 3 3 6 9</code></pre>
</div>
</div>
<p>AR Solutions: Data frames are built on named lists of vectors, which all have the same length. Besides the <code>class</code> and the column names (<code>names</code>), the <code>row.names</code> are their only further attribute. This must be a character vector with the same length as the other vectors.</p>
<p>We need to provide the number of rows as an input to make it possible to create data frames with 0 columns but multiple rows.</p>
<p>This leads to the following constructor:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>new_data.frame <span class="ot">&lt;-</span> <span class="cf">function</span>(x, n, <span class="at">row.names =</span> <span class="cn">NULL</span>) {</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if the underlying object is a list</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">is.list</span>(x))</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check all inputs are the same length</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># (This check also allows that x has length 0)</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">lengths</span>(x) <span class="sc">==</span> n))</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(row.names)) {</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use special row names helper from base R</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>    row.names <span class="ot">&lt;-</span> <span class="fu">.set_row_names</span>(n)</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Otherwise check that they're a character vector with the</span></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># correct length</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.character</span>(row.names), <span class="fu">length</span>(row.names) <span class="sc">==</span> n)</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">structure</span>(</span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>    x,</span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">class =</span> <span class="st">"data.frame"</span>,</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">row.names =</span> row.names</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Test</span></span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">a =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">2</span>)</span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a><span class="fu">new_data.frame</span>(x, <span class="at">n =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;   a b
#&gt; 1 1 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">new_data.frame</span>(x, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">row.names =</span> <span class="st">"l1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;    a b
#&gt; l1 1 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame with 0 columns and 2 rows</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">new_data.frame</span>(<span class="fu">list</span>(), <span class="at">n =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; data frame with 0 columns and 2 rows</code></pre>
</div>
</div>
<p>Note: AR Solutions approach also validates that all inputs are same length, and supports creation of dataframes with 0 columns but multiple rows.</p>
<hr>
<ol start="2" type="1">
<li>Enhance my <code>factor()</code> helper to have better behaviour when one or more <code>values</code> is not found in <code>levels</code>. What does <code>base::factor()</code> do in this situation?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>new_factor <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">x =</span> <span class="fu">integer</span>(), <span class="at">levels =</span> <span class="fu">character</span>()) {</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.integer</span>(x),</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.character</span>(levels)</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">structure</span>(</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>    x,</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> levels,</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">class =</span> <span class="st">"factor"</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Answer: the fix is to update <code>validate_factor()</code> to allow <code>NA</code> values, since the helper already fills in <code>NA</code> when <code>values</code> is not found in <code>levels</code>. This matches the behavior of <code>base::factor()</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>validate_factor <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  values <span class="ot">&lt;-</span> <span class="fu">unclass</span>(x)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  levels <span class="ot">&lt;-</span> <span class="fu">attr</span>(x, <span class="st">"levels"</span>)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(<span class="fu">is.na</span>(values) <span class="sc">|</span> values <span class="sc">&gt;</span> <span class="dv">0</span>)) {</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">"All non-missing `x` values must be greater than zero"</span>,</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">call. =</span> <span class="cn">FALSE</span></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(levels) <span class="sc">&lt;</span> <span class="fu">max</span>(values, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(</span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>      <span class="st">"There must be at least as many `levels` as possible values in `x`"</span>,</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">call. =</span> <span class="cn">FALSE</span></span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a>  x</span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a>my_factor <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">x =</span> <span class="fu">character</span>(), <span class="at">levels =</span> <span class="fu">unique</span>(x)) {</span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true" tabindex="-1"></a>  ind <span class="ot">&lt;-</span> <span class="fu">match</span>(x, levels)</span>
<span id="cb71-24"><a href="#cb71-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">validate_factor</span>(<span class="fu">new_factor</span>(ind, levels))</span>
<span id="cb71-25"><a href="#cb71-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb71-26"><a href="#cb71-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-27"><a href="#cb71-27" aria-hidden="true" tabindex="-1"></a><span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>), <span class="at">levels =</span> <span class="st">"a"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] a    a    &lt;NA&gt;
#&gt; Levels: a</code></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">my_factor</span>(<span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>), <span class="at">levels =</span> <span class="st">"a"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] a    a    &lt;NA&gt;
#&gt; Levels: a</code></pre>
</div>
</div>
<p>AR Solutions: <code>base::factor()</code> converts these values (silently) into <code>NA</code>s.</p>
<p>The <code>factor()</code> helper including the constructor (<code>new_factor()</code>) and its validator (<code>validate_factor()</code>) were given in <em>Advanced R</em>. However, as the goal of this question is to throw an early error within the helper, we only repeat the code for the helper:</p>
<p>To improve the <code>factor()</code> helper we choose to return an informative error message instead.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>factor2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">levels =</span> <span class="fu">unique</span>(x)) {</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  new_levels <span class="ot">&lt;-</span> <span class="fu">match</span>(x, levels)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Error if levels don't include all values</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  missing <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">setdiff</span>(x, levels))</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(missing) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">"The following values do not occur in the levels of x: "</span>,</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"'"</span>, missing, <span class="st">"'"</span>, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"."</span>,</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">call. =</span> <span class="cn">FALSE</span></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">validate_factor</span>(<span class="fu">new_factor</span>(new_levels, levels))</span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Test</span></span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a><span class="fu">try</span>(<span class="fu">factor2</span>(<span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>), <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Error : The following values do not occur in the levels of x: 'c'.</code></pre>
</div>
</div>
<hr>
<ol start="3" type="1">
<li>Carefully read the source code of <code>factor()</code>. What does it do that my constructor does not?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"alpha"</span>, <span class="st">"beta"</span>, <span class="st">"beta"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] alpha alpha beta  beta 
#&gt; Levels: alpha beta</code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(<span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">ordered =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "ordered" "factor"</code></pre>
</div>
</div>
<p>Answer: the base implementation:</p>
<ul>
<li>sets the value to <code>character(0)</code> if the value is null</li>
<li>retains value names</li>
<li>allows an upper bound on the number of levels, <code>nmax</code></li>
<li>coerces the value to character</li>
<li>provides a method for excluding values from levels, <code>exclude</code></li>
<li>provides <code>labels</code> for remapping factors</li>
<li>adds an “ordered” class if the value is ordered (<code>ordered = TRUE</code>)</li>
</ul>
<p>Note: labels are an interesting and unexpected feature of <code>factor()</code></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>factor</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; function (x = character(), levels, labels = levels, exclude = NA, 
#&gt;     ordered = is.ordered(x), nmax = NA) 
#&gt; {
#&gt;     if (is.null(x)) 
#&gt;         x &lt;- character()
#&gt;     nx &lt;- names(x)
#&gt;     if (missing(levels)) {
#&gt;         y &lt;- unique(x, nmax = nmax)
#&gt;         ind &lt;- order(y)
#&gt;         levels &lt;- unique(as.character(y)[ind])
#&gt;     }
#&gt;     force(ordered)
#&gt;     if (!is.character(x)) 
#&gt;         x &lt;- as.character(x)
#&gt;     levels &lt;- levels[is.na(match(levels, exclude))]
#&gt;     f &lt;- match(x, levels)
#&gt;     if (!is.null(nx)) 
#&gt;         names(f) &lt;- nx
#&gt;     if (missing(labels)) {
#&gt;         levels(f) &lt;- as.character(levels)
#&gt;     }
#&gt;     else {
#&gt;         nlab &lt;- length(labels)
#&gt;         if (nlab == length(levels)) {
#&gt;             nlevs &lt;- unique(xlevs &lt;- as.character(labels))
#&gt;             at &lt;- attributes(f)
#&gt;             at$levels &lt;- nlevs
#&gt;             f &lt;- match(xlevs, nlevs)[f]
#&gt;             attributes(f) &lt;- at
#&gt;         }
#&gt;         else if (nlab == 1L) 
#&gt;             levels(f) &lt;- paste0(labels, seq_along(levels))
#&gt;         else stop(gettextf("invalid 'labels'; length %d should be 1 or %d", 
#&gt;             nlab, length(levels)), domain = NA)
#&gt;     }
#&gt;     class(f) &lt;- c(if (ordered) "ordered", "factor")
#&gt;     f
#&gt; }
#&gt; &lt;bytecode: 0x158901678&gt;
#&gt; &lt;environment: namespace:base&gt;</code></pre>
</div>
</div>
<p>AR Solutions: The original implementation (<code>base::factor()</code>) allows more flexible input for <code>x</code>. It coerces <code>x</code> to character or replaces it with <code>character(0)</code> (in case of <code>NULL</code>). It also ensures that the <code>levels</code> are unique. This is achieved by setting them via <code>base::levels&lt;-</code>, which fails when duplicate values are supplied.</p>
<p>Note: I missed the fact that <code>base::levels&lt;-</code> fails when duplicate values are supplied.</p>
<hr>
<ol start="4" type="1">
<li>Factors have an optional “contrasts” attribute. Read the help for <code>C()</code>, and briefly describe the purpose of the attribute. What type should it have? Rewrite the <code>new_factor()</code> constructor to include this attribute.</li>
</ol>
<p>Answer: per the “contrast {stats}” documentation, contrast matrices are used in fitting analysis of variance and regression models, so the attribute should be a matrix.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>new_factor <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">x =</span> <span class="fu">integer</span>(), <span class="at">levels =</span> <span class="fu">character</span>(), <span class="at">contr =</span> <span class="fu">matrix</span>()) {</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(x), <span class="fu">is.character</span>(levels), <span class="fu">is.matrix</span>(contr))</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">structure</span>(</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>    x,</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> levels,</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">class =</span> <span class="st">"factor"</span>,</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">contrasts =</span> contr</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>AR Solutions: When factor variables (representing nominal or ordinal information) are used in statistical models, they are typically encoded as dummy variables and by default each level is compared with the first factor level. However, many different encodings (“contrasts”) are possible, see <a href="https://en.wikipedia.org/wiki/Contrast_(statistics)">Contrast</a>.</p>
<p>Within R’s formula interface you can wrap a factor in <code>stats::C()</code> and specify the contrast of your choice. Alternatively, you can set the <code>contrasts</code> attribute of your factor variable, which accepts matrix input. (See <code>?contr.helmert</code> or similar for details.)</p>
<p>Our updated <code>new_factor()</code> constructor gets a <code>contrasts</code> argument, which accepts a numeric matrix or <code>NULL</code> (default).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Updated new_factor() constructor</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>new_factor <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">x =</span> <span class="fu">integer</span>(),</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">levels =</span> <span class="fu">character</span>(),</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">contrasts =</span> <span class="cn">NULL</span>) {</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(x))</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">is.character</span>(levels))</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(constrasts)) {</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.matrix</span>(contrasts) <span class="sc">&amp;&amp;</span> <span class="fu">is.numeric</span>(contrasts)) <span class="co"># nolint: conjunct_test_linter.</span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">structure</span>(</span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>    x,</span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> levels,</span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">class =</span> <span class="st">"factor"</span>,</span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">contrasts =</span> contrasts</span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ol start="5" type="1">
<li>Read the documentation for <code>utils::as.roman()</code>. How would you write a constructor for this class? Does it need a validator? What might a helper do?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dput</span>(<span class="fu">as.roman</span>(<span class="dv">3899</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; structure(3899L, class = "roman")</code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>new_roman <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">x =</span> <span class="fu">integer</span>()) {</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(x))</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">structure</span>(</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>    x,</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">class =</span> <span class="st">"roman"</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a><span class="fu">new_roman</span>(<span class="dv">2022</span>L)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] MMXXII</code></pre>
</div>
</div>
<p>Answer: the structure of the class “roman” is simple, an integer with a defined class. A simple constructor would take an integer and return an object of class “roman” as above. A validator is probably not needed, but could validate that the integer is within the supported range of integers (1-3899). A helper might coerce the number to be an integer using <code>as.integer()</code>.</p>
<p>AR Solutions: This function transforms numeric input into Roman numbers. It is built on the integer type, which results in the following constructor.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>new_roman <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">x =</span> <span class="fu">integer</span>()) {</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(x))</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">structure</span>(x, <span class="at">class =</span> <span class="st">"roman"</span>)</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The documentation tells us, that only values between 1 and 3899 are uniquely represented, which we then include in our validation function.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>validate_roman <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  values <span class="ot">&lt;-</span> <span class="fu">unclass</span>(x)</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(values <span class="sc">&lt;</span> <span class="dv">1</span> <span class="sc">|</span> values <span class="sc">&gt;</span> <span class="dv">3899</span>)) {</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Roman numbers must fall between 1 and 3899."</span>,</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">call. =</span> <span class="cn">FALSE</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>  x</span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For convenience, we allow the user to also pass real values to a helper function.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>roman <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">x =</span> <span class="fu">integer</span>()) {</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(x)</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">validate_roman</span>(<span class="fu">new_roman</span>(x))</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Test</span></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a><span class="fu">roman</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">753</span>, <span class="dv">2019</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] I       DCCLIII MMXIX</code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">try</span>(<span class="fu">roman</span>(<span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Error : Roman numbers must fall between 1 and 3899.</code></pre>
</div>
</div>
<hr>
</section>
<section id="exercises-2" class="level3">
<h3 class="anchored" data-anchor-id="exercises-2">13.4.4 Exercises</h3>
<ol type="1">
<li>Read the source code for <code>t()</code> and <code>t.test()</code> and confirm that <code>t.test()</code> is an S3 generic and not an S3 method. What happens if you create an object with class <code>test</code> and call <code>t()</code> with it? Why?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">structure</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">class =</span> <span class="st">"test"</span>)</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="fu">t</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]
#&gt; [1,]    1    2    3    4    5    6    7    8    9    10
#&gt; attr(,"class")
#&gt; [1] "test"</code></pre>
</div>
</div>
<p>Answer: both <code>t()</code> and <code>t.test()</code> simply call <code>UseMethod()</code>, and are S3 generics.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>t</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; function (x) 
#&gt; UseMethod("t")
#&gt; &lt;bytecode: 0x10fd37468&gt;
#&gt; &lt;environment: namespace:base&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>t.test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; function (x, ...) 
#&gt; UseMethod("t.test")
#&gt; &lt;bytecode: 0x1588fa8a0&gt;
#&gt; &lt;environment: namespace:stats&gt;</code></pre>
</div>
</div>
<p>Creating an object with class <code>test</code> and calling <code>t()</code> uses the default method since <code>t.test()</code> is not a registered method for <code>t()</code>, as this code shows:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">methods</span>(<span class="st">"t"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] t.data.frame  t.default     t.ts*         t.vctrs_sclr* t.vctrs_vctr*
#&gt; see '?methods' for accessing help and source code</code></pre>
</div>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">s3_dispatch</span>(<span class="fu">t</span>(x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;    t.test
#&gt; =&gt; t.default</code></pre>
</div>
</div>
<p>AR Solutions: We can see that <code>t.test()</code> is a generic because it calls <code>UseMethod()</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co"># or simply call</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ftype</span>(t.test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "S3"      "generic"</code></pre>
</div>
</div>
<p>Interestingly, R also provides helpers, which list functions that look like methods, but in fact are not:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>tools<span class="sc">::</span><span class="fu">nonS3methods</span>(<span class="st">"stats"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "anova.lmlist"        "expand.model.frame"  "fitted.values"      
#&gt; [4] "influence.measures"  "lag.plot"            "t.test"             
#&gt; [7] "plot.spec.phase"     "plot.spec.coherency"</code></pre>
</div>
</div>
<p>When we create an object with class <code>test</code>, <code>t()</code> dispatches to the <code>t.default()</code> method. This happens, because <code>UseMethod()</code> simply searches for functions named <code>paste0("generic", ".", c(class(x), "default"))</code>.</p>
<p>However, in older versions of R (pre R 4.0.0; when <em>Advanced R</em> was written) this behaviour was slightly different. Instead of dispatching to the <code>t.default()</code> method, the <code>t.test()</code> generic was erroneously treated as a method of <code>t()</code> which then dispatched to <code>t.test.default()</code> or (when defined) to <code>t.test.test()</code>.</p>
<hr>
<ol start="2" type="1">
<li>What generics does the <code>table</code> class have methods for?</li>
</ol>
<p>Answer: <code>s3_methods_class()</code> answers this question:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">s3_methods_class</span>(<span class="st">"table"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 11 × 4
#&gt;    generic       class visible source             
#&gt;    &lt;chr&gt;         &lt;chr&gt; &lt;lgl&gt;   &lt;chr&gt;              
#&gt;  1 [             table TRUE    base               
#&gt;  2 aperm         table TRUE    base               
#&gt;  3 as_tibble     table FALSE   registered S3method
#&gt;  4 as.data.frame table TRUE    base               
#&gt;  5 Axis          table FALSE   registered S3method
#&gt;  6 lines         table FALSE   registered S3method
#&gt;  7 plot          table FALSE   registered S3method
#&gt;  8 points        table FALSE   registered S3method
#&gt;  9 print         table TRUE    base               
#&gt; 10 summary       table TRUE    base               
#&gt; 11 tail          table FALSE   registered S3method</code></pre>
</div>
</div>
<p>AR Solutions: This is a simple application of <code>sloop::s3_methods_class()</code>.</p>
<p>Interestingly, the <code>table</code> class has a number of methods designed to help plotting with base graphics.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rpois</span>(<span class="dv">100</span>, <span class="dv">5</span>)</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">table</span>(x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="advanced-r-3_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="816"></p>
</figure>
</div>
</div>
</div>
<hr>
<ol start="3" type="1">
<li>What generics does the <code>ecdf</code> class have methods for?</li>
</ol>
<p>Answer:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">s3_methods_class</span>(<span class="st">"ecdf"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 4 × 4
#&gt;   generic  class visible source             
#&gt;   &lt;chr&gt;    &lt;chr&gt; &lt;lgl&gt;   &lt;chr&gt;              
#&gt; 1 plot     ecdf  TRUE    stats              
#&gt; 2 print    ecdf  FALSE   registered S3method
#&gt; 3 quantile ecdf  FALSE   registered S3method
#&gt; 4 summary  ecdf  FALSE   registered S3method</code></pre>
</div>
</div>
<p>AR Solutions: We use the same approach as above.</p>
<p>The methods are primarily designed for display (<code>plot()</code>, <code>print()</code>, <code>summary()</code>), but you can also extract quantiles with <code>quantile()</code>.</p>
<hr>
<ol start="4" type="1">
<li>Which base generic has the greatest number of defined methods?</li>
</ol>
<p>Answer: using code from 6.2.5, identify generics and count defined methods:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co"># from 6.2.5 exercises, this code makes a list of all functions in the base package</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>funs <span class="ot">&lt;-</span> <span class="fu">Filter</span>(is.function, <span class="fu">mget</span>(<span class="fu">ls</span>(<span class="st">"package:base"</span>, <span class="at">all.names =</span> <span class="cn">TRUE</span>), <span class="at">inherits =</span> <span class="cn">TRUE</span>))</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>get_method_count <span class="ot">&lt;-</span> <span class="cf">function</span>(fname) {</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> fname,</span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this code should work but doesn't:</span></span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># method_count = nrow(s3_methods_generic(fname))</span></span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">method_count =</span> <span class="fu">length</span>(<span class="fu">methods</span>(fname))</span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb114-11"><a href="#cb114-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb114-12"><a href="#cb114-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-13"><a href="#cb114-13" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dfr</span>(<span class="fu">names</span>(funs), get_method_count) <span class="sc">|&gt;</span></span>
<span id="cb114-14"><a href="#cb114-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(method_count))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;                                    name method_count
#&gt; 1                                 print          277
#&gt; 2                                format          126
#&gt; 3                                     [           49
#&gt; 4                               summary           39
#&gt; 5                          as.character           32
#&gt; 6                         as.data.frame           32
#&gt; 7                                  plot           31
#&gt; 8                                    [[           22
#&gt; 9                                   [&lt;-           18
#&gt; 10                                  $&lt;-           18
#&gt; 11                                    $           17
#&gt; 12                                 file           17
#&gt; 13                                 [[&lt;-           15
#&gt; 14                              as.list           15
#&gt; 15                                    c           15
#&gt; 16                            all.equal           12
#&gt; 17                                xtfrm           11
#&gt; 18                                  rep           10
#&gt; 19                               unique           10
#&gt; 20                           duplicated            9
#&gt; 21                              as.Date            8
#&gt; 22                            as.matrix            8
#&gt; 23                           as.POSIXlt            7
#&gt; 24                             length&lt;-            7
#&gt; 25                                 mean            7
#&gt; 26                              names&lt;-            7
#&gt; 27                                  row            7
#&gt; 28                        anyDuplicated            6
#&gt; 29                           as.POSIXct            6
#&gt; 30                                 diff            6
#&gt; 31                               length            6
#&gt; 32                                write            6
#&gt; 33                                anyNA            5
#&gt; 34                     conditionMessage            5
#&gt; 35                                is.na            5
#&gt; 36                              is.na&lt;-            5
#&gt; 37                               labels            5
#&gt; 38                                names            5
#&gt; 39                                    t            5
#&gt; 40                                    -            4
#&gt; 41                                    +            4
#&gt; 42                            as.double            4
#&gt; 43                            as.vector            4
#&gt; 44                                close            4
#&gt; 45                                  cut            4
#&gt; 46                                 open            4
#&gt; 47                                range            4
#&gt; 48                                split            4
#&gt; 49                               subset            4
#&gt; 50                                    !            3
#&gt; 51                                    &amp;            3
#&gt; 52                                    |            3
#&gt; 53                           as.logical            3
#&gt; 54                                cbind            3
#&gt; 55                           dimnames&lt;-            3
#&gt; 56                           is.numeric            3
#&gt; 57                                kappa            3
#&gt; 58                               levels            3
#&gt; 59                             levels&lt;-            3
#&gt; 60                                   ls            3
#&gt; 61                                match            3
#&gt; 62                                merge            3
#&gt; 63                                mtfrm            3
#&gt; 64                               pretty            3
#&gt; 65                          row.names&lt;-            3
#&gt; 66                                  seq            3
#&gt; 67                                 sort            3
#&gt; 68                            transform            3
#&gt; 69                                    *            2
#&gt; 70                                    /            2
#&gt; 71                                aperm            2
#&gt; 72                           as.integer            2
#&gt; 73                             as.table            2
#&gt; 74                               body&lt;-            2
#&gt; 75                                   by            2
#&gt; 76                                dim&lt;-            2
#&gt; 77                             dimnames            2
#&gt; 78                                  dir            2
#&gt; 79                                 drop            2
#&gt; 80                           droplevels            2
#&gt; 81             getDLLRegisteredRoutines            2
#&gt; 82                            intersect            2
#&gt; 83                            is.finite            2
#&gt; 84                          is.infinite            2
#&gt; 85                               is.nan            2
#&gt; 86                               julian            2
#&gt; 87                              library            2
#&gt; 88                                 list            2
#&gt; 89                                  max            2
#&gt; 90                                  min            2
#&gt; 91                               months            2
#&gt; 92                                   qr            2
#&gt; 93                             quarters            2
#&gt; 94                                rbind            2
#&gt; 95                                  rev            2
#&gt; 96                                round            2
#&gt; 97                            row.names            2
#&gt; 98                               rowsum            2
#&gt; 99                              setdiff            2
#&gt; 100                            setequal            2
#&gt; 101                               solve            2
#&gt; 102                             sort_by            2
#&gt; 103                             split&lt;-            2
#&gt; 104                              system            2
#&gt; 105                               trunc            2
#&gt; 106                               union            2
#&gt; 107                              unlist            2
#&gt; 108                            weekdays            2
#&gt; 109                               which            2
#&gt; 110                              within            2
#&gt; 111                                  !=            1
#&gt; 112                                 %/%            1
#&gt; 113                                  %%            1
#&gt; 114                                   ^            1
#&gt; 115                                   &lt;            1
#&gt; 116                                  &lt;=            1
#&gt; 117                                  ==            1
#&gt; 118                                   &gt;            1
#&gt; 119                                  &gt;=            1
#&gt; 120                            as.array            1
#&gt; 121                      as.environment            1
#&gt; 122                       as.expression            1
#&gt; 123                         as.function            1
#&gt; 124                             as.null            1
#&gt; 125                           as.single            1
#&gt; 126                                attr            1
#&gt; 127                                chol            1
#&gt; 128                     chooseOpsMethod            1
#&gt; 129                       conditionCall            1
#&gt; 130                         determinant            1
#&gt; 131                                 dim            1
#&gt; 132                                dump            1
#&gt; 133                                eval            1
#&gt; 134                              factor            1
#&gt; 135                               flush            1
#&gt; 136                                  gc            1
#&gt; 137                         interaction            1
#&gt; 138                         isSymmetric            1
#&gt; 139                           kronecker            1
#&gt; 140                             lengths            1
#&gt; 141                       library.dynam            1
#&gt; 142                         nameOfClass            1
#&gt; 143                               order            1
#&gt; 144                                pmax            1
#&gt; 145                                pmin            1
#&gt; 146                              remove            1
#&gt; 147                              sample            1
#&gt; 148                                save            1
#&gt; 149                               scale            1
#&gt; 150                                seek            1
#&gt; 151                            sequence            1
#&gt; 152                                sink            1
#&gt; 153                                 sum            1
#&gt; 154                            toString            1
#&gt; 155                            truncate            1
#&gt; 156                               units            1
#&gt; 157                             units&lt;-            1
#&gt; 158                                 url            1
#&gt; 159                                with            1
#&gt; 160                              -.Date            0
#&gt; 161                            -.POSIXt            0
#&gt; 162                                   :            0
#&gt; 163                                  ::            0
#&gt; 164                                 :::            0
#&gt; 165                           !.hexmode            0
#&gt; 166                           !.octmode            0
#&gt; 167                        .__H__.cbind            0
#&gt; 168                        .__H__.rbind            0
#&gt; 169                              ...elt            0
#&gt; 170                           ...length            0
#&gt; 171                            ...names            0
#&gt; 172                      ..getNamespace            0
#&gt; 173                      .amatch_bounds            0
#&gt; 174                       .amatch_costs            0
#&gt; 175                            .bincode            0
#&gt; 176                                  .C            0
#&gt; 177                        .cache_class            0
#&gt; 178                               .Call            0
#&gt; 179                      .Call.graphics            0
#&gt; 180                       .check_tzones            0
#&gt; 181                             .class2            0
#&gt; 182                                .col            0
#&gt; 183                           .colMeans            0
#&gt; 184                            .colSums            0
#&gt; 185                               .Date            0
#&gt; 186             .decode_numeric_version            0
#&gt; 187                            .Defunct            0
#&gt; 188                        .deparseOpts            0
#&gt; 189                         .Deprecated            0
#&gt; 190                             .detach            0
#&gt; 191                           .difftime            0
#&gt; 192                         .doSortWrap            0
#&gt; 193                            .doTrace            0
#&gt; 194                             .doWrap            0
#&gt; 195                            .dynLibs            0
#&gt; 196             .encode_numeric_version            0
#&gt; 197              .expand_R_libs_env_var            0
#&gt; 198                           .External            0
#&gt; 199                  .External.graphics            0
#&gt; 200                          .External2            0
#&gt; 201                          .First.sys            0
#&gt; 202                       .format.zeros            0
#&gt; 203                    .formula2varlist            0
#&gt; 204                            .Fortran            0
#&gt; 205                       .getNamespace            0
#&gt; 206                   .getNamespaceInfo            0
#&gt; 207                .getRequiredPackages            0
#&gt; 208               .getRequiredPackages2            0
#&gt; 209                                 .gt            0
#&gt; 210                                .gtn            0
#&gt; 211                  .handleSimpleError            0
#&gt; 212                           .Internal            0
#&gt; 213                .isMethodsDispatchOn            0
#&gt; 214                             .isOpen            0
#&gt; 215                          .kappa_tri            0
#&gt; 216                          .kronecker            0
#&gt; 217                           .libPaths            0
#&gt; 218               .make_numeric_version            0
#&gt; 219                        .makeMessage            0
#&gt; 220                             .mapply            0
#&gt; 221                          .maskedMsg            0
#&gt; 222                 .mergeExportMethods            0
#&gt; 223                 .mergeImportMethods            0
#&gt; 224                  .NotYetImplemented            0
#&gt; 225                         .NotYetUsed            0
#&gt; 226                  .OptRequireMethods            0
#&gt; 227                           .packages            0
#&gt; 228              .packageStartupMessage            0
#&gt; 229                            .POSIXct            0
#&gt; 230                            .POSIXlt            0
#&gt; 231                             .pretty            0
#&gt; 232                          .Primitive            0
#&gt; 233                          .primTrace            0
#&gt; 234                        .primUntrace            0
#&gt; 235                           .rangeNum            0
#&gt; 236                              .rmpkg            0
#&gt; 237                                .row            0
#&gt; 238                     .row_names_info            0
#&gt; 239                           .rowMeans            0
#&gt; 240                       .rowNamesDF&lt;-            0
#&gt; 241                            .rowSums            0
#&gt; 242                           .S3method            0
#&gt; 243                             .Script            0
#&gt; 244                      .set_row_names            0
#&gt; 245                .signalSimpleWarning            0
#&gt; 246                   .standard_regexps            0
#&gt; 247                             .subset            0
#&gt; 248                            .subset2            0
#&gt; 249                      .TAOCP1997init            0
#&gt; 250                          .traceback            0
#&gt; 251                 .tryResumeInterrupt            0
#&gt; 252                       .valid.factor            0
#&gt; 253                                   (            0
#&gt; 254                              [.AsIs            0
#&gt; 255                        [.data.frame            0
#&gt; 256                              [.Date            0
#&gt; 257                          [.difftime            0
#&gt; 258                             [.Dlist            0
#&gt; 259                       [.DLLInfoList            0
#&gt; 260                            [.factor            0
#&gt; 261                           [.hexmode            0
#&gt; 262                            [.listof            0
#&gt; 263                           [.noquote            0
#&gt; 264                   [.numeric_version            0
#&gt; 265                           [.octmode            0
#&gt; 266                           [.POSIXct            0
#&gt; 267                           [.POSIXlt            0
#&gt; 268                       [.simple.list            0
#&gt; 269                             [.table            0
#&gt; 270                          [.warnings            0
#&gt; 271                       [[.data.frame            0
#&gt; 272                             [[.Date            0
#&gt; 273                           [[.factor            0
#&gt; 274                  [[.numeric_version            0
#&gt; 275                          [[.POSIXct            0
#&gt; 276                          [[.POSIXlt            0
#&gt; 277                     [[&lt;-.data.frame            0
#&gt; 278                         [[&lt;-.factor            0
#&gt; 279                [[&lt;-.numeric_version            0
#&gt; 280                        [[&lt;-.POSIXlt            0
#&gt; 281                      [&lt;-.data.frame            0
#&gt; 282                            [&lt;-.Date            0
#&gt; 283                        [&lt;-.difftime            0
#&gt; 284                          [&lt;-.factor            0
#&gt; 285                 [&lt;-.numeric_version            0
#&gt; 286                         [&lt;-.POSIXct            0
#&gt; 287                         [&lt;-.POSIXlt            0
#&gt; 288                                   {            0
#&gt; 289                                   @            0
#&gt; 290                                 @&lt;-            0
#&gt; 291                          *.difftime            0
#&gt; 292                          /.difftime            0
#&gt; 293                           &amp;.hexmode            0
#&gt; 294                           &amp;.octmode            0
#&gt; 295                                  &amp;&amp;            0
#&gt; 296                                 %*%            0
#&gt; 297                                %||%            0
#&gt; 298                                %in%            0
#&gt; 299                                 %o%            0
#&gt; 300                                 %x%            0
#&gt; 301                              +.Date            0
#&gt; 302                            +.POSIXt            0
#&gt; 303                                  &lt;-            0
#&gt; 304                                 &lt;&lt;-            0
#&gt; 305                                   =            0
#&gt; 306                           |.hexmode            0
#&gt; 307                           |.octmode            0
#&gt; 308                                  ||            0
#&gt; 309                                   ~            0
#&gt; 310                           $.DLLInfo            0
#&gt; 311                   $.package_version            0
#&gt; 312                      $&lt;-.data.frame            0
#&gt; 313                         $&lt;-.POSIXlt            0
#&gt; 314                          abbreviate            0
#&gt; 315                                 abs            0
#&gt; 316                                acos            0
#&gt; 317                               acosh            0
#&gt; 318               activeBindingFunction            0
#&gt; 319                               addNA            0
#&gt; 320                     addTaskCallback            0
#&gt; 321                               agrep            0
#&gt; 322                              agrepl            0
#&gt; 323                               alist            0
#&gt; 324                                 all            0
#&gt; 325                 all.equal.character            0
#&gt; 326                   all.equal.default            0
#&gt; 327               all.equal.environment            0
#&gt; 328               all.equal.envRefClass            0
#&gt; 329                    all.equal.factor            0
#&gt; 330                   all.equal.formula            0
#&gt; 331                  all.equal.function            0
#&gt; 332                  all.equal.language            0
#&gt; 333                      all.equal.list            0
#&gt; 334                   all.equal.numeric            0
#&gt; 335                    all.equal.POSIXt            0
#&gt; 336                       all.equal.raw            0
#&gt; 337                           all.names            0
#&gt; 338                            all.vars            0
#&gt; 339                     allowInterrupts            0
#&gt; 340                                 any            0
#&gt; 341                 anyDuplicated.array            0
#&gt; 342            anyDuplicated.data.frame            0
#&gt; 343               anyDuplicated.default            0
#&gt; 344                anyDuplicated.matrix            0
#&gt; 345                    anyNA.data.frame            0
#&gt; 346               anyNA.numeric_version            0
#&gt; 347                       anyNA.POSIXlt            0
#&gt; 348                       aperm.default            0
#&gt; 349                         aperm.table            0
#&gt; 350                              append            0
#&gt; 351                               apply            0
#&gt; 352                                 Arg            0
#&gt; 353                                args            0
#&gt; 354                               array            0
#&gt; 355                            array2DF            0
#&gt; 356                            arrayInd            0
#&gt; 357                    as.array.default            0
#&gt; 358                             as.call            0
#&gt; 359              as.character.condition            0
#&gt; 360                   as.character.Date            0
#&gt; 361                as.character.default            0
#&gt; 362                  as.character.error            0
#&gt; 363                 as.character.factor            0
#&gt; 364                as.character.hexmode            0
#&gt; 365        as.character.numeric_version            0
#&gt; 366                as.character.octmode            0
#&gt; 367                 as.character.POSIXt            0
#&gt; 368                 as.character.srcref            0
#&gt; 369                          as.complex            0
#&gt; 370                 as.data.frame.array            0
#&gt; 371                  as.data.frame.AsIs            0
#&gt; 372             as.data.frame.character            0
#&gt; 373               as.data.frame.complex            0
#&gt; 374            as.data.frame.data.frame            0
#&gt; 375                  as.data.frame.Date            0
#&gt; 376               as.data.frame.default            0
#&gt; 377              as.data.frame.difftime            0
#&gt; 378                as.data.frame.factor            0
#&gt; 379               as.data.frame.integer            0
#&gt; 380                  as.data.frame.list            0
#&gt; 381               as.data.frame.logical            0
#&gt; 382                as.data.frame.matrix            0
#&gt; 383          as.data.frame.model.matrix            0
#&gt; 384               as.data.frame.noquote            0
#&gt; 385               as.data.frame.numeric            0
#&gt; 386       as.data.frame.numeric_version            0
#&gt; 387               as.data.frame.ordered            0
#&gt; 388               as.data.frame.POSIXct            0
#&gt; 389               as.data.frame.POSIXlt            0
#&gt; 390                   as.data.frame.raw            0
#&gt; 391                 as.data.frame.table            0
#&gt; 392                    as.data.frame.ts            0
#&gt; 393                as.data.frame.vector            0
#&gt; 394                   as.Date.character            0
#&gt; 395                     as.Date.default            0
#&gt; 396                      as.Date.factor            0
#&gt; 397                     as.Date.numeric            0
#&gt; 398                     as.Date.POSIXct            0
#&gt; 399                     as.Date.POSIXlt            0
#&gt; 400                         as.difftime            0
#&gt; 401                  as.double.difftime            0
#&gt; 402                   as.double.POSIXlt            0
#&gt; 403               as.expression.default            0
#&gt; 404                           as.factor            0
#&gt; 405                 as.function.default            0
#&gt; 406                          as.hexmode            0
#&gt; 407                  as.list.data.frame            0
#&gt; 408                        as.list.Date            0
#&gt; 409                     as.list.default            0
#&gt; 410                    as.list.difftime            0
#&gt; 411                 as.list.environment            0
#&gt; 412                      as.list.factor            0
#&gt; 413                    as.list.function            0
#&gt; 414             as.list.numeric_version            0
#&gt; 415                     as.list.POSIXct            0
#&gt; 416                     as.list.POSIXlt            0
#&gt; 417                   as.logical.factor            0
#&gt; 418                as.matrix.data.frame            0
#&gt; 419                   as.matrix.default            0
#&gt; 420                   as.matrix.noquote            0
#&gt; 421                   as.matrix.POSIXlt            0
#&gt; 422                             as.name            0
#&gt; 423                     as.null.default            0
#&gt; 424                          as.numeric            0
#&gt; 425                  as.numeric_version            0
#&gt; 426                          as.octmode            0
#&gt; 427                          as.ordered            0
#&gt; 428                  as.package_version            0
#&gt; 429                         as.pairlist            0
#&gt; 430                     as.POSIXct.Date            0
#&gt; 431                  as.POSIXct.default            0
#&gt; 432                  as.POSIXct.numeric            0
#&gt; 433                  as.POSIXct.POSIXlt            0
#&gt; 434                as.POSIXlt.character            0
#&gt; 435                     as.POSIXlt.Date            0
#&gt; 436                  as.POSIXlt.default            0
#&gt; 437                   as.POSIXlt.factor            0
#&gt; 438                  as.POSIXlt.numeric            0
#&gt; 439                  as.POSIXlt.POSIXct            0
#&gt; 440                               as.qr            0
#&gt; 441                              as.raw            0
#&gt; 442                   as.single.default            0
#&gt; 443                           as.symbol            0
#&gt; 444                    as.table.default            0
#&gt; 445                as.vector.data.frame            0
#&gt; 446                    as.vector.factor            0
#&gt; 447                   as.vector.POSIXlt            0
#&gt; 448                                asin            0
#&gt; 449                               asinh            0
#&gt; 450                         asNamespace            0
#&gt; 451                              asplit            0
#&gt; 452                                asS3            0
#&gt; 453                                asS4            0
#&gt; 454                              assign            0
#&gt; 455                                atan            0
#&gt; 456                               atan2            0
#&gt; 457                               atanh            0
#&gt; 458                              attach            0
#&gt; 459                     attachNamespace            0
#&gt; 460                      attr.all.equal            0
#&gt; 461                              attr&lt;-            0
#&gt; 462                          attributes            0
#&gt; 463                        attributes&lt;-            0
#&gt; 464                            autoload            0
#&gt; 465                          autoloader            0
#&gt; 466                           backsolve            0
#&gt; 467                      balancePOSIXlt            0
#&gt; 468                             baseenv            0
#&gt; 469                            basename            0
#&gt; 470                             besselI            0
#&gt; 471                             besselJ            0
#&gt; 472                             besselK            0
#&gt; 473                             besselY            0
#&gt; 474                                beta            0
#&gt; 475                     bindingIsActive            0
#&gt; 476                     bindingIsLocked            0
#&gt; 477                      bindtextdomain            0
#&gt; 478                             bitwAnd            0
#&gt; 479                             bitwNot            0
#&gt; 480                              bitwOr            0
#&gt; 481                          bitwShiftL            0
#&gt; 482                          bitwShiftR            0
#&gt; 483                             bitwXor            0
#&gt; 484                                body            0
#&gt; 485                              bquote            0
#&gt; 486                               break            0
#&gt; 487                             browser            0
#&gt; 488                    browserCondition            0
#&gt; 489                     browserSetDebug            0
#&gt; 490                         browserText            0
#&gt; 491                            builtins            0
#&gt; 492                       by.data.frame            0
#&gt; 493                          by.default            0
#&gt; 494                              bzfile            0
#&gt; 495                              c.Date            0
#&gt; 496                          c.difftime            0
#&gt; 497                            c.factor            0
#&gt; 498                           c.noquote            0
#&gt; 499                   c.numeric_version            0
#&gt; 500                           c.POSIXct            0
#&gt; 501                           c.POSIXlt            0
#&gt; 502                          c.warnings            0
#&gt; 503                                call            0
#&gt; 504                              callCC            0
#&gt; 505                        capabilities            0
#&gt; 506                            casefold            0
#&gt; 507                                 cat            0
#&gt; 508                    cbind.data.frame            0
#&gt; 509                             ceiling            0
#&gt; 510                         char.expand            0
#&gt; 511                           character            0
#&gt; 512                           charmatch            0
#&gt; 513                           charToRaw            0
#&gt; 514                              chartr            0
#&gt; 515                             chkDots            0
#&gt; 516                        chol.default            0
#&gt; 517                            chol2inv            0
#&gt; 518                              choose            0
#&gt; 519             chooseOpsMethod.default            0
#&gt; 520                               class            0
#&gt; 521                             class&lt;-            0
#&gt; 522                       clearPushBack            0
#&gt; 523                    close.connection            0
#&gt; 524                       close.srcfile            0
#&gt; 525                  close.srcfilealias            0
#&gt; 526                 closeAllConnections            0
#&gt; 527                                 col            0
#&gt; 528                            colMeans            0
#&gt; 529                            colnames            0
#&gt; 530                          colnames&lt;-            0
#&gt; 531                             colSums            0
#&gt; 532                         commandArgs            0
#&gt; 533                             comment            0
#&gt; 534                           comment&lt;-            0
#&gt; 535                             complex            0
#&gt; 536                     computeRestarts            0
#&gt; 537             conditionCall.condition            0
#&gt; 538          conditionMessage.condition            0
#&gt; 539                       conflictRules            0
#&gt; 540                           conflicts            0
#&gt; 541                                Conj            0
#&gt; 542                        contributors            0
#&gt; 543                                 cos            0
#&gt; 544                                cosh            0
#&gt; 545                               cospi            0
#&gt; 546                           crossprod            0
#&gt; 547                         Cstack_info            0
#&gt; 548                              cummax            0
#&gt; 549                              cummin            0
#&gt; 550                             cumprod            0
#&gt; 551                              cumsum            0
#&gt; 552                      curlGetHeaders            0
#&gt; 553                            cut.Date            0
#&gt; 554                         cut.default            0
#&gt; 555                          cut.POSIXt            0
#&gt; 556                          data.class            0
#&gt; 557                          data.frame            0
#&gt; 558                         data.matrix            0
#&gt; 559                                date            0
#&gt; 560                               debug            0
#&gt; 561                      debuggingState            0
#&gt; 562                           debugonce            0
#&gt; 563                             declare            0
#&gt; 564            default.stringsAsFactors            0
#&gt; 565                       delayedAssign            0
#&gt; 566                             deparse            0
#&gt; 567                            deparse1            0
#&gt; 568                                 det            0
#&gt; 569                              detach            0
#&gt; 570                  determinant.matrix            0
#&gt; 571                                dget            0
#&gt; 572                                diag            0
#&gt; 573                              diag&lt;-            0
#&gt; 574                           diff.Date            0
#&gt; 575                        diff.default            0
#&gt; 576                       diff.difftime            0
#&gt; 577                         diff.POSIXt            0
#&gt; 578                            difftime            0
#&gt; 579                             digamma            0
#&gt; 580                      dim.data.frame            0
#&gt; 581                 dimnames.data.frame            0
#&gt; 582               dimnames&lt;-.data.frame            0
#&gt; 583                          dir.create            0
#&gt; 584                          dir.exists            0
#&gt; 585                             dirname            0
#&gt; 586                             do.call            0
#&gt; 587                           dontCheck            0
#&gt; 588                              double            0
#&gt; 589                                dput            0
#&gt; 590                              dQuote            0
#&gt; 591               droplevels.data.frame            0
#&gt; 592                   droplevels.factor            0
#&gt; 593                    duplicated.array            0
#&gt; 594               duplicated.data.frame            0
#&gt; 595                  duplicated.default            0
#&gt; 596                   duplicated.matrix            0
#&gt; 597          duplicated.numeric_version            0
#&gt; 598                  duplicated.POSIXlt            0
#&gt; 599                 duplicated.warnings            0
#&gt; 600                            dyn.load            0
#&gt; 601                          dyn.unload            0
#&gt; 602                              dynGet            0
#&gt; 603                              eapply            0
#&gt; 604                               eigen            0
#&gt; 605                            emptyenv            0
#&gt; 606                          enc2native            0
#&gt; 607                            enc2utf8            0
#&gt; 608                        encodeString            0
#&gt; 609                            Encoding            0
#&gt; 610                          Encoding&lt;-            0
#&gt; 611                            endsWith            0
#&gt; 612                             enquote            0
#&gt; 613                         env.profile            0
#&gt; 614                         environment            0
#&gt; 615                       environment&lt;-            0
#&gt; 616                 environmentIsLocked            0
#&gt; 617                     environmentName            0
#&gt; 618                      errorCondition            0
#&gt; 619                         eval.parent            0
#&gt; 620                               evalq            0
#&gt; 621                                Exec            0
#&gt; 622                              exists            0
#&gt; 623                                 exp            0
#&gt; 624                         expand.grid            0
#&gt; 625                               expm1            0
#&gt; 626                          expression            0
#&gt; 627                      extSoftVersion            0
#&gt; 628                           factorial            0
#&gt; 629                                fifo            0
#&gt; 630                         file.access            0
#&gt; 631                         file.append            0
#&gt; 632                         file.choose            0
#&gt; 633                           file.copy            0
#&gt; 634                         file.create            0
#&gt; 635                         file.exists            0
#&gt; 636                           file.info            0
#&gt; 637                           file.link            0
#&gt; 638                           file.mode            0
#&gt; 639                          file.mtime            0
#&gt; 640                           file.path            0
#&gt; 641                         file.remove            0
#&gt; 642                         file.rename            0
#&gt; 643                           file.show            0
#&gt; 644                           file.size            0
#&gt; 645                        file.symlink            0
#&gt; 646                              Filter            0
#&gt; 647                                Find            0
#&gt; 648                        find.package            0
#&gt; 649                        findInterval            0
#&gt; 650                      findPackageEnv            0
#&gt; 651                         findRestart            0
#&gt; 652                               floor            0
#&gt; 653                    flush.connection            0
#&gt; 654                                 for            0
#&gt; 655                               force            0
#&gt; 656                        forceAndCall            0
#&gt; 657                             formals            0
#&gt; 658                           formals&lt;-            0
#&gt; 659                         format.AsIs            0
#&gt; 660                   format.data.frame            0
#&gt; 661                         format.Date            0
#&gt; 662                      format.default            0
#&gt; 663                     format.difftime            0
#&gt; 664                       format.factor            0
#&gt; 665                      format.hexmode            0
#&gt; 666                         format.info            0
#&gt; 667                   format.libraryIQR            0
#&gt; 668              format.numeric_version            0
#&gt; 669                      format.octmode            0
#&gt; 670                  format.packageInfo            0
#&gt; 671                      format.POSIXct            0
#&gt; 672                      format.POSIXlt            0
#&gt; 673                         format.pval            0
#&gt; 674               format.summaryDefault            0
#&gt; 675                             formatC            0
#&gt; 676                            formatDL            0
#&gt; 677                        forwardsolve            0
#&gt; 678                            function            0
#&gt; 679                               gamma            0
#&gt; 680                             gc.time            0
#&gt; 681                              gcinfo            0
#&gt; 682                           gctorture            0
#&gt; 683                          gctorture2            0
#&gt; 684                                 get            0
#&gt; 685                                get0            0
#&gt; 686                   getAllConnections            0
#&gt; 687                       getCallingDLL            0
#&gt; 688                      getCallingDLLe            0
#&gt; 689                       getConnection            0
#&gt; 690  getDLLRegisteredRoutines.character            0
#&gt; 691    getDLLRegisteredRoutines.DLLInfo            0
#&gt; 692                          getElement            0
#&gt; 693                       geterrmessage            0
#&gt; 694                    getExportedValue            0
#&gt; 695                             getHook            0
#&gt; 696                       getLoadedDLLs            0
#&gt; 697                        getNamespace            0
#&gt; 698                 getNamespaceExports            0
#&gt; 699                 getNamespaceImports            0
#&gt; 700                    getNamespaceInfo            0
#&gt; 701                    getNamespaceName            0
#&gt; 702                   getNamespaceUsers            0
#&gt; 703                 getNamespaceVersion            0
#&gt; 704                 getNativeSymbolInfo            0
#&gt; 705                           getOption            0
#&gt; 706                         getRversion            0
#&gt; 707                         getSrcLines            0
#&gt; 708                getTaskCallbackNames            0
#&gt; 709                             gettext            0
#&gt; 710                            gettextf            0
#&gt; 711                               getwd            0
#&gt; 712                                  gl            0
#&gt; 713               globalCallingHandlers            0
#&gt; 714                           globalenv            0
#&gt; 715                            gregexec            0
#&gt; 716                            gregexpr            0
#&gt; 717                                grep            0
#&gt; 718                               grepl            0
#&gt; 719                             grepRaw            0
#&gt; 720                            grouping            0
#&gt; 721                                gsub            0
#&gt; 722                               gzcon            0
#&gt; 723                              gzfile            0
#&gt; 724                                   I            0
#&gt; 725                               iconv            0
#&gt; 726                           iconvlist            0
#&gt; 727                       icuGetCollate            0
#&gt; 728                       icuSetCollate            0
#&gt; 729                           identical            0
#&gt; 730                            identity            0
#&gt; 731                                  if            0
#&gt; 732                              ifelse            0
#&gt; 733                                  Im            0
#&gt; 734                       importIntoEnv            0
#&gt; 735                             infoRDS            0
#&gt; 736                            inherits            0
#&gt; 737                             integer            0
#&gt; 738                         interactive            0
#&gt; 739                           intToBits            0
#&gt; 740                           intToUtf8            0
#&gt; 741                         inverse.rle            0
#&gt; 742                           invisible            0
#&gt; 743                       invokeRestart            0
#&gt; 744          invokeRestartInteractively            0
#&gt; 745                            is.array            0
#&gt; 746                           is.atomic            0
#&gt; 747                             is.call            0
#&gt; 748                        is.character            0
#&gt; 749                          is.complex            0
#&gt; 750                       is.data.frame            0
#&gt; 751                           is.double            0
#&gt; 752                          is.element            0
#&gt; 753                      is.environment            0
#&gt; 754                       is.expression            0
#&gt; 755                           is.factor            0
#&gt; 756                   is.finite.POSIXlt            0
#&gt; 757                         is.function            0
#&gt; 758                 is.infinite.POSIXlt            0
#&gt; 759                          is.integer            0
#&gt; 760                         is.language            0
#&gt; 761                             is.list            0
#&gt; 762                           is.loaded            0
#&gt; 763                          is.logical            0
#&gt; 764                           is.matrix            0
#&gt; 765                    is.na.data.frame            0
#&gt; 766               is.na.numeric_version            0
#&gt; 767                       is.na.POSIXlt            0
#&gt; 768                     is.na&lt;-.default            0
#&gt; 769                      is.na&lt;-.factor            0
#&gt; 770             is.na&lt;-.numeric_version            0
#&gt; 771                             is.name            0
#&gt; 772                      is.nan.POSIXlt            0
#&gt; 773                             is.null            0
#&gt; 774                  is.numeric_version            0
#&gt; 775                     is.numeric.Date            0
#&gt; 776                 is.numeric.difftime            0
#&gt; 777                   is.numeric.POSIXt            0
#&gt; 778                           is.object            0
#&gt; 779                          is.ordered            0
#&gt; 780                  is.package_version            0
#&gt; 781                         is.pairlist            0
#&gt; 782                        is.primitive            0
#&gt; 783                               is.qr            0
#&gt; 784                                is.R            0
#&gt; 785                              is.raw            0
#&gt; 786                        is.recursive            0
#&gt; 787                           is.single            0
#&gt; 788                           is.symbol            0
#&gt; 789                            is.table            0
#&gt; 790                         is.unsorted            0
#&gt; 791                           is.vector            0
#&gt; 792                                 isa            0
#&gt; 793                              isatty            0
#&gt; 794                     isBaseNamespace            0
#&gt; 795                          isdebugged            0
#&gt; 796                             isFALSE            0
#&gt; 797                        isIncomplete            0
#&gt; 798                         isNamespace            0
#&gt; 799                   isNamespaceLoaded            0
#&gt; 800                             ISOdate            0
#&gt; 801                         ISOdatetime            0
#&gt; 802                              isOpen            0
#&gt; 803                           isRestart            0
#&gt; 804                                isS4            0
#&gt; 805                          isSeekable            0
#&gt; 806                  isSymmetric.matrix            0
#&gt; 807                              isTRUE            0
#&gt; 808                              jitter            0
#&gt; 809                         julian.Date            0
#&gt; 810                       julian.POSIXt            0
#&gt; 811                       kappa.default            0
#&gt; 812                            kappa.lm            0
#&gt; 813                            kappa.qr            0
#&gt; 814                           l10n_info            0
#&gt; 815                          La_library            0
#&gt; 816                          La_version            0
#&gt; 817                              La.svd            0
#&gt; 818                      labels.default            0
#&gt; 819                              lapply            0
#&gt; 820                            lazyLoad            0
#&gt; 821                      lazyLoadDBexec            0
#&gt; 822                     lazyLoadDBfetch            0
#&gt; 823                               lbeta            0
#&gt; 824                             lchoose            0
#&gt; 825                      length.POSIXlt            0
#&gt; 826                       length&lt;-.Date            0
#&gt; 827                   length&lt;-.difftime            0
#&gt; 828                     length&lt;-.factor            0
#&gt; 829                    length&lt;-.POSIXct            0
#&gt; 830                    length&lt;-.POSIXlt            0
#&gt; 831                      levels.default            0
#&gt; 832                     levels&lt;-.factor            0
#&gt; 833                          lfactorial            0
#&gt; 834                              lgamma            0
#&gt; 835                      libcurlVersion            0
#&gt; 836                library.dynam.unload            0
#&gt; 837                             licence            0
#&gt; 838                             license            0
#&gt; 839                           list.dirs            0
#&gt; 840                          list.files            0
#&gt; 841                             list2DF            0
#&gt; 842                            list2env            0
#&gt; 843                                load            0
#&gt; 844                    loadedNamespaces            0
#&gt; 845                loadingNamespaceInfo            0
#&gt; 846                       loadNamespace            0
#&gt; 847                               local            0
#&gt; 848                         lockBinding            0
#&gt; 849                     lockEnvironment            0
#&gt; 850                                 log            0
#&gt; 851                               log10            0
#&gt; 852                               log1p            0
#&gt; 853                                log2            0
#&gt; 854                                logb            0
#&gt; 855                             logical            0
#&gt; 856                           lower.tri            0
#&gt; 857                          make.names            0
#&gt; 858                         make.unique            0
#&gt; 859                   makeActiveBinding            0
#&gt; 860                                 Map            0
#&gt; 861                              mapply            0
#&gt; 862                        margin.table            0
#&gt; 863                          marginSums            0
#&gt; 864                          mat.or.vec            0
#&gt; 865                           match.arg            0
#&gt; 866                          match.call            0
#&gt; 867                           match.fun            0
#&gt; 868                     Math.data.frame            0
#&gt; 869                           Math.Date            0
#&gt; 870                       Math.difftime            0
#&gt; 871                         Math.factor            0
#&gt; 872                         Math.POSIXt            0
#&gt; 873                              matrix            0
#&gt; 874                             max.col            0
#&gt; 875                           mean.Date            0
#&gt; 876                        mean.default            0
#&gt; 877                       mean.difftime            0
#&gt; 878                        mean.POSIXct            0
#&gt; 879                        mean.POSIXlt            0
#&gt; 880                        mem.maxNSize            0
#&gt; 881                        mem.maxVSize            0
#&gt; 882                         memCompress            0
#&gt; 883                       memDecompress            0
#&gt; 884                      memory.profile            0
#&gt; 885                    merge.data.frame            0
#&gt; 886                       merge.default            0
#&gt; 887                             message            0
#&gt; 888                                mget            0
#&gt; 889                             missing            0
#&gt; 890                                 Mod            0
#&gt; 891                                mode            0
#&gt; 892                              mode&lt;-            0
#&gt; 893                         months.Date            0
#&gt; 894                       months.POSIXt            0
#&gt; 895                    mostattributes&lt;-            0
#&gt; 896                       mtfrm.default            0
#&gt; 897                       mtfrm.POSIXct            0
#&gt; 898                       mtfrm.POSIXlt            0
#&gt; 899                 nameOfClass.default            0
#&gt; 900                       names.POSIXlt            0
#&gt; 901                     names&lt;-.POSIXlt            0
#&gt; 902                     namespaceExport            0
#&gt; 903                     namespaceImport            0
#&gt; 904              namespaceImportClasses            0
#&gt; 905                 namespaceImportFrom            0
#&gt; 906              namespaceImportMethods            0
#&gt; 907                               nargs            0
#&gt; 908                               nchar            0
#&gt; 909                                ncol            0
#&gt; 910                                NCOL            0
#&gt; 911                              Negate            0
#&gt; 912                             new.env            0
#&gt; 913                                next            0
#&gt; 914                          NextMethod            0
#&gt; 915                            ngettext            0
#&gt; 916                             nlevels            0
#&gt; 917                             noquote            0
#&gt; 918                                norm            0
#&gt; 919                       normalizePath            0
#&gt; 920                                nrow            0
#&gt; 921                                NROW            0
#&gt; 922                            nullfile            0
#&gt; 923                             numeric            0
#&gt; 924                     numeric_version            0
#&gt; 925                           numToBits            0
#&gt; 926                           numToInts            0
#&gt; 927                              nzchar            0
#&gt; 928                             objects            0
#&gt; 929                            oldClass            0
#&gt; 930                          oldClass&lt;-            0
#&gt; 931                          OlsonNames            0
#&gt; 932                             on.exit            0
#&gt; 933                     open.connection            0
#&gt; 934                        open.srcfile            0
#&gt; 935                   open.srcfilealias            0
#&gt; 936                    open.srcfilecopy            0
#&gt; 937                      Ops.data.frame            0
#&gt; 938                            Ops.Date            0
#&gt; 939                        Ops.difftime            0
#&gt; 940                          Ops.factor            0
#&gt; 941                 Ops.numeric_version            0
#&gt; 942                         Ops.ordered            0
#&gt; 943                          Ops.POSIXt            0
#&gt; 944                             options            0
#&gt; 945                             ordered            0
#&gt; 946                               outer            0
#&gt; 947                     package_version            0
#&gt; 948                        packageEvent            0
#&gt; 949                 packageHasNamespace            0
#&gt; 950                packageNotFoundError            0
#&gt; 951               packageStartupMessage            0
#&gt; 952                            packBits            0
#&gt; 953                            pairlist            0
#&gt; 954                          parent.env            0
#&gt; 955                        parent.env&lt;-            0
#&gt; 956                        parent.frame            0
#&gt; 957                               parse            0
#&gt; 958                  parseNamespaceFile            0
#&gt; 959                               paste            0
#&gt; 960                              paste0            0
#&gt; 961                         path.expand            0
#&gt; 962                        path.package            0
#&gt; 963                         pcre_config            0
#&gt; 964                                pipe            0
#&gt; 965                              pmatch            0
#&gt; 966                            pmax.int            0
#&gt; 967                            pmin.int            0
#&gt; 968                            polyroot            0
#&gt; 969                          pos.to.env            0
#&gt; 970                            Position            0
#&gt; 971                      pretty.default            0
#&gt; 972                           prettyNum            0
#&gt; 973                          print.AsIs            0
#&gt; 974                            print.by            0
#&gt; 975                     print.condition            0
#&gt; 976                    print.connection            0
#&gt; 977                    print.data.frame            0
#&gt; 978                          print.Date            0
#&gt; 979                       print.default            0
#&gt; 980                      print.difftime            0
#&gt; 981                         print.Dlist            0
#&gt; 982                       print.DLLInfo            0
#&gt; 983                   print.DLLInfoList            0
#&gt; 984         print.DLLRegisteredRoutines            0
#&gt; 985                         print.eigen            0
#&gt; 986                        print.factor            0
#&gt; 987                      print.function            0
#&gt; 988                       print.hexmode            0
#&gt; 989                    print.libraryIQR            0
#&gt; 990                        print.listof            0
#&gt; 991             print.NativeRoutineList            0
#&gt; 992                       print.noquote            0
#&gt; 993               print.numeric_version            0
#&gt; 994                       print.octmode            0
#&gt; 995                   print.packageInfo            0
#&gt; 996                       print.POSIXct            0
#&gt; 997                       print.POSIXlt            0
#&gt; 998                     print.proc_time            0
#&gt; 999                       print.restart            0
#&gt; 1000                          print.rle            0
#&gt; 1001                  print.simple.list            0
#&gt; 1002                      print.srcfile            0
#&gt; 1003                       print.srcref            0
#&gt; 1004                print.summary.table            0
#&gt; 1005             print.summary.warnings            0
#&gt; 1006               print.summaryDefault            0
#&gt; 1007                        print.table            0
#&gt; 1008                     print.warnings            0
#&gt; 1009                           prmatrix            0
#&gt; 1010                          proc.time            0
#&gt; 1011                               prod            0
#&gt; 1012                         prop.table            0
#&gt; 1013                        proportions            0
#&gt; 1014                    provideDimnames            0
#&gt; 1015                           psigamma            0
#&gt; 1016                           pushBack            0
#&gt; 1017                     pushBackLength            0
#&gt; 1018                                  q            0
#&gt; 1019                            qr.coef            0
#&gt; 1020                         qr.default            0
#&gt; 1021                          qr.fitted            0
#&gt; 1022                               qr.Q            0
#&gt; 1023                             qr.qty            0
#&gt; 1024                              qr.qy            0
#&gt; 1025                               qr.R            0
#&gt; 1026                           qr.resid            0
#&gt; 1027                           qr.solve            0
#&gt; 1028                               qr.X            0
#&gt; 1029                      quarters.Date            0
#&gt; 1030                    quarters.POSIXt            0
#&gt; 1031                               quit            0
#&gt; 1032                              quote            0
#&gt; 1033                      R_compiled_by            0
#&gt; 1034                   R_system_version            0
#&gt; 1035                             R.home            0
#&gt; 1036                          R.Version            0
#&gt; 1037                         range.Date            0
#&gt; 1038                      range.default            0
#&gt; 1039                      range.POSIXct            0
#&gt; 1040                               rank            0
#&gt; 1041                             rapply            0
#&gt; 1042                                raw            0
#&gt; 1043                      rawConnection            0
#&gt; 1044                 rawConnectionValue            0
#&gt; 1045                           rawShift            0
#&gt; 1046                          rawToBits            0
#&gt; 1047                          rawToChar            0
#&gt; 1048                   rbind.data.frame            0
#&gt; 1049                              rcond            0
#&gt; 1050                                 Re            0
#&gt; 1051                           read.dcf            0
#&gt; 1052                            readBin            0
#&gt; 1053                           readChar            0
#&gt; 1054                           readline            0
#&gt; 1055                          readLines            0
#&gt; 1056                            readRDS            0
#&gt; 1057                       readRenviron            0
#&gt; 1058                             Recall            0
#&gt; 1059                             Reduce            0
#&gt; 1060                      reg.finalizer            0
#&gt; 1061                            regexec            0
#&gt; 1062                            regexpr            0
#&gt; 1063                   registerS3method            0
#&gt; 1064                  registerS3methods            0
#&gt; 1065                         regmatches            0
#&gt; 1066                       regmatches&lt;-            0
#&gt; 1067                 removeTaskCallback            0
#&gt; 1068                            rep_len            0
#&gt; 1069                           rep.Date            0
#&gt; 1070                       rep.difftime            0
#&gt; 1071                         rep.factor            0
#&gt; 1072                            rep.int            0
#&gt; 1073                rep.numeric_version            0
#&gt; 1074                        rep.POSIXct            0
#&gt; 1075                        rep.POSIXlt            0
#&gt; 1076                             repeat            0
#&gt; 1077                            replace            0
#&gt; 1078                          replicate            0
#&gt; 1079                            require            0
#&gt; 1080                   requireNamespace            0
#&gt; 1081                 restartDescription            0
#&gt; 1082                     restartFormals            0
#&gt; 1083                         retracemem            0
#&gt; 1084                             return            0
#&gt; 1085                        returnValue            0
#&gt; 1086                        rev.default            0
#&gt; 1087                                rle            0
#&gt; 1088                                 rm            0
#&gt; 1089                            RNGkind            0
#&gt; 1090                         RNGversion            0
#&gt; 1091                         round.Date            0
#&gt; 1092                       round.POSIXt            0
#&gt; 1093               row.names.data.frame            0
#&gt; 1094                  row.names.default            0
#&gt; 1095             row.names&lt;-.data.frame            0
#&gt; 1096                row.names&lt;-.default            0
#&gt; 1097                           rowMeans            0
#&gt; 1098                           rownames            0
#&gt; 1099                         rownames&lt;-            0
#&gt; 1100                  rowsum.data.frame            0
#&gt; 1101                     rowsum.default            0
#&gt; 1102                            rowSums            0
#&gt; 1103                         sample.int            0
#&gt; 1104                             sapply            0
#&gt; 1105                         save.image            0
#&gt; 1106                            saveRDS            0
#&gt; 1107                      scale.default            0
#&gt; 1108                               scan            0
#&gt; 1109                             search            0
#&gt; 1110                        searchpaths            0
#&gt; 1111                    seek.connection            0
#&gt; 1112                          seq_along            0
#&gt; 1113                            seq_len            0
#&gt; 1114                           seq.Date            0
#&gt; 1115                        seq.default            0
#&gt; 1116                            seq.int            0
#&gt; 1117                         seq.POSIXt            0
#&gt; 1118                   sequence.default            0
#&gt; 1119                          serialize            0
#&gt; 1120                       serverSocket            0
#&gt; 1121                           set.seed            0
#&gt; 1122                            setHook            0
#&gt; 1123                   setNamespaceInfo            0
#&gt; 1124                setSessionTimeLimit            0
#&gt; 1125                       setTimeLimit            0
#&gt; 1126                              setwd            0
#&gt; 1127                    showConnections            0
#&gt; 1128                            shQuote            0
#&gt; 1129                               sign            0
#&gt; 1130                    signalCondition            0
#&gt; 1131                             signif            0
#&gt; 1132                    simpleCondition            0
#&gt; 1133                        simpleError            0
#&gt; 1134                      simpleMessage            0
#&gt; 1135                      simpleWarning            0
#&gt; 1136                     simplify2array            0
#&gt; 1137                                sin            0
#&gt; 1138                             single            0
#&gt; 1139                               sinh            0
#&gt; 1140                        sink.number            0
#&gt; 1141                              sinpi            0
#&gt; 1142                        slice.index            0
#&gt; 1143                       socketAccept            0
#&gt; 1144                   socketConnection            0
#&gt; 1145                       socketSelect            0
#&gt; 1146                      socketTimeout            0
#&gt; 1147                      solve.default            0
#&gt; 1148                           solve.qr            0
#&gt; 1149                 sort_by.data.frame            0
#&gt; 1150                    sort_by.default            0
#&gt; 1151                       sort.default            0
#&gt; 1152                           sort.int            0
#&gt; 1153                          sort.list            0
#&gt; 1154                       sort.POSIXlt            0
#&gt; 1155                             source            0
#&gt; 1156                   split.data.frame            0
#&gt; 1157                         split.Date            0
#&gt; 1158                      split.default            0
#&gt; 1159                      split.POSIXct            0
#&gt; 1160                 split&lt;-.data.frame            0
#&gt; 1161                    split&lt;-.default            0
#&gt; 1162                            sprintf            0
#&gt; 1163                               sqrt            0
#&gt; 1164                             sQuote            0
#&gt; 1165                            srcfile            0
#&gt; 1166                       srcfilealias            0
#&gt; 1167                        srcfilecopy            0
#&gt; 1168                             srcref            0
#&gt; 1169                    standardGeneric            0
#&gt; 1170                         startsWith            0
#&gt; 1171                             stderr            0
#&gt; 1172                              stdin            0
#&gt; 1173                             stdout            0
#&gt; 1174                               stop            0
#&gt; 1175                          stopifnot            0
#&gt; 1176                       storage.mode            0
#&gt; 1177                     storage.mode&lt;-            0
#&gt; 1178                     str2expression            0
#&gt; 1179                           str2lang            0
#&gt; 1180                           strftime            0
#&gt; 1181                           strptime            0
#&gt; 1182                             strrep            0
#&gt; 1183                           strsplit            0
#&gt; 1184                             strtoi            0
#&gt; 1185                            strtrim            0
#&gt; 1186                          structure            0
#&gt; 1187                            strwrap            0
#&gt; 1188                                sub            0
#&gt; 1189                  subset.data.frame            0
#&gt; 1190                     subset.default            0
#&gt; 1191                      subset.matrix            0
#&gt; 1192                         substitute            0
#&gt; 1193                             substr            0
#&gt; 1194                           substr&lt;-            0
#&gt; 1195                          substring            0
#&gt; 1196                        substring&lt;-            0
#&gt; 1197                 summary.connection            0
#&gt; 1198                 summary.data.frame            0
#&gt; 1199                 Summary.data.frame            0
#&gt; 1200                       summary.Date            0
#&gt; 1201                       Summary.Date            0
#&gt; 1202                    summary.default            0
#&gt; 1203                   Summary.difftime            0
#&gt; 1204                     summary.factor            0
#&gt; 1205                     Summary.factor            0
#&gt; 1206                     summary.matrix            0
#&gt; 1207            Summary.numeric_version            0
#&gt; 1208                    Summary.ordered            0
#&gt; 1209                    summary.POSIXct            0
#&gt; 1210                    Summary.POSIXct            0
#&gt; 1211                    summary.POSIXlt            0
#&gt; 1212                    Summary.POSIXlt            0
#&gt; 1213                  summary.proc_time            0
#&gt; 1214                    summary.srcfile            0
#&gt; 1215                     summary.srcref            0
#&gt; 1216                      summary.table            0
#&gt; 1217                   summary.warnings            0
#&gt; 1218                   suppressMessages            0
#&gt; 1219     suppressPackageStartupMessages            0
#&gt; 1220                   suppressWarnings            0
#&gt; 1221                  suspendInterrupts            0
#&gt; 1222                                svd            0
#&gt; 1223                              sweep            0
#&gt; 1224                             switch            0
#&gt; 1225                           sys.call            0
#&gt; 1226                          sys.calls            0
#&gt; 1227                          Sys.chmod            0
#&gt; 1228                           Sys.Date            0
#&gt; 1229                          sys.frame            0
#&gt; 1230                         sys.frames            0
#&gt; 1231                       sys.function            0
#&gt; 1232                         Sys.getenv            0
#&gt; 1233                      Sys.getlocale            0
#&gt; 1234                         Sys.getpid            0
#&gt; 1235                           Sys.glob            0
#&gt; 1236                           Sys.info            0
#&gt; 1237                     sys.load.image            0
#&gt; 1238                     Sys.localeconv            0
#&gt; 1239                         sys.nframe            0
#&gt; 1240                        sys.on.exit            0
#&gt; 1241                         sys.parent            0
#&gt; 1242                        sys.parents            0
#&gt; 1243                       Sys.readlink            0
#&gt; 1244                     sys.save.image            0
#&gt; 1245                         Sys.setenv            0
#&gt; 1246                    Sys.setFileTime            0
#&gt; 1247                    Sys.setLanguage            0
#&gt; 1248                      Sys.setlocale            0
#&gt; 1249                          Sys.sleep            0
#&gt; 1250                         sys.source            0
#&gt; 1251                         sys.status            0
#&gt; 1252                           Sys.time            0
#&gt; 1253                       Sys.timezone            0
#&gt; 1254                          Sys.umask            0
#&gt; 1255                       Sys.unsetenv            0
#&gt; 1256                          Sys.which            0
#&gt; 1257                        system.file            0
#&gt; 1258                        system.time            0
#&gt; 1259                            system2            0
#&gt; 1260                       t.data.frame            0
#&gt; 1261                          t.default            0
#&gt; 1262                              table            0
#&gt; 1263                           tabulate            0
#&gt; 1264                           Tailcall            0
#&gt; 1265                                tan            0
#&gt; 1266                               tanh            0
#&gt; 1267                              tanpi            0
#&gt; 1268                             tapply            0
#&gt; 1269                taskCallbackManager            0
#&gt; 1270                         tcrossprod            0
#&gt; 1271                            tempdir            0
#&gt; 1272                           tempfile            0
#&gt; 1273                     textConnection            0
#&gt; 1274                textConnectionValue            0
#&gt; 1275                            tolower            0
#&gt; 1276                             topenv            0
#&gt; 1277                   toString.default            0
#&gt; 1278                            toupper            0
#&gt; 1279                              trace            0
#&gt; 1280                          traceback            0
#&gt; 1281                           tracemem            0
#&gt; 1282                       tracingState            0
#&gt; 1283               transform.data.frame            0
#&gt; 1284                  transform.default            0
#&gt; 1285                           trigamma            0
#&gt; 1286                             trimws            0
#&gt; 1287                         trunc.Date            0
#&gt; 1288                       trunc.POSIXt            0
#&gt; 1289                truncate.connection            0
#&gt; 1290                                try            0
#&gt; 1291                           tryCatch            0
#&gt; 1292                   tryInvokeRestart            0
#&gt; 1293                             typeof            0
#&gt; 1294                     unCfillPOSIXlt            0
#&gt; 1295                            unclass            0
#&gt; 1296                            undebug            0
#&gt; 1297                       unique.array            0
#&gt; 1298                  unique.data.frame            0
#&gt; 1299                     unique.default            0
#&gt; 1300                      unique.matrix            0
#&gt; 1301             unique.numeric_version            0
#&gt; 1302                     unique.POSIXlt            0
#&gt; 1303                    unique.warnings            0
#&gt; 1304                     units.difftime            0
#&gt; 1305                   units&lt;-.difftime            0
#&gt; 1306                          unix.time            0
#&gt; 1307                             unlink            0
#&gt; 1308                    unloadNamespace            0
#&gt; 1309                      unlockBinding            0
#&gt; 1310                             unname            0
#&gt; 1311                        unserialize            0
#&gt; 1312                            unsplit            0
#&gt; 1313                            untrace            0
#&gt; 1314                         untracemem            0
#&gt; 1315                                unz            0
#&gt; 1316                          upper.tri            0
#&gt; 1317                                use            0
#&gt; 1318                          UseMethod            0
#&gt; 1319                          utf8ToInt            0
#&gt; 1320                           validEnc            0
#&gt; 1321                          validUTF8            0
#&gt; 1322                             vapply            0
#&gt; 1323                             vector            0
#&gt; 1324                          Vectorize            0
#&gt; 1325                            warning            0
#&gt; 1326                   warningCondition            0
#&gt; 1327                           warnings            0
#&gt; 1328                      weekdays.Date            0
#&gt; 1329                    weekdays.POSIXt            0
#&gt; 1330                          which.max            0
#&gt; 1331                          which.min            0
#&gt; 1332                              while            0
#&gt; 1333                       with.default            0
#&gt; 1334                      withAutoprint            0
#&gt; 1335                withCallingHandlers            0
#&gt; 1336                  within.data.frame            0
#&gt; 1337                        within.list            0
#&gt; 1338                       withRestarts            0
#&gt; 1339                        withVisible            0
#&gt; 1340                          write.dcf            0
#&gt; 1341                           writeBin            0
#&gt; 1342                          writeChar            0
#&gt; 1343                         writeLines            0
#&gt; 1344                                xor            0
#&gt; 1345                 xpdrows.data.frame            0
#&gt; 1346                         xtfrm.AsIs            0
#&gt; 1347                   xtfrm.data.frame            0
#&gt; 1348                         xtfrm.Date            0
#&gt; 1349                      xtfrm.default            0
#&gt; 1350                     xtfrm.difftime            0
#&gt; 1351                       xtfrm.factor            0
#&gt; 1352              xtfrm.numeric_version            0
#&gt; 1353                      xtfrm.POSIXct            0
#&gt; 1354                      xtfrm.POSIXlt            0
#&gt; 1355                             xzfile            0
#&gt; 1356                           zapsmall            0</code></pre>
</div>
</div>
<p>This brute-force code unsurprisingly identifies <code>print()</code> as having the greatest number of methods. A bug in <code>s3_methods_generic()</code> prevents its use (error below).</p>
<pre><code>Error in gsub(paste0("^", generic_esc, "[.,]"), "", info$method) : 
invalid regular expression '^([.,]', reason 'Missing ')''</code></pre>
<p>AR Solutions: A little experimentation (and thinking about the most popular functions) suggests that the <code>print()</code> generic has the most defined methods.</p>
<p>Let’s verify this programmatically with the tools we have learned in this and the previous chapters.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span>(<span class="at">all.names =</span> <span class="cn">TRUE</span>, <span class="at">envir =</span> <span class="fu">baseenv</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mget</span>(<span class="at">envir =</span> <span class="fu">baseenv</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">keep</span>(is_function) <span class="sc">%&gt;%</span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">keep</span>(is_s3_generic) <span class="sc">%&gt;%</span></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span> <span class="fu">set_names</span>(<span class="fu">nrow</span>(<span class="fu">s3_methods_generic</span>(.x)), .x)) <span class="sc">%&gt;%</span></span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">flatten_int</span>() <span class="sc">%&gt;%</span></span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>(<span class="at">decreasing =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;         print        format             [       summary  as.character 
#&gt;           277           126            48            39            32 
#&gt; as.data.frame 
#&gt;            32</code></pre>
</div>
</div>
<hr>
<ol start="5" type="1">
<li>Carefully read the documentation for <code>UseMethod()</code> and explain why the following code returns the results that it does. What two usual rules of function evaluation does <code>UseMethod()</code> violate?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">UseMethod</span>(<span class="st">"g"</span>)</span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>g.default <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">c</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)</span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a><span class="fu">g</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; x y 
#&gt; 1 1</code></pre>
</div>
</div>
<p>Answer: the documentation states in <strong>Technical Details</strong>:</p>
<blockquote class="blockquote">
<p><code>UseMethod</code> creates a new function call with arguments matched as they came in to the generic. Any local variables defined before the call to <code>UseMethod</code> are retained (unlike S).</p>
</blockquote>
<p>So, <code>UseMethod()</code> creates a new function call where <code>x</code> matches <code>x &lt;- 1</code> and the local variable <code>y &lt;- 10</code> is retained. This is passed to <code>g.default()</code>. This violates both lazy evaluation and lexical scoping.</p>
<p>AR Solutions: Let’s take this step by step. If you call <code>g.default(x)</code> directly you get <code>c(1, 1)</code> as you might expect.</p>
<p>The value bound to <code>x</code> comes from the argument, the value from <code>y</code> comes from the global environment.</p>
<p>But when we call <code>g(x)</code> we get <code>c(1, 10)</code>.</p>
<p>This is seemingly inconsistent: why does <code>x</code> come from the value defined inside of <code>g()</code>, and <code>y</code> still come from the global environment? It’s because <code>UseMethod()</code> calls <code>g.default()</code> in a special way so that variables defined inside the generic are available to methods. The exception are arguments supplied to the function: they are passed on as is and cannot be affected by code inside the generic.</p>
<hr>
<ol start="6" type="1">
<li>What are the arguments to <code>[</code>? Why is this a hard question to answer?</li>
</ol>
<p>Answer: the possible arguments include the <code>x</code>, the object being extracted (or replaced), indices (<code>i</code>, <code>j</code>, <code>...</code>), <code>name</code>, <code>drop</code>, <code>exact</code>, and <code>value</code>.</p>
<p>This is a hard question to answer since <code>[</code> is an irregular primitive function that can be called in multiple ways, none of which support using all possible arguments.</p>
<p>AR Solutions: The subsetting operator <code>[</code> is a primitive and a generic function, which can be confirmed via <code>ftype()</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ftype</span>(<span class="st">`</span><span class="at">[</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "primitive" "generic"</code></pre>
</div>
</div>
<p>For primitive functions <code>formals([)</code> returns <code>NULL</code> so we need to find another way to determine the functions arguments. One possible way to figure out <code>[</code>’s arguments would be to inspect the underlying C source code, which can be searched for via <code>pryr::show_c_source(.Primitive("["))</code>. When we inspect the arguments of some of <code>[</code>’s methods, we see that the arguments vary with the class of <code>x</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(<span class="fu">formals</span>(<span class="st">`</span><span class="at">[.data.frame</span><span class="st">`</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "x"    "i"    "j"    "drop"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(<span class="fu">formals</span>(<span class="st">`</span><span class="at">[.table</span><span class="st">`</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "x"    "i"    "j"    "..."  "drop"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(<span class="fu">formals</span>(<span class="st">`</span><span class="at">[.Date</span><span class="st">`</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "x"    "..."  "drop"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(<span class="fu">formals</span>(<span class="st">`</span><span class="at">[.AsIs</span><span class="st">`</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "x"   "i"   "..."</code></pre>
</div>
</div>
<p>To finally get a better overview, we have to put in a little more effort and also use <code>s3_methods_generic()</code> again.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">s3_methods_generic</span>(<span class="st">"["</span>) <span class="sc">%&gt;%</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(visible) <span class="sc">%&gt;%</span></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="fu">paste0</span>(<span class="st">"[."</span>, class),</span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">argnames =</span> purrr<span class="sc">::</span><span class="fu">map</span>(method, <span class="sc">~</span> <span class="fu">names</span>(<span class="fu">formals</span>(.x))),</span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">args =</span> purrr<span class="sc">::</span><span class="fu">map</span>(method, <span class="sc">~</span> <span class="fu">formals</span>(.x)),</span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">args =</span> purrr<span class="sc">::</span><span class="fu">map2</span>(</span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a>      argnames, args,</span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> <span class="fu">paste</span>(.x, .y, <span class="at">sep =</span> <span class="st">" = "</span>)</span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">args =</span> purrr<span class="sc">::</span><span class="fu">set_names</span>(args, method)</span>
<span id="cb131-12"><a href="#cb131-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb131-13"><a href="#cb131-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(args) <span class="sc">%&gt;%</span></span>
<span id="cb131-14"><a href="#cb131-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; $`[.AsIs`
#&gt; [1] "x = "   "i = "   "... = "
#&gt; 
#&gt; $`[.data.frame`
#&gt; [1] "x = "                                              
#&gt; [2] "i = "                                              
#&gt; [3] "j = "                                              
#&gt; [4] "drop = if (missing(i)) TRUE else length(cols) == 1"
#&gt; 
#&gt; $`[.Date`
#&gt; [1] "x = "        "... = "      "drop = TRUE"
#&gt; 
#&gt; $`[.difftime`
#&gt; [1] "x = "        "... = "      "drop = TRUE"
#&gt; 
#&gt; $`[.Dlist`
#&gt; [1] "x = "   "i = "   "... = "
#&gt; 
#&gt; $`[.DLLInfoList`
#&gt; [1] "x = "   "... = "</code></pre>
</div>
</div>
<hr>
</section>
<section id="exercises-3" class="level3">
<h3 class="anchored" data-anchor-id="exercises-3">13.5.1 Exercises</h3>
<ol type="1">
<li>Categorise the objects returned by <code>lm()</code>, <code>factor()</code>, <code>table()</code>, <code>as.Date()</code>, <code>as.POSIXct()</code>, <code>ecdf()</code>, <code>ordered()</code>, <code>I()</code> into the styles described above.</li>
</ol>
<p>Answer:</p>
<ul>
<li><code>lm()</code>, <code>ecdf()</code>: scalar</li>
<li><code>factor()</code>, <code>as.Date()</code>, <code>as.POSIXct()</code>, <code>ordered</code>: vector</li>
<li><code>table()</code>: data frame</li>
<li><code>I()</code>: same as the source object</li>
</ul>
<p>AR Solutions: We can categorise the return values into the various object styles by observing how the <a href="https://vctrs.r-lib.org/articles/type-size.html#size">number of observations</a> is calculated: For vector style classes, <code>length(x)</code> represents the number of observations. Record style objects use a list of equal length elements to represent individual components. For data frames and matrices, the observations are represented by the rows. Scalar style objects use a list to represent a single thing.</p>
<p>This leads us to:</p>
<ul>
<li>Vector object-style: <code>factor()</code>, <code>table()</code>, <code>as.Date()</code>, <code>as.POSIXct()</code>, <code>ordered()</code></li>
<li>Record object-style: not observed</li>
<li>Data frame object-style: not observed</li>
<li>Scalar object-style: <code>lm()</code>, <code>ecdf()</code></li>
</ul>
<p>The object style of <code>I()</code> depends on the input since this function returns a “copy of the object with class <code>AsIs</code> prepended to the class(es)”.</p>
<hr>
<ol start="2" type="1">
<li>What would a constructor function for <code>lm</code> objects, <code>new_lm()</code>, look like? Use <code>?lm</code> and experimentation to figure out the required fields and their types.</li>
</ol>
<p>Answer: the only required field is <code>formula</code>, provided that the variables listed in the formula exist (and are both vectors). <code>formula</code> must be of type “<code>formula</code>”.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="ot">&lt;-</span> <span class="fu">pull</span>(mtcars, mpg)</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>wt <span class="ot">&lt;-</span> <span class="fu">pull</span>(mtcars, wt)</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(mpg <span class="sc">~</span> wt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt; Call:
#&gt; lm(formula = mpg ~ wt)
#&gt; 
#&gt; Coefficients:
#&gt; (Intercept)           wt  
#&gt;      37.285       -5.344</code></pre>
</div>
</div>
<p>AR Solutions: The constructor needs to populate the attributes of an <code>lm</code> object and check their types for correctness. Let’s start by creating a simple <code>lm</code> object and explore its underlying base type and attributes:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(cyl <span class="sc">~</span> ., <span class="at">data =</span> mtcars)</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "list"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; $names
#&gt;  [1] "coefficients"  "residuals"     "effects"       "rank"         
#&gt;  [5] "fitted.values" "assign"        "qr"            "df.residual"  
#&gt;  [9] "xlevels"       "call"          "terms"         "model"        
#&gt; 
#&gt; $class
#&gt; [1] "lm"</code></pre>
</div>
</div>
<p>As <code>mod</code> is built upon a list, we can simply use <code>map(mod, typeof)</code> to find out the base types of its elements. (Additionally, we inspect <code>?lm</code>, to learn more about the individual attributes.)</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map_chr</span>(mod, typeof)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  coefficients     residuals       effects          rank fitted.values 
#&gt;      "double"      "double"      "double"     "integer"      "double" 
#&gt;        assign            qr   df.residual       xlevels          call 
#&gt;     "integer"        "list"     "integer"        "list"    "language" 
#&gt;         terms         model 
#&gt;    "language"        "list"</code></pre>
</div>
</div>
<p>Now we should have enough information to write a constructor for new <code>lm</code> objects.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>new_lm <span class="ot">&lt;-</span> <span class="cf">function</span>(coefficients, residuals, effects, rank, fitted.values, assign,</span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>                   qr, df.residual, xlevels, call, terms, model) {</span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(</span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.double</span>(coefficients), <span class="fu">is.double</span>(residuals),</span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.double</span>(effects), <span class="fu">is.integer</span>(rank), <span class="fu">is.double</span>(fitted.values),</span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.integer</span>(assign), <span class="fu">is.list</span>(qr), <span class="fu">is.integer</span>(df.residual),</span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.list</span>(xlevels), <span class="fu">is.language</span>(call), <span class="fu">is.language</span>(terms),</span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.list</span>(model)</span>
<span id="cb141-9"><a href="#cb141-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb141-10"><a href="#cb141-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-11"><a href="#cb141-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">structure</span>(</span>
<span id="cb141-12"><a href="#cb141-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb141-13"><a href="#cb141-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">coefficients =</span> coefficients,</span>
<span id="cb141-14"><a href="#cb141-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">residuals =</span> residuals,</span>
<span id="cb141-15"><a href="#cb141-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">effects =</span> effects,</span>
<span id="cb141-16"><a href="#cb141-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">rank =</span> rank,</span>
<span id="cb141-17"><a href="#cb141-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">fitted.values =</span> fitted.values,</span>
<span id="cb141-18"><a href="#cb141-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">assign =</span> assign,</span>
<span id="cb141-19"><a href="#cb141-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">qr =</span> qr,</span>
<span id="cb141-20"><a href="#cb141-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">df.residual =</span> df.residual,</span>
<span id="cb141-21"><a href="#cb141-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlevels =</span> xlevels,</span>
<span id="cb141-22"><a href="#cb141-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">call =</span> call,</span>
<span id="cb141-23"><a href="#cb141-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">terms =</span> terms,</span>
<span id="cb141-24"><a href="#cb141-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">model =</span> model</span>
<span id="cb141-25"><a href="#cb141-25" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb141-26"><a href="#cb141-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">class =</span> <span class="st">"lm"</span></span>
<span id="cb141-27"><a href="#cb141-27" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb141-28"><a href="#cb141-28" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="exercises-4" class="level3">
<h3 class="anchored" data-anchor-id="exercises-4">13.6.3 Exercises</h3>
<ol type="1">
<li>How does <code>[.Date</code> support subclasses? How does it fail to support subclasses?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">[.Date</span><span class="st">`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; function (x, ..., drop = TRUE) 
#&gt; {
#&gt;     .Date(NextMethod("["), oldClass(x))
#&gt; }
#&gt; &lt;bytecode: 0x148a1e7f8&gt;
#&gt; &lt;environment: namespace:base&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">.Date</span><span class="st">`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; function (xx, cl = "Date") 
#&gt; `class&lt;-`(xx, cl)
#&gt; &lt;bytecode: 0x11937a7f0&gt;
#&gt; &lt;environment: namespace:base&gt;</code></pre>
</div>
</div>
<p>Answer: by passing the object’s class to <code>.Date</code>, <code>[.Date</code> avoids the problem of <code>[.secret</code> and can return subclasses of <code>Date</code>. However, the <code>.Date</code> method can return objects that don’t contain the class <code>Date</code>.</p>
<p>AR Solutions: <code>[.Date</code> calls <code>.Date</code> with the result of calling <code>[</code> on the parent class, along with <code>oldClass()</code>:</p>
<p><code>.Date</code> is kind of like a constructor for date classes, although it doesn’t check the input is the correct type:</p>
<p><code>oldClass()</code> is basically the same as <code>class()</code>, except that it doesn’t return implicit classes, i.e.&nbsp;it’s basically <code>attr(x, "class")</code> (looking at the C code that’s exactly what it does, except that it also handles S4 objects).</p>
<p>As <code>oldClass()</code> is “basically” <code>class()</code>, we can rewrite <code>[.Date</code> to make the implementation more clear:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">[.Date</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ..., <span class="at">drop =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">NextMethod</span>(<span class="st">"["</span>)</span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(out) <span class="ot">&lt;-</span> <span class="fu">class</span>(x)</span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a>  out</span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So, <code>[.Date</code> ensures that the output has the same class as in the input. But what about other attributes that a subclass might possess? They get lost:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">structure</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">test =</span> <span class="st">"test"</span>, <span class="at">class =</span> <span class="fu">c</span>(<span class="st">"myDate"</span>, <span class="st">"Date"</span>))</span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(x[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; $class
#&gt; [1] "myDate" "Date"</code></pre>
</div>
</div>
<p>Note: this is a better explanation of how it fails to support subclasses; it drops non-class attributes.</p>
<hr>
<ol start="2" type="1">
<li>R has two classes for representing date time data, <code>POSIXct</code> and <code>POSIXlt</code>, which both inherit from <code>POSIXt</code>. Which generics have different behaviours for the two classes? Which generics share the same behaviour?</li>
</ol>
<p>Answer: if a generic is defined for either class, it must have different behaviors. Generics that aren’t defined for either class must have the same behavior. We can get the list of generics defined for either class using <code>sloop::s3_methods_class()</code>. These generics have different behaviors for the two classes:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>ct_generics <span class="ot">&lt;-</span> <span class="fu">s3_methods_class</span>(<span class="st">"POSIXct"</span>)<span class="sc">$</span>generic</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>lt_generics <span class="ot">&lt;-</span> <span class="fu">s3_methods_class</span>(<span class="st">"POSIXlt"</span>)<span class="sc">$</span>generic</span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>defined_generics <span class="ot">&lt;-</span> <span class="fu">union</span>(ct_generics, lt_generics)</span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>defined_generics</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  [1] "["             "[["            "[&lt;-"           "as.data.frame"
#&gt;  [5] "as.Date"       "as.list"       "as.POSIXlt"    "c"            
#&gt;  [9] "format"        "length&lt;-"      "mean"          "mtfrm"        
#&gt; [13] "print"         "range"         "rep"           "split"        
#&gt; [17] "summary"       "Summary"       "weighted.mean" "xtfrm"        
#&gt; [21] "[[&lt;-"          "$&lt;-"           "anyNA"         "as.double"    
#&gt; [25] "as.matrix"     "as.POSIXct"    "as.vector"     "duplicated"   
#&gt; [29] "is.finite"     "is.infinite"   "is.na"         "is.nan"       
#&gt; [33] "length"        "names"         "names&lt;-"       "sort"         
#&gt; [37] "unique"</code></pre>
</div>
</div>
<p>We adapt work from previous exercises to get the list of all generics, and identify S3 generics that aren’t defined for either class, which must have the same behavior:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>s3_generic_funs <span class="ot">&lt;-</span> <span class="fu">Filter</span>(is_s3_generic, <span class="fu">names</span>(funs))</span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a><span class="fu">union</span>(<span class="fu">setdiff</span>(defined_generics, s3_generic_funs), <span class="fu">setdiff</span>(s3_generic_funs, defined_generics))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;   [1] "Summary"                  "weighted.mean"           
#&gt;   [3] "-"                        "!="                      
#&gt;   [5] "*"                        "/"                       
#&gt;   [7] "&amp;"                        "%/%"                     
#&gt;   [9] "%%"                       "^"                       
#&gt;  [11] "+"                        "&lt;"                       
#&gt;  [13] "&lt;="                       "=="                      
#&gt;  [15] "&gt;"                        "&gt;="                      
#&gt;  [17] "|"                        "$"                       
#&gt;  [19] "abs"                      "acos"                    
#&gt;  [21] "acosh"                    "all"                     
#&gt;  [23] "all.equal"                "any"                     
#&gt;  [25] "anyDuplicated"            "aperm"                   
#&gt;  [27] "Arg"                      "as.array"                
#&gt;  [29] "as.call"                  "as.character"            
#&gt;  [31] "as.complex"               "as.environment"          
#&gt;  [33] "as.expression"            "as.function"             
#&gt;  [35] "as.integer"               "as.logical"              
#&gt;  [37] "as.null"                  "as.numeric"              
#&gt;  [39] "as.raw"                   "as.single"               
#&gt;  [41] "as.table"                 "asin"                    
#&gt;  [43] "asinh"                    "atan"                    
#&gt;  [45] "atanh"                    "by"                      
#&gt;  [47] "cbind"                    "ceiling"                 
#&gt;  [49] "chol"                     "chooseOpsMethod"         
#&gt;  [51] "close"                    "conditionCall"           
#&gt;  [53] "conditionMessage"         "Conj"                    
#&gt;  [55] "cos"                      "cosh"                    
#&gt;  [57] "cospi"                    "cummax"                  
#&gt;  [59] "cummin"                   "cumprod"                 
#&gt;  [61] "cumsum"                   "cut"                     
#&gt;  [63] "determinant"              "diff"                    
#&gt;  [65] "digamma"                  "dim"                     
#&gt;  [67] "dim&lt;-"                    "dimnames"                
#&gt;  [69] "dimnames&lt;-"               "droplevels"              
#&gt;  [71] "exp"                      "expm1"                   
#&gt;  [73] "floor"                    "flush"                   
#&gt;  [75] "gamma"                    "getDLLRegisteredRoutines"
#&gt;  [77] "Im"                       "is.array"                
#&gt;  [79] "is.matrix"                "is.na&lt;-"                 
#&gt;  [81] "is.numeric"               "isSymmetric"             
#&gt;  [83] "julian"                   "kappa"                   
#&gt;  [85] "labels"                   "levels"                  
#&gt;  [87] "levels&lt;-"                 "lgamma"                  
#&gt;  [89] "log"                      "log10"                   
#&gt;  [91] "log1p"                    "log2"                    
#&gt;  [93] "max"                      "merge"                   
#&gt;  [95] "min"                      "Mod"                     
#&gt;  [97] "months"                   "nameOfClass"             
#&gt;  [99] "open"                     "plot"                    
#&gt; [101] "pretty"                   "prod"                    
#&gt; [103] "qr"                       "quarters"                
#&gt; [105] "rbind"                    "Re"                      
#&gt; [107] "rev"                      "round"                   
#&gt; [109] "row.names"                "row.names&lt;-"             
#&gt; [111] "rowsum"                   "scale"                   
#&gt; [113] "seek"                     "seq"                     
#&gt; [115] "seq.int"                  "sequence"                
#&gt; [117] "sign"                     "signif"                  
#&gt; [119] "sin"                      "sinh"                    
#&gt; [121] "sinpi"                    "solve"                   
#&gt; [123] "sort_by"                  "split&lt;-"                 
#&gt; [125] "sqrt"                     "subset"                  
#&gt; [127] "sum"                      "t"                       
#&gt; [129] "tan"                      "tanh"                    
#&gt; [131] "tanpi"                    "toString"                
#&gt; [133] "transform"                "trigamma"                
#&gt; [135] "trunc"                    "truncate"                
#&gt; [137] "units"                    "units&lt;-"                 
#&gt; [139] "unlist"                   "weekdays"                
#&gt; [141] "with"                     "within"</code></pre>
</div>
</div>
<p>Note: this code doesn’t quite work, since <code>Summary</code> is a generic according to <code>isGeneric</code> and is not according to <code>is_s3_generic</code>, and <code>weighted.mean</code> is a non-base S3 generic.</p>
<p>AR Solutions: To answer this question, we have to get the respective generics</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>generics_t <span class="ot">&lt;-</span> <span class="fu">s3_methods_class</span>(<span class="st">"POSIXt"</span>)<span class="sc">$</span>generic</span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>generics_ct <span class="ot">&lt;-</span> <span class="fu">s3_methods_class</span>(<span class="st">"POSIXct"</span>)<span class="sc">$</span>generic</span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>generics_lt <span class="ot">&lt;-</span> <span class="fu">s3_methods_class</span>(<span class="st">"POSIXlt"</span>)<span class="sc">$</span>generic</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The generics in <code>generics_t</code> with a method for the superclass <code>POSIXt</code> potentially share the same behaviour for both subclasses. However, if a generic has a specific method for one of the subclasses, it has to be subtracted:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="co"># These generics provide subclass-specific methods</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="fu">union</span>(generics_ct, generics_lt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  [1] "["             "[["            "[&lt;-"           "as.data.frame"
#&gt;  [5] "as.Date"       "as.list"       "as.POSIXlt"    "c"            
#&gt;  [9] "format"        "length&lt;-"      "mean"          "mtfrm"        
#&gt; [13] "print"         "range"         "rep"           "split"        
#&gt; [17] "summary"       "Summary"       "weighted.mean" "xtfrm"        
#&gt; [21] "[[&lt;-"          "$&lt;-"           "anyNA"         "as.double"    
#&gt; [25] "as.matrix"     "as.POSIXct"    "as.vector"     "duplicated"   
#&gt; [29] "is.finite"     "is.infinite"   "is.na"         "is.nan"       
#&gt; [33] "length"        "names"         "names&lt;-"       "sort"         
#&gt; [37] "unique"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="co"># These generics share (inherited) methods for both subclasses</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setdiff</span>(generics_t, <span class="fu">union</span>(generics_ct, generics_lt))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  [1] "-"            "+"            "all.equal"    "as.character" "Axis"        
#&gt;  [6] "cut"          "diff"         "hist"         "is.numeric"   "julian"      
#&gt; [11] "Math"         "months"       "Ops"          "pretty"       "quantile"    
#&gt; [16] "quarters"     "round"        "seq"          "str"          "trunc"       
#&gt; [21] "weekdays"</code></pre>
</div>
</div>
<p>Note: again, advanced R gives a better answer to this question, by comparing to the generics supported by the parent class.</p>
<hr>
<ol start="3" type="1">
<li>What do you expect this code to return? What does it actually return? Why?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>generic2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">UseMethod</span>(<span class="st">"generic2"</span>)</span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>generic2.a1 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="st">"a1"</span></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>generic2.a2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="st">"a2"</span></span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>generic2.b <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(x) <span class="ot">&lt;-</span> <span class="st">"a1"</span></span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">NextMethod</span>()</span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a><span class="fu">generic2</span>(<span class="fu">structure</span>(<span class="fu">list</span>(), <span class="at">class =</span> <span class="fu">c</span>(<span class="st">"b"</span>, <span class="st">"a2"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "a2"</code></pre>
</div>
</div>
<p>Answer: I’d expect this code to return <code>"a2"</code> with a class of <code>c("a1", "a2")</code>. It actually returns “a2” with a class of <code>character</code>. This is because when <code>generic2.b</code> calls <code>NextMethod()</code>, <code>generic2.a2</code> is called which returns a bare <code>"a2"</code>, dropping the class assigned by <code>generic2.b</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(<span class="fu">generic2</span>(<span class="fu">structure</span>(<span class="fu">list</span>(), <span class="at">class =</span> <span class="fu">c</span>(<span class="st">"b"</span>, <span class="st">"a2"</span>))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "character"</code></pre>
</div>
</div>
<p>AR Solutions: When we execute the code above, this is what is happening:</p>
<ul>
<li><p>we pass an object of classes <code>b</code> and <code>a2</code> to <code>generic2()</code>, which prompts R to look for a method<code>generic2.b()</code></p></li>
<li><p>the method <code>generic2.b()</code> then changes the class to <code>a1</code> and calls <code>NextMethod()</code></p></li>
<li><p>One would think that this will lead R to call <code>generic2.a1()</code>, but in fact, as mentioned in <em>Advanced R</em>, <code>NextMethod()</code> &gt; doesn’t actually work with the class attribute of the object, but instead uses a special global variable (.Class) to keep track of which method to call next.</p>
<p>This is why <code>generic2.a2()</code> is called instead.</p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generic2</span>(<span class="fu">structure</span>(<span class="fu">list</span>(), <span class="at">class =</span> <span class="fu">c</span>(<span class="st">"b"</span>, <span class="st">"a2"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "a2"</code></pre>
</div>
</div>
<p>Let’s just double check the statement above and evaluate <code>.Class</code> explicitly within the <code>generic2.b()</code> method.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>generic2.b <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(x) <span class="ot">&lt;-</span> <span class="st">"a1"</span></span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(.Class)</span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">NextMethod</span>()</span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-7"><a href="#cb164-7" aria-hidden="true" tabindex="-1"></a><span class="fu">generic2</span>(<span class="fu">structure</span>(<span class="fu">list</span>(), <span class="at">class =</span> <span class="fu">c</span>(<span class="st">"b"</span>, <span class="st">"a2"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "b"  "a2"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "a2"</code></pre>
</div>
</div>
<hr>
</section>
<section id="exercises-5" class="level3">
<h3 class="anchored" data-anchor-id="exercises-5">13.7.5 Exercises</h3>
<ol type="1">
<li>Explain the differences in dispatch below:</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>length.integer <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="dv">10</span></span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span></span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(x1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "integer"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">s3_dispatch</span>(<span class="fu">length</span>(x1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  * length.integer
#&gt;    length.numeric
#&gt;    length.default
#&gt; =&gt; length (internal)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">structure</span>(x1, <span class="at">class =</span> <span class="st">"integer"</span>)</span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(x2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "integer"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="fu">s3_dispatch</span>(<span class="fu">length</span>(x2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; =&gt; length.integer
#&gt;    length.default
#&gt;  * length (internal)</code></pre>
</div>
</div>
<p>Answer: <code>x1</code> dispatches using implicit class, which is <code>c("integer", "numeric")</code>. <code>x2</code> has an explicit class, so it is dispatched to <code>length.integer</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="fu">s3_class</span>(x1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "integer" "numeric"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="fu">s3_class</span>(x2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "integer"</code></pre>
</div>
</div>
<p>AR Solutions: <code>class()</code> returns <code>integer</code> in both cases. However, while the class of <code>x1</code> is created implicitly and inherits from the <code>numeric</code> class, the class of <code>x2</code> is set explicitly. This is important because <code>length()</code> is an internal generic and internal generics only dispatch to methods when the class attribute has been set, i.e.&nbsp;internal generics do not use implicit classes.</p>
<p>An object has no explicit class if <code>attr(x, "class")</code> returns <code>NULL</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(x1, <span class="st">"class"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; NULL</code></pre>
</div>
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(x2, <span class="st">"class"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "integer"</code></pre>
</div>
</div>
<p>To see the relevant classes for the S3 dispatch, one can use <code>sloop::s3_class()</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="fu">s3_class</span>(x1) <span class="co"># implicit</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "integer" "numeric"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">s3_class</span>(x2) <span class="co"># explicit</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "integer"</code></pre>
</div>
</div>
<p>For a better understanding of <code>s3_dipatch()</code>’s output we quote from <code>?s3_dispatch</code>: - =&gt; method exists and is found by <code>UseMethod()</code>. - -&gt; method exists and is used by <code>NextMethod()</code>. - * method exists but is not used. - Nothing (and greyed out in console): method does not exist.</p>
<p>Note: AR Solutions includes an additional important detail, that “internal generics only dispatch to methods when the class attribute has been set”, which explains why the internal generic is used for <code>x1</code>.</p>
<hr>
<ol start="2" type="1">
<li>What classes have a method for the <code>Math</code> group generic in base R? Read the source code. How do the methods work?</li>
</ol>
<p>Answer: four base classes have a method for <code>Math</code>: <code>data.frame</code>, <code>Date</code>, <code>difftime</code>, <code>factor</code>, and <code>POSIXt</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="fu">s3_methods_generic</span>(<span class="st">"Math"</span>) <span class="sc">|&gt;</span></span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(source <span class="sc">==</span> <span class="st">"base"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 5 × 4
#&gt;   generic class      visible source
#&gt;   &lt;chr&gt;   &lt;chr&gt;      &lt;lgl&gt;   &lt;chr&gt; 
#&gt; 1 Math    data.frame TRUE    base  
#&gt; 2 Math    Date       TRUE    base  
#&gt; 3 Math    difftime   TRUE    base  
#&gt; 4 Math    factor     TRUE    base  
#&gt; 5 Math    POSIXt     TRUE    base</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>Math.data.frame</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; function (x, ...) 
#&gt; {
#&gt;     mode.ok &lt;- vapply(x, function(x) is.numeric(x) || is.logical(x) || 
#&gt;         is.complex(x), NA)
#&gt;     if (all(mode.ok)) {
#&gt;         x[] &lt;- lapply(X = x, FUN = .Generic, ...)
#&gt;         return(x)
#&gt;     }
#&gt;     else {
#&gt;         vnames &lt;- names(x)
#&gt;         if (is.null(vnames)) 
#&gt;             vnames &lt;- seq_along(x)
#&gt;         stop("non-numeric-alike variable(s) in data frame: ", 
#&gt;             paste(vnames[!mode.ok], collapse = ", "))
#&gt;     }
#&gt; }
#&gt; &lt;bytecode: 0x13828fc98&gt;
#&gt; &lt;environment: namespace:base&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>Math.Date</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; function (x, ...) 
#&gt; stop(gettextf("%s not defined for \"Date\" objects", .Generic), 
#&gt;     domain = NA)
#&gt; &lt;bytecode: 0x138296df8&gt;
#&gt; &lt;environment: namespace:base&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a>Math.difftime</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; function (x, ...) 
#&gt; {
#&gt;     switch(.Generic, abs = , sign = , floor = , ceiling = , trunc = , 
#&gt;         round = , signif = {
#&gt;             units &lt;- attr(x, "units")
#&gt;             .difftime(NextMethod(), units)
#&gt;         }, stop(gettextf("'%s' not defined for \"difftime\" objects", 
#&gt;             .Generic), domain = NA))
#&gt; }
#&gt; &lt;bytecode: 0x13829e8c0&gt;
#&gt; &lt;environment: namespace:base&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>Math.factor</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; function (x, ...) 
#&gt; stop(gettextf("%s not meaningful for factors", sQuote(.Generic)))
#&gt; &lt;bytecode: 0x13829d7b0&gt;
#&gt; &lt;environment: namespace:base&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a>Math.POSIXt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; function (x, ...) 
#&gt; {
#&gt;     stop(gettextf("'%s' not defined for \"POSIXt\" objects", 
#&gt;         .Generic), domain = NA)
#&gt; }
#&gt; &lt;bytecode: 0x1382a2fd0&gt;
#&gt; &lt;environment: namespace:base&gt;</code></pre>
</div>
</div>
<ul>
<li><code>Math.data.frame</code> performs math if all columns (variables) are either numeric, logical or complex, and errors if any are not</li>
<li><code>Math.difftime</code> performs only certain math functions: <code>abs</code>, <code>sign</code>, <code>floor</code>, <code>ceiling</code>, <code>trunc</code>, <code>round</code>, and <code>signif</code>, and errors for other functions</li>
<li><code>Math.Date</code>, <code>Math.factor</code>, and <code>Math.POSIXt</code> always error</li>
</ul>
<p>AR Solutions: : The following functions belong to this group (see ?<code>Math</code>):</p>
<ul>
<li><code>abs</code>, <code>sign</code>, <code>sqrt</code>, <code>floor</code>, <code>ceiling</code>, <code>trunc</code>, <code>round</code>, <code>signif</code></li>
<li><code>exp</code>, <code>log</code>, <code>expm1</code>, <code>log1p</code>, <code>cos</code>, <code>sin</code>, <code>tan</code>, <code>cospi</code>, <code>sinpi</code>, <code>tanpi</code>, <code>acos</code>, <code>asin</code>, <code>atan</code>, <code>cosh</code>, <code>sinh</code>, <code>tanh</code>, <code>acosh</code>, <code>asinh</code>, <code>atanh</code></li>
<li><code>lgamma</code>, <code>gamma</code>, <code>digamma</code>, <code>trigamma</code></li>
<li><code>cumsum</code>, <code>cumprod</code>, <code>cummax</code>, <code>cummin</code></li>
</ul>
<p>The following classes have a method for this group generic:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="fu">s3_methods_generic</span>(<span class="st">"Math"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 8 × 4
#&gt;   generic class      visible source             
#&gt;   &lt;chr&gt;   &lt;chr&gt;      &lt;lgl&gt;   &lt;chr&gt;              
#&gt; 1 Math    data.frame TRUE    base               
#&gt; 2 Math    Date       TRUE    base               
#&gt; 3 Math    difftime   TRUE    base               
#&gt; 4 Math    factor     TRUE    base               
#&gt; 5 Math    POSIXt     TRUE    base               
#&gt; 6 Math    quosure    FALSE   registered S3method
#&gt; 7 Math    vctrs_sclr FALSE   registered S3method
#&gt; 8 Math    vctrs_vctr FALSE   registered S3method</code></pre>
</div>
</div>
<p>To explain the basic idea, we just overwrite the data frame method:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a>Math.data.frame <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="st">"hello"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now all functions from the math generic group, will return <code>"hello"</code></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="fu">abs</span>(mtcars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "hello"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(mtcars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "hello"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lgamma</span>(mtcars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "hello"</code></pre>
</div>
</div>
<p>Of course, different functions should perform different calculations. Here <code>.Generic</code> comes into play, which provides us with the calling generic as a string</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a>Math.data.frame <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ...) {</span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a>  .Generic</span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb208-4"><a href="#cb208-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abs</span>(mtcars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "abs"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(mtcars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "exp"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lgamma</span>(mtcars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "lgamma"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(Math.data.frame)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The original source code of <code>Math.data.frame()</code> is a good example on how to invoke the string returned by <code>.Generic</code> into a specific method. <code>Math.factor()</code> is a good example of a method, which is simply defined for better error messages.</p>
<p>Note: I prefer my answer to the AR Solutions answer.</p>
<hr>
<ol start="3" type="1">
<li><code>Math.difftime()</code> is more complicated than I described. Why?</li>
</ol>
<p>Answer: the explanation in the text omits the fact that <code>Math.difftime()</code> first checks that the math function being called.</p>
<p>AR Solutions: <code>Math.difftime()</code> also excludes cases apart from <code>abs</code>, <code>sign</code>, <code>floor</code>, <code>ceiling</code>, <code>trunc</code>, <code>round</code> and <code>signif</code> and needs to return a fitting error message.</p>
<hr>
</section>
</section>
<section id="r6" class="level2">
<h2 class="anchored" data-anchor-id="r6">14 R6</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This chapter describes the R6 OOP system. R6 has two special properties:</p>
<ul>
<li><p>It uses the encapsulated OOP paradigm, which means that methods belong to objects, not generics, and you call them like <code>object$method()</code>.</p></li>
<li><p>R6 objects are <strong>mutable</strong>, which means that they are modified in place, and hence have reference semantics.</p></li>
</ul>
<p>If you’ve learned OOP in another programming language, it’s likely that R6 will feel very natural, and you’ll be inclined to prefer it over S3. Resist the temptation to follow the path of least resistance: in most cases R6 will lead you to non-idiomatic R code. We’ll come back to this theme in Section 16.3.</p>
<p>R6 is very similar to a base OOP system called <strong>reference classes</strong>, or RC for short. I describe why I teach R6 and not RC in Section 14.5.</p>
<section id="exercises-6" class="level3">
<h3 class="anchored" data-anchor-id="exercises-6">14.2.6 Exercises</h3>
<ol type="1">
<li>Create a bank account R6 class that stores a balance and allows you to deposit and withdraw money. Create a subclass that throws an error if you attempt to go into overdraft. Create another subclass that allows you to go into overdraft, but charges you a fee.</li>
</ol>
<p>Answer: <code>Account</code> stores a balance as an integer value of cents, and prints in dollars (to avoid problems with floating point math).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a>Account <span class="ot">&lt;-</span> <span class="fu">R6Class</span>(<span class="st">"Account"</span>, <span class="fu">list</span>(</span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">balance =</span> <span class="dv">0</span>L,</span>
<span id="cb216-3"><a href="#cb216-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">initialize =</span> <span class="cf">function</span>(<span class="at">balance =</span> <span class="dv">0</span>L) {</span>
<span id="cb216-4"><a href="#cb216-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(balance), <span class="fu">length</span>(balance) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb216-5"><a href="#cb216-5" aria-hidden="true" tabindex="-1"></a>    self<span class="sc">$</span>balance <span class="ot">&lt;-</span> balance</span>
<span id="cb216-6"><a href="#cb216-6" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb216-7"><a href="#cb216-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">print =</span> <span class="cf">function</span>(...) {</span>
<span id="cb216-8"><a href="#cb216-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Account: </span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb216-9"><a href="#cb216-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"  Balance: $"</span>, <span class="fu">format</span>(self<span class="sc">$</span>balance <span class="sc">/</span> <span class="dv">100</span>, <span class="at">nsmall =</span> <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb216-10"><a href="#cb216-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">invisible</span>(self)</span>
<span id="cb216-11"><a href="#cb216-11" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb216-12"><a href="#cb216-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">deposit =</span> <span class="cf">function</span>(value) {</span>
<span id="cb216-13"><a href="#cb216-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(value), <span class="fu">length</span>(value) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb216-14"><a href="#cb216-14" aria-hidden="true" tabindex="-1"></a>    self<span class="sc">$</span>balance <span class="ot">&lt;-</span> self<span class="sc">$</span>balance <span class="sc">+</span> value</span>
<span id="cb216-15"><a href="#cb216-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">invisible</span>(self)</span>
<span id="cb216-16"><a href="#cb216-16" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb216-17"><a href="#cb216-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">withdraw =</span> <span class="cf">function</span>(value) {</span>
<span id="cb216-18"><a href="#cb216-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(value), <span class="fu">length</span>(value) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb216-19"><a href="#cb216-19" aria-hidden="true" tabindex="-1"></a>    self<span class="sc">$</span>balance <span class="ot">&lt;-</span> self<span class="sc">$</span>balance <span class="sc">-</span> value</span>
<span id="cb216-20"><a href="#cb216-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">invisible</span>(self)</span>
<span id="cb216-21"><a href="#cb216-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb216-22"><a href="#cb216-22" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb216-23"><a href="#cb216-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-24"><a href="#cb216-24" aria-hidden="true" tabindex="-1"></a>AccountOverdraft <span class="ot">&lt;-</span> <span class="fu">R6Class</span>(<span class="st">"AccountOverdraft"</span>,</span>
<span id="cb216-25"><a href="#cb216-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">inherit =</span> Account,</span>
<span id="cb216-26"><a href="#cb216-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">public =</span> <span class="fu">list</span>(</span>
<span id="cb216-27"><a href="#cb216-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">withdraw =</span> <span class="cf">function</span>(value) {</span>
<span id="cb216-28"><a href="#cb216-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stopifnot</span>(value <span class="sc">&lt;=</span> self<span class="sc">$</span>balance)</span>
<span id="cb216-29"><a href="#cb216-29" aria-hidden="true" tabindex="-1"></a>      super<span class="sc">$</span><span class="fu">withdraw</span>(value)</span>
<span id="cb216-30"><a href="#cb216-30" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb216-31"><a href="#cb216-31" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb216-32"><a href="#cb216-32" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb216-33"><a href="#cb216-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-34"><a href="#cb216-34" aria-hidden="true" tabindex="-1"></a>AccountOverdraftFee <span class="ot">&lt;-</span> <span class="fu">R6Class</span>(<span class="st">"AccountOverdraftFee"</span>,</span>
<span id="cb216-35"><a href="#cb216-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">inherit =</span> Account,</span>
<span id="cb216-36"><a href="#cb216-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">public =</span> <span class="fu">list</span>(</span>
<span id="cb216-37"><a href="#cb216-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">withdraw =</span> <span class="cf">function</span>(value) {</span>
<span id="cb216-38"><a href="#cb216-38" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (value <span class="sc">&gt;</span> self<span class="sc">$</span>balance) value <span class="ot">&lt;-</span> value <span class="sc">+</span> <span class="dv">500</span>L</span>
<span id="cb216-39"><a href="#cb216-39" aria-hidden="true" tabindex="-1"></a>      super<span class="sc">$</span><span class="fu">withdraw</span>(value)</span>
<span id="cb216-40"><a href="#cb216-40" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb216-41"><a href="#cb216-41" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb216-42"><a href="#cb216-42" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb216-43"><a href="#cb216-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-44"><a href="#cb216-44" aria-hidden="true" tabindex="-1"></a><span class="fu">try</span>(Account<span class="sc">$</span><span class="fu">new</span>(<span class="fl">1.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Error in initialize(...) : is.integer(balance) is not TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> Account<span class="sc">$</span><span class="fu">new</span>(<span class="dv">100</span>L)</span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a>a<span class="sc">$</span><span class="fu">deposit</span>(<span class="dv">100</span>L)</span>
<span id="cb218-3"><a href="#cb218-3" aria-hidden="true" tabindex="-1"></a>a<span class="sc">$</span><span class="fu">withdraw</span>(<span class="dv">250</span>L)</span>
<span id="cb218-4"><a href="#cb218-4" aria-hidden="true" tabindex="-1"></a>a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Account: 
#&gt;   Balance: $-0.50</code></pre>
</div>
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a>a2 <span class="ot">&lt;-</span> AccountOverdraft<span class="sc">$</span><span class="fu">new</span>(<span class="dv">200</span>L)</span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a><span class="fu">try</span>(a2<span class="sc">$</span><span class="fu">withdraw</span>(<span class="dv">250</span>L))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Error in a2$withdraw(250L) : value &lt;= self$balance is not TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a>a2<span class="sc">$</span><span class="fu">withdraw</span>(<span class="dv">150</span>L)</span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a>a2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Account: 
#&gt;   Balance: $0.50</code></pre>
</div>
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a>a3 <span class="ot">&lt;-</span> AccountOverdraftFee<span class="sc">$</span><span class="fu">new</span>(<span class="dv">200</span>L)</span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a>a3<span class="sc">$</span><span class="fu">withdraw</span>(<span class="dv">250</span>L)</span>
<span id="cb224-3"><a href="#cb224-3" aria-hidden="true" tabindex="-1"></a>a3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Account: 
#&gt;   Balance: $-5.50</code></pre>
</div>
</div>
<p>AR Solutions: <code>BankAccount</code> is a similar, simpler approach:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb226"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a>BankAccount <span class="ot">&lt;-</span> <span class="fu">R6Class</span>(</span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">classname =</span> <span class="st">"BankAccount"</span>,</span>
<span id="cb226-3"><a href="#cb226-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">public =</span> <span class="fu">list</span>(</span>
<span id="cb226-4"><a href="#cb226-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">balance =</span> <span class="dv">0</span>,</span>
<span id="cb226-5"><a href="#cb226-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">deposit =</span> <span class="cf">function</span>(<span class="at">dep =</span> <span class="dv">0</span>) {</span>
<span id="cb226-6"><a href="#cb226-6" aria-hidden="true" tabindex="-1"></a>      self<span class="sc">$</span>balance <span class="ot">&lt;-</span> self<span class="sc">$</span>balance <span class="sc">+</span> dep</span>
<span id="cb226-7"><a href="#cb226-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">invisible</span>(self)</span>
<span id="cb226-8"><a href="#cb226-8" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb226-9"><a href="#cb226-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">withdraw =</span> <span class="cf">function</span>(draw) {</span>
<span id="cb226-10"><a href="#cb226-10" aria-hidden="true" tabindex="-1"></a>      self<span class="sc">$</span>balance <span class="ot">&lt;-</span> self<span class="sc">$</span>balance <span class="sc">-</span> draw</span>
<span id="cb226-11"><a href="#cb226-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">invisible</span>(self)</span>
<span id="cb226-12"><a href="#cb226-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb226-13"><a href="#cb226-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb226-14"><a href="#cb226-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb226-15"><a href="#cb226-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-16"><a href="#cb226-16" aria-hidden="true" tabindex="-1"></a>BankAccountStrict <span class="ot">&lt;-</span> <span class="fu">R6Class</span>(</span>
<span id="cb226-17"><a href="#cb226-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">classname =</span> <span class="st">"BankAccountStrict"</span>,</span>
<span id="cb226-18"><a href="#cb226-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">inherit =</span> BankAccount,</span>
<span id="cb226-19"><a href="#cb226-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">public =</span> <span class="fu">list</span>(</span>
<span id="cb226-20"><a href="#cb226-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">withdraw =</span> <span class="cf">function</span>(<span class="at">draw =</span> <span class="dv">0</span>) {</span>
<span id="cb226-21"><a href="#cb226-21" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (self<span class="sc">$</span>balance <span class="sc">-</span> draw <span class="sc">&lt;</span> <span class="dv">0</span>) {</span>
<span id="cb226-22"><a href="#cb226-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"Your `withdraw` must be smaller "</span>,</span>
<span id="cb226-23"><a href="#cb226-23" aria-hidden="true" tabindex="-1"></a>          <span class="st">"than your `balance`."</span>,</span>
<span id="cb226-24"><a href="#cb226-24" aria-hidden="true" tabindex="-1"></a>          <span class="at">call. =</span> <span class="cn">FALSE</span></span>
<span id="cb226-25"><a href="#cb226-25" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb226-26"><a href="#cb226-26" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb226-27"><a href="#cb226-27" aria-hidden="true" tabindex="-1"></a>      super<span class="sc">$</span><span class="fu">withdraw</span>(<span class="at">draw =</span> draw)</span>
<span id="cb226-28"><a href="#cb226-28" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb226-29"><a href="#cb226-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb226-30"><a href="#cb226-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb226-31"><a href="#cb226-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-32"><a href="#cb226-32" aria-hidden="true" tabindex="-1"></a>BankAccountCharging <span class="ot">&lt;-</span> <span class="fu">R6Class</span>(</span>
<span id="cb226-33"><a href="#cb226-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">classname =</span> <span class="st">"BankAccountCharging"</span>,</span>
<span id="cb226-34"><a href="#cb226-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">inherit =</span> BankAccount,</span>
<span id="cb226-35"><a href="#cb226-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">public =</span> <span class="fu">list</span>(</span>
<span id="cb226-36"><a href="#cb226-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">withdraw =</span> <span class="cf">function</span>(<span class="at">draw =</span> <span class="dv">0</span>) {</span>
<span id="cb226-37"><a href="#cb226-37" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (self<span class="sc">$</span>balance <span class="sc">-</span> draw <span class="sc">&lt;</span> <span class="dv">0</span>) {</span>
<span id="cb226-38"><a href="#cb226-38" aria-hidden="true" tabindex="-1"></a>        draw <span class="ot">&lt;-</span> draw <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb226-39"><a href="#cb226-39" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb226-40"><a href="#cb226-40" aria-hidden="true" tabindex="-1"></a>      super<span class="sc">$</span><span class="fu">withdraw</span>(<span class="at">draw =</span> draw)</span>
<span id="cb226-41"><a href="#cb226-41" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb226-42"><a href="#cb226-42" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb226-43"><a href="#cb226-43" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note: my object name, <code>AccountOverdraftFee</code> is misleading, since it is not a subclass of <code>AccountOverdraft</code> - the R Solutions naming convention is clearer.</p>
<hr>
<ol start="2" type="1">
<li>Create an R6 class that represents a shuffled deck of cards. You should be able to draw cards from the deck with <code>$draw(n)</code>, and return all cards to the deck and reshuffle with <code>$reshuffle()</code>. Use the following code to make a vector of cards.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a>suit <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"♠"</span>, <span class="st">"♥"</span>, <span class="st">"♦"</span>, <span class="st">"♣"</span>)</span>
<span id="cb227-2"><a href="#cb227-2" aria-hidden="true" tabindex="-1"></a>value <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">10</span>, <span class="st">"J"</span>, <span class="st">"Q"</span>, <span class="st">"K"</span>)</span>
<span id="cb227-3"><a href="#cb227-3" aria-hidden="true" tabindex="-1"></a>cards <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">rep</span>(value, <span class="dv">4</span>), suit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Answer: <code>Cards</code> shuffles the deck using <code>sample()</code>. The <code>draw()</code> function prints the cards drawn and moves them into play.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a>Cards <span class="ot">&lt;-</span> <span class="fu">R6Class</span>(<span class="st">"Cards"</span>, <span class="fu">list</span>(</span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">deck =</span> <span class="fu">sample</span>(cards, <span class="dv">52</span>),</span>
<span id="cb228-3"><a href="#cb228-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">play =</span> <span class="cn">NULL</span>,</span>
<span id="cb228-4"><a href="#cb228-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">print =</span> <span class="cf">function</span>(...) {</span>
<span id="cb228-5"><a href="#cb228-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Cards: </span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb228-6"><a href="#cb228-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"  Deck:"</span>, self<span class="sc">$</span>deck, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, <span class="at">sep =</span> <span class="st">" "</span>)</span>
<span id="cb228-7"><a href="#cb228-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"  Play:"</span>, self<span class="sc">$</span>play, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, <span class="at">sep =</span> <span class="st">" "</span>)</span>
<span id="cb228-8"><a href="#cb228-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">invisible</span>(self)</span>
<span id="cb228-9"><a href="#cb228-9" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb228-10"><a href="#cb228-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">draw =</span> <span class="cf">function</span>(<span class="at">n =</span> <span class="dv">1</span>L) {</span>
<span id="cb228-11"><a href="#cb228-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(n), <span class="fu">length</span>(n) <span class="sc">==</span> <span class="dv">1</span>, n <span class="sc">&gt;</span> <span class="dv">0</span>, n <span class="sc">&lt;=</span> <span class="fu">length</span>(self<span class="sc">$</span>deck))</span>
<span id="cb228-12"><a href="#cb228-12" aria-hidden="true" tabindex="-1"></a>    d <span class="ot">&lt;-</span> <span class="fu">head</span>(self<span class="sc">$</span>deck, n)</span>
<span id="cb228-13"><a href="#cb228-13" aria-hidden="true" tabindex="-1"></a>    self<span class="sc">$</span>play <span class="ot">&lt;-</span> <span class="fu">c</span>(self<span class="sc">$</span>play, d)</span>
<span id="cb228-14"><a href="#cb228-14" aria-hidden="true" tabindex="-1"></a>    self<span class="sc">$</span>deck <span class="ot">&lt;-</span> <span class="fu">tail</span>(self<span class="sc">$</span>deck, <span class="sc">-</span>n)</span>
<span id="cb228-15"><a href="#cb228-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">invisible</span>(self)</span>
<span id="cb228-16"><a href="#cb228-16" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb228-17"><a href="#cb228-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">reshuffle =</span> <span class="cf">function</span>() {</span>
<span id="cb228-18"><a href="#cb228-18" aria-hidden="true" tabindex="-1"></a>    self<span class="sc">$</span>deck <span class="ot">&lt;-</span> <span class="fu">sample</span>(cards, <span class="dv">52</span>)</span>
<span id="cb228-19"><a href="#cb228-19" aria-hidden="true" tabindex="-1"></a>    self<span class="sc">$</span>play <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb228-20"><a href="#cb228-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">invisible</span>(self)</span>
<span id="cb228-21"><a href="#cb228-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb228-22"><a href="#cb228-22" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb228-23"><a href="#cb228-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-24"><a href="#cb228-24" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> Cards<span class="sc">$</span><span class="fu">new</span>()</span>
<span id="cb228-25"><a href="#cb228-25" aria-hidden="true" tabindex="-1"></a>d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Cards: 
#&gt;   Deck: 5♣ K♠ 2♣ 9♣ K♥ 2♥ 9♠ 3♥ Q♣ 6♥ 8♥ 8♦ 7♠ 4♠ A♠ J♥ A♣ 9♦ 3♣ 5♦ 7♥ K♣ 3♠ Q♦ A♥ 5♠ 8♣ 4♦ Q♥ 7♣ 10♥ 3♦ 5♥ 7♦ J♠ 9♥ K♦ 2♦ 2♠ A♦ Q♠ 6♠ 6♦ 10♣ 8♠ 4♣ 10♠ J♦ 10♦ 6♣ J♣ 4♥ 
#&gt;   Play:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="fu">try</span>(d<span class="sc">$</span><span class="fu">draw</span>(<span class="fl">1.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Error in d$draw(1.5) : is.integer(n) is not TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="fu">try</span>(d<span class="sc">$</span><span class="fu">draw</span>(<span class="dv">0</span>L))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Error in d$draw(0L) : n &gt; 0 is not TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="fu">try</span>(d<span class="sc">$</span><span class="fu">draw</span>(<span class="dv">53</span>L))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Error in d$draw(53L) : n &lt;= length(self$deck) is not TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb236"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span><span class="fu">draw</span>(<span class="dv">13</span>L)</span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a>d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Cards: 
#&gt;   Deck: 4♠ A♠ J♥ A♣ 9♦ 3♣ 5♦ 7♥ K♣ 3♠ Q♦ A♥ 5♠ 8♣ 4♦ Q♥ 7♣ 10♥ 3♦ 5♥ 7♦ J♠ 9♥ K♦ 2♦ 2♠ A♦ Q♠ 6♠ 6♦ 10♣ 8♠ 4♣ 10♠ J♦ 10♦ 6♣ J♣ 4♥ 
#&gt;   Play: 5♣ K♠ 2♣ 9♣ K♥ 2♥ 9♠ 3♥ Q♣ 6♥ 8♥ 8♦ 7♠</code></pre>
</div>
<div class="sourceCode cell-code" id="cb238"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span><span class="fu">draw</span>(<span class="dv">13</span>L)</span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a>d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Cards: 
#&gt;   Deck: 8♣ 4♦ Q♥ 7♣ 10♥ 3♦ 5♥ 7♦ J♠ 9♥ K♦ 2♦ 2♠ A♦ Q♠ 6♠ 6♦ 10♣ 8♠ 4♣ 10♠ J♦ 10♦ 6♣ J♣ 4♥ 
#&gt;   Play: 5♣ K♠ 2♣ 9♣ K♥ 2♥ 9♠ 3♥ Q♣ 6♥ 8♥ 8♦ 7♠ 4♠ A♠ J♥ A♣ 9♦ 3♣ 5♦ 7♥ K♣ 3♠ Q♦ A♥ 5♠</code></pre>
</div>
<div class="sourceCode cell-code" id="cb240"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span><span class="fu">reshuffle</span>()</span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a>d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Cards: 
#&gt;   Deck: K♠ Q♠ 9♠ 4♠ 5♣ 7♥ 10♥ 6♠ A♥ K♣ 8♦ 5♠ 6♣ J♠ J♦ 7♦ 2♠ 6♥ 2♦ 2♣ 10♣ A♣ 4♦ A♠ 8♠ J♥ K♥ 4♣ Q♥ 9♣ 9♥ 3♦ 6♦ 3♠ 8♣ 5♦ A♦ Q♦ 7♠ 3♣ 3♥ 4♥ 7♣ 5♥ J♣ 9♦ 2♥ 10♦ Q♣ 8♥ K♦ 10♠ 
#&gt;   Play:</code></pre>
</div>
</div>
<p>AR Solutions: Our new <code>ShuffledDeck</code> class will use <code>sample()</code> and positive integer subsetting to implement the reshuffling and drawing functionality. We also add a check, so you cannot draw more cards than there are left in the deck.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb242"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a>ShuffledDeck <span class="ot">&lt;-</span> <span class="fu">R6Class</span>(</span>
<span id="cb242-2"><a href="#cb242-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">classname =</span> <span class="st">"ShuffledDeck"</span>,</span>
<span id="cb242-3"><a href="#cb242-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">public =</span> <span class="fu">list</span>(</span>
<span id="cb242-4"><a href="#cb242-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">deck =</span> <span class="cn">NULL</span>,</span>
<span id="cb242-5"><a href="#cb242-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">initialize =</span> <span class="cf">function</span>(<span class="at">deck =</span> cards) {</span>
<span id="cb242-6"><a href="#cb242-6" aria-hidden="true" tabindex="-1"></a>      self<span class="sc">$</span>deck <span class="ot">&lt;-</span> <span class="fu">sample</span>(deck)</span>
<span id="cb242-7"><a href="#cb242-7" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb242-8"><a href="#cb242-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">reshuffle =</span> <span class="cf">function</span>() {</span>
<span id="cb242-9"><a href="#cb242-9" aria-hidden="true" tabindex="-1"></a>      self<span class="sc">$</span>deck <span class="ot">&lt;-</span> <span class="fu">sample</span>(cards)</span>
<span id="cb242-10"><a href="#cb242-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">invisible</span>(self)</span>
<span id="cb242-11"><a href="#cb242-11" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb242-12"><a href="#cb242-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="cf">function</span>() {</span>
<span id="cb242-13"><a href="#cb242-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">length</span>(self<span class="sc">$</span>deck)</span>
<span id="cb242-14"><a href="#cb242-14" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb242-15"><a href="#cb242-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">draw =</span> <span class="cf">function</span>(<span class="at">n =</span> <span class="dv">1</span>) {</span>
<span id="cb242-16"><a href="#cb242-16" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (n <span class="sc">&gt;</span> self<span class="sc">$</span><span class="fu">n</span>()) {</span>
<span id="cb242-17"><a href="#cb242-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"Only "</span>, self<span class="sc">$</span><span class="fu">n</span>(), <span class="st">" cards remaining."</span>, <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb242-18"><a href="#cb242-18" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb242-19"><a href="#cb242-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-20"><a href="#cb242-20" aria-hidden="true" tabindex="-1"></a>      output <span class="ot">&lt;-</span> self<span class="sc">$</span>deck[<span class="fu">seq_len</span>(n)]</span>
<span id="cb242-21"><a href="#cb242-21" aria-hidden="true" tabindex="-1"></a>      self<span class="sc">$</span>deck <span class="ot">&lt;-</span> self<span class="sc">$</span>deck[<span class="sc">-</span><span class="fu">seq_len</span>(n)]</span>
<span id="cb242-22"><a href="#cb242-22" aria-hidden="true" tabindex="-1"></a>      output</span>
<span id="cb242-23"><a href="#cb242-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb242-24"><a href="#cb242-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb242-25"><a href="#cb242-25" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notes: it seems simpler to set <code>deck</code> directly instead of using an <code>initialize</code> function, although <code>sample(cards)</code> is cleaner. <code>self$n()</code> is a useful function, and the choice of removing and returning cards with <code>draw()</code> is probably a better design. I prefer my approach using <code>head()</code> and <code>tail()</code> over R Solutions use of <code>seq_len()</code>.</p>
<p>Bug: per 14.4.3 setting fields directly fixes the order when the class is <em>defined</em>. This results in a bug: <code>Cards</code> has the same starting shuffle for each new object, but <code>ShuffledDeck</code> does not:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb243"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a>Cards<span class="sc">$</span><span class="fu">new</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Cards: 
#&gt;   Deck: 5♣ K♠ 2♣ 9♣ K♥ 2♥ 9♠ 3♥ Q♣ 6♥ 8♥ 8♦ 7♠ 4♠ A♠ J♥ A♣ 9♦ 3♣ 5♦ 7♥ K♣ 3♠ Q♦ A♥ 5♠ 8♣ 4♦ Q♥ 7♣ 10♥ 3♦ 5♥ 7♦ J♠ 9♥ K♦ 2♦ 2♠ A♦ Q♠ 6♠ 6♦ 10♣ 8♠ 4♣ 10♠ J♦ 10♦ 6♣ J♣ 4♥ 
#&gt;   Play:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb245"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a>Cards<span class="sc">$</span><span class="fu">new</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Cards: 
#&gt;   Deck: 5♣ K♠ 2♣ 9♣ K♥ 2♥ 9♠ 3♥ Q♣ 6♥ 8♥ 8♦ 7♠ 4♠ A♠ J♥ A♣ 9♦ 3♣ 5♦ 7♥ K♣ 3♠ Q♦ A♥ 5♠ 8♣ 4♦ Q♥ 7♣ 10♥ 3♦ 5♥ 7♦ J♠ 9♥ K♦ 2♦ 2♠ A♦ Q♠ 6♠ 6♦ 10♣ 8♠ 4♣ 10♠ J♦ 10♦ 6♣ J♣ 4♥ 
#&gt;   Play:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb247"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a>ShuffledDeck<span class="sc">$</span><span class="fu">new</span>()<span class="sc">$</span><span class="fu">draw</span>(<span class="dv">52</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  [1] "K♥"  "4♠"  "7♥"  "9♠"  "9♥"  "6♥"  "Q♦"  "4♦"  "9♦"  "J♦"  "A♠"  "10♠"
#&gt; [13] "4♥"  "K♣"  "8♥"  "3♠"  "8♣"  "3♣"  "A♦"  "6♣"  "K♠"  "J♠"  "3♥"  "2♥" 
#&gt; [25] "3♦"  "5♥"  "J♥"  "J♣"  "2♠"  "7♠"  "A♥"  "5♠"  "Q♥"  "Q♣"  "6♦"  "7♦" 
#&gt; [37] "10♥" "5♣"  "5♦"  "6♠"  "4♣"  "2♦"  "9♣"  "10♣" "2♣"  "7♣"  "K♦"  "A♣" 
#&gt; [49] "10♦" "8♠"  "8♦"  "Q♠"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb249"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a>ShuffledDeck<span class="sc">$</span><span class="fu">new</span>()<span class="sc">$</span><span class="fu">draw</span>(<span class="dv">52</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  [1] "8♣"  "6♠"  "3♠"  "4♥"  "J♥"  "Q♣"  "J♣"  "8♦"  "5♦"  "K♠"  "10♣" "K♣" 
#&gt; [13] "2♦"  "Q♥"  "A♦"  "9♠"  "7♦"  "3♥"  "7♣"  "9♦"  "A♥"  "J♠"  "8♥"  "A♣" 
#&gt; [25] "8♠"  "7♠"  "K♥"  "5♥"  "2♣"  "2♥"  "5♠"  "10♠" "3♦"  "4♣"  "A♠"  "Q♠" 
#&gt; [37] "9♥"  "9♣"  "6♥"  "10♥" "K♦"  "7♥"  "2♠"  "Q♦"  "3♣"  "10♦" "4♠"  "6♣" 
#&gt; [49] "4♦"  "5♣"  "6♦"  "J♦"</code></pre>
</div>
</div>
<hr>
<ol start="3" type="1">
<li>Why can’t you model a bank account or a deck of cards with an S3 class?</li>
</ol>
<p>Answer: because S3 classes are copied-on-modify, they lack state. R6 classes are stateful since they are modified in-place. Both bank accounts and a deck of cards are stateful objects.</p>
<p>AR Solutions: Because S3 classes obey R’s usual semantics of copy-on-modify: every time you deposit money into your bank account or draw a card from the deck, you’d get a new copy of the object.</p>
<p>It is possible to combine S3 classes with an environment (which is how R6 works), but it is ill-advised to create an object that looks like a regular R object but has reference semantics.</p>
<hr>
<ol start="4" type="1">
<li>Create an R6 class that allows you to get and set the current time zone. You can access the current time zone with <code>Sys.timezone()</code> and set it with <code>Sys.setenv(TZ = "newtimezone")</code>. When setting the time zone, make sure the new time zone is in the list provided by <code>OlsonNames()</code>.</li>
</ol>
<p>Answer: <code>TimeZone</code> is initialized with the current time zone, stored as <code>tz</code> in the object.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb251"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a>orig_tz <span class="ot">&lt;-</span> <span class="fu">Sys.timezone</span>()</span>
<span id="cb251-2"><a href="#cb251-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-3"><a href="#cb251-3" aria-hidden="true" tabindex="-1"></a>TimeZone <span class="ot">&lt;-</span> <span class="fu">R6Class</span>(<span class="st">"TimeZone"</span>, <span class="fu">list</span>(</span>
<span id="cb251-4"><a href="#cb251-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">tz =</span> <span class="fu">Sys.timezone</span>(),</span>
<span id="cb251-5"><a href="#cb251-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">get =</span> <span class="cf">function</span>() {</span>
<span id="cb251-6"><a href="#cb251-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Current time zone: "</span>, self<span class="sc">$</span>tz, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb251-7"><a href="#cb251-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">invisible</span>(self)</span>
<span id="cb251-8"><a href="#cb251-8" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb251-9"><a href="#cb251-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">set =</span> <span class="cf">function</span>(tz) {</span>
<span id="cb251-10"><a href="#cb251-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(tz <span class="sc">%in%</span> <span class="fu">OlsonNames</span>())</span>
<span id="cb251-11"><a href="#cb251-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Sys.setenv</span>(<span class="at">TZ =</span> tz)</span>
<span id="cb251-12"><a href="#cb251-12" aria-hidden="true" tabindex="-1"></a>    self<span class="sc">$</span>tz <span class="ot">&lt;-</span> tz</span>
<span id="cb251-13"><a href="#cb251-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Set time zone: "</span>, self<span class="sc">$</span>tz, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb251-14"><a href="#cb251-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">invisible</span>(self)</span>
<span id="cb251-15"><a href="#cb251-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb251-16"><a href="#cb251-16" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb251-17"><a href="#cb251-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-18"><a href="#cb251-18" aria-hidden="true" tabindex="-1"></a>tz <span class="ot">&lt;-</span> TimeZone<span class="sc">$</span><span class="fu">new</span>()</span>
<span id="cb251-19"><a href="#cb251-19" aria-hidden="true" tabindex="-1"></a>tz<span class="sc">$</span><span class="fu">get</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Current time zone: America/Chicago</code></pre>
</div>
<div class="sourceCode cell-code" id="cb253"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="fu">date</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "Sat Apr 27 09:20:20 2024"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb255"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a>tz<span class="sc">$</span><span class="fu">set</span>(<span class="st">"America/New_York"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Set time zone: America/New_York</code></pre>
</div>
<div class="sourceCode cell-code" id="cb257"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="fu">date</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "Sat Apr 27 10:20:20 2024"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb259"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setenv</span>(<span class="at">TZ =</span> orig_tz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Bug: like <code>Cards</code>, <code>TimeZone</code> should set <code>tz</code> in <code>initialize()</code>.</p>
<p>AR Solutions: To create an R6 class that allows us to get and set the time zone, we provide the respective functions as public methods to the R6 class.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb260"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a>Timezone <span class="ot">&lt;-</span> <span class="fu">R6Class</span>(</span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">classname =</span> <span class="st">"Timezone"</span>,</span>
<span id="cb260-3"><a href="#cb260-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">public =</span> <span class="fu">list</span>(</span>
<span id="cb260-4"><a href="#cb260-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">get =</span> <span class="cf">function</span>() {</span>
<span id="cb260-5"><a href="#cb260-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">Sys.timezone</span>()</span>
<span id="cb260-6"><a href="#cb260-6" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb260-7"><a href="#cb260-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">set =</span> <span class="cf">function</span>(value) {</span>
<span id="cb260-8"><a href="#cb260-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stopifnot</span>(value <span class="sc">%in%</span> <span class="fu">OlsonNames</span>())</span>
<span id="cb260-9"><a href="#cb260-9" aria-hidden="true" tabindex="-1"></a>      old <span class="ot">&lt;-</span> self<span class="sc">$</span><span class="fu">get</span>()</span>
<span id="cb260-10"><a href="#cb260-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">Sys.setenv</span>(<span class="at">TZ =</span> value)</span>
<span id="cb260-11"><a href="#cb260-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">invisible</span>(old)</span>
<span id="cb260-12"><a href="#cb260-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb260-13"><a href="#cb260-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb260-14"><a href="#cb260-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>(When setting, we return the old value invisibly because this makes it easy to restore the previous value.)</p>
<hr>
<ol start="5" type="1">
<li>Create an R6 class that manages the current working directory. It should have <code>$get()</code> and <code>$set()</code> methods.</li>
</ol>
<p>Answer: similar to <code>TimeZone</code>, <code>WorkingDirectory</code> initializes <code>wd</code> to <code>getwd()</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb261"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a>orig_wd <span class="ot">&lt;-</span> <span class="fu">getwd</span>()</span>
<span id="cb261-2"><a href="#cb261-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-3"><a href="#cb261-3" aria-hidden="true" tabindex="-1"></a>WorkingDirectory <span class="ot">&lt;-</span> <span class="fu">R6Class</span>(<span class="st">"WorkingDirectory"</span>, <span class="fu">list</span>(</span>
<span id="cb261-4"><a href="#cb261-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">wd =</span> <span class="fu">getwd</span>(),</span>
<span id="cb261-5"><a href="#cb261-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">get =</span> <span class="cf">function</span>() {</span>
<span id="cb261-6"><a href="#cb261-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Current directory: "</span>, self<span class="sc">$</span>wd, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb261-7"><a href="#cb261-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">invisible</span>(self)</span>
<span id="cb261-8"><a href="#cb261-8" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb261-9"><a href="#cb261-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">set =</span> <span class="cf">function</span>(dir) {</span>
<span id="cb261-10"><a href="#cb261-10" aria-hidden="true" tabindex="-1"></a>    self<span class="sc">$</span>wd <span class="ot">&lt;-</span> <span class="fu">setwd</span>(dir)</span>
<span id="cb261-11"><a href="#cb261-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Set directory: "</span>, self<span class="sc">$</span>wd, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb261-12"><a href="#cb261-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">invisible</span>(self)</span>
<span id="cb261-13"><a href="#cb261-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb261-14"><a href="#cb261-14" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb261-15"><a href="#cb261-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-16"><a href="#cb261-16" aria-hidden="true" tabindex="-1"></a>wd <span class="ot">&lt;-</span> WorkingDirectory<span class="sc">$</span><span class="fu">new</span>()</span>
<span id="cb261-17"><a href="#cb261-17" aria-hidden="true" tabindex="-1"></a>wd<span class="sc">$</span><span class="fu">get</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Current directory: /Users/agamemnon/GitHub/rtraining/analysis</code></pre>
</div>
<div class="sourceCode cell-code" id="cb263"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a>wd<span class="sc">$</span><span class="fu">set</span>(<span class="st">"assets"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Set directory: /Users/agamemnon/GitHub/rtraining/analysis</code></pre>
</div>
<div class="sourceCode cell-code" id="cb265"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a><span class="fu">list.files</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "extra.css"       "recursive-1.png" "recursive-2.png"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb267"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(orig_wd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>AR Solutions: Take a look at the following implementation, which is quite minimalistic:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb268"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a>WorkingDirectory <span class="ot">&lt;-</span> <span class="fu">R6Class</span>(</span>
<span id="cb268-2"><a href="#cb268-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">classname =</span> <span class="st">"WorkingDirectory"</span>,</span>
<span id="cb268-3"><a href="#cb268-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">public =</span> <span class="fu">list</span>(</span>
<span id="cb268-4"><a href="#cb268-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">get =</span> <span class="cf">function</span>() {</span>
<span id="cb268-5"><a href="#cb268-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">getwd</span>()</span>
<span id="cb268-6"><a href="#cb268-6" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb268-7"><a href="#cb268-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">set =</span> <span class="cf">function</span>(value) {</span>
<span id="cb268-8"><a href="#cb268-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">setwd</span>(value)</span>
<span id="cb268-9"><a href="#cb268-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb268-10"><a href="#cb268-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb268-11"><a href="#cb268-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Bug: like <code>Cards</code>, <code>WorkingDirectory</code> should set <code>wd</code> in <code>initialize()</code>. Also, as AR Solutions notes in a comment:</p>
<blockquote class="blockquote">
<p>You should never do <code>get = getwd()</code> etc because in packages, that inlines the function definition at package build time, creating a subtle dependency that will cause bugs that are extremely difficult to track down</p>
</blockquote>
<hr>
<ol start="6" type="1">
<li>Why can’t you model the time zone or current working directory with an S3 class?</li>
</ol>
<p>Answer: per exercise 3, time zone and current working directory are both stateful.</p>
<p>AR Solutions: Because S3 classes are not suitable for modelling a state that changes over time. S3 methods should (almost) always return the same result when called with the same inputs.</p>
<hr>
<ol start="7" type="1">
<li>What base type are R6 objects built on top of? What attributes do they have?</li>
</ol>
<p>Answer: R6n objects are built on environments, and have a class attribute with an S3 hierarchy including the base R6 class, per 14.2.5.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb269"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(tz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "environment"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb271"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(tz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; $class
#&gt; [1] "TimeZone" "R6"</code></pre>
</div>
</div>
<p>AR Solutions: R6 objects are built on top of environments. They have a <code>class</code> attribute, which is a character vector containing the class name, the name of any super classes (if existent) and the string <code>"R6"</code> as the last element.</p>
<hr>
</section>
<section id="exercises-7" class="level3">
<h3 class="anchored" data-anchor-id="exercises-7">14.3.3 Exercises</h3>
<ol type="1">
<li>Create a bank account class that prevents you from directly setting the account balance, but you can still withdraw from and deposit to. Throw an error if you attempt to go into overdraft.</li>
</ol>
<p>Answer: <code>SecureAccount</code> uses a private internal balance exposed through an active function.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb273"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb273-1"><a href="#cb273-1" aria-hidden="true" tabindex="-1"></a>SecureAccount <span class="ot">&lt;-</span> <span class="fu">R6Class</span>(<span class="st">"SecureAccount"</span>,</span>
<span id="cb273-2"><a href="#cb273-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">private =</span> <span class="fu">list</span>(</span>
<span id="cb273-3"><a href="#cb273-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">.balance =</span> <span class="dv">0</span>L</span>
<span id="cb273-4"><a href="#cb273-4" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb273-5"><a href="#cb273-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">public =</span> <span class="fu">list</span>(</span>
<span id="cb273-6"><a href="#cb273-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">deposit =</span> <span class="cf">function</span>(value) {</span>
<span id="cb273-7"><a href="#cb273-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(value), <span class="fu">length</span>(value) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb273-8"><a href="#cb273-8" aria-hidden="true" tabindex="-1"></a>      private<span class="sc">$</span>.balance <span class="ot">&lt;-</span> private<span class="sc">$</span>.balance <span class="sc">+</span> value</span>
<span id="cb273-9"><a href="#cb273-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">invisible</span>(self)</span>
<span id="cb273-10"><a href="#cb273-10" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb273-11"><a href="#cb273-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">withdraw =</span> <span class="cf">function</span>(value) {</span>
<span id="cb273-12"><a href="#cb273-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(value), <span class="fu">length</span>(value) <span class="sc">==</span> <span class="dv">1</span>, value <span class="sc">&lt;=</span> private<span class="sc">$</span>.balance)</span>
<span id="cb273-13"><a href="#cb273-13" aria-hidden="true" tabindex="-1"></a>      private<span class="sc">$</span>.balance <span class="ot">&lt;-</span> private<span class="sc">$</span>.balance <span class="sc">-</span> value</span>
<span id="cb273-14"><a href="#cb273-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">invisible</span>(self)</span>
<span id="cb273-15"><a href="#cb273-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb273-16"><a href="#cb273-16" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb273-17"><a href="#cb273-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">active =</span> <span class="fu">list</span>(</span>
<span id="cb273-18"><a href="#cb273-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">balance =</span> <span class="cf">function</span>(value) {</span>
<span id="cb273-19"><a href="#cb273-19" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">missing</span>(value)) {</span>
<span id="cb273-20"><a href="#cb273-20" aria-hidden="true" tabindex="-1"></a>        private<span class="sc">$</span>.balance</span>
<span id="cb273-21"><a href="#cb273-21" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb273-22"><a href="#cb273-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"`$balance` is read only"</span>, <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb273-23"><a href="#cb273-23" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb273-24"><a href="#cb273-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb273-25"><a href="#cb273-25" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb273-26"><a href="#cb273-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb273-27"><a href="#cb273-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-28"><a href="#cb273-28" aria-hidden="true" tabindex="-1"></a>sa <span class="ot">&lt;-</span> SecureAccount<span class="sc">$</span><span class="fu">new</span>()</span>
<span id="cb273-29"><a href="#cb273-29" aria-hidden="true" tabindex="-1"></a>sa<span class="sc">$</span><span class="fu">deposit</span>(<span class="dv">10</span>L)</span>
<span id="cb273-30"><a href="#cb273-30" aria-hidden="true" tabindex="-1"></a>sa<span class="sc">$</span><span class="fu">withdraw</span>(<span class="dv">5</span>L)</span>
<span id="cb273-31"><a href="#cb273-31" aria-hidden="true" tabindex="-1"></a><span class="fu">try</span>(sa<span class="sc">$</span><span class="fu">withdraw</span>(<span class="dv">20</span>L))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Error in sa$withdraw(20L) : value &lt;= private$.balance is not TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb275"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a><span class="fu">try</span>(sa<span class="sc">$</span>balance <span class="ot">&lt;-</span> <span class="dv">100</span>L)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Error : `$balance` is read only</code></pre>
</div>
<div class="sourceCode cell-code" id="cb277"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a>sa<span class="sc">$</span>balance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 5</code></pre>
</div>
</div>
<p>AR Solutions: To fulfill this requirement, we make balance a private field. The user has to use the <code>$deposit()</code> and <code>$withdraw()</code> methods which have access to the balance field.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb279"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a>BankAccountStrict2 <span class="ot">&lt;-</span> <span class="fu">R6Class</span>(</span>
<span id="cb279-2"><a href="#cb279-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">classname =</span> <span class="st">"BankAccountStrict2"</span>,</span>
<span id="cb279-3"><a href="#cb279-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">public =</span> <span class="fu">list</span>(</span>
<span id="cb279-4"><a href="#cb279-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">deposit =</span> <span class="cf">function</span>(<span class="at">dep =</span> <span class="dv">0</span>) {</span>
<span id="cb279-5"><a href="#cb279-5" aria-hidden="true" tabindex="-1"></a>      private<span class="sc">$</span>balance <span class="ot">&lt;-</span> private<span class="sc">$</span>balance <span class="sc">+</span> dep</span>
<span id="cb279-6"><a href="#cb279-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">invisible</span>(self)</span>
<span id="cb279-7"><a href="#cb279-7" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb279-8"><a href="#cb279-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">withdraw =</span> <span class="cf">function</span>(<span class="at">draw =</span> <span class="dv">0</span>) {</span>
<span id="cb279-9"><a href="#cb279-9" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (private<span class="sc">$</span>balance <span class="sc">-</span> draw <span class="sc">&lt;</span> <span class="dv">0</span>) {</span>
<span id="cb279-10"><a href="#cb279-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(</span>
<span id="cb279-11"><a href="#cb279-11" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Your `withdraw` must be smaller "</span>,</span>
<span id="cb279-12"><a href="#cb279-12" aria-hidden="true" tabindex="-1"></a>          <span class="st">"than your `balance`."</span>,</span>
<span id="cb279-13"><a href="#cb279-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">call. =</span> <span class="cn">FALSE</span></span>
<span id="cb279-14"><a href="#cb279-14" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb279-15"><a href="#cb279-15" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb279-16"><a href="#cb279-16" aria-hidden="true" tabindex="-1"></a>      private<span class="sc">$</span>balance <span class="ot">&lt;-</span> private<span class="sc">$</span>balance <span class="sc">-</span> draw</span>
<span id="cb279-17"><a href="#cb279-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">invisible</span>(self)</span>
<span id="cb279-18"><a href="#cb279-18" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb279-19"><a href="#cb279-19" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb279-20"><a href="#cb279-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">private =</span> <span class="fu">list</span>(</span>
<span id="cb279-21"><a href="#cb279-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">balance =</span> <span class="dv">0</span></span>
<span id="cb279-22"><a href="#cb279-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb279-23"><a href="#cb279-23" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ol start="2" type="1">
<li>Create a class with a write-only <code>$password</code> field. It should have <code>$check_password(password)</code> method that returns <code>TRUE</code> or <code>FALSE</code>, but there should be no way to view the complete password.</li>
</ol>
<p>Answer: <code>Login</code> implements a write-only <code>$password</code> field using an active function. <code>check_password()</code> will error if a password hasn’t been set. In real life, this should be implemented with a secure password hashing function, like <code>bcrypt</code> or <code>scrypt</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb280"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a>Login <span class="ot">&lt;-</span> <span class="fu">R6Class</span>(<span class="st">"Login"</span>,</span>
<span id="cb280-2"><a href="#cb280-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">private =</span> <span class="fu">list</span>(</span>
<span id="cb280-3"><a href="#cb280-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">.password =</span> <span class="cn">NULL</span></span>
<span id="cb280-4"><a href="#cb280-4" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb280-5"><a href="#cb280-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">public =</span> <span class="fu">list</span>(</span>
<span id="cb280-6"><a href="#cb280-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">check_password =</span> <span class="cf">function</span>(password) {</span>
<span id="cb280-7"><a href="#cb280-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stopifnot</span>(<span class="fu">is.character</span>(password), <span class="fu">length</span>(password) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb280-8"><a href="#cb280-8" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">is.null</span>(private<span class="sc">$</span>.password)) <span class="fu">stop</span>(<span class="st">"Error: password not set"</span>)</span>
<span id="cb280-9"><a href="#cb280-9" aria-hidden="true" tabindex="-1"></a>      password <span class="sc">==</span> private<span class="sc">$</span>.password</span>
<span id="cb280-10"><a href="#cb280-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb280-11"><a href="#cb280-11" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb280-12"><a href="#cb280-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">active =</span> <span class="fu">list</span>(</span>
<span id="cb280-13"><a href="#cb280-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">password =</span> <span class="cf">function</span>(value) {</span>
<span id="cb280-14"><a href="#cb280-14" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">missing</span>(value)) {</span>
<span id="cb280-15"><a href="#cb280-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"`$password` is write only"</span>, <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb280-16"><a href="#cb280-16" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb280-17"><a href="#cb280-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">is.character</span>(value), <span class="fu">length</span>(value) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb280-18"><a href="#cb280-18" aria-hidden="true" tabindex="-1"></a>        private<span class="sc">$</span>.password <span class="ot">&lt;-</span> value</span>
<span id="cb280-19"><a href="#cb280-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">invisible</span>(self)</span>
<span id="cb280-20"><a href="#cb280-20" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb280-21"><a href="#cb280-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb280-22"><a href="#cb280-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb280-23"><a href="#cb280-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb280-24"><a href="#cb280-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-25"><a href="#cb280-25" aria-hidden="true" tabindex="-1"></a>l <span class="ot">&lt;-</span> Login<span class="sc">$</span><span class="fu">new</span>()</span>
<span id="cb280-26"><a href="#cb280-26" aria-hidden="true" tabindex="-1"></a><span class="fu">try</span>(l<span class="sc">$</span><span class="fu">check_password</span>(<span class="st">"Password1"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Error in l$check_password("Password1") : Error: password not set</code></pre>
</div>
<div class="sourceCode cell-code" id="cb282"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a>l<span class="sc">$</span>password <span class="ot">&lt;-</span> <span class="st">"Password1"</span></span>
<span id="cb282-2"><a href="#cb282-2" aria-hidden="true" tabindex="-1"></a>l<span class="sc">$</span><span class="fu">check_password</span>(<span class="st">"Password1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb284"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a>l<span class="sc">$</span><span class="fu">check_password</span>(<span class="st">"Password2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb286"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a><span class="fu">try</span>(l<span class="sc">$</span>password)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Error : `$password` is write only</code></pre>
</div>
</div>
<p>AR Solutions: To protect the password from changes and direct access, the password will be a private field. Further, our <code>Password</code> will get its own print method which hides the password.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb288"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a>Password <span class="ot">&lt;-</span> <span class="fu">R6Class</span>(</span>
<span id="cb288-2"><a href="#cb288-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">classname =</span> <span class="st">"Password"</span>,</span>
<span id="cb288-3"><a href="#cb288-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">public =</span> <span class="fu">list</span>(</span>
<span id="cb288-4"><a href="#cb288-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">print =</span> <span class="cf">function</span>(...) {</span>
<span id="cb288-5"><a href="#cb288-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"&lt;Password&gt;: ********</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb288-6"><a href="#cb288-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">invisible</span>(self)</span>
<span id="cb288-7"><a href="#cb288-7" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb288-8"><a href="#cb288-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">set =</span> <span class="cf">function</span>(value) {</span>
<span id="cb288-9"><a href="#cb288-9" aria-hidden="true" tabindex="-1"></a>      private<span class="sc">$</span>password <span class="ot">&lt;-</span> value</span>
<span id="cb288-10"><a href="#cb288-10" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb288-11"><a href="#cb288-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">check =</span> <span class="cf">function</span>(password) {</span>
<span id="cb288-12"><a href="#cb288-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">identical</span>(password, private<span class="sc">$</span>password)</span>
<span id="cb288-13"><a href="#cb288-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb288-14"><a href="#cb288-14" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb288-15"><a href="#cb288-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">private =</span> <span class="fu">list</span>(</span>
<span id="cb288-16"><a href="#cb288-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">password =</span> <span class="cn">NULL</span></span>
<span id="cb288-17"><a href="#cb288-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb288-18"><a href="#cb288-18" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s create one instance of our new class and confirm that the password is neither accessible nor visible, but still check-able.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb289"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a>my_pw <span class="ot">&lt;-</span> Password<span class="sc">$</span><span class="fu">new</span>()</span>
<span id="cb289-2"><a href="#cb289-2" aria-hidden="true" tabindex="-1"></a>my_pw<span class="sc">$</span><span class="fu">set</span>(<span class="st">"snuffles"</span>)</span>
<span id="cb289-3"><a href="#cb289-3" aria-hidden="true" tabindex="-1"></a>my_pw<span class="sc">$</span>password</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; NULL</code></pre>
</div>
<div class="sourceCode cell-code" id="cb291"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true" tabindex="-1"></a>my_pw</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; &lt;Password&gt;: ********</code></pre>
</div>
<div class="sourceCode cell-code" id="cb293"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb293-1"><a href="#cb293-1" aria-hidden="true" tabindex="-1"></a>my_pw<span class="sc">$</span><span class="fu">check</span>(<span class="st">"snuggles"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb295"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb295-1"><a href="#cb295-1" aria-hidden="true" tabindex="-1"></a>my_pw<span class="sc">$</span><span class="fu">check</span>(<span class="st">"snuffles"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] TRUE</code></pre>
</div>
</div>
<p>Note: the AR Solutions class properly masks the password when calling <code>print()</code>, but mine does not:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb297"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb297-1"><a href="#cb297-1" aria-hidden="true" tabindex="-1"></a>l</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; &lt;Login&gt;
#&gt;   Public:
#&gt;     check_password: function (password) 
#&gt;     clone: function (deep = FALSE) 
#&gt;     password: active binding
#&gt;   Private:
#&gt;     .password: Password1</code></pre>
</div>
</div>
<hr>
<ol start="3" type="1">
<li>Extend the <code>Rando</code> class with another active binding that allows you to access the previous random value. Ensure that active binding is the only way to access the value.</li>
</ol>
<p>Answer: the updated <code>Rando</code> class sets a private value when <code>random</code> is run that is accessible only through <code>previous</code>, initially set to <code>NA</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb299"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb299-1"><a href="#cb299-1" aria-hidden="true" tabindex="-1"></a>Rando <span class="ot">&lt;-</span> R6<span class="sc">::</span><span class="fu">R6Class</span>(<span class="st">"Rando"</span>,</span>
<span id="cb299-2"><a href="#cb299-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">private =</span> <span class="fu">list</span>(</span>
<span id="cb299-3"><a href="#cb299-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">.previous =</span> <span class="cn">NA</span></span>
<span id="cb299-4"><a href="#cb299-4" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb299-5"><a href="#cb299-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">active =</span> <span class="fu">list</span>(</span>
<span id="cb299-6"><a href="#cb299-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">random =</span> <span class="cf">function</span>(value) {</span>
<span id="cb299-7"><a href="#cb299-7" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">missing</span>(value)) {</span>
<span id="cb299-8"><a href="#cb299-8" aria-hidden="true" tabindex="-1"></a>        private<span class="sc">$</span>.previous <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>)</span>
<span id="cb299-9"><a href="#cb299-9" aria-hidden="true" tabindex="-1"></a>        private<span class="sc">$</span>.previous</span>
<span id="cb299-10"><a href="#cb299-10" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb299-11"><a href="#cb299-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"Can't set `$random`"</span>, <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb299-12"><a href="#cb299-12" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb299-13"><a href="#cb299-13" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb299-14"><a href="#cb299-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">previous =</span> <span class="cf">function</span>(value) {</span>
<span id="cb299-15"><a href="#cb299-15" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">missing</span>(value)) {</span>
<span id="cb299-16"><a href="#cb299-16" aria-hidden="true" tabindex="-1"></a>        private<span class="sc">$</span>.previous</span>
<span id="cb299-17"><a href="#cb299-17" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb299-18"><a href="#cb299-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"Can't set `$previous`"</span>, <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb299-19"><a href="#cb299-19" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb299-20"><a href="#cb299-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb299-21"><a href="#cb299-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb299-22"><a href="#cb299-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb299-23"><a href="#cb299-23" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> Rando<span class="sc">$</span><span class="fu">new</span>()</span>
<span id="cb299-24"><a href="#cb299-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-25"><a href="#cb299-25" aria-hidden="true" tabindex="-1"></a>x<span class="sc">$</span>previous</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb301"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb301-1"><a href="#cb301-1" aria-hidden="true" tabindex="-1"></a>x<span class="sc">$</span>random</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 0.9643438</code></pre>
</div>
<div class="sourceCode cell-code" id="cb303"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb303-1"><a href="#cb303-1" aria-hidden="true" tabindex="-1"></a>x<span class="sc">$</span>previous</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 0.9643438</code></pre>
</div>
<div class="sourceCode cell-code" id="cb305"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb305-1"><a href="#cb305-1" aria-hidden="true" tabindex="-1"></a>x<span class="sc">$</span>random</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 0.1186832</code></pre>
</div>
<div class="sourceCode cell-code" id="cb307"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb307-1"><a href="#cb307-1" aria-hidden="true" tabindex="-1"></a>x<span class="sc">$</span>previous</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 0.1186832</code></pre>
</div>
</div>
<p>AR Solutions: To access the previous random value from an instance, we add a private <code>$last_random</code> field to our class, and we modify <code>$random()</code> to write to this field, whenever it is called. To access the <code>$last_random</code> field we provide <code>$previous()</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb309"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb309-1"><a href="#cb309-1" aria-hidden="true" tabindex="-1"></a>Rando <span class="ot">&lt;-</span> R6<span class="sc">::</span><span class="fu">R6Class</span>(</span>
<span id="cb309-2"><a href="#cb309-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">classname =</span> <span class="st">"Rando"</span>,</span>
<span id="cb309-3"><a href="#cb309-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">private =</span> <span class="fu">list</span>(</span>
<span id="cb309-4"><a href="#cb309-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">last_random =</span> <span class="cn">NULL</span></span>
<span id="cb309-5"><a href="#cb309-5" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb309-6"><a href="#cb309-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">active =</span> <span class="fu">list</span>(</span>
<span id="cb309-7"><a href="#cb309-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">random =</span> <span class="cf">function</span>(value) {</span>
<span id="cb309-8"><a href="#cb309-8" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">missing</span>(value)) {</span>
<span id="cb309-9"><a href="#cb309-9" aria-hidden="true" tabindex="-1"></a>        private<span class="sc">$</span>last_random <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>)</span>
<span id="cb309-10"><a href="#cb309-10" aria-hidden="true" tabindex="-1"></a>        private<span class="sc">$</span>last_random</span>
<span id="cb309-11"><a href="#cb309-11" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb309-12"><a href="#cb309-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"Can't set `$random`."</span>, <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb309-13"><a href="#cb309-13" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb309-14"><a href="#cb309-14" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb309-15"><a href="#cb309-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">previous =</span> <span class="cf">function</span>(value) {</span>
<span id="cb309-16"><a href="#cb309-16" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">missing</span>(value)) {</span>
<span id="cb309-17"><a href="#cb309-17" aria-hidden="true" tabindex="-1"></a>        private<span class="sc">$</span>last_random</span>
<span id="cb309-18"><a href="#cb309-18" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb309-19"><a href="#cb309-19" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb309-20"><a href="#cb309-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb309-21"><a href="#cb309-21" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ol start="4" type="1">
<li>Can subclasses access private fields/methods from their parent? Perform an experiment to find out.</li>
</ol>
<p>Answer: <code>LoginEvil</code> shows that subclasses <em>can</em> access private fields from their parent.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb310"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb310-1"><a href="#cb310-1" aria-hidden="true" tabindex="-1"></a>LoginEvil <span class="ot">&lt;-</span> <span class="fu">R6Class</span>(<span class="st">"LoginEvil"</span>,</span>
<span id="cb310-2"><a href="#cb310-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">inherit =</span> Login,</span>
<span id="cb310-3"><a href="#cb310-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">public =</span> <span class="fu">list</span>(</span>
<span id="cb310-4"><a href="#cb310-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">steal_password =</span> <span class="cf">function</span>() {</span>
<span id="cb310-5"><a href="#cb310-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"The password is: "</span>, private<span class="sc">$</span>.password, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb310-6"><a href="#cb310-6" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb310-7"><a href="#cb310-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb310-8"><a href="#cb310-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb310-9"><a href="#cb310-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-10"><a href="#cb310-10" aria-hidden="true" tabindex="-1"></a>evil <span class="ot">&lt;-</span> LoginEvil<span class="sc">$</span><span class="fu">new</span>()</span>
<span id="cb310-11"><a href="#cb310-11" aria-hidden="true" tabindex="-1"></a>evil<span class="sc">$</span>password <span class="ot">&lt;-</span> <span class="st">"SuperSecretPassword"</span></span>
<span id="cb310-12"><a href="#cb310-12" aria-hidden="true" tabindex="-1"></a>evil<span class="sc">$</span><span class="fu">steal_password</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; The password is: SuperSecretPassword</code></pre>
</div>
</div>
<p>AR Solutions: To find out if private fields/methods can be accessed from subclasses, we first create a class <code>A</code> with a private field <code>foo</code> and a private method <code>bar()</code>. Afterwards, an instance of a subclass <code>B</code> is created and calls the <code>foobar()</code> methods, which tries to access the <code>foo</code> field and the <code>bar()</code> method from its superclass <code>A</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb312"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb312-1"><a href="#cb312-1" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">R6Class</span>(</span>
<span id="cb312-2"><a href="#cb312-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">classname =</span> <span class="st">"A"</span>,</span>
<span id="cb312-3"><a href="#cb312-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">private =</span> <span class="fu">list</span>(</span>
<span id="cb312-4"><a href="#cb312-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">field =</span> <span class="st">"foo"</span>,</span>
<span id="cb312-5"><a href="#cb312-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="cf">function</span>() {</span>
<span id="cb312-6"><a href="#cb312-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">"bar"</span></span>
<span id="cb312-7"><a href="#cb312-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb312-8"><a href="#cb312-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb312-9"><a href="#cb312-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb312-10"><a href="#cb312-10" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">R6Class</span>(</span>
<span id="cb312-11"><a href="#cb312-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">classname =</span> <span class="st">"B"</span>,</span>
<span id="cb312-12"><a href="#cb312-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">inherit =</span> A,</span>
<span id="cb312-13"><a href="#cb312-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">public =</span> <span class="fu">list</span>(</span>
<span id="cb312-14"><a href="#cb312-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">test =</span> <span class="cf">function</span>() {</span>
<span id="cb312-15"><a href="#cb312-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Field:  "</span>, super<span class="sc">$</span>field, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb312-16"><a href="#cb312-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Method: "</span>, super<span class="sc">$</span><span class="fu">method</span>(), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb312-17"><a href="#cb312-17" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb312-18"><a href="#cb312-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb312-19"><a href="#cb312-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb312-20"><a href="#cb312-20" aria-hidden="true" tabindex="-1"></a>B<span class="sc">$</span><span class="fu">new</span>()<span class="sc">$</span><span class="fu">test</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Field:  
#&gt; Method: bar</code></pre>
</div>
</div>
<p>We conclude that subclasses can access private methods from their superclasses, but not private fields.</p>
<p>Note: as I discovered, private fields are not accessible through <code>super$</code>, but <em>are</em> accessible through <code>private$</code>.</p>
<hr>
</section>
<section id="exercises-8" class="level3">
<h3 class="anchored" data-anchor-id="exercises-8">14.4.4 Exercises</h3>
<ol type="1">
<li>Create a class that allows you to write a line to a specified file. You should open a connection to the file in <code>$initialize()</code>, append a line using <code>cat()</code> in <code>$append_line()</code>, and close the connection in <code>$finalize()</code>.</li>
</ol>
<p>Answer: <code>WriteFile</code> implemented below.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb314"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb314-1"><a href="#cb314-1" aria-hidden="true" tabindex="-1"></a>WriteFile <span class="ot">&lt;-</span> <span class="fu">R6Class</span>(<span class="st">"WriteFile"</span>, <span class="fu">list</span>(</span>
<span id="cb314-2"><a href="#cb314-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">wfile =</span> <span class="cn">NULL</span>,</span>
<span id="cb314-3"><a href="#cb314-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">initialize =</span> <span class="cf">function</span>(filename) {</span>
<span id="cb314-4"><a href="#cb314-4" aria-hidden="true" tabindex="-1"></a>    self<span class="sc">$</span>wfile <span class="ot">&lt;-</span> <span class="fu">file</span>(filename, <span class="st">"a"</span>)</span>
<span id="cb314-5"><a href="#cb314-5" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb314-6"><a href="#cb314-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">append_line =</span> <span class="cf">function</span>(line) {</span>
<span id="cb314-7"><a href="#cb314-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(line, <span class="at">file =</span> self<span class="sc">$</span>wfile)</span>
<span id="cb314-8"><a href="#cb314-8" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb314-9"><a href="#cb314-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">finalize =</span> <span class="cf">function</span>() {</span>
<span id="cb314-10"><a href="#cb314-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">close</span>(self<span class="sc">$</span>wfile)</span>
<span id="cb314-11"><a href="#cb314-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb314-12"><a href="#cb314-12" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb314-13"><a href="#cb314-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-14"><a href="#cb314-14" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb314-15"><a href="#cb314-15" aria-hidden="true" tabindex="-1"></a>wf <span class="ot">&lt;-</span> WriteFile<span class="sc">$</span><span class="fu">new</span>(tmp)</span>
<span id="cb314-16"><a href="#cb314-16" aria-hidden="true" tabindex="-1"></a>wf<span class="sc">$</span><span class="fu">append_line</span>(<span class="st">"The quick brown fox jumps over the lazy dog.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb314-17"><a href="#cb314-17" aria-hidden="true" tabindex="-1"></a><span class="fu">readLines</span>(tmp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "The quick brown fox jumps over the lazy dog."</code></pre>
</div>
</div>
<p>AR Solutions: Our <code>FileWriter</code> class will create a connection to a file at initialization. Therefore, we open a connection to a user specified file during the initialisation. Note that we need to set <code>open = "a"</code> in <code>file()</code> to open connection for appending text. Otherwise, <code>cat()</code> would only work when applied to files, but not with connections as explicitly asked for in the exercise. Further, we add the <code>append_line()</code> method and a <code>close()</code> statement as finalizer.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb316"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb316-1"><a href="#cb316-1" aria-hidden="true" tabindex="-1"></a>FileWriter <span class="ot">&lt;-</span> R6<span class="sc">::</span><span class="fu">R6Class</span>(</span>
<span id="cb316-2"><a href="#cb316-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">classname =</span> <span class="st">"FileWriter"</span>,</span>
<span id="cb316-3"><a href="#cb316-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">public =</span> <span class="fu">list</span>(</span>
<span id="cb316-4"><a href="#cb316-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">con =</span> <span class="cn">NULL</span>,</span>
<span id="cb316-5"><a href="#cb316-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">initialize =</span> <span class="cf">function</span>(filename) {</span>
<span id="cb316-6"><a href="#cb316-6" aria-hidden="true" tabindex="-1"></a>      self<span class="sc">$</span>con <span class="ot">&lt;-</span> <span class="fu">file</span>(filename, <span class="at">open =</span> <span class="st">"a"</span>)</span>
<span id="cb316-7"><a href="#cb316-7" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb316-8"><a href="#cb316-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">finalize =</span> <span class="cf">function</span>() {</span>
<span id="cb316-9"><a href="#cb316-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">close</span>(self<span class="sc">$</span>con)</span>
<span id="cb316-10"><a href="#cb316-10" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb316-11"><a href="#cb316-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">append_line =</span> <span class="cf">function</span>(x) {</span>
<span id="cb316-12"><a href="#cb316-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(x, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, <span class="at">sep =</span> <span class="st">""</span>, <span class="at">file =</span> self<span class="sc">$</span>con)</span>
<span id="cb316-13"><a href="#cb316-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb316-14"><a href="#cb316-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb316-15"><a href="#cb316-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
</section>
<section id="s4" class="level2">
<h2 class="anchored" data-anchor-id="s4">15 S4</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb317"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb317-1"><a href="#cb317-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>S4 provides a formal approach to functional OOP. The underlying ideas are similar to S3 (the topic of Chapter 13), but implementation is much stricter and makes use of specialised functions for creating classes (<code>setClass()</code>), generics (<code>setGeneric()</code>), and methods (<code>setMethod()</code>). Additionally, S4 provides both multiple inheritance (i.e.&nbsp;a class can have multiple parents) and multiple dispatch (i.e.&nbsp;method dispatch can use the class of multiple arguments).</p>
<p>An important new component of S4 is the <strong>slot</strong>, a named component of the object that is accessed using the specialised subsetting operator <code>@</code> (pronounced at). The set of slots, and their classes, forms an important part of the definition of an S4 class.</p>
<section id="exercises-9" class="level3">
<h3 class="anchored" data-anchor-id="exercises-9">15.2.1 Exercises</h3>
<ol type="1">
<li><code>lubridate::period()</code> returns an S4 class. What slots does it have? What class is each slot? What accessors does it provide?</li>
</ol>
<p>Answer: the S4 class, <code>Period</code>, has 6 slots: .Data, year, month, day, hour, and minute, all numeric. I couldn’t figure out how to get the accessors.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb318"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb318-1"><a href="#cb318-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> lubridate<span class="sc">::</span><span class="fu">period</span>()</span>
<span id="cb318-2"><a href="#cb318-2" aria-hidden="true" tabindex="-1"></a><span class="fu">is</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "Period"   "Timespan" "numeric"  "vector"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb320"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb320-1"><a href="#cb320-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vapply</span>(<span class="fu">slotNames</span>(p), <span class="cf">function</span>(x) <span class="fu">class</span>(<span class="fu">slot</span>(p, x)), <span class="fu">character</span>(<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;     .Data      year     month       day      hour    minute 
#&gt; "numeric" "numeric" "numeric" "numeric" "numeric" "numeric"</code></pre>
</div>
</div>
<p>AR Solutions: Objects of the S4 <code>Period</code> class have six slots named <code>year</code>, <code>month</code>, <code>day</code>, <code>hour</code>, <code>minute</code>, and <code>.Data</code> (which contains the number of seconds). All slots are of type double. Most fields can be retrieved by an identically named accessor (e.g.&nbsp;<code>lubridate::year()</code> will return the field), use <code>second()</code> to get the <code>.Data</code> slot.</p>
<p>As a short example, we create a period of 1 second, 2 minutes, 3 hours, 4 days and 5 weeks.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb322"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb322-1"><a href="#cb322-1" aria-hidden="true" tabindex="-1"></a>example_12345 <span class="ot">&lt;-</span> lubridate<span class="sc">::</span><span class="fu">period</span>(</span>
<span id="cb322-2"><a href="#cb322-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>),</span>
<span id="cb322-3"><a href="#cb322-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"second"</span>, <span class="st">"minute"</span>, <span class="st">"hour"</span>, <span class="st">"day"</span>, <span class="st">"week"</span>)</span>
<span id="cb322-4"><a href="#cb322-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This should add up to a period of 39 days, 3 hours, 2 minutes and 1 second.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb323"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb323-1"><a href="#cb323-1" aria-hidden="true" tabindex="-1"></a>example_12345</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "39d 3H 2M 1S"</code></pre>
</div>
</div>
<p>When we inspect <code>example_12345</code>, we see the fields and infer that the seconds are stored in the <code>.Data</code> field.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb325"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb325-1"><a href="#cb325-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(example_12345)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Formal class 'Period' [package "lubridate"] with 6 slots
#&gt;   ..@ .Data : num 1
#&gt;   ..@ year  : num 0
#&gt;   ..@ month : num 0
#&gt;   ..@ day   : num 39
#&gt;   ..@ hour  : num 3
#&gt;   ..@ minute: num 2</code></pre>
</div>
</div>
<p>Notes: it is easier to just use <code>getClass</code> to enumerate slots and slot classes:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb327"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb327-1"><a href="#cb327-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getClass</span>(<span class="fu">is</span>(lubridate<span class="sc">::</span><span class="fu">period</span>()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Class "Period" [package "lubridate"]
#&gt; 
#&gt; Slots:
#&gt;                                                       
#&gt; Name:    .Data    year   month     day    hour  minute
#&gt; Class: numeric numeric numeric numeric numeric numeric
#&gt; 
#&gt; Extends: 
#&gt; Class "Timespan", directly
#&gt; Class "numeric", from data part
#&gt; Class "vector", by class "numeric", distance 2</code></pre>
</div>
</div>
<p>Methods defined for a particular class can be listed using <code>showMethods()</code>, and S4 methods can be listed using <code>.S4methods()</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb329"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb329-1"><a href="#cb329-1" aria-hidden="true" tabindex="-1"></a><span class="fu">.S4methods</span>(<span class="st">"Period"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; no methods found</code></pre>
</div>
</div>
<p><code>Period</code> has no S4 methods, only regular functions.</p>
<hr>
<ol start="2" type="1">
<li>What other ways can you find help for a method? Read <code>?"?"</code> and summarise the details.</li>
</ol>
<p>Answer: there are three ways to get help for a method:</p>
<ol type="1">
<li><code>?function</code> provides the function documentation</li>
<li><code>methods?function</code> provides the overall documentation methods for the function</li>
<li><code>methods?function(signature)</code> provides the documentation for a specific method</li>
</ol>
<p>AR Solutions: Besides adding <code>?</code> in front of a function call (i.e.&nbsp;<code>?method()</code>), we may find:</p>
<ul>
<li>general documentation for a generic via <code>?genericName</code></li>
<li>general documentation for the methods of a generic via <code>methods?genericName</code></li>
<li>documentation for a specific method via <code>ClassName?methodName</code>.</li>
</ul>
<hr>
</section>
<section id="exercises-10" class="level3">
<h3 class="anchored" data-anchor-id="exercises-10">15.3.6 Exercises</h3>
<ol type="1">
<li>Extend the Person class with fields to match <code>utils::person()</code>. Think about what slots you will need, what class each slot should have, and what you’ll need to check in your validity method.</li>
</ol>
<p>Answer: the <code>Person</code> class uses the fields from <code>utils::person()</code>, excluding deprecated fields. Per the docs, <code>family</code> must be a string (length 1), others can be vectors (but this is not enforced).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb331"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb331-1"><a href="#cb331-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setClass</span>(<span class="st">"Person"</span>,</span>
<span id="cb331-2"><a href="#cb331-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">slots =</span> <span class="fu">c</span>(</span>
<span id="cb331-3"><a href="#cb331-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">given =</span> <span class="st">"character"</span>,</span>
<span id="cb331-4"><a href="#cb331-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">"character"</span>,</span>
<span id="cb331-5"><a href="#cb331-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">email =</span> <span class="st">"character"</span>,</span>
<span id="cb331-6"><a href="#cb331-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">role =</span> <span class="st">"character"</span>,</span>
<span id="cb331-7"><a href="#cb331-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">comment =</span> <span class="st">"character"</span></span>
<span id="cb331-8"><a href="#cb331-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb331-9"><a href="#cb331-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">prototype =</span> <span class="fu">list</span>(</span>
<span id="cb331-10"><a href="#cb331-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">given =</span> <span class="cn">NA_character_</span>,</span>
<span id="cb331-11"><a href="#cb331-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="cn">NA_character_</span>,</span>
<span id="cb331-12"><a href="#cb331-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">email =</span> <span class="cn">NA_character_</span>,</span>
<span id="cb331-13"><a href="#cb331-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">role =</span> <span class="cn">NA_character_</span>,</span>
<span id="cb331-14"><a href="#cb331-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">comment =</span> <span class="cn">NA_character_</span></span>
<span id="cb331-15"><a href="#cb331-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb331-16"><a href="#cb331-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb331-17"><a href="#cb331-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb331-18"><a href="#cb331-18" aria-hidden="true" tabindex="-1"></a><span class="fu">setValidity</span>(<span class="st">"Person"</span>, <span class="cf">function</span>(object) {</span>
<span id="cb331-19"><a href="#cb331-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># regex from https://www.nicebread.de/validating-email-adresses-in-r/</span></span>
<span id="cb331-20"><a href="#cb331-20" aria-hidden="true" tabindex="-1"></a>  regex <span class="ot">&lt;-</span> <span class="st">"</span><span class="sc">\\</span><span class="st">&lt;[A-Z0-9._%+-]+@[A-Z0-9.-]+</span><span class="sc">\\</span><span class="st">.[A-Z]{2,}</span><span class="sc">\\</span><span class="st">&gt;"</span></span>
<span id="cb331-21"><a href="#cb331-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb331-22"><a href="#cb331-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(object<span class="sc">@</span>family) <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb331-23"><a href="#cb331-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"@family must be a string (length 1)"</span></span>
<span id="cb331-24"><a href="#cb331-24" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(object<span class="sc">@</span>email) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(regex, object<span class="sc">@</span>email, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb331-25"><a href="#cb331-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"invalid @email"</span></span>
<span id="cb331-26"><a href="#cb331-26" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb331-27"><a href="#cb331-27" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span></span>
<span id="cb331-28"><a href="#cb331-28" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb331-29"><a href="#cb331-29" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">|&gt;</span></span>
<span id="cb331-30"><a href="#cb331-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">invisible</span>()</span>
<span id="cb331-31"><a href="#cb331-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb331-32"><a href="#cb331-32" aria-hidden="true" tabindex="-1"></a>Person <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">given =</span> <span class="cn">NA_character_</span>, <span class="at">family =</span> <span class="cn">NA_character_</span>,</span>
<span id="cb331-33"><a href="#cb331-33" aria-hidden="true" tabindex="-1"></a>                   <span class="at">email =</span> <span class="cn">NA_character_</span>, <span class="at">role =</span> <span class="cn">NA_character_</span>, <span class="at">comment =</span> <span class="cn">NA_character_</span>) {</span>
<span id="cb331-34"><a href="#cb331-34" aria-hidden="true" tabindex="-1"></a>  given <span class="ot">&lt;-</span> <span class="fu">as.character</span>(given)</span>
<span id="cb331-35"><a href="#cb331-35" aria-hidden="true" tabindex="-1"></a>  family <span class="ot">&lt;-</span> <span class="fu">as.character</span>(family)</span>
<span id="cb331-36"><a href="#cb331-36" aria-hidden="true" tabindex="-1"></a>  email <span class="ot">&lt;-</span> <span class="fu">as.character</span>(email)</span>
<span id="cb331-37"><a href="#cb331-37" aria-hidden="true" tabindex="-1"></a>  role <span class="ot">&lt;-</span> <span class="fu">as.character</span>(role)</span>
<span id="cb331-38"><a href="#cb331-38" aria-hidden="true" tabindex="-1"></a>  comment <span class="ot">&lt;-</span> <span class="fu">as.character</span>(comment)</span>
<span id="cb331-39"><a href="#cb331-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb331-40"><a href="#cb331-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">new</span>(<span class="st">"Person"</span>, <span class="at">given =</span> given, <span class="at">family =</span> family, <span class="at">email =</span> email, <span class="at">role =</span> role, <span class="at">comment =</span> comment)</span>
<span id="cb331-41"><a href="#cb331-41" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb331-42"><a href="#cb331-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb331-43"><a href="#cb331-43" aria-hidden="true" tabindex="-1"></a><span class="fu">Person</span>(<span class="st">"John"</span>, <span class="st">"Benninghoff"</span>, <span class="at">email =</span> <span class="st">"john@example.com"</span>, <span class="at">comment =</span> <span class="dv">51</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; An object of class "Person"
#&gt; Slot "given":
#&gt; [1] "John"
#&gt; 
#&gt; Slot "family":
#&gt; [1] "Benninghoff"
#&gt; 
#&gt; Slot "email":
#&gt; [1] "john@example.com"
#&gt; 
#&gt; Slot "role":
#&gt; [1] NA
#&gt; 
#&gt; Slot "comment":
#&gt; [1] "51"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb333"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb333-1"><a href="#cb333-1" aria-hidden="true" tabindex="-1"></a><span class="fu">try</span>(<span class="fu">Person</span>(<span class="st">"John"</span>, <span class="fu">c</span>(<span class="st">"Three"</span>, <span class="st">"Last"</span>, <span class="st">"Names"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Error in validObject(.Object) : 
#&gt;   invalid class "Person" object: @family must be a string (length 1)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb335"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb335-1"><a href="#cb335-1" aria-hidden="true" tabindex="-1"></a><span class="fu">try</span>(<span class="fu">Person</span>(<span class="st">"John"</span>, <span class="at">email =</span> <span class="st">"invalid@local"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Error in validObject(.Object) : 
#&gt;   invalid class "Person" object: invalid @email</code></pre>
</div>
</div>
<p>AR Solutions: The Person class from <em>Advanced R</em> contains the slots <code>name</code> and <code>age</code>. The person class from the <code>{utils}</code> package contains the slots <code>given</code> (vector of given names), <code>family</code>, <code>role</code>, <code>email</code> and <code>comment</code> (see <code>?utils::person</code>).</p>
<p>All slots from <code>utils::person()</code> besides <code>role</code> must be of type character and length 1. The entries in the <code>role</code> slot must match one of the following abbreviations “aut”, “com”, “cph”, “cre”, “ctb”, “ctr”, “dtc”, “fnd”, “rev”, “ths”, “trl”. Therefore, <code>role</code> might be of different length than the other slots and we’ll add a corresponding constraint within the validator.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb337"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb337-1"><a href="#cb337-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Definition of the Person class</span></span>
<span id="cb337-2"><a href="#cb337-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setClass</span>(<span class="st">"Person"</span>,</span>
<span id="cb337-3"><a href="#cb337-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">slots =</span> <span class="fu">c</span>(</span>
<span id="cb337-4"><a href="#cb337-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">age =</span> <span class="st">"numeric"</span>,</span>
<span id="cb337-5"><a href="#cb337-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">given =</span> <span class="st">"character"</span>,</span>
<span id="cb337-6"><a href="#cb337-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">"character"</span>,</span>
<span id="cb337-7"><a href="#cb337-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">role =</span> <span class="st">"character"</span>,</span>
<span id="cb337-8"><a href="#cb337-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">email =</span> <span class="st">"character"</span>,</span>
<span id="cb337-9"><a href="#cb337-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">comment =</span> <span class="st">"character"</span></span>
<span id="cb337-10"><a href="#cb337-10" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb337-11"><a href="#cb337-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">prototype =</span> <span class="fu">list</span>(</span>
<span id="cb337-12"><a href="#cb337-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">age =</span> <span class="cn">NA_real_</span>,</span>
<span id="cb337-13"><a href="#cb337-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">given =</span> <span class="cn">NA_character_</span>,</span>
<span id="cb337-14"><a href="#cb337-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="cn">NA_character_</span>,</span>
<span id="cb337-15"><a href="#cb337-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">role =</span> <span class="cn">NA_character_</span>,</span>
<span id="cb337-16"><a href="#cb337-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">email =</span> <span class="cn">NA_character_</span>,</span>
<span id="cb337-17"><a href="#cb337-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">comment =</span> <span class="cn">NA_character_</span></span>
<span id="cb337-18"><a href="#cb337-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb337-19"><a href="#cb337-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb337-20"><a href="#cb337-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper to create instances of the Person class</span></span>
<span id="cb337-21"><a href="#cb337-21" aria-hidden="true" tabindex="-1"></a>Person <span class="ot">&lt;-</span> <span class="cf">function</span>(given, family,</span>
<span id="cb337-22"><a href="#cb337-22" aria-hidden="true" tabindex="-1"></a>                   <span class="at">age =</span> <span class="cn">NA_real_</span>,</span>
<span id="cb337-23"><a href="#cb337-23" aria-hidden="true" tabindex="-1"></a>                   <span class="at">role =</span> <span class="cn">NA_character_</span>,</span>
<span id="cb337-24"><a href="#cb337-24" aria-hidden="true" tabindex="-1"></a>                   <span class="at">email =</span> <span class="cn">NA_character_</span>,</span>
<span id="cb337-25"><a href="#cb337-25" aria-hidden="true" tabindex="-1"></a>                   <span class="at">comment =</span> <span class="cn">NA_character_</span>) {</span>
<span id="cb337-26"><a href="#cb337-26" aria-hidden="true" tabindex="-1"></a>  age <span class="ot">&lt;-</span> <span class="fu">as.double</span>(age)</span>
<span id="cb337-27"><a href="#cb337-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">new</span>(<span class="st">"Person"</span>,</span>
<span id="cb337-28"><a href="#cb337-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">age =</span> age,</span>
<span id="cb337-29"><a href="#cb337-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">given =</span> given,</span>
<span id="cb337-30"><a href="#cb337-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> family,</span>
<span id="cb337-31"><a href="#cb337-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">role =</span> role,</span>
<span id="cb337-32"><a href="#cb337-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">email =</span> email,</span>
<span id="cb337-33"><a href="#cb337-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">comment =</span> comment</span>
<span id="cb337-34"><a href="#cb337-34" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb337-35"><a href="#cb337-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb337-36"><a href="#cb337-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Validator to ensure that each slot is of length one</span></span>
<span id="cb337-37"><a href="#cb337-37" aria-hidden="true" tabindex="-1"></a><span class="fu">setValidity</span>(<span class="st">"Person"</span>, <span class="cf">function</span>(object) { <span class="co"># nolint: cyclocomp_linter.</span></span>
<span id="cb337-38"><a href="#cb337-38" aria-hidden="true" tabindex="-1"></a>  invalids <span class="ot">&lt;-</span> <span class="fu">character</span>(<span class="dv">0</span>)</span>
<span id="cb337-39"><a href="#cb337-39" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(object<span class="sc">@</span>age) <span class="sc">!=</span> <span class="dv">1</span> <span class="sc">||</span></span>
<span id="cb337-40"><a href="#cb337-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">length</span>(object<span class="sc">@</span>given) <span class="sc">!=</span> <span class="dv">1</span> <span class="sc">||</span></span>
<span id="cb337-41"><a href="#cb337-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">length</span>(object<span class="sc">@</span>family) <span class="sc">!=</span> <span class="dv">1</span> <span class="sc">||</span></span>
<span id="cb337-42"><a href="#cb337-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">length</span>(object<span class="sc">@</span>email) <span class="sc">!=</span> <span class="dv">1</span> <span class="sc">||</span></span>
<span id="cb337-43"><a href="#cb337-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">length</span>(object<span class="sc">@</span>comment) <span class="sc">!=</span> <span class="dv">1</span>) {</span>
<span id="cb337-44"><a href="#cb337-44" aria-hidden="true" tabindex="-1"></a>    invalids <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb337-45"><a href="#cb337-45" aria-hidden="true" tabindex="-1"></a>      <span class="st">"@name, @age, @given, @family, @email, "</span>,</span>
<span id="cb337-46"><a href="#cb337-46" aria-hidden="true" tabindex="-1"></a>      <span class="st">"@comment must be of length 1"</span></span>
<span id="cb337-47"><a href="#cb337-47" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb337-48"><a href="#cb337-48" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb337-49"><a href="#cb337-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-50"><a href="#cb337-50" aria-hidden="true" tabindex="-1"></a>  known_roles <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb337-51"><a href="#cb337-51" aria-hidden="true" tabindex="-1"></a>    <span class="cn">NA_character_</span>, <span class="st">"aut"</span>, <span class="st">"com"</span>, <span class="st">"cph"</span>, <span class="st">"cre"</span>, <span class="st">"ctb"</span>,</span>
<span id="cb337-52"><a href="#cb337-52" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ctr"</span>, <span class="st">"dtc"</span>, <span class="st">"fnd"</span>, <span class="st">"rev"</span>, <span class="st">"ths"</span>, <span class="st">"trl"</span></span>
<span id="cb337-53"><a href="#cb337-53" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb337-54"><a href="#cb337-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-55"><a href="#cb337-55" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(object<span class="sc">@</span>role <span class="sc">%in%</span> known_roles)) {</span>
<span id="cb337-56"><a href="#cb337-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(</span>
<span id="cb337-57"><a href="#cb337-57" aria-hidden="true" tabindex="-1"></a>      <span class="st">"@role(s) must be one of"</span>,</span>
<span id="cb337-58"><a href="#cb337-58" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste</span>(known_roles, <span class="at">collapse =</span> <span class="st">", "</span>) <span class="co"># nolint: paste_linter.</span></span>
<span id="cb337-59"><a href="#cb337-59" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb337-60"><a href="#cb337-60" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb337-61"><a href="#cb337-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-62"><a href="#cb337-62" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(invalids)) {</span>
<span id="cb337-63"><a href="#cb337-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(invalids)</span>
<span id="cb337-64"><a href="#cb337-64" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb337-65"><a href="#cb337-65" aria-hidden="true" tabindex="-1"></a>  <span class="cn">TRUE</span></span>
<span id="cb337-66"><a href="#cb337-66" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">|&gt;</span></span>
<span id="cb337-67"><a href="#cb337-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">invisible</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notes: while I missed including <code>age</code>, our implementations are similar except for validations.</p>
<hr>
<ol start="2" type="1">
<li>What happens if you define a new S4 class that doesn’t have any slots? (Hint: read about virtual classes in <code>?setClass</code>.)</li>
</ol>
<p>Answer: defining a new class with no slots makes it a virtual class, which can’t be used to create new objects, but can be used to define a class union.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb338"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb338-1"><a href="#cb338-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setClass</span>(<span class="st">"Virtual"</span>)</span>
<span id="cb338-2"><a href="#cb338-2" aria-hidden="true" tabindex="-1"></a><span class="fu">try</span>(<span class="fu">new</span>(<span class="st">"Virtual"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Error in new("Virtual") : 
#&gt;   trying to generate an object from a virtual class ("Virtual")</code></pre>
</div>
<div class="sourceCode cell-code" id="cb340"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb340-1"><a href="#cb340-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setClassUnion</span>(<span class="st">"Virtual"</span>, <span class="st">"Person"</span>)</span>
<span id="cb340-2"><a href="#cb340-2" aria-hidden="true" tabindex="-1"></a><span class="fu">getClass</span>(<span class="st">"Virtual"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Extended class definition ( "ClassUnionRepresentation" )
#&gt; Virtual Class "Virtual" [in ".GlobalEnv"]
#&gt; 
#&gt; No Slots, prototype of class "Person"
#&gt; 
#&gt; Known Subclasses: "Person"</code></pre>
</div>
</div>
<p>AR Solutions: It depends on the other arguments. If we inherit from another class, we get the same slots. But something interesting happens if we don’t inherit from an existing class. We get a virtual class. A virtual class can’t be instantiated:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb342"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb342-1"><a href="#cb342-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setClass</span>(<span class="st">"Human"</span>)</span>
<span id="cb342-2"><a href="#cb342-2" aria-hidden="true" tabindex="-1"></a><span class="fu">try</span>(<span class="fu">new</span>(<span class="st">"Human"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Error in new("Human") : 
#&gt;   trying to generate an object from a virtual class ("Human")</code></pre>
</div>
</div>
<p>But can be inherited from:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb344"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb344-1"><a href="#cb344-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setClass</span>(<span class="st">"Programmer"</span>, <span class="at">contains =</span> <span class="st">"Human"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ol start="3" type="1">
<li>Imagine you were going to reimplement factors, dates, and data frames in S4. Sketch out the <code>setClass()</code> calls that you would use to define the classes. Think about appropriate <code>slots</code> and <code>prototype</code>.</li>
</ol>
<p>Answer: sketch below. Default values would be set in <code>initialize()</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb345"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb345-1"><a href="#cb345-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setClass</span>(<span class="st">"Factor"</span>,</span>
<span id="cb345-2"><a href="#cb345-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">slots =</span> <span class="fu">list</span>(</span>
<span id="cb345-3"><a href="#cb345-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"character"</span>,</span>
<span id="cb345-4"><a href="#cb345-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="st">"character"</span>,</span>
<span id="cb345-5"><a href="#cb345-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="st">"character"</span>,</span>
<span id="cb345-6"><a href="#cb345-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">exclude =</span> <span class="st">"character"</span>,</span>
<span id="cb345-7"><a href="#cb345-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">ordered =</span> <span class="st">"logical"</span>,</span>
<span id="cb345-8"><a href="#cb345-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">nmax =</span> <span class="st">"integer"</span></span>
<span id="cb345-9"><a href="#cb345-9" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb345-10"><a href="#cb345-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">prototype =</span> <span class="fu">list</span>(</span>
<span id="cb345-11"><a href="#cb345-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">character</span>(<span class="dv">0</span>),</span>
<span id="cb345-12"><a href="#cb345-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">character</span>(<span class="dv">0</span>),</span>
<span id="cb345-13"><a href="#cb345-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">character</span>(<span class="dv">0</span>),</span>
<span id="cb345-14"><a href="#cb345-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">exclude =</span> <span class="cn">NA_character_</span>,</span>
<span id="cb345-15"><a href="#cb345-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">ordered =</span> <span class="cn">FALSE</span>,</span>
<span id="cb345-16"><a href="#cb345-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">nmax =</span> <span class="cn">NA_integer_</span></span>
<span id="cb345-17"><a href="#cb345-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb345-18"><a href="#cb345-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb345-19"><a href="#cb345-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb345-20"><a href="#cb345-20" aria-hidden="true" tabindex="-1"></a><span class="fu">setClass</span>(<span class="st">"S4Date"</span>,</span>
<span id="cb345-21"><a href="#cb345-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">slots =</span> <span class="fu">list</span>(</span>
<span id="cb345-22"><a href="#cb345-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">days =</span> <span class="st">"integer"</span></span>
<span id="cb345-23"><a href="#cb345-23" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb345-24"><a href="#cb345-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">prototype =</span> <span class="fu">list</span>(</span>
<span id="cb345-25"><a href="#cb345-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">days =</span> <span class="dv">0</span>L</span>
<span id="cb345-26"><a href="#cb345-26" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb345-27"><a href="#cb345-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb345-28"><a href="#cb345-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb345-29"><a href="#cb345-29" aria-hidden="true" tabindex="-1"></a><span class="fu">setClass</span>(<span class="st">"DataFrame"</span>,</span>
<span id="cb345-30"><a href="#cb345-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">slots =</span> <span class="fu">list</span>(</span>
<span id="cb345-31"><a href="#cb345-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="st">"matrix"</span>,</span>
<span id="cb345-32"><a href="#cb345-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_names =</span> <span class="st">"character"</span>,</span>
<span id="cb345-33"><a href="#cb345-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">row_names =</span> <span class="st">"character"</span></span>
<span id="cb345-34"><a href="#cb345-34" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb345-35"><a href="#cb345-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">prototype =</span> <span class="fu">list</span>(</span>
<span id="cb345-36"><a href="#cb345-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="dv">0</span>, <span class="at">ncol =</span> <span class="dv">0</span>),</span>
<span id="cb345-37"><a href="#cb345-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_names =</span> <span class="cn">NULL</span>,</span>
<span id="cb345-38"><a href="#cb345-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">row_names =</span> <span class="cn">NULL</span></span>
<span id="cb345-39"><a href="#cb345-39" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb345-40"><a href="#cb345-40" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>AR Solutions: For all these classes we need one slot for the data and one slot per attribute. Keep in mind, that inheritance matters for ordered factors and dates. For data frames, special checks like equal lengths of the underlying list’s elements should be done within a validator.</p>
<p>For simplicity we don’t introduce an explicit subclass for ordered factors. Instead, we introduce <code>ordered</code> as a slot.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb346"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb346-1"><a href="#cb346-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setClass</span>(<span class="st">"Factor"</span>,</span>
<span id="cb346-2"><a href="#cb346-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">slots =</span> <span class="fu">c</span>(</span>
<span id="cb346-3"><a href="#cb346-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="st">"integer"</span>,</span>
<span id="cb346-4"><a href="#cb346-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="st">"character"</span>,</span>
<span id="cb346-5"><a href="#cb346-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">ordered =</span> <span class="st">"logical"</span></span>
<span id="cb346-6"><a href="#cb346-6" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb346-7"><a href="#cb346-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">prototype =</span> <span class="fu">list</span>(</span>
<span id="cb346-8"><a href="#cb346-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">integer</span>(),</span>
<span id="cb346-9"><a href="#cb346-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">character</span>(),</span>
<span id="cb346-10"><a href="#cb346-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">ordered =</span> <span class="cn">FALSE</span></span>
<span id="cb346-11"><a href="#cb346-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb346-12"><a href="#cb346-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb346-13"><a href="#cb346-13" aria-hidden="true" tabindex="-1"></a><span class="fu">new</span>(<span class="st">"Factor"</span>, <span class="at">data =</span> <span class="fu">c</span>(<span class="dv">1</span>L, <span class="dv">2</span>L), <span class="at">levels =</span> letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; An object of class "Factor"
#&gt; Slot "data":
#&gt; [1] 1 2
#&gt; 
#&gt; Slot "levels":
#&gt; [1] "a" "b" "c"
#&gt; 
#&gt; Slot "ordered":
#&gt; [1] FALSE</code></pre>
</div>
</div>
<p>The <code>Date2</code> class stores its dates as integers, similarly to base R which uses doubles. Dates don’t have any other attributes.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb348"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb348-1"><a href="#cb348-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setClass</span>(<span class="st">"Date2"</span>,</span>
<span id="cb348-2"><a href="#cb348-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">slots =</span> <span class="fu">list</span>(</span>
<span id="cb348-3"><a href="#cb348-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="st">"integer"</span></span>
<span id="cb348-4"><a href="#cb348-4" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb348-5"><a href="#cb348-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prototype =</span> <span class="fu">list</span>(</span>
<span id="cb348-6"><a href="#cb348-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">integer</span>()</span>
<span id="cb348-7"><a href="#cb348-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb348-8"><a href="#cb348-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb348-9"><a href="#cb348-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb348-10"><a href="#cb348-10" aria-hidden="true" tabindex="-1"></a><span class="fu">new</span>(<span class="st">"Date2"</span>, <span class="at">data =</span> <span class="dv">1</span>L)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; An object of class "Date2"
#&gt; Slot "data":
#&gt; [1] 1</code></pre>
</div>
</div>
<p>Our <code>DataFrame</code> class consists of a list and a slot for <code>row.names</code>. Most of the logic (e.g.&nbsp;checking that all elements of the list are a vector, and that they all have the same length) would need to be part of a validator.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb350"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb350-1"><a href="#cb350-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setClass</span>(<span class="st">"DataFrame"</span>,</span>
<span id="cb350-2"><a href="#cb350-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">slots =</span> <span class="fu">c</span>(</span>
<span id="cb350-3"><a href="#cb350-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="st">"list"</span>,</span>
<span id="cb350-4"><a href="#cb350-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">row.names =</span> <span class="st">"character"</span></span>
<span id="cb350-5"><a href="#cb350-5" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb350-6"><a href="#cb350-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">prototype =</span> <span class="fu">list</span>(</span>
<span id="cb350-7"><a href="#cb350-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">list</span>(),</span>
<span id="cb350-8"><a href="#cb350-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">row.names =</span> <span class="fu">character</span>(<span class="dv">0</span>)</span>
<span id="cb350-9"><a href="#cb350-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb350-10"><a href="#cb350-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb350-11"><a href="#cb350-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb350-12"><a href="#cb350-12" aria-hidden="true" tabindex="-1"></a><span class="fu">new</span>(<span class="st">"DataFrame"</span>, <span class="at">data =</span> <span class="fu">list</span>(<span class="at">a =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; An object of class "DataFrame"
#&gt; Slot "data":
#&gt; $a
#&gt; [1] 1
#&gt; 
#&gt; $b
#&gt; [1] 2
#&gt; 
#&gt; 
#&gt; Slot "row.names":
#&gt; character(0)</code></pre>
</div>
</div>
<p>Notes:</p>
<ul>
<li>A key insight from AR Solutions is that the objects need one slot for data and one for each attribute</li>
<li>My implementation of <code>Factor</code> is wrong, where the AR Solutions answer is clearly right</li>
<li>The implementations of the new <code>Date</code> object are similar; the prototype for AR Solutions is better</li>
<li>The AR Solutions <code>DataFrame</code> omits column names (names), where mine does not; using a list for the data in <code>DataFrame</code> is a better choice, but harder to implement</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb352"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb352-1"><a href="#cb352-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(<span class="fu">data.frame</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; $names
#&gt; character(0)
#&gt; 
#&gt; $row.names
#&gt; integer(0)
#&gt; 
#&gt; $class
#&gt; [1] "data.frame"</code></pre>
</div>
</div>
<hr>
</section>
<section id="exercises-11" class="level3">
<h3 class="anchored" data-anchor-id="exercises-11">15.4.5 Exercises</h3>
<ol type="1">
<li>Add <code>age()</code> accessors for the <code>Person</code> class.</li>
</ol>
<p>Answer: the code below adds age accessors to Advanced R <code>Person</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb354"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb354-1"><a href="#cb354-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setClass</span>(<span class="st">"Person"</span>,</span>
<span id="cb354-2"><a href="#cb354-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">slots =</span> <span class="fu">c</span>(</span>
<span id="cb354-3"><a href="#cb354-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"character"</span>,</span>
<span id="cb354-4"><a href="#cb354-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">age =</span> <span class="st">"numeric"</span></span>
<span id="cb354-5"><a href="#cb354-5" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb354-6"><a href="#cb354-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">prototype =</span> <span class="fu">list</span>(</span>
<span id="cb354-7"><a href="#cb354-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="cn">NA_character_</span>,</span>
<span id="cb354-8"><a href="#cb354-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">age =</span> <span class="cn">NA_real_</span></span>
<span id="cb354-9"><a href="#cb354-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb354-10"><a href="#cb354-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb354-11"><a href="#cb354-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb354-12"><a href="#cb354-12" aria-hidden="true" tabindex="-1"></a>john <span class="ot">&lt;-</span> <span class="fu">new</span>(<span class="st">"Person"</span>, <span class="at">name =</span> <span class="st">"John Smith"</span>)</span>
<span id="cb354-13"><a href="#cb354-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb354-14"><a href="#cb354-14" aria-hidden="true" tabindex="-1"></a><span class="fu">setGeneric</span>(<span class="st">"age"</span>, <span class="cf">function</span>(x) <span class="fu">standardGeneric</span>(<span class="st">"age"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb354-15"><a href="#cb354-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">invisible</span>()</span>
<span id="cb354-16"><a href="#cb354-16" aria-hidden="true" tabindex="-1"></a><span class="fu">setMethod</span>(<span class="st">"age"</span>, <span class="st">"Person"</span>, <span class="cf">function</span>(x) x<span class="sc">@</span>age)</span>
<span id="cb354-17"><a href="#cb354-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb354-18"><a href="#cb354-18" aria-hidden="true" tabindex="-1"></a><span class="fu">age</span>(john)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb356"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb356-1"><a href="#cb356-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setGeneric</span>(<span class="st">"age&lt;-"</span>, <span class="cf">function</span>(x, value) <span class="fu">standardGeneric</span>(<span class="st">"age&lt;-"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb356-2"><a href="#cb356-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">invisible</span>()</span>
<span id="cb356-3"><a href="#cb356-3" aria-hidden="true" tabindex="-1"></a><span class="fu">setMethod</span>(<span class="st">"age&lt;-"</span>, <span class="st">"Person"</span>, <span class="cf">function</span>(x, value) {</span>
<span id="cb356-4"><a href="#cb356-4" aria-hidden="true" tabindex="-1"></a>  x<span class="sc">@</span>age <span class="ot">&lt;-</span> value</span>
<span id="cb356-5"><a href="#cb356-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">validObject</span>(x)</span>
<span id="cb356-6"><a href="#cb356-6" aria-hidden="true" tabindex="-1"></a>  x</span>
<span id="cb356-7"><a href="#cb356-7" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb356-8"><a href="#cb356-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb356-9"><a href="#cb356-9" aria-hidden="true" tabindex="-1"></a><span class="fu">age</span>(john) <span class="ot">&lt;-</span> <span class="dv">51</span></span>
<span id="cb356-10"><a href="#cb356-10" aria-hidden="true" tabindex="-1"></a><span class="fu">age</span>(john)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 51</code></pre>
</div>
</div>
<p>AR Solutions: We implement the accessors via an <code>age()</code> generic, with a method for the <code>Person</code> class and a corresponding replacement function <code>age&lt;-</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb358"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb358-1"><a href="#cb358-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setGeneric</span>(<span class="st">"age"</span>, <span class="cf">function</span>(x) <span class="fu">standardGeneric</span>(<span class="st">"age"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "age"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb360"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb360-1"><a href="#cb360-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setMethod</span>(<span class="st">"age"</span>, <span class="st">"Person"</span>, <span class="cf">function</span>(x) x<span class="sc">@</span>age)</span>
<span id="cb360-2"><a href="#cb360-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb360-3"><a href="#cb360-3" aria-hidden="true" tabindex="-1"></a><span class="fu">setGeneric</span>(<span class="st">"age&lt;-"</span>, <span class="cf">function</span>(x, value) <span class="fu">standardGeneric</span>(<span class="st">"age&lt;-"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "age&lt;-"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb362"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb362-1"><a href="#cb362-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setMethod</span>(<span class="st">"age&lt;-"</span>, <span class="st">"Person"</span>, <span class="cf">function</span>(x, value) {</span>
<span id="cb362-2"><a href="#cb362-2" aria-hidden="true" tabindex="-1"></a>  x<span class="sc">@</span>age <span class="ot">&lt;-</span> value</span>
<span id="cb362-3"><a href="#cb362-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">validObject</span>(x)</span>
<span id="cb362-4"><a href="#cb362-4" aria-hidden="true" tabindex="-1"></a>  x</span>
<span id="cb362-5"><a href="#cb362-5" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ol start="2" type="1">
<li>In the definition of the generic, why is it necessary to repeat the name of the generic twice?</li>
</ol>
<p>Answer: according to the R docs, <code>setGeneric(name)</code> specifies an existing function. When creating a new generic, the form <code>setGeneric(name, def)</code> is used, where <code>def</code> is <code>standardGeneric(name)</code>.</p>
<p>AR Solutions: Within <code>setGeneric()</code> the <code>name</code> (1st argument) is needed as the name of the generic. Then, the name also explicitly incorporates method dispatch via <code>standardGeneric()</code> within the generic’s body (<code>def</code> parameter of <code>setGeneric()</code>). This behaviour is similar to <code>UseMethod()</code> in S3.</p>
<hr>
<ol start="3" type="1">
<li>Why does the <code>show()</code> method defined in Section 15.4.3 use <code>is(object)[[1]]</code>? (Hint: try printing the employee subclass.)</li>
</ol>
<p>Answer: <code>is(object)</code> returns a vector for a subclass, with the current class first.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb363"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb363-1"><a href="#cb363-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setClass</span>(<span class="st">"Employee"</span>,</span>
<span id="cb363-2"><a href="#cb363-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">contains =</span> <span class="st">"Person"</span>,</span>
<span id="cb363-3"><a href="#cb363-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">slots =</span> <span class="fu">c</span>(</span>
<span id="cb363-4"><a href="#cb363-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">boss =</span> <span class="st">"Person"</span></span>
<span id="cb363-5"><a href="#cb363-5" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb363-6"><a href="#cb363-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">prototype =</span> <span class="fu">list</span>(</span>
<span id="cb363-7"><a href="#cb363-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">boss =</span> <span class="fu">new</span>(<span class="st">"Person"</span>)</span>
<span id="cb363-8"><a href="#cb363-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb363-9"><a href="#cb363-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb363-10"><a href="#cb363-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-11"><a href="#cb363-11" aria-hidden="true" tabindex="-1"></a><span class="fu">setMethod</span>(<span class="st">"show"</span>, <span class="st">"Person"</span>, <span class="cf">function</span>(object) {</span>
<span id="cb363-12"><a href="#cb363-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">is</span>(object)[[<span class="dv">1</span>]], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb363-13"><a href="#cb363-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"  Name: "</span>, object<span class="sc">@</span>name, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb363-14"><a href="#cb363-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"  Age:  "</span>, object<span class="sc">@</span>age, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb363-15"><a href="#cb363-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep =</span> <span class="st">""</span></span>
<span id="cb363-16"><a href="#cb363-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb363-17"><a href="#cb363-17" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb363-18"><a href="#cb363-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-19"><a href="#cb363-19" aria-hidden="true" tabindex="-1"></a>john</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Person
#&gt;   Name: John Smith
#&gt;   Age:  51</code></pre>
</div>
<div class="sourceCode cell-code" id="cb365"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb365-1"><a href="#cb365-1" aria-hidden="true" tabindex="-1"></a>jane <span class="ot">&lt;-</span> <span class="fu">new</span>(<span class="st">"Employee"</span>, <span class="at">name =</span> <span class="st">"Jane Doe"</span>)</span>
<span id="cb365-2"><a href="#cb365-2" aria-hidden="true" tabindex="-1"></a><span class="fu">is</span>(jane)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "Employee" "Person"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb367"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb367-1"><a href="#cb367-1" aria-hidden="true" tabindex="-1"></a>jane</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Employee
#&gt;   Name: Jane Doe
#&gt;   Age:  NA</code></pre>
</div>
</div>
<p>AR Solutions: <code>is(object)</code> returns the class of the object. <code>is(object)</code> also contains the superclass, for subclasses like <code>Employee</code>. In order to always return the most specific class (the subclass), <code>show()</code> returns the first element of <code>is(object)</code>.</p>
<hr>
<ol start="4" type="1">
<li>What happens if you define a method with different argument names to the generic?</li>
</ol>
<p>Answer: this should cause method dispatch to fail, but I don’t know of a way to test.</p>
<p>AR Solutions: It depends. We first create the object <code>hadley</code> of class <code>Person</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb369"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb369-1"><a href="#cb369-1" aria-hidden="true" tabindex="-1"></a>.Person <span class="ot">&lt;-</span> <span class="fu">setClass</span>(</span>
<span id="cb369-2"><a href="#cb369-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Person"</span>,</span>
<span id="cb369-3"><a href="#cb369-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">slots =</span> <span class="fu">c</span>(<span class="at">name =</span> <span class="st">"character"</span>, <span class="at">age =</span> <span class="st">"numeric"</span>)</span>
<span id="cb369-4"><a href="#cb369-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb369-5"><a href="#cb369-5" aria-hidden="true" tabindex="-1"></a>hadley <span class="ot">&lt;-</span> <span class="fu">.Person</span>(<span class="at">name =</span> <span class="st">"Hadley"</span>)</span>
<span id="cb369-6"><a href="#cb369-6" aria-hidden="true" tabindex="-1"></a>hadley</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Person
#&gt;   Name: Hadley
#&gt;   Age:</code></pre>
</div>
</div>
<p>Now let’s see which arguments can be supplied to the <code>show()</code> generic.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb371"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb371-1"><a href="#cb371-1" aria-hidden="true" tabindex="-1"></a><span class="fu">formals</span>(<span class="st">"show"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; $object</code></pre>
</div>
</div>
<p>Usually, we would use this argument when defining a new method.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb373"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb373-1"><a href="#cb373-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setMethod</span>(<span class="st">"show"</span>, <span class="st">"Person"</span>, <span class="cf">function</span>(object) {</span>
<span id="cb373-2"><a href="#cb373-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(object<span class="sc">@</span>name, <span class="st">"creates hard exercises"</span>)</span>
<span id="cb373-3"><a href="#cb373-3" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb373-4"><a href="#cb373-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb373-5"><a href="#cb373-5" aria-hidden="true" tabindex="-1"></a>hadley</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Hadley creates hard exercises</code></pre>
</div>
</div>
<p>When we supply another name as a first element of our method (e.g.&nbsp;<code>x</code> instead of <code>object</code>), this element will be matched to the correct <code>object</code> argument and we receive a warning. Our method will work, though:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb375"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb375-1"><a href="#cb375-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setMethod</span>(<span class="st">"show"</span>, <span class="st">"Person"</span>, <span class="cf">function</span>(x) {</span>
<span id="cb375-2"><a href="#cb375-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(x<span class="sc">@</span>name, <span class="st">"creates hard exercises"</span>)</span>
<span id="cb375-3"><a href="#cb375-3" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; Warning: For function 'show', signature 'Person': argument in method definition
#&gt; changed from (x) to (object)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb377"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb377-1"><a href="#cb377-1" aria-hidden="true" tabindex="-1"></a>hadley</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Hadley creates hard exercises</code></pre>
</div>
</div>
<p>If we add more arguments to our method than our generic can handle, we will get an error.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb379"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb379-1"><a href="#cb379-1" aria-hidden="true" tabindex="-1"></a><span class="fu">try</span>(</span>
<span id="cb379-2"><a href="#cb379-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setMethod</span>(<span class="st">"show"</span>, <span class="st">"Person"</span>, <span class="cf">function</span>(x, y) {</span>
<span id="cb379-3"><a href="#cb379-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(x<span class="sc">@</span>name, <span class="st">"is"</span>, x<span class="sc">@</span>age, <span class="st">"years old"</span>)</span>
<span id="cb379-4"><a href="#cb379-4" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb379-5"><a href="#cb379-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Error in conformMethod(signature, mnames, fnames, f, fdef, definition) : 
#&gt;   in method for 'show' with signature 'object="Person"': formal arguments (object = "Person") omitted in the method definition cannot be in the signature</code></pre>
</div>
</div>
<p>If we do this with arguments added to the correctly written <code>object</code> argument, we will receive an informative error message. It states that we could add other argument names for generics, which can take the <code>...</code> argument.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb381"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb381-1"><a href="#cb381-1" aria-hidden="true" tabindex="-1"></a><span class="fu">try</span>(</span>
<span id="cb381-2"><a href="#cb381-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setMethod</span>(<span class="st">"show"</span>, <span class="st">"Person"</span>, <span class="cf">function</span>(object, y) {</span>
<span id="cb381-3"><a href="#cb381-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(object<span class="sc">@</span>name, <span class="st">"is"</span>, object<span class="sc">@</span>age, <span class="st">"years old"</span>)</span>
<span id="cb381-4"><a href="#cb381-4" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb381-5"><a href="#cb381-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Error in rematchDefinition(definition, fdef, mnames, fnames, signature) : 
#&gt;   methods can add arguments to the generic 'show' only if '...' is an argument to the generic</code></pre>
</div>
</div>
<hr>
</section>
<section id="exercises-12" class="level3">
<h3 class="anchored" data-anchor-id="exercises-12">15.5.5 Exercises</h3>
<ol type="1">
<li>Draw the method graph for <code>f(sweat_smile, kissing_cat)</code></li>
</ol>
<p>Answer: skipped.</p>
<p>AR Solutions: Look at the graph and repeat after me: “I will keep my class structure simple and use multiple inheritance sparingly”.</p>
<hr>
<ol start="2" type="1">
<li>Draw the method graph for <code>f(smiley, wink, kissing_smiling_eyes)</code></li>
</ol>
<p>Answer: skipped.</p>
<p>AR Solutions: We see that the method graph below looks simpler than the one above. Relatively speaking, multiple dispatch seems to introduce less complexity than multiple inheritance. Use it with care, though!</p>
<hr>
<ol start="3" type="1">
<li>Take the last example which shows multiple dispatch over two classes that use multiple inheritance. What happens if you define a method for all terminal classes? Why does method dispatch not save us much work here?</li>
</ol>
<p>Answer: since all terminal nodes are equidistant from the classes, the method is ambiguous. This is true at the first level as well. The only way to avoid ambiguity is to avoid method dispatch altogether and define a method at the root node.</p>
<p>AR Solutions: We will introduce ambiguity, since one class has distance 2 to all terminal nodes and the other four have distance 1 to two terminal nodes each. To resolve this ambiguity we have to define five more methods, one per class combination.</p>
<hr>
</section>
<section id="exercises-13" class="level3">
<h3 class="anchored" data-anchor-id="exercises-13">15.6.3 Exercises</h3>
<ol type="1">
<li>What would a full <code>setOldClass()</code> definition look like for an ordered factor (i.e.&nbsp;add <code>slots</code> and <code>prototype</code> the definition above)?</li>
</ol>
<p>Answer: building on the AR Solutions example and the <code>factor</code> example in 15.6.1, the following S4 object behaves like the <code>ordered()</code> version:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb383"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb383-1"><a href="#cb383-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setClass</span>(<span class="st">"Ordered"</span>,</span>
<span id="cb383-2"><a href="#cb383-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">contains =</span> <span class="st">"integer"</span>,</span>
<span id="cb383-3"><a href="#cb383-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">slots =</span> <span class="fu">c</span>(</span>
<span id="cb383-4"><a href="#cb383-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="st">"character"</span>,</span>
<span id="cb383-5"><a href="#cb383-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">ordered =</span> <span class="st">"logical"</span></span>
<span id="cb383-6"><a href="#cb383-6" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb383-7"><a href="#cb383-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">prototype =</span> <span class="fu">structure</span>(</span>
<span id="cb383-8"><a href="#cb383-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">integer</span>(),</span>
<span id="cb383-9"><a href="#cb383-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">character</span>(),</span>
<span id="cb383-10"><a href="#cb383-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">ordered =</span> <span class="cn">TRUE</span></span>
<span id="cb383-11"><a href="#cb383-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb383-12"><a href="#cb383-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb383-13"><a href="#cb383-13" aria-hidden="true" tabindex="-1"></a><span class="fu">setOldClass</span>(<span class="st">"ordered"</span>, <span class="at">S4Class =</span> <span class="st">"Ordered"</span>)</span>
<span id="cb383-14"><a href="#cb383-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb383-15"><a href="#cb383-15" aria-hidden="true" tabindex="-1"></a>o <span class="ot">&lt;-</span> <span class="fu">new</span>(<span class="st">"Ordered"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">levels =</span> letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>])</span>
<span id="cb383-16"><a href="#cb383-16" aria-hidden="true" tabindex="-1"></a>o</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; An object of class "Ordered"
#&gt; [1] 1 2 3 4
#&gt; Slot "levels":
#&gt; [1] "a" "b" "c" "d"
#&gt; 
#&gt; Slot "ordered":
#&gt; [1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb385"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb385-1"><a href="#cb385-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(<span class="fu">ordered</span>(<span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  Ord.factor w/ 4 levels "a"&lt;"b"&lt;"c"&lt;"d": 1 2 3 4</code></pre>
</div>
</div>
<p>AR Solutions: The purpose of <code>setOldClass()</code> lies in registering an S3 class as a “formally defined class”, so that it can be used within the S4 object-oriented programming system. When using it, we may provide the argument <code>S4Class</code>, which will inherit the slots and their default values (prototype) to the registered class.</p>
<p>Let’s build an S4 <code>OrderedFactor</code> on top of the S3 factor in such a way.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb387"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb387-1"><a href="#cb387-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setOldClass</span>(<span class="st">"factor"</span>) <span class="co"># use build-in definition for brevity</span></span>
<span id="cb387-2"><a href="#cb387-2" aria-hidden="true" tabindex="-1"></a>OrderedFactor <span class="ot">&lt;-</span> <span class="fu">setClass</span>(</span>
<span id="cb387-3"><a href="#cb387-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"OrderedFactor"</span>,</span>
<span id="cb387-4"><a href="#cb387-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">contains =</span> <span class="st">"factor"</span>, <span class="co"># inherit from registered S3 class</span></span>
<span id="cb387-5"><a href="#cb387-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">slots =</span> <span class="fu">c</span>(</span>
<span id="cb387-6"><a href="#cb387-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="st">"character"</span>,</span>
<span id="cb387-7"><a href="#cb387-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">ordered =</span> <span class="st">"logical"</span> <span class="co"># add logical order slot</span></span>
<span id="cb387-8"><a href="#cb387-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb387-9"><a href="#cb387-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">prototype =</span> <span class="fu">structure</span>(</span>
<span id="cb387-10"><a href="#cb387-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">integer</span>(),</span>
<span id="cb387-11"><a href="#cb387-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">character</span>(),</span>
<span id="cb387-12"><a href="#cb387-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">ordered =</span> <span class="fu">logical</span>() <span class="co"># add default value</span></span>
<span id="cb387-13"><a href="#cb387-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb387-14"><a href="#cb387-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can now register the (S3) ordered-class, while providing an “S4 template”. We can also use the S4-class to create new object directly.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb388"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb388-1"><a href="#cb388-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setOldClass</span>(<span class="st">"ordered"</span>, <span class="at">S4Class =</span> <span class="st">"OrderedFactor"</span>)</span>
<span id="cb388-2"><a href="#cb388-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">OrderedFactor</span>(</span>
<span id="cb388-3"><a href="#cb388-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L),</span>
<span id="cb388-4"><a href="#cb388-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>),</span>
<span id="cb388-5"><a href="#cb388-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">ordered =</span> <span class="cn">TRUE</span></span>
<span id="cb388-6"><a href="#cb388-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb388-7"><a href="#cb388-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Formal class 'OrderedFactor' [package ".GlobalEnv"] with 4 slots
#&gt;   ..@ .Data   : int [1:3] 1 2 2
#&gt;   ..@ levels  : chr [1:3] "a" "b" "c"
#&gt;   ..@ ordered : logi TRUE
#&gt;   ..@ .S3Class: chr "factor"</code></pre>
</div>
</div>
<p>Notes: while my class <code>Ordered</code> looks similar to the AR Solutions version, it does not include the S3 class:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb390"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb390-1"><a href="#cb390-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(o)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Formal class 'Ordered' [package ".GlobalEnv"] with 3 slots
#&gt;   ..@ .Data  : int [1:4] 1 2 3 4
#&gt;   ..@ levels : chr [1:4] "a" "b" "c" "d"
#&gt;   ..@ ordered: logi TRUE</code></pre>
</div>
</div>
<hr>
<ol start="2" type="1">
<li>Define a <code>length</code> method for the <code>Person</code> class.</li>
</ol>
<p>Answer: since <code>Person</code> is a vector class, its length is the <code>length()</code> of any of its fields (we use Person2 here due to prevent conflicts with the already defined Person class):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb392"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb392-1"><a href="#cb392-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setClass</span>(<span class="st">"Person2"</span>,</span>
<span id="cb392-2"><a href="#cb392-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">slots =</span> <span class="fu">c</span>(</span>
<span id="cb392-3"><a href="#cb392-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"character"</span>,</span>
<span id="cb392-4"><a href="#cb392-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">age =</span> <span class="st">"numeric"</span></span>
<span id="cb392-5"><a href="#cb392-5" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb392-6"><a href="#cb392-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">prototype =</span> <span class="fu">list</span>(</span>
<span id="cb392-7"><a href="#cb392-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="cn">NA_character_</span>,</span>
<span id="cb392-8"><a href="#cb392-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">age =</span> <span class="cn">NA_real_</span></span>
<span id="cb392-9"><a href="#cb392-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb392-10"><a href="#cb392-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb392-11"><a href="#cb392-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb392-12"><a href="#cb392-12" aria-hidden="true" tabindex="-1"></a><span class="fu">setGeneric</span>(<span class="st">"length"</span>) <span class="sc">|&gt;</span></span>
<span id="cb392-13"><a href="#cb392-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">invisible</span>()</span>
<span id="cb392-14"><a href="#cb392-14" aria-hidden="true" tabindex="-1"></a><span class="fu">setMethod</span>(<span class="st">"length"</span>, <span class="st">"Person2"</span>, <span class="cf">function</span>(x) <span class="fu">length</span>(x<span class="sc">@</span>name))</span>
<span id="cb392-15"><a href="#cb392-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb392-16"><a href="#cb392-16" aria-hidden="true" tabindex="-1"></a>people <span class="ot">&lt;-</span> <span class="fu">new</span>(<span class="st">"Person2"</span>, <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"John Smith"</span>, <span class="st">"Jane Doe"</span>), <span class="at">age =</span> <span class="fu">c</span>(<span class="cn">NA_real_</span>, <span class="cn">NA_real_</span>))</span>
<span id="cb392-17"><a href="#cb392-17" aria-hidden="true" tabindex="-1"></a>people</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; An object of class "Person2"
#&gt; Slot "name":
#&gt; [1] "John Smith" "Jane Doe"  
#&gt; 
#&gt; Slot "age":
#&gt; [1] NA NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb394"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb394-1"><a href="#cb394-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(people)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 2</code></pre>
</div>
</div>
<p>AR Solutions: We keep things simple and will just return <code>"180cm"</code> when the <code>length()</code> method is called on a <code>Person</code> object. The method can be defined either as an S3 or S4 method.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb396"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb396-1"><a href="#cb396-1" aria-hidden="true" tabindex="-1"></a>length.Person <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="st">"180cm"</span> <span class="co"># S3</span></span>
<span id="cb396-2"><a href="#cb396-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setMethod</span>(<span class="st">"length"</span>, <span class="st">"Person"</span>, <span class="cf">function</span>(x) <span class="st">"180cm"</span>) <span class="co"># S4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
</section>
<section id="trade-offs" class="level2">
<h2 class="anchored" data-anchor-id="trade-offs">16 Trade-offs</h2>
<p>You now know about the three most important OOP toolkits available in R. Now that you understand their basic operation and the principles that underlie them, we can start to compare and contrast the systems in order to understand their strengths and weaknesses. This will help you pick the system that is most likely to solve new problems.</p>
<p>Overall, when picking an OO system, I recommend that you default to S3. S3 is simple, and widely used throughout base R and CRAN. While it’s far from perfect, its idiosyncrasies are well understood and there are known approaches to overcome most shortcomings. If you have an existing background in programming you are likely to lean towards R6, because it will feel familiar. I think you should resist this tendency for two reasons. Firstly, if you use R6 it’s very easy to create a non-idiomatic API that will feel very odd to native R users, and will have surprising pain points because of the reference semantics. Secondly, if you stick to R6, you’ll lose out on learning a new way of thinking about OOP that gives you a new set of tools for solving problems.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/jabenninghoff\.github\.io\/rtraining\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../analysis/advanced-r-2.html" class="pagination-link" aria-label="Advanced R (Functional programming)">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Advanced R (Functional programming)</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../analysis/advanced-r-4.html" class="pagination-link" aria-label="Advanced R (Metaprogramming)">
        <span class="nav-page-text">Advanced R (Metaprogramming)</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2024, John Benninghoff</p>
</div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="../LICENSE.html">
<p>License</p>
</a>
  </li>  
</ul>
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/jabenninghoff/rtraining/blob/main/analysis/advanced-r-3.Rmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/jabenninghoff/rtraining/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jabenninghoff/rtraining">
      <i class="bi bi-github" role="img" aria-label="github">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>