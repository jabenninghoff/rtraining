<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />



<meta name="date" content="2022-12-09" />

<title>ggplot2 (Grammar)</title>

<script src="site_libs/header-attrs-2.24/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
<link href="site_libs/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-5.2.2/bootstrap.bundle.min.js"></script>
<script src="site_libs/bs3compat-0.5.1/transition.js"></script>
<script src="site_libs/bs3compat-0.5.1/tabs.js"></script>
<script src="site_libs/bs3compat-0.5.1/bs3compat.js"></script>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script src="site_libs/navigation-1.1/sourceembed.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="site_libs/font-awesome-6.4.2/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>




<style type="text/css">
#rmd-source-code {
  display: none;
}
</style>





<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">rtraining notebooks</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Analysis
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="FaultTree.html">FaultTree.widget Test</a>
    </li>
    <li>
      <a href="advanced-r-1.html">Advanced R Workbook (Foundations)</a>
    </li>
    <li>
      <a href="advanced-r-2.html">Advanced R Workbook (Functional programming)</a>
    </li>
    <li>
      <a href="advanced-r-3.html">Advanced R Workbook (Object-oriented programming)</a>
    </li>
    <li>
      <a href="advanced-r-4.html">Advanced R Workbook (Metaprogramming)</a>
    </li>
    <li>
      <a href="ggplot2-1.html">ggplot2 (Getting started)</a>
    </li>
    <li>
      <a href="ggplot2-2.html">ggplot2 (Layers)</a>
    </li>
    <li>
      <a href="ggplot2-3.html">ggplot2 (Scales)</a>
    </li>
    <li>
      <a href="ggplot2-4.html">ggplot2 (Grammar)</a>
    </li>
    <li>
      <a href="ggplot2-5.html">ggplot2 (Extending)</a>
    </li>
    <li>
      <a href="r-setup-log.html">R Setup Log</a>
    </li>
    <li>
      <a href="r-training-log.html">R Training Log</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/jabenninghoff/rtraining/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
<li role="separator" class="divider"></li>
<li><a id="rmd-download-source" href="#">Download Rmd</a></li>
</ul>
</div>



<h1 class="title toc-ignore">ggplot2 (Grammar)</h1>
<h4 class="date">2022-12-09</h4>

</div>


<p>Workbook for completing quizzes and exercises from the “Grammar”
chapters of <a href="https://ggplot2-book.org/index.html">ggplot2:
Elegant Graphics for Data Analysis</a>, third edition, with comparisons
to solutions from <a
href="https://ggplot2-book-solutions-3ed.netlify.app">Solutions to
ggplot2: Elegant Graphics for Data Analysis</a>.</p>
<pre class="r"><code>library(MASS) # nolint: unused_import_linter. Used for &quot;rlm&quot;.
library(ggplot2)
library(dplyr)
library(jbplot)
library(ggthemes)

knitr::opts_chunk$set(
  comment = &quot;#&gt;&quot;,
  fig.align = &quot;center&quot;
)</code></pre>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>This workbook includes answers and solutions to the quizzes and
exercises from <a href="https://ggplot2-book.org/index.html">ggplot2:
Elegant Graphics for Data Analysis</a> and <a
href="https://ggplot2-book-solutions-3ed.netlify.app">Solutions to
ggplot2: Elegant Graphics for Data Analysis</a>, organized by chapter.
It includes excerpts from both books, copied here.</p>
<p><strong>WARNING, SPOILERS!</strong> If you haven’t read the ggplot2
book and intend to complete the quizzes and exercises, don’t read this
notebook. It contains my (potentially wrong) answers to both.</p>
</div>
<div id="mastering-the-grammar" class="section level1">
<h1>13 Mastering the grammar</h1>
<p>In order to unlock the full power of ggplot2, you’ll need to master
the underlying grammar. By understanding the grammar, and how its
components fit together, you can create a wider range of visualizations,
combine multiple sources of data, and customise to your heart’s
content.</p>
<p>This chapter describes the theoretical basis of ggplot2: the layered
grammar of graphics. The layered grammar is based on Wilkinson’s grammar
of graphics, but adds a number of enhancements that help it to be more
expressive and fit seamlessly into the R environment. The differences
between the layered grammar and Wilkinson’s grammar are described fully
in Hadley Wickham. In this chapter you will learn a little bit about
each component of the grammar and how they all fit together. The next
chapters discuss the components in more detail, and provide more
examples of how you can use them in practice.</p>
<p>The grammar makes it easier for you to iteratively update a plot,
changing a single feature at a time. The grammar is also useful because
it suggests the high-level aspects of a plot that <em>can</em> be
changed, giving you a framework to think about graphics, and hopefully
shortening the distance from mind to paper. It also encourages the use
of graphics customised to a particular problem, rather than relying on
specific chart types.</p>
<div id="exercises" class="section level2">
<h2>13.5 Exercises</h2>
<ul>
<li>One of the best ways to get a handle on how the grammar works is to
apply it to the analysis of existing graphics. For each of the graphics
listed below, write down the components of the graphic. Don’t worry if
you don’t know what the corresponding functions in ggplot2 are called
(or if they even exist!), instead focussing on recording the key
elements of a plot so you could communicate it to someone else.</li>
</ul>
<p>Answer: use the components from 13.4 to describe each plot: data,
aesthetics (aes), stat, geom, scale, coordinate system (coord), and
faceting</p>
<ol style="list-style-type: decimal">
<li>“Napoleon’s march” by Charles John Minard: <a
href="http://www.datavis.ca/gallery/re-minard.php">link</a></li>
</ol>
<p>Answer: the plot describes Napolean’s 1812 campaign. Larger version
at: <a
href="https://en.wikipedia.org/wiki/Charles_Joseph_Minard#/media/File:Minard.png">Wikipedia</a></p>
<ul>
<li>data: the size, location and date of the army’s travel, along with
temperature</li>
<li>aes: x, y mapped to location over time, with width representing
size</li>
<li>stat: no transformation</li>
<li>geom: line</li>
<li>scale: scales are used for location and temperature</li>
<li>coord: Cartesian / map projection</li>
<li>facet: no faceting</li>
</ul>
<hr />
<ol start="2" style="list-style-type: decimal">
<li>“Where the Heat and the Thunder Hit Their Shots”, by Jeremy White,
Joe Ward, and Matthew Ericson at The New York Times. <a
href="https://archive.nytimes.com/www.nytimes.com/interactive/2012/06/11/sports/basketball/nba-shot-analysis.html?_r=0">link</a></li>
</ol>
<p>Answer: a plot of basketball shots and points scored.</p>
<ul>
<li>data: number of attempts and points scored by location</li>
<li>aes: x, y mapped to location, size mapped to attempts, color to
points scored</li>
<li>stat: no transformation (possibly points per attempt)</li>
<li>geom: hex tiles</li>
<li>scale: continuous scales mapped to location, size (attempts), and
color (points)</li>
<li>coord: Cartesian, mapped to the court</li>
<li>facet: faceting by team and players</li>
</ul>
<hr />
<ol start="3" style="list-style-type: decimal">
<li>“London Cycle Hire Journeys”, by James Cheshire. <a
href="https://web.archive.org/web/20190523203409/http://spatialanalysis.co.uk/2012/02/great-maps-ggplot2/">link</a></li>
</ol>
<p>Answer: retrieved from <a
href="https://web.archive.org/web/20210516232923/http://spatialanalysis.co.uk/wp-content/uploads/2012/02/bike_ggplot.png">archive.org</a>.</p>
<ul>
<li>data: travels of London bicycle rentals</li>
<li>aes: x, y mapped to location, density (alpha) mapped to number of
trips in a location</li>
<li>stat: none</li>
<li>geom: line</li>
<li>scale: location</li>
<li>coord: Cartesian / map projection</li>
<li>facet: none</li>
</ul>
<hr />
<ol start="4" style="list-style-type: decimal">
<li>The Pew Research Center’s favorite data visualizations of 2014: <a
href="https://www.pewresearch.org/fact-tank/2014/12/29/our-favorite-pew-research-center-data-visualizations-from-2014/">link</a></li>
</ol>
<p>Answer: multiple plots, described individually.</p>
<p>Political Shifts</p>
<ul>
<li>data: responses to political values questions</li>
<li>aes: height showing volume of responses, between consistently
liberal and conservative</li>
<li>stat: histogram</li>
<li>geom: area / frequency polygon, with color showing above / below
median of the other party</li>
<li>scale: continuous</li>
<li>coord: Cartesian</li>
<li>facet: faceting by party by year</li>
</ul>
<p>Next America</p>
<ul>
<li>data: population by age group and gender</li>
<li>aes: binned data by age and gender</li>
<li>stat: none</li>
<li>geom: bar and color by gender, with boomers a distinct color</li>
<li>scale: continuous</li>
<li>coord: Cartesian</li>
<li>facet: faceting by year, animated</li>
</ul>
<p>“Murder Capitals”</p>
<ul>
<li>data: murder rate for six cities, with the highest rate shown for
each year, national rate</li>
<li>aes: x is time (year) and y is the murder rate</li>
<li>stat: none</li>
<li>geom: bar, line</li>
<li>scale: city is additionally mapped to year at the top of the plot,
and national rate is shown as a line across the bottom</li>
<li>coord: Cartesian</li>
<li>facet: none</li>
</ul>
<p>Ideological Placement of News Sources</p>
<ul>
<li>data: scores of responses to political values questions mapped to
audiences for news sources</li>
<li>aes: x mapped to score for a news source audience</li>
<li>stat: none</li>
<li>geom: point</li>
<li>scale: a single (x-axis) continuous scale, with labels for each
source</li>
<li>coord: Cartesian</li>
<li>facet: none</li>
</ul>
<p>Regional Support for Same-Sex Marriage</p>
<ul>
<li>data: percentage of population supporting same-sex marriage by
region</li>
<li>aes: x mapped to time (year), y mapped to percent support</li>
<li>stat: none</li>
<li>geom: line</li>
<li>scale: continuous</li>
<li>coord: Cartesian</li>
<li>facet: faceting by region, national support is an additional
layer</li>
</ul>
<hr />
<ol start="5" style="list-style-type: decimal">
<li>“The Tony’s Have Never Been so Dominated by Women”, by Joanna Kao at
FiveThirtyEight: <a
href="https://fivethirtyeight.com/features/the-tonys-have-never-been-so-dominated-by-women/">link</a>.</li>
</ol>
<p>Answer: a plot of Tony award winners by category.</p>
<ul>
<li>data: Tony award categories by year with at least one female
winner</li>
<li>aes: categories along the y axis, years along the x axis, colored
red if a female won</li>
<li>stat: none</li>
<li>geom: square points with color showing female winners</li>
<li>scale: discrete categories and years</li>
<li>coord: Cartesian</li>
<li>facet: none</li>
</ul>
<hr />
<ol start="6" style="list-style-type: decimal">
<li>“In Climbing Income Ladder, Location Matters” by the Mike Bostock,
Shan Carter, Amanda Cox, Matthew Ericson, Josh Keller, Alicia
Parlapiano, Kevin Quealy and Josh Williams at the New York Times: <a
href="https://www.nytimes.com/2013/07/22/business/in-climbing-income-ladder-location-matters.html">link</a></li>
</ol>
<p>Answer: not visible due to paywall, unable to retrieve the
graphic.</p>
<hr />
<ol start="7" style="list-style-type: decimal">
<li>“Dissecting a Trailer: The Parts of the Film That Make the Cut”, by
Shan Carter, Amanda Cox, and Mike Bostock at the New York Times: <a
href="https://archive.nytimes.com/www.nytimes.com/interactive/2013/02/19/movies/awardsseason/oscar-trailers.html">link</a></li>
</ol>
<p>Answer: multiple plots showing the sequencing of movie trailers.</p>
<ul>
<li>data: scenes in a trailer mapped to when they occurred in the full
film</li>
<li>aes: x axis showing the timestamp of a trailer scene, y axis and
color showing when the scene occurred, including scenes not in the final
film</li>
<li>stat: none</li>
<li>geom: square points (with width per scene), connected by lines</li>
<li>scale: continuous duration (seconds)</li>
<li>coord: Cartesian</li>
<li>facet: faceting by trailer (all plots are mapped to the same
scale)</li>
</ul>
<hr />
</div>
</div>
<div id="build-a-plot-layer-by-layer" class="section level1">
<h1>14 Build a plot layer by layer</h1>
<p>One of the key ideas behind ggplot2 is that it allows you to easily
iterate, building up a complex plot a layer at a time. Each layer can
come from a different dataset and have a different aesthetic mapping,
making it possible to create sophisticated plots that display data from
multiple sources.</p>
<p>You’ve already created layers with functions like
<code>geom_point()</code> and <code>geom_histogram()</code>. In this
chapter, you’ll dive into the details of a layer, and how you can
control all five components: data, the aesthetic mappings, the geom,
stat, and position adjustments. The goal here is to give you the tools
to build sophisticated plots tailored to the problem at hand.</p>
<div id="exercises-1" class="section level2">
<h2>14.3.1 Exercises</h2>
<ol style="list-style-type: decimal">
<li>The first two arguments to ggplot are <code>data</code> and
<code>mapping</code>. The first two arguments to all layer functions are
<code>mapping</code> and <code>data</code>. Why does the order of the
arguments differ? (Hint: think about what you set most commonly.)</li>
</ol>
<p>Answer: most plots use common data for all layers, where the
aesthetics are more likely to vary.</p>
<p>GG Solutions:</p>
<ul>
<li>Commonly, you first set the data in <code>ggplot()</code> and then
set aesthetics inside your layer functions, like
<code>geom_point()</code>, <code>geom_boxplot()</code>, or
<code>geom_histogram()</code>.</li>
</ul>
<hr />
<ol start="2" style="list-style-type: decimal">
<li>The following code uses dplyr to generate some summary statistics
about each class of car.</li>
</ol>
<pre class="r"><code>class &lt;- ggplot2::mpg %&gt;%
  group_by(class) %&gt;%
  summarise(n = n(), hwy = mean(hwy))</code></pre>
<pre><code>Use the data to recreate this plot:</code></pre>
<p>Answer: with some help from the source code to get the measurements
right, here is the solution:</p>
<pre class="r"><code>ggplot(ggplot2::mpg, aes(class, hwy)) +
  geom_point() +
  geom_jitter(width = 0.25) +
  geom_point(data = class, color = &quot;red&quot;, size = 5) +
  geom_text(aes(y = 10, label = paste0(&quot;n = &quot;, n)), data = class, size = 3)</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-2-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>GG Solutions:</p>
<pre class="r"><code>ggplot2::mpg %&gt;%
  ggplot(aes(class, hwy)) +
  geom_jitter(width = 0.15, height = 0.35) +
  geom_point(
    data = class, aes(class, hwy),
    color = &quot;red&quot;,
    size = 6
  ) +
  geom_text(data = class, aes(y = 10, x = class, label = paste0(&quot;n = &quot;, n)))</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-3-1.png" width="768" style="display: block; margin: auto;" /></p>
<ul>
<li>I plotted 3 different layers: jittered points, red point for the
summary measure, mean, and text for the sample size (n).</li>
</ul>
<hr />
</div>
<div id="exercises-2" class="section level2">
<h2>14.4.3 Exercises</h2>
<ol style="list-style-type: decimal">
<li>Simplify the following plot specifications:</li>
</ol>
<pre class="r"><code>ggplot(ggplot2::mpg) +
  geom_point(aes(mpg$displ, mpg$hwy))

ggplot() +
  geom_point(mapping = aes(y = hwy, x = cty), data = mpg) +
  geom_smooth(data = mpg, mapping = aes(cty, hwy))

ggplot(diamonds, aes(carat, price)) +
  geom_point(aes(log(brainwt), log(bodywt)), data = msleep)</code></pre>
<p>Answer:</p>
<pre class="r"><code>ggplot(ggplot2::mpg, aes(displ, hwy)) +
  geom_point()</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-5-1.png" width="768" style="display: block; margin: auto;" /></p>
<pre class="r"><code>ggplot(ggplot2::mpg, aes(cty, hwy)) +
  geom_point() +
  geom_smooth(method = &quot;loess&quot;, formula = y ~ x)</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-5-2.png" width="768" style="display: block; margin: auto;" /></p>
<pre class="r"><code>ggplot(msleep, aes(log(brainwt), log(bodywt))) +
  geom_point(na.rm = TRUE)</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-5-3.png" width="768" style="display: block; margin: auto;" /></p>
<p>GG Solutions offers a similar solution for the first two and a
strange solution for the third (since the <code>diamonds</code> data is
never used in the third plot):</p>
<pre class="r"><code>ggplot(ggplot2::mpg) +
  geom_point(aes(displ, hwy))

ggplot(ggplot2::mpg, aes(cty, hwy)) +
  geom_point() +
  geom_smooth()

msleep_processed &lt;- msleep %&gt;%
  mutate(
    brainwt_log = log(brainwt),
    bodywt_log = log(bodywt)
  )

ggplot(diamonds, aes(carat, price)) +
  geom_point(aes(brainwt_log, bodywt_log),
    data = msleep_processed
  )</code></pre>
<p>Note: I prefer my answer to GG Solutions.</p>
<hr />
<ol start="2" style="list-style-type: decimal">
<li>What does the following code do? Does it work? Does it make sense?
Why/why not?</li>
</ol>
<pre class="r"><code>ggplot(ggplot2::mpg) +
  geom_point(aes(class, cty)) +
  geom_boxplot(aes(trans, hwy))</code></pre>
<p>Answer: it does work, but does not make sense, and should be done as
separate plots so that the variables comparisons are visible:</p>
<pre class="r"><code>ggplot(ggplot2::mpg, aes(class, cty)) +
  geom_point() +
  coord_flip()</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-8-1.png" width="768" style="display: block; margin: auto;" /></p>
<pre class="r"><code>ggplot(ggplot2::mpg, aes(trans, hwy)) +
  geom_boxplot() +
  coord_flip()</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-8-2.png" width="768" style="display: block; margin: auto;" /></p>
<p>GG Solutions:</p>
<ul>
<li>It plots points of <code>class</code> vs <code>cty</code> and then a
boxplot of <code>trans</code> vs <code>hwy</code>. It doesn’t make sense
to plot layers with different <code>x</code> and <code>y</code>
variables.</li>
</ul>
<hr />
<ol start="3" style="list-style-type: decimal">
<li>What happens if you try to use a continuous variable on the x axis
in one layer, and a categorical variable in another layer? What happens
if you do it in the opposite order?</li>
</ol>
<p>Answer: let’s experiment!</p>
<p>This code throws an error,
<code>Error: Discrete value supplied to continuous scale</code></p>
<pre class="r"><code>ggplot(ggplot2::mpg, aes(displ, hwy)) +
  geom_point() +
  geom_point(aes(drv, hwy), color = &quot;red&quot;)</code></pre>
<p>Reversing the order works, but draws a strange plot:</p>
<pre class="r"><code>ggplot(ggplot2::mpg, aes(displ, hwy)) +
  geom_point(aes(drv, hwy), color = &quot;red&quot;) +
  geom_point()</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-10-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>GG Solutions:</p>
<ul>
<li>Not sure</li>
</ul>
<hr />
</div>
<div id="exercises-3" class="section level2">
<h2>14.5.1 Exercises</h2>
<ol style="list-style-type: decimal">
<li>Download and print out the ggplot2 cheatsheet from <a
href="http://www.rstudio.com/resources/cheatsheets/">rstudio</a> so you
have a handy visual reference for all the geoms.</li>
</ol>
<p>Answer: cheatsheets have moved to <a
href="https://posit.co/resources/cheatsheets/">posit</a> (as the company
rebranded).</p>
<hr />
<ol start="2" style="list-style-type: decimal">
<li>Look at the documentation for the graphical primitive geoms. Which
aesthetics do they use? How can you summarise them in a compact
form?</li>
</ol>
<p>Answer: from 14.5, the primitives are:</p>
<ul>
<li><code>geom_blank()</code>: no aesthetics, “draw nothing”</li>
<li><code>geom_point()</code>: <strong><code>x</code></strong>,
<strong><code>y</code></strong>, <code>alpha</code>, <code>color</code>,
<code>fill</code>, <code>group</code>, <code>shape</code>,
<code>size</code>, <code>stroke</code>, “draw points”</li>
<li><code>geom_path()</code>: <strong><code>x</code></strong>,
<strong><code>y</code></strong>, <code>alpha</code>, <code>color</code>,
<code>group</code>, <code>linetype</code>, <code>linewidth</code>,
“connect observations”</li>
<li><code>geom_ribbon()</code>: <strong><code>x</code> or
<code>y</code></strong>, <strong><code>ymin</code> or
<code>xmin</code></strong>, <strong><code>ymax</code> or
<code>xmax</code></strong>, <code>alpha</code>, <code>color</code>,
<code>fill</code>, <code>group</code>, <code>linetype</code>,
<code>linewidth</code>, “draw an area along a line”</li>
<li><code>geom_segment()</code>: <strong><code>x</code></strong>,
<strong><code>y</code></strong>, <strong><code>xend</code></strong>,
<strong><code>yend</code></strong>, <code>alpha</code>,
<code>color</code>, <code>group</code>, <code>linetype</code>,
<code>linewidth</code>, “connect two points”</li>
<li><code>geom_rect()</code>: <strong><code>x</code></strong>,
<strong><code>y</code></strong>, <code>alpha</code>, <code>color</code>,
<code>fill</code>, <code>group</code>, <code>height</code>,
<code>linetype</code>, <code>linewidth</code>, <code>width</code>, “draw
rectangles”</li>
<li><code>geom_polygon()</code>: <strong><code>x</code></strong>,
<strong><code>y</code></strong>, <code>alpha</code>, <code>color</code>,
<code>fill</code>, <code>group</code>, <code>linetype</code>,
<code>linewidth</code>, <code>subgroup</code>, “draw polygons”</li>
<li><code>geom_text()</code>: <strong><code>x</code></strong>,
<strong><code>y</code></strong>, <strong><code>label</code></strong>,
<code>alpha</code>, <code>angle</code>, <code>color</code>,
<code>family</code>, <code>fontface</code>, <code>group</code>,
<code>hjust</code>, <code>lineheight</code>, <code>size</code>,
<code>vjust</code>, “draw text”</li>
</ul>
<hr />
<ol start="3" style="list-style-type: decimal">
<li>What’s the best way to master an unfamiliar geom? List three
resources to help you get started.</li>
</ol>
<p>Answer:</p>
<ul>
<li>R Documentation for ggplot2, either built-in or <a
href="https://ggplot2.tidyverse.org">online</a></li>
<li>Posit <a
href="https://posit.co/resources/cheatsheets/">cheatsheets</a></li>
<li>The <a href="https://r-graph-gallery.com">R Graph Gallery</a></li>
</ul>
<hr />
<ol start="4" style="list-style-type: decimal">
<li>For each of the plots below, identify the geom used to draw it.</li>
</ol>
<p>Answer: in the order they appear in the <a
href="https://ggplot2-book.org/layers.html#exercises-11">Exercises</a>:</p>
<ol style="list-style-type: decimal">
<li><code>geom_violin</code></li>
<li><code>geom_point</code> (actually uses <code>geom_count</code>)</li>
<li><code>geom_hex</code></li>
<li><code>geom_point</code> (actually uses
<code>geom_jitter</code>)</li>
<li><code>geom_area</code></li>
<li><code>geom_path</code></li>
</ol>
<p>Note: verifying my answers against the <a
href="https://github.com/hadley/ggplot2-book/blob/master/layers.Rmd">source
code</a>, I got two wrong, although the underlying geom is
<code>geom_point</code>.</p>
<p>GG Solutions:</p>
<p>Starting from top left, clockwise direction:</p>
<ul>
<li><code>geom_violin()</code>, <code>geom_point()</code>,
<code>geom_point()</code>, <code>geom_path()</code>,
<code>geom_area()</code>, <code>geom_hex()</code>.</li>
</ul>
<p>Note: GG Solutions makes the same mistakes I did.</p>
<hr />
<ol start="5" style="list-style-type: decimal">
<li><p>For each of the following problems, suggest a useful geom:</p>
<ul>
<li>Display how a variable has changed over time.</li>
<li>Show the detailed distribution of a single variable.</li>
<li>Focus attention on the overall trend in a large dataset.</li>
<li>Draw a map.</li>
<li>Label outlying points.</li>
</ul></li>
</ol>
<p>Answers below:</p>
<ul>
<li>Display how a variable has changed over time:
<code>geom_line</code>, with time on the x axis, or
<code>geom_path</code> to show changes in two dimensions over time.</li>
<li>Show the detailed distribution of a single variable: one of the
distribution plots, <code>geom_histogram</code> and
<code>geom_dotplot</code> are good choices.</li>
<li>Focus attention on the overall trend in a large dataset:
<code>geom_smooth</code>.</li>
<li>Draw a map: <code>geom_map</code> or its successor,
<code>geom_sf</code>.</li>
<li>Label outlying points: <code>geom_text</code> or
<code>geom_label</code>.</li>
</ul>
<hr />
</div>
<div id="exercises-4" class="section level2">
<h2>14.6.2 Exercises</h2>
<ol style="list-style-type: decimal">
<li>The code below creates a similar dataset to
<code>stat_smooth()</code>. Use the appropriate geoms to mimic the
default <code>geom_smooth()</code> display.</li>
</ol>
<pre class="r"><code>mod &lt;- loess(hwy ~ displ, data = ggplot2::mpg)
smoothed &lt;- data.frame(displ = seq(1.6, 7, length.out = 50))
pred &lt;- predict(mod, newdata = smoothed, se = TRUE)
smoothed$hwy &lt;- pred$fit
smoothed$hwy_lwr &lt;- pred$fit - 1.96 * pred$se.fit
smoothed$hwy_upr &lt;- pred$fit + 1.96 * pred$se.fit</code></pre>
<p>Answer: the exercise is to replicate <code>geom_smooth</code> using
the <code>smoothed</code> data frame, which includes a line and a
ribbon:</p>
<pre class="r"><code>ggplot(ggplot2::mpg, aes(displ, hwy)) +
  geom_point() +
  geom_smooth(method = &quot;loess&quot;, formula = y ~ x)</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-12-1.png" width="768" style="display: block; margin: auto;" /></p>
<pre class="r"><code>ggplot(ggplot2::mpg, aes(displ, hwy)) +
  geom_point() +
  geom_line(data = smoothed, color = &quot;blue&quot;, linewidth = 1) +
  geom_ribbon(mapping = aes(ymin = hwy_lwr, ymax = hwy_upr), data = smoothed, alpha = 0.2)</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-12-2.png" width="768" style="display: block; margin: auto;" /></p>
<p>A perfect match!</p>
<p>GG Solutions:</p>
<pre class="r"><code>smoothed %&gt;%
  ggplot(aes(displ, hwy)) +
  geom_line(color = &quot;dodgerblue1&quot;) +
  geom_ribbon(aes(ymin = hwy_lwr, ymax = hwy_upr), alpha = 0.4)</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-13-1.png" width="768" style="display: block; margin: auto;" /></p>
<hr />
<ol start="2" style="list-style-type: decimal">
<li>What stats were used to create the following plots?</li>
</ol>
<p>Answer: in the order they appear in the <a
href="https://ggplot2-book.org/layers.html#exercises-12">Exercises</a>:</p>
<ol style="list-style-type: decimal">
<li><code>stat_ecdf</code></li>
<li><code>stat_qq</code></li>
<li><code>stat_density</code></li>
</ol>
<p>Confirmed correct by reviewing the <a
href="https://github.com/hadley/ggplot2-book/blob/master/layers.Rmd">source
code</a>.</p>
<p>GG Solutions: From left to right,</p>
<p><code>stat_ecdf()</code>, <code>stat_qq()</code>,
<code>stat_function()</code></p>
<hr />
<ol start="3" style="list-style-type: decimal">
<li>Read the help for <code>stat_sum()</code> then use
<code>geom_count()</code> to create a plot that shows the proportion of
cars that have each combination of <code>drv</code> and
<code>trans</code>.</li>
</ol>
<p>Answer: in addition, facet by year.</p>
<pre class="r"><code>ggplot(ggplot2::mpg, aes(drv, trans)) +
  geom_count(aes(size = after_stat(prop), group = 1)) +
  scale_size(labels = scales::label_percent()) +
  facet_wrap(vars(year)) +
  labs(title = &quot;Combinations of drive train and transmissions&quot;, x = NULL, y = NULL) +
  labs(size = &quot;% of cars&quot;) +
  theme_quo()</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-14-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>GG Solutions:</p>
<pre class="r"><code>ggplot2::mpg %&gt;%
  ggplot(aes(drv, trans)) +
  geom_count(aes(size = after_stat(prop), group = 1))</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-15-1.png" width="768" style="display: block; margin: auto;" /></p>
<hr />
</div>
<div id="exercises-5" class="section level2">
<h2>14.7.1 Exercises</h2>
<ol style="list-style-type: decimal">
<li>When might you use <code>position_nudge()</code>? Read the
documentation.</li>
</ol>
<p>Answer: as the documentation states, “Nudging is built in to
<code>geom_text()</code> because it’s so useful for moving labels a
small distance from what they’re labelling.”</p>
<p>GG Solutions: According to the help page,
<code>position_nudge()</code> is generally useful for adjusting the
position of items on discrete scales by a small amount. Nudging is built
in to geom_text() because it’s so useful for moving labels a small
distance from what they’re labelling.</p>
<hr />
<ol start="2" style="list-style-type: decimal">
<li>Many position adjustments can only be used with a few geoms. For
example, you can’t stack boxplots or errors bars. Why not? What
properties must a geom possess in order to be stackable? What properties
must it possess to be dodgeable?</li>
</ol>
<p>Answer: reading the docs, <code>position_stack()</code> requires that
geoms have a position (points, lines, text) or a dimension (bar, area).
Boxplots and error bars can’t be stacked since they don’t have a
position or area. A geom must have a width in order to be dodgeable,
which can be set with <code>position_dodge(width = ...)</code>.</p>
<p>GG Solutions: Not sure</p>
<hr />
<ol start="3" style="list-style-type: decimal">
<li>Why might you use <code>geom_jitter()</code> instead of
<code>geom_count()</code>? What are the advantages and disadvantages of
each technique?</li>
</ol>
<p>Answer: <code>geom_jitter()</code> preserves the size and number of
points but not position, and <code>geom_count()</code> preserves the
position but not number or size. <code>geom_jitter()</code> can be a
better choice when there are few overlapping points.</p>
<p>GG Solutions: <code>geom_jitter()</code> adds a small amount of
random variation to the location of each point. It is useful for looking
at all the overplotted points. On the other hand,
<code>geom_count()</code> counts the number of overlapping observations
at each location. It is useful for understanding the number of points in
a location.</p>
<hr />
<ol start="4" style="list-style-type: decimal">
<li>When might you use a stacked area plot? What are the advantages and
disadvantages compared to a line plot?</li>
</ol>
<p>Answer: a stacked area plot is a good way to show the relationship of
related variables, showing how parts of a whole change over time, for
example, plotting the phases of incident response (mean time to detect,
mean time to resolve). It is very similar to a line plot, and makes
relative values (proportions) easier to compare and absolute values
harder to compare.</p>
<p>GG Solutions: Stacked area plot seems useful when you want to portray
an area whereas a line plot seems useful when you just need a line.</p>
<hr />
</div>
</div>
<div id="scales-and-guides" class="section level1">
<h1>15 Scales and guides</h1>
<p>The scales toolbox in Chapters 10 to 12 provides extensive guidance
for how to work with scales, focusing on solving common data
visualisation problems. The practical goals of the toolbox mean that
topics are introduced when they are most relevant: for example, scale
transformations are discussed in relation to continuous position scales
(Section 10.1.7) because that is the most common situation in which you
might want to transform a scale. However, because ggplot2 aims to
provide a grammar of graphics, there is nothing preventing you from
transforming other kinds of scales (see Section 15.6). This chapter aims
to illustrate these concepts: I’ll discuss the theory underpinning
scales and guides, and give examples showing how concepts that I’ve
discussed specifically for position or colour scales also apply
elsewhere.</p>
<div id="setting-color-with-limits" class="section level2">
<h2>Setting color with limits</h2>
<p>Let’s create a pair of plots controlling color with limits (from
11.3.5)! First, we’ll just plot both independently:</p>
<pre class="r"><code>gg_99 &lt;- ggplot2::mpg |&gt;
  filter(year == 1999) |&gt;
  ggplot(aes(displ, hwy, color = fl)) +
  geom_point()

gg_08 &lt;- ggplot2::mpg |&gt;
  filter(year == 2008) |&gt;
  ggplot(aes(displ, hwy, color = fl)) +
  geom_point()

gg_99</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-16-1.png" width="768" style="display: block; margin: auto;" /></p>
<pre class="r"><code>gg_08</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-16-2.png" width="768" style="display: block; margin: auto;" /></p>
<p>Now, let’s replot using limits:</p>
<pre class="r"><code>gg_99 +
  lims(x = c(1, 7), y = c(10, 45)) +
  scale_color_discrete(
    limits = c(&quot;c&quot;, &quot;d&quot;, &quot;e&quot;, &quot;p&quot;, &quot;r&quot;),
    breaks = c(&quot;d&quot;, &quot;p&quot;, &quot;r&quot;),
    labels = c(&quot;diesel&quot;, &quot;premium&quot;, &quot;regular&quot;)
  )</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-17-1.png" width="768" style="display: block; margin: auto;" /></p>
<pre class="r"><code>gg_08 +
  lims(x = c(1, 7), y = c(10, 45)) +
  scale_color_discrete(
    limits = c(&quot;c&quot;, &quot;d&quot;, &quot;e&quot;, &quot;p&quot;, &quot;r&quot;),
    labels = c(&quot;compressed&quot;, &quot;diesel&quot;, &quot;ethanol&quot;, &quot;premium&quot;, &quot;regular&quot;)
  )</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-17-2.png" width="768" style="display: block; margin: auto;" />
## Key glyphs</p>
<p>Let’s use a key glyph! (<code>draw_key_timeseries()</code>)</p>
<pre class="r"><code>ggplot(economics, aes(date, psavert, color = &quot;Personal\nSavings\nRate&quot;)) +
  geom_line(key_glyph = &quot;timeseries&quot;) +
  labs(x = NULL, y = NULL, color = NULL) +
  theme_quo()</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-18-1.png" width="768" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="coordinate-systems" class="section level1">
<h1>16 Coordinate systems</h1>
<p>Coordinate systems have two main jobs:</p>
<ul>
<li><p>Combine the two position aesthetics to produce a 2d position on
the plot. The position aesthetics are called <code>x</code> and
<code>y</code>, but they might be better called position 1 and 2 because
their meaning depends on the coordinate system used. For example, with
the polar coordinate system they become angle and radius (or radius and
angle), and with maps they become latitude and longitude.</p></li>
<li><p>In coordination with the faceter, coordinate systems draw axes
and panel backgrounds. While the scales control the values that appear
on the axes, and how they map from data to position, it is the
coordinate system which actually draws them. This is because their
appearance depends on the coordinate system: an angle axis looks quite
different than an x axis.</p></li>
</ul>
<div id="polar-coordinates" class="section level2">
<h2>Polar coordinates</h2>
<p>Let’s draw a spiral with polar coordinates!</p>
<pre class="r"><code>data.frame(x = c(1, 200), y = c(200, 1)) |&gt;
  ggplot(aes(x, y)) +
  geom_line() +
  coord_polar()</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-19-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>We can use polar coordinates to draw a pie chart:</p>
<pre class="r"><code>ggplot(mtcars, aes(factor(1), fill = factor(cyl))) +
  geom_bar(width = 1) +
  scale_x_discrete(NULL, expand = c(0, 0)) +
  scale_y_continuous(NULL, expand = c(0, 0)) +
  coord_polar(theta = &quot;y&quot;) +
  labs(title = &quot;Number of cylinders&quot;, fill = NULL) +
  theme_void()</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-20-1.png" width="768" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="faceting" class="section level1">
<h1>17 Faceting</h1>
<p>You first encountered faceting in Section 2.5. Faceting generates
small multiples each showing a different subset of the data. Small
multiples are a powerful tool for exploratory data analysis: you can
rapidly compare patterns in different parts of the data and see whether
they are the same or different. This section will discuss how you can
fine-tune facets, particularly the way in which they interact with
position scales.</p>
<div id="facet-grid" class="section level2">
<h2>Facet grid</h2>
<p>Let’s draw a facet grid!</p>
<pre class="r"><code>ggplot2::mpg |&gt;
  filter(cyl != 5) |&gt;
  ggplot(aes(displ, hwy)) +
  geom_point() +
  geom_smooth(method = &quot;rlm&quot;, formula = y ~ x) +
  facet_grid(drv ~ cyl) +
  labs(x = NULL, y = NULL)</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-21-1.png" width="768" style="display: block; margin: auto;" /></p>
</div>
<div id="free-scales" class="section level2">
<h2>Free scales</h2>
<p>Free scales are useful when faceting across different variables over
the same time period:</p>
<pre class="r"><code>ggplot(economics_long, aes(date, value)) +
  geom_line() +
  facet_wrap(~variable, scales = &quot;free_y&quot;, ncol = 1)</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-22-1.png" width="768" style="display: block; margin: auto;" /></p>
</div>
<div id="facet-space" class="section level2">
<h2>Facet space</h2>
<p><code>facet_grid()</code> has an additional parameter called
<code>space</code>, which takes the same values as <code>scales</code>.
When space is “free”, each column (or row) will have width (or height)
proportional to the range of the scale for that column (or row). This
makes the scaling equal across the whole plot: 1 cm on each panel maps
to the same range of data. (This is somewhat analogous to the ‘sliced’
axis limits of lattice.) For example, if panel a had range 2 and panel b
had range 4, one-third of the space would be given to a, and two-thirds
to b. This is most useful for categorical scales, where we can assign
space proportionally based on the number of levels in each facet, as
illustrated below.</p>
<pre class="r"><code>mpg2 &lt;- subset(ggplot2::mpg, cyl != 5 &amp; drv %in% c(&quot;4&quot;, &quot;f&quot;) &amp; class != &quot;2seater&quot;)
mpg2$model &lt;- reorder(mpg2$model, mpg2$cty)
mpg2$manufacturer &lt;- reorder(mpg2$manufacturer, -mpg2$cty)

ggplot(mpg2, aes(cty, model)) +
  geom_point() +
  facet_grid(manufacturer ~ ., scales = &quot;free&quot;, space = &quot;free&quot;) +
  labs(x = NULL, y = NULL) +
  theme(strip.text.y = element_text(angle = 0))</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-23-1.png" width="768" style="display: block; margin: auto;" /></p>
</div>
<div id="grouping-and-faceting" class="section level2">
<h2>Grouping and faceting</h2>
<p>Let’s combine grouping and faceting!</p>
<pre class="r"><code># Need to use dplyr::select for disambiguation for build_analysis_site()
ggplot(ggplot2::mpg, aes(displ, hwy)) +
  geom_point(data = dplyr::select(ggplot2::mpg, -drv), color = &quot;grey75&quot;) +
  geom_point(aes(color = drv)) +
  facet_wrap(~drv)</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-24-1.png" width="768" style="display: block; margin: auto;" /></p>
</div>
<div id="exercises-6" class="section level2">
<h2>17.7 Exercises</h2>
<ol style="list-style-type: decimal">
<li>Diamonds: display the distribution of price conditional on cut and
carat. Try faceting by cut and grouping by carat. Try faceting by carat
and grouping by cut. Which do you prefer?</li>
</ol>
<p>Answer: faceting by caret requires discretizing, here we use
<code>cut_number()</code>:</p>
<pre class="r"><code>ggplot(diamonds, aes(price, group = carat, color = carat)) +
  geom_histogram(bins = 100) +
  scale_color_viridis_c() +
  facet_wrap(~cut)</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-25-1.png" width="768" style="display: block; margin: auto;" /></p>
<pre class="r"><code>diamonds |&gt;
  mutate(carat_n = cut_number(carat, 6)) |&gt;
  ggplot(aes(price, group = cut, fill = cut)) +
  geom_histogram(bins = 100) +
  scale_color_viridis_d() +
  facet_wrap(~carat_n)</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-25-2.png" width="768" style="display: block; margin: auto;" /></p>
<p>Faceting by cut seems preferable, since it provides an insight not
provided by faceting by carat: there are more large carat diamonds with
a Fair cut.</p>
<p>GG Solutions: takes a different approach, and concludes: “It makes
more sense to facet by cut because its a discrete variable. Faceting by
carat, a continuous variable, makes too many facets and renders the plot
unreadable!”</p>
<hr />
<ol start="2" style="list-style-type: decimal">
<li>Diamonds: compare the relationship between price and carat for each
colour. What makes it hard to compare the groups? Is grouping better or
faceting? If you use faceting, what annotation might you add to make it
easier to see the differences between panels?</li>
</ol>
<p>Answer: comparing is hard because of overlap between groups and
overplotting. Overall, grouping seems easier to read than faceting.
Adding a reference line (in this case, a robust linear regression) makes
it easier to see differences across faceting panels.</p>
<pre class="r"><code>ggplot(diamonds, aes(carat, price)) +
  geom_point(aes(color = color)) +
  geom_smooth(method = &quot;rlm&quot;, formula = y ~ x, se = FALSE) +
  coord_cartesian(ylim = c(0, max(diamonds$price)))</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-26-1.png" width="768" style="display: block; margin: auto;" /></p>
<pre class="r"><code>ggplot(diamonds, aes(carat, price)) +
  geom_point(aes(color = color)) +
  geom_smooth(data = dplyr::select(diamonds, -color), method = &quot;rlm&quot;, formula = y ~ x, se = FALSE) +
  coord_cartesian(ylim = c(0, max(diamonds$price))) +
  facet_wrap(~color)</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-26-2.png" width="768" style="display: block; margin: auto;" /></p>
<p>GG Solutions:</p>
<pre class="r"><code>diamonds %&gt;%
  ggplot(aes(carat, price)) +
  geom_point(aes(color = color))</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-27-1.png" width="768" style="display: block; margin: auto;" /></p>
<pre class="r"><code>diamonds %&gt;%
  ggplot(aes(carat, price)) +
  geom_point(aes(color = color)) +
  facet_wrap(~color)</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-27-2.png" width="768" style="display: block; margin: auto;" /></p>
<ul>
<li>I think its better to use grouping to compare the different colors.
The panels all have the same shape, so it’s hard to compare the groups
across facets. If I use faceting, I’d add that the plot is facetted by
diamond colour, from D (best) to J (worst).</li>
</ul>
<hr />
<ol start="3" style="list-style-type: decimal">
<li>Why is <code>facet_wrap()</code> generally more useful than
<code>facet_grid()</code>?</li>
</ol>
<p>Answer: when faceting by a single variable, <code>facet_wrap()</code>
is easier to use as it wraps the facets to fit the plot space
automatically. <code>facet_grid()</code> is generally more useful only
when faceting with two variables.</p>
<p>GG Solutions: I think <code>facet_wrap()</code> is more useful than
<code>facet_grid()</code> because the former function is useful if you
have a single variable with many levels and want to arrange the plots in
a more space efficient manner. In data analysis, its extremely common to
have a single variable with many levels that the analyst wants to
arrange the for easy comparison. Although <code>facet_grid()</code>
works on single variables, <code>facet_wrap()</code> involves less
typing when you have a single variable.</p>
<hr />
<ol start="4" style="list-style-type: decimal">
<li>Recreate the following plot. It facets <code>mpg2</code> by class,
overlaying a smooth curve fit to the full dataset.</li>
</ol>
<p>Answer: plot below.</p>
<pre class="r"><code>ggplot(mpg2, aes(displ, hwy)) +
  geom_point() +
  geom_smooth(data = dplyr::select(mpg2, -class), method = &quot;loess&quot;, formula = y ~ x, se = FALSE) +
  facet_wrap(~class)</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-28-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>Comparing to the <a
href="https://github.com/hadley/ggplot2-book/blob/master/facet.Rmd">source
code</a>, the answer is correct!</p>
<p>GG Solutions:</p>
<pre class="r"><code>mpg2 %&gt;%
  ggplot(aes(displ, hwy)) +
  geom_point() +
  geom_smooth(data = mpg2 %&gt;% dplyr::select(-class), se = FALSE, method = &quot;loess&quot;) +
  facet_wrap(~class)</code></pre>
<pre><code>#&gt; `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-29-1.png" width="768" style="display: block; margin: auto;" /></p>
<hr />
</div>
</div>
<div id="themes" class="section level1">
<h1>18 Themes</h1>
<p>In this chapter you will learn how to use the ggplot2 theme system,
which allows you to exercise fine control over the non-data elements of
your plot. The theme system does not affect how the data is rendered by
geoms, or how it is transformed by scales. Themes don’t change the
perceptual properties of the plot, but they do help you make the plot
aesthetically pleasing or match an existing style guide. Themes give you
control over things like fonts, ticks, panel strips, and
backgrounds.</p>
<p>This separation of control into data and non-data parts is quite
different from base and lattice graphics. In base and lattice graphics,
most functions take a large number of arguments that specify both data
and non-data appearance, which makes the functions complicated and
harder to learn. ggplot2 takes a different approach: when creating the
plot you determine how the data is displayed, then <em>after</em> it has
been created you can edit every detail of the rendering, using the
theming system.</p>
<div id="exercises-7" class="section level2">
<h2>18.2.1 Exercises</h2>
<ol style="list-style-type: decimal">
<li>Try out all the themes in ggthemes. Which do you like the best?</li>
</ol>
<p>Answer: the “interesting” themes are displayed below. From the top
four, I’d pick <code>theme_solarized_2()</code>, although
<code>theme_fivethirtyeight()</code> is a close runner-up.</p>
<pre class="r"><code>base &lt;- ggplot(ggplot2::mpg, aes(displ, hwy)) +
  geom_point(aes(color = factor(cyl))) +
  geom_smooth(method = &quot;loess&quot;, formula = y ~ x) +
  labs(
    title = &quot;Fuel economy declines as engine size increases&quot;,
    subtitle = &quot;1999-2008&quot;,
    caption = &quot;Data from https://fueleconomy.gov/&quot;,
    x = &quot;Displacement (liters)&quot;,
    y = &quot;Miles per gallon (highway)&quot;,
    color = &quot;Cylinders&quot;
  )

base</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-30-1.png" width="768" style="display: block; margin: auto;" /></p>
<pre class="r"><code>base + theme_calc()</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-30-2.png" width="768" style="display: block; margin: auto;" /></p>
<pre class="r"><code>base + theme_fivethirtyeight()</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-30-3.png" width="768" style="display: block; margin: auto;" /></p>
<pre class="r"><code>base + theme_hc()</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-30-4.png" width="768" style="display: block; margin: auto;" /></p>
<pre class="r"><code>base + theme_solarized_2()</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-30-5.png" width="768" style="display: block; margin: auto;" /></p>
<hr />
<ol start="2" style="list-style-type: decimal">
<li>What aspects of the default theme do you like? What don’t you
like?<br />
What would you change?</li>
</ol>
<p>Answer: my personal theme, <code>theme_quo()</code> uses a white
background with light gray gridlines (based on
<code>theme_minimal()</code>), bold titles, captions left-adjusted, and
a better font, <a href="https://www.latofonts.com">Lato</a>.</p>
<pre class="r"><code>base +
  theme_quo()</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-31-1.png" width="768" style="display: block; margin: auto;" /></p>
<hr />
<ol start="3" style="list-style-type: decimal">
<li>Look at the plots in your favourite scientific journal. What theme
do they most resemble? What are the main differences?</li>
</ol>
<p>Answer: the plots from <a
href="https://doi.org/10.1016/j.ssci.2018.07.021">this paper</a> on
<em>Safety Science</em> most closely resemble
<code>theme_classic()</code>, with few differences, the most notable
being the position of the legend in Figures 4, 5, 8, and 9.</p>
<hr />
</div>
<div id="exercises-8" class="section level2">
<h2>18.4.6 Exercises</h2>
<ol style="list-style-type: decimal">
<li>Create the ugliest plot possible! (Contributed by Andrew D. Steen,
University of Tennessee - Knoxville)</li>
</ol>
<p>Answer: using the same base, alter colors and theme settings, must
still be legible:</p>
<pre class="r"><code>base +
  geom_smooth(method = &quot;loess&quot;, formula = y ~ x, color = &quot;orange&quot;, fill = &quot;limegreen&quot;) +
  theme_grey(base_family = &quot;Comic Sans MS&quot;) +
  theme(
    plot.background = element_rect(fill = &quot;skyblue&quot;, color = &quot;purple&quot;),
    plot.title = element_text(face = &quot;bold&quot;, hjust = 1, color = &quot;red&quot;),
    plot.subtitle = element_text(color = &quot;yellow&quot;),
    plot.caption = element_text(hjust = 0.5, color = &quot;blue&quot;),
    plot.margin = margin(50, 50, 50, 50),
    axis.line = element_line(color = &quot;maroon&quot;, linetype = &quot;dotdash&quot;),
    axis.text = element_text(color = &quot;hotpink&quot;),
    axis.title = element_text(color = &quot;green&quot;),
    legend.background = element_rect(fill = &quot;lemonchiffon&quot;, color = &quot;gray50&quot;),
    legend.key = element_rect(fill = &quot;pink&quot;, color = &quot;black&quot;),
    legend.text = element_text(color = &quot;purple&quot;),
    legend.title = element_text(color = &quot;deeppink&quot;),
    panel.background = element_rect(fill = &quot;lavender&quot;),
    panel.grid = element_line(linetype = &quot;twodash&quot;)
  ) +
  scale_color_excel()</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-32-1.png" width="768" style="display: block; margin: auto;" /></p>
<hr />
<ol start="2" style="list-style-type: decimal">
<li><code>theme_dark()</code> makes the inside of the plot dark, but not
the outside. Change the plot background to black, and then update the
text settings so you can still read the labels.</li>
</ol>
<p>Answer:</p>
<pre class="r"><code>base +
  theme_dark() +
  theme(
    plot.background = element_rect(fill = &quot;black&quot;),
    legend.background = element_rect(fill = &quot;black&quot;),
    text = element_text(color = &quot;gray50&quot;)
  )</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-33-1.png" width="768" style="display: block; margin: auto;" /></p>
<hr />
<ol start="3" style="list-style-type: decimal">
<li>Make an elegant theme that uses “linen” as the background colour and
a serif font for the text.</li>
</ol>
<p>Answer:</p>
<pre class="r"><code>base +
  theme_minimal(base_family = &quot;Georgia&quot;) +
  theme(
    plot.background = element_rect(fill = &quot;linen&quot;),
    panel.grid.major = element_line(color = &quot;gray85&quot;),
    panel.grid.minor = element_line(color = &quot;gray90&quot;)
  )</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-34-1.png" width="768" style="display: block; margin: auto;" /></p>
<hr />
<ol start="4" style="list-style-type: decimal">
<li>Systematically explore the effects of <code>hjust</code> when you
have a multiline title. Why doesn’t <code>vjust</code> do anything?</li>
</ol>
<p>Answer: with multiline titles, <code>hjust</code> affects both lines
in the same way, between left justified (0), centered (0.5), and right
justified (1). <code>vjust</code> does slightly alter the vertical
justification, but not significantly since two lines are just within the
vertical margins.</p>
<pre class="r"><code>multi &lt;- base +
  labs(title = &quot;Fuel economy declines as engine size increases\n1999-2008&quot;, subtitle = NULL)

multi + theme(plot.title = element_text(hjust = 0))</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-35-1.png" width="768" style="display: block; margin: auto;" /></p>
<pre class="r"><code>multi + theme(plot.title = element_text(hjust = 0.25))</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-35-2.png" width="768" style="display: block; margin: auto;" /></p>
<pre class="r"><code>multi + theme(plot.title = element_text(hjust = 0.5))</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-35-3.png" width="768" style="display: block; margin: auto;" /></p>
<pre class="r"><code>multi + theme(plot.title = element_text(hjust = 1))</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-35-4.png" width="768" style="display: block; margin: auto;" /></p>
<pre class="r"><code>multi + theme(plot.title = element_text(hjust = 1, vjust = 0))</code></pre>
<p><img src="ggplot2-4_files/figure-html/unnamed-chunk-35-5.png" width="768" style="display: block; margin: auto;" /></p>
<hr />
</div>
</div>

<div id="rmd-source-code">LS0tCnRpdGxlOiBnZ3Bsb3QyIChHcmFtbWFyKQpkYXRlOiAnMjAyMi0xMi0wOScKb3V0cHV0OgogIGh0bWxfZG9jdW1lbnQ6CiAgICB0aGVtZToKICAgICAgdmVyc2lvbjogNQogICAgdG9jOiB5ZXMKICAgIHRvY19mbG9hdDoKICAgICAgY29sbGFwc2VkOiB5ZXMKICAgICAgc21vb3RoX3Njcm9sbDogbm8KLS0tCgpXb3JrYm9vayBmb3IgY29tcGxldGluZyBxdWl6emVzIGFuZCBleGVyY2lzZXMgZnJvbSB0aGUgIkdyYW1tYXIiIGNoYXB0ZXJzIG9mIFtnZ3Bsb3QyOiBFbGVnYW50IEdyYXBoaWNzIGZvciBEYXRhIEFuYWx5c2lzXShodHRwczovL2dncGxvdDItYm9vay5vcmcvaW5kZXguaHRtbCksIHRoaXJkIGVkaXRpb24sIHdpdGggY29tcGFyaXNvbnMgdG8gc29sdXRpb25zIGZyb20gW1NvbHV0aW9ucyB0byBnZ3Bsb3QyOiBFbGVnYW50IEdyYXBoaWNzIGZvciBEYXRhIEFuYWx5c2lzXShodHRwczovL2dncGxvdDItYm9vay1zb2x1dGlvbnMtM2VkLm5ldGxpZnkuYXBwKS4KCmBgYHtyIHNldHVwLCBtZXNzYWdlID0gRkFMU0UsIHdhcm5pbmcgPSBGQUxTRX0KbGlicmFyeShNQVNTKSAjIG5vbGludDogdW51c2VkX2ltcG9ydF9saW50ZXIuIFVzZWQgZm9yICJybG0iLgpsaWJyYXJ5KGdncGxvdDIpCmxpYnJhcnkoZHBseXIpCmxpYnJhcnkoamJwbG90KQpsaWJyYXJ5KGdndGhlbWVzKQoKa25pdHI6Om9wdHNfY2h1bmskc2V0KAogIGNvbW1lbnQgPSAiIz4iLAogIGZpZy5hbGlnbiA9ICJjZW50ZXIiCikKYGBgCgojIEludHJvZHVjdGlvbgoKVGhpcyB3b3JrYm9vayBpbmNsdWRlcyBhbnN3ZXJzIGFuZCBzb2x1dGlvbnMgdG8gdGhlIHF1aXp6ZXMgYW5kIGV4ZXJjaXNlcyBmcm9tIFtnZ3Bsb3QyOiBFbGVnYW50IEdyYXBoaWNzIGZvciBEYXRhIEFuYWx5c2lzXShodHRwczovL2dncGxvdDItYm9vay5vcmcvaW5kZXguaHRtbCkgYW5kIFtTb2x1dGlvbnMgdG8gZ2dwbG90MjogRWxlZ2FudCBHcmFwaGljcyBmb3IgRGF0YSBBbmFseXNpc10oaHR0cHM6Ly9nZ3Bsb3QyLWJvb2stc29sdXRpb25zLTNlZC5uZXRsaWZ5LmFwcCksIG9yZ2FuaXplZCBieSBjaGFwdGVyLiBJdCBpbmNsdWRlcyBleGNlcnB0cyBmcm9tIGJvdGggYm9va3MsIGNvcGllZCBoZXJlLgoKKipXQVJOSU5HLCBTUE9JTEVSUyEqKiBJZiB5b3UgaGF2ZW4ndCByZWFkIHRoZSBnZ3Bsb3QyIGJvb2sgYW5kIGludGVuZCB0byBjb21wbGV0ZSB0aGUgcXVpenplcyBhbmQgZXhlcmNpc2VzLCBkb24ndCByZWFkIHRoaXMgbm90ZWJvb2suIEl0IGNvbnRhaW5zIG15IChwb3RlbnRpYWxseSB3cm9uZykgYW5zd2VycyB0byBib3RoLgoKIyAxMyBNYXN0ZXJpbmcgdGhlIGdyYW1tYXIKCkluIG9yZGVyIHRvIHVubG9jayB0aGUgZnVsbCBwb3dlciBvZiBnZ3Bsb3QyLCB5b3UnbGwgbmVlZCB0byBtYXN0ZXIgdGhlIHVuZGVybHlpbmcgZ3JhbW1hci4gQnkgdW5kZXJzdGFuZGluZyB0aGUgZ3JhbW1hciwgYW5kIGhvdyBpdHMgY29tcG9uZW50cyBmaXQgdG9nZXRoZXIsIHlvdSBjYW4gY3JlYXRlIGEgd2lkZXIgcmFuZ2Ugb2YgdmlzdWFsaXphdGlvbnMsIGNvbWJpbmUgbXVsdGlwbGUgc291cmNlcyBvZiBkYXRhLCBhbmQgY3VzdG9taXNlIHRvIHlvdXIgaGVhcnQncyBjb250ZW50LgoKVGhpcyBjaGFwdGVyIGRlc2NyaWJlcyB0aGUgdGhlb3JldGljYWwgYmFzaXMgb2YgZ2dwbG90MjogdGhlIGxheWVyZWQgZ3JhbW1hciBvZiBncmFwaGljcy4gVGhlIGxheWVyZWQgZ3JhbW1hciBpcyBiYXNlZCBvbiBXaWxraW5zb24ncyBncmFtbWFyIG9mIGdyYXBoaWNzLCBidXQgYWRkcyBhIG51bWJlciBvZiBlbmhhbmNlbWVudHMgdGhhdCBoZWxwIGl0IHRvIGJlIG1vcmUgZXhwcmVzc2l2ZSBhbmQgZml0IHNlYW1sZXNzbHkgaW50byB0aGUgUiBlbnZpcm9ubWVudC4gVGhlIGRpZmZlcmVuY2VzIGJldHdlZW4gdGhlIGxheWVyZWQgZ3JhbW1hciBhbmQgV2lsa2luc29uJ3MgZ3JhbW1hciBhcmUgZGVzY3JpYmVkIGZ1bGx5IGluIEhhZGxleSBXaWNraGFtLiBJbiB0aGlzIGNoYXB0ZXIgeW91IHdpbGwgbGVhcm4gYSBsaXR0bGUgYml0IGFib3V0IGVhY2ggY29tcG9uZW50IG9mIHRoZSBncmFtbWFyIGFuZCBob3cgdGhleSBhbGwgZml0IHRvZ2V0aGVyLiAgVGhlIG5leHQgY2hhcHRlcnMgZGlzY3VzcyB0aGUgY29tcG9uZW50cyBpbiBtb3JlIGRldGFpbCwgYW5kIHByb3ZpZGUgbW9yZSBleGFtcGxlcyBvZiBob3cgeW91IGNhbiB1c2UgdGhlbSBpbiBwcmFjdGljZS4KClRoZSBncmFtbWFyIG1ha2VzIGl0IGVhc2llciBmb3IgeW91IHRvIGl0ZXJhdGl2ZWx5IHVwZGF0ZSBhIHBsb3QsIGNoYW5naW5nIGEgc2luZ2xlIGZlYXR1cmUgYXQgYSB0aW1lLiBUaGUgZ3JhbW1hciBpcyBhbHNvIHVzZWZ1bCBiZWNhdXNlIGl0IHN1Z2dlc3RzIHRoZSBoaWdoLWxldmVsIGFzcGVjdHMgb2YgYSBwbG90IHRoYXQgKmNhbiogYmUgY2hhbmdlZCwgZ2l2aW5nIHlvdSBhIGZyYW1ld29yayB0byB0aGluayBhYm91dCBncmFwaGljcywgYW5kIGhvcGVmdWxseSBzaG9ydGVuaW5nIHRoZSBkaXN0YW5jZSBmcm9tIG1pbmQgdG8gcGFwZXIuICBJdCBhbHNvIGVuY291cmFnZXMgdGhlIHVzZSBvZiBncmFwaGljcyBjdXN0b21pc2VkIHRvIGEgcGFydGljdWxhciBwcm9ibGVtLCByYXRoZXIgdGhhbiByZWx5aW5nIG9uIHNwZWNpZmljIGNoYXJ0IHR5cGVzLgoKIyMgMTMuNSBFeGVyY2lzZXMgCgotICAgT25lIG9mIHRoZSBiZXN0IHdheXMgdG8gZ2V0IGEgaGFuZGxlIG9uIGhvdyB0aGUgZ3JhbW1hciB3b3JrcyBpcyB0byBhcHBseQogICAgaXQgdG8gdGhlIGFuYWx5c2lzIG9mIGV4aXN0aW5nIGdyYXBoaWNzLiBGb3IgZWFjaCBvZiB0aGUgZ3JhcGhpY3MgbGlzdGVkIAogICAgYmVsb3csIHdyaXRlIGRvd24gdGhlIGNvbXBvbmVudHMgb2YgdGhlIGdyYXBoaWMuIERvbid0IHdvcnJ5IGlmIHlvdSBkb24ndAogICAga25vdyB3aGF0IHRoZSBjb3JyZXNwb25kaW5nIGZ1bmN0aW9ucyBpbiBnZ3Bsb3QyIGFyZSBjYWxsZWQgKG9yIGlmIHRoZXkgZXZlbgogICAgZXhpc3QhKSwgaW5zdGVhZCBmb2N1c3Npbmcgb24gcmVjb3JkaW5nIHRoZSBrZXkgZWxlbWVudHMgb2YgYSBwbG90IHNvIHlvdQogICAgY291bGQgY29tbXVuaWNhdGUgaXQgdG8gc29tZW9uZSBlbHNlLgoKQW5zd2VyOiB1c2UgdGhlIGNvbXBvbmVudHMgZnJvbSAxMy40IHRvIGRlc2NyaWJlIGVhY2ggcGxvdDogZGF0YSwgYWVzdGhldGljcyAoYWVzKSwgc3RhdCwgZ2VvbSwgc2NhbGUsIGNvb3JkaW5hdGUgc3lzdGVtIChjb29yZCksIGFuZCBmYWNldGluZwoKMS4gICJOYXBvbGVvbidzIG1hcmNoIiBieSBDaGFybGVzIEpvaG4gTWluYXJkOiBbbGlua10oaHR0cDovL3d3dy5kYXRhdmlzLmNhL2dhbGxlcnkvcmUtbWluYXJkLnBocCkKCkFuc3dlcjogdGhlIHBsb3QgZGVzY3JpYmVzIE5hcG9sZWFuJ3MgMTgxMiBjYW1wYWlnbi4gTGFyZ2VyIHZlcnNpb24gYXQ6IFtXaWtpcGVkaWFdKGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0NoYXJsZXNfSm9zZXBoX01pbmFyZCMvbWVkaWEvRmlsZTpNaW5hcmQucG5nKQoKLSBkYXRhOiB0aGUgc2l6ZSwgbG9jYXRpb24gYW5kIGRhdGUgb2YgdGhlIGFybXkncyB0cmF2ZWwsIGFsb25nIHdpdGggdGVtcGVyYXR1cmUKLSBhZXM6IHgsIHkgbWFwcGVkIHRvIGxvY2F0aW9uIG92ZXIgdGltZSwgd2l0aCB3aWR0aCByZXByZXNlbnRpbmcgc2l6ZQotIHN0YXQ6IG5vIHRyYW5zZm9ybWF0aW9uCi0gZ2VvbTogbGluZQotIHNjYWxlOiBzY2FsZXMgYXJlIHVzZWQgZm9yIGxvY2F0aW9uIGFuZCB0ZW1wZXJhdHVyZQotIGNvb3JkOiBDYXJ0ZXNpYW4gLyBtYXAgcHJvamVjdGlvbgotIGZhY2V0OiBubyBmYWNldGluZwoKLS0tCgoyLiAgIldoZXJlIHRoZSBIZWF0IGFuZCB0aGUgVGh1bmRlciBIaXQgVGhlaXIgU2hvdHMiLCBieSBKZXJlbXkgV2hpdGUsIAogICAgSm9lIFdhcmQsIGFuZCBNYXR0aGV3IEVyaWNzb24gYXQgVGhlIE5ldyBZb3JrIFRpbWVzLgogICAgW2xpbmtdKGh0dHBzOi8vYXJjaGl2ZS5ueXRpbWVzLmNvbS93d3cubnl0aW1lcy5jb20vaW50ZXJhY3RpdmUvMjAxMi8wNi8xMS9zcG9ydHMvYmFza2V0YmFsbC9uYmEtc2hvdC1hbmFseXNpcy5odG1sP19yPTApCgpBbnN3ZXI6IGEgcGxvdCBvZiBiYXNrZXRiYWxsIHNob3RzIGFuZCBwb2ludHMgc2NvcmVkLgoKLSBkYXRhOiBudW1iZXIgb2YgYXR0ZW1wdHMgYW5kIHBvaW50cyBzY29yZWQgYnkgbG9jYXRpb24KLSBhZXM6IHgsIHkgbWFwcGVkIHRvIGxvY2F0aW9uLCBzaXplIG1hcHBlZCB0byBhdHRlbXB0cywgY29sb3IgdG8gcG9pbnRzIHNjb3JlZAotIHN0YXQ6IG5vIHRyYW5zZm9ybWF0aW9uIChwb3NzaWJseSBwb2ludHMgcGVyIGF0dGVtcHQpCi0gZ2VvbTogaGV4IHRpbGVzCi0gc2NhbGU6IGNvbnRpbnVvdXMgc2NhbGVzIG1hcHBlZCB0byBsb2NhdGlvbiwgc2l6ZSAoYXR0ZW1wdHMpLCBhbmQgY29sb3IgKHBvaW50cykKLSBjb29yZDogQ2FydGVzaWFuLCBtYXBwZWQgdG8gdGhlIGNvdXJ0Ci0gZmFjZXQ6IGZhY2V0aW5nIGJ5IHRlYW0gYW5kIHBsYXllcnMKCi0tLQoKMy4gICJMb25kb24gQ3ljbGUgSGlyZSBKb3VybmV5cyIsIGJ5IEphbWVzIENoZXNoaXJlLgogICAgW2xpbmtdKGh0dHBzOi8vd2ViLmFyY2hpdmUub3JnL3dlYi8yMDE5MDUyMzIwMzQwOS9odHRwOi8vc3BhdGlhbGFuYWx5c2lzLmNvLnVrLzIwMTIvMDIvZ3JlYXQtbWFwcy1nZ3Bsb3QyLykKCkFuc3dlcjogcmV0cmlldmVkIGZyb20gW2FyY2hpdmUub3JnXShodHRwczovL3dlYi5hcmNoaXZlLm9yZy93ZWIvMjAyMTA1MTYyMzI5MjMvaHR0cDovL3NwYXRpYWxhbmFseXNpcy5jby51ay93cC1jb250ZW50L3VwbG9hZHMvMjAxMi8wMi9iaWtlX2dncGxvdC5wbmcpLgoKLSBkYXRhOiB0cmF2ZWxzIG9mIExvbmRvbiBiaWN5Y2xlIHJlbnRhbHMKLSBhZXM6IHgsIHkgbWFwcGVkIHRvIGxvY2F0aW9uLCBkZW5zaXR5IChhbHBoYSkgbWFwcGVkIHRvIG51bWJlciBvZiB0cmlwcyBpbiBhIGxvY2F0aW9uCi0gc3RhdDogbm9uZQotIGdlb206IGxpbmUKLSBzY2FsZTogbG9jYXRpb24KLSBjb29yZDogQ2FydGVzaWFuIC8gbWFwIHByb2plY3Rpb24KLSBmYWNldDogbm9uZQoKLS0tCgo0LiAgVGhlIFBldyBSZXNlYXJjaCBDZW50ZXIncyBmYXZvcml0ZSBkYXRhIHZpc3VhbGl6YXRpb25zIG9mIDIwMTQ6CiAgICBbbGlua10oaHR0cHM6Ly93d3cucGV3cmVzZWFyY2gub3JnL2ZhY3QtdGFuay8yMDE0LzEyLzI5L291ci1mYXZvcml0ZS1wZXctcmVzZWFyY2gtY2VudGVyLWRhdGEtdmlzdWFsaXphdGlvbnMtZnJvbS0yMDE0LykKCkFuc3dlcjogbXVsdGlwbGUgcGxvdHMsIGRlc2NyaWJlZCBpbmRpdmlkdWFsbHkuCgpQb2xpdGljYWwgU2hpZnRzCgotIGRhdGE6IHJlc3BvbnNlcyB0byBwb2xpdGljYWwgdmFsdWVzIHF1ZXN0aW9ucwotIGFlczogaGVpZ2h0IHNob3dpbmcgdm9sdW1lIG9mIHJlc3BvbnNlcywgYmV0d2VlbiBjb25zaXN0ZW50bHkgbGliZXJhbCBhbmQgY29uc2VydmF0aXZlCi0gc3RhdDogaGlzdG9ncmFtCi0gZ2VvbTogYXJlYSAvIGZyZXF1ZW5jeSBwb2x5Z29uLCB3aXRoIGNvbG9yIHNob3dpbmcgYWJvdmUgLyBiZWxvdyBtZWRpYW4gb2YgdGhlIG90aGVyIHBhcnR5Ci0gc2NhbGU6IGNvbnRpbnVvdXMKLSBjb29yZDogQ2FydGVzaWFuCi0gZmFjZXQ6IGZhY2V0aW5nIGJ5IHBhcnR5IGJ5IHllYXIKCk5leHQgQW1lcmljYQoKLSBkYXRhOiBwb3B1bGF0aW9uIGJ5IGFnZSBncm91cCBhbmQgZ2VuZGVyCi0gYWVzOiBiaW5uZWQgZGF0YSBieSBhZ2UgYW5kIGdlbmRlcgotIHN0YXQ6IG5vbmUKLSBnZW9tOiBiYXIgYW5kIGNvbG9yIGJ5IGdlbmRlciwgd2l0aCBib29tZXJzIGEgZGlzdGluY3QgY29sb3IKLSBzY2FsZTogY29udGludW91cwotIGNvb3JkOiBDYXJ0ZXNpYW4KLSBmYWNldDogZmFjZXRpbmcgYnkgeWVhciwgYW5pbWF0ZWQKCiJNdXJkZXIgQ2FwaXRhbHMiCgotIGRhdGE6IG11cmRlciByYXRlIGZvciBzaXggY2l0aWVzLCB3aXRoIHRoZSBoaWdoZXN0IHJhdGUgc2hvd24gZm9yIGVhY2ggeWVhciwgbmF0aW9uYWwgcmF0ZQotIGFlczogeCBpcyB0aW1lICh5ZWFyKSBhbmQgeSBpcyB0aGUgbXVyZGVyIHJhdGUKLSBzdGF0OiBub25lCi0gZ2VvbTogYmFyLCBsaW5lCi0gc2NhbGU6IGNpdHkgaXMgYWRkaXRpb25hbGx5IG1hcHBlZCB0byB5ZWFyIGF0IHRoZSB0b3Agb2YgdGhlIHBsb3QsIGFuZCBuYXRpb25hbCByYXRlIGlzIHNob3duIGFzIGEKICBsaW5lIGFjcm9zcyB0aGUgYm90dG9tCi0gY29vcmQ6IENhcnRlc2lhbgotIGZhY2V0OiBub25lCgpJZGVvbG9naWNhbCBQbGFjZW1lbnQgb2YgTmV3cyBTb3VyY2VzCgotIGRhdGE6IHNjb3JlcyBvZiByZXNwb25zZXMgdG8gcG9saXRpY2FsIHZhbHVlcyBxdWVzdGlvbnMgbWFwcGVkIHRvIGF1ZGllbmNlcyBmb3IgbmV3cyBzb3VyY2VzCi0gYWVzOiB4IG1hcHBlZCB0byBzY29yZSBmb3IgYSBuZXdzIHNvdXJjZSBhdWRpZW5jZQotIHN0YXQ6IG5vbmUKLSBnZW9tOiBwb2ludAotIHNjYWxlOiBhIHNpbmdsZSAoeC1heGlzKSBjb250aW51b3VzIHNjYWxlLCB3aXRoIGxhYmVscyBmb3IgZWFjaCBzb3VyY2UKLSBjb29yZDogQ2FydGVzaWFuCi0gZmFjZXQ6IG5vbmUKClJlZ2lvbmFsIFN1cHBvcnQgZm9yIFNhbWUtU2V4IE1hcnJpYWdlCgotIGRhdGE6IHBlcmNlbnRhZ2Ugb2YgcG9wdWxhdGlvbiBzdXBwb3J0aW5nIHNhbWUtc2V4IG1hcnJpYWdlIGJ5IHJlZ2lvbgotIGFlczogeCBtYXBwZWQgdG8gdGltZSAoeWVhciksIHkgbWFwcGVkIHRvIHBlcmNlbnQgc3VwcG9ydAotIHN0YXQ6IG5vbmUKLSBnZW9tOiBsaW5lCi0gc2NhbGU6IGNvbnRpbnVvdXMKLSBjb29yZDogQ2FydGVzaWFuCi0gZmFjZXQ6IGZhY2V0aW5nIGJ5IHJlZ2lvbiwgbmF0aW9uYWwgc3VwcG9ydCBpcyBhbiBhZGRpdGlvbmFsIGxheWVyCgotLS0KCjUuICAiVGhlIFRvbnkncyBIYXZlIE5ldmVyIEJlZW4gc28gRG9taW5hdGVkIGJ5IFdvbWVuIiwgYnkgCiAgICBKb2FubmEgS2FvIGF0IEZpdmVUaGlydHlFaWdodDoKICAgIFtsaW5rXShodHRwczovL2ZpdmV0aGlydHllaWdodC5jb20vZmVhdHVyZXMvdGhlLXRvbnlzLWhhdmUtbmV2ZXItYmVlbi1zby1kb21pbmF0ZWQtYnktd29tZW4vKS4KCkFuc3dlcjogYSBwbG90IG9mIFRvbnkgYXdhcmQgd2lubmVycyBieSBjYXRlZ29yeS4KCi0gZGF0YTogVG9ueSBhd2FyZCBjYXRlZ29yaWVzIGJ5IHllYXIgd2l0aCBhdCBsZWFzdCBvbmUgZmVtYWxlIHdpbm5lcgotIGFlczogY2F0ZWdvcmllcyBhbG9uZyB0aGUgeSBheGlzLCB5ZWFycyBhbG9uZyB0aGUgeCBheGlzLCBjb2xvcmVkIHJlZCBpZiBhIGZlbWFsZSB3b24KLSBzdGF0OiBub25lCi0gZ2VvbTogc3F1YXJlIHBvaW50cyB3aXRoIGNvbG9yIHNob3dpbmcgZmVtYWxlIHdpbm5lcnMKLSBzY2FsZTogZGlzY3JldGUgY2F0ZWdvcmllcyBhbmQgeWVhcnMKLSBjb29yZDogQ2FydGVzaWFuCi0gZmFjZXQ6IG5vbmUKCi0tLQoKNi4gICJJbiBDbGltYmluZyBJbmNvbWUgTGFkZGVyLCBMb2NhdGlvbiBNYXR0ZXJzIiBieSB0aGUgTWlrZSBCb3N0b2NrLCAKICAgIFNoYW4gQ2FydGVyLCBBbWFuZGEgQ294LCBNYXR0aGV3IEVyaWNzb24sIEpvc2ggS2VsbGVyLCBBbGljaWEgCiAgICBQYXJsYXBpYW5vLCBLZXZpbiBRdWVhbHkgYW5kIEpvc2ggV2lsbGlhbXMgYXQgdGhlIE5ldyBZb3JrIFRpbWVzOgogICAgW2xpbmtdKGh0dHBzOi8vd3d3Lm55dGltZXMuY29tLzIwMTMvMDcvMjIvYnVzaW5lc3MvaW4tY2xpbWJpbmctaW5jb21lLWxhZGRlci1sb2NhdGlvbi1tYXR0ZXJzLmh0bWwpCgpBbnN3ZXI6IG5vdCB2aXNpYmxlIGR1ZSB0byBwYXl3YWxsLCB1bmFibGUgdG8gcmV0cmlldmUgdGhlIGdyYXBoaWMuCgotLS0KCjcuICJEaXNzZWN0aW5nIGEgVHJhaWxlcjogVGhlIFBhcnRzIG9mIHRoZSBGaWxtIFRoYXQgTWFrZSB0aGUgQ3V0IiwKICAgIGJ5IFNoYW4gQ2FydGVyLCBBbWFuZGEgQ294LCBhbmQgTWlrZSBCb3N0b2NrIGF0IHRoZSBOZXcgWW9yayBUaW1lczoKICAgIFtsaW5rXShodHRwczovL2FyY2hpdmUubnl0aW1lcy5jb20vd3d3Lm55dGltZXMuY29tL2ludGVyYWN0aXZlLzIwMTMvMDIvMTkvbW92aWVzL2F3YXJkc3NlYXNvbi9vc2Nhci10cmFpbGVycy5odG1sKQoKQW5zd2VyOiBtdWx0aXBsZSBwbG90cyBzaG93aW5nIHRoZSBzZXF1ZW5jaW5nIG9mIG1vdmllIHRyYWlsZXJzLgoKLSBkYXRhOiBzY2VuZXMgaW4gYSB0cmFpbGVyIG1hcHBlZCB0byB3aGVuIHRoZXkgb2NjdXJyZWQgaW4gdGhlIGZ1bGwgZmlsbQotIGFlczogeCBheGlzIHNob3dpbmcgdGhlIHRpbWVzdGFtcCBvZiBhIHRyYWlsZXIgc2NlbmUsIHkgYXhpcyBhbmQgY29sb3Igc2hvd2luZyB3aGVuIHRoZSBzY2VuZQogIG9jY3VycmVkLCBpbmNsdWRpbmcgc2NlbmVzIG5vdCBpbiB0aGUgZmluYWwgZmlsbQotIHN0YXQ6IG5vbmUKLSBnZW9tOiBzcXVhcmUgcG9pbnRzICh3aXRoIHdpZHRoIHBlciBzY2VuZSksIGNvbm5lY3RlZCBieSBsaW5lcwotIHNjYWxlOiBjb250aW51b3VzIGR1cmF0aW9uIChzZWNvbmRzKQotIGNvb3JkOiBDYXJ0ZXNpYW4KLSBmYWNldDogZmFjZXRpbmcgYnkgdHJhaWxlciAoYWxsIHBsb3RzIGFyZSBtYXBwZWQgdG8gdGhlIHNhbWUgc2NhbGUpCgotLS0KCiMgMTQgQnVpbGQgYSBwbG90IGxheWVyIGJ5IGxheWVyCgpPbmUgb2YgdGhlIGtleSBpZGVhcyBiZWhpbmQgZ2dwbG90MiBpcyB0aGF0IGl0IGFsbG93cyB5b3UgdG8gZWFzaWx5IGl0ZXJhdGUsIGJ1aWxkaW5nIHVwIGEgY29tcGxleCBwbG90IGEgbGF5ZXIgYXQgYSB0aW1lLiBFYWNoIGxheWVyIGNhbiBjb21lIGZyb20gYSBkaWZmZXJlbnQgZGF0YXNldCBhbmQgaGF2ZSBhIGRpZmZlcmVudCBhZXN0aGV0aWMgbWFwcGluZywgbWFraW5nIGl0IHBvc3NpYmxlIHRvIGNyZWF0ZSBzb3BoaXN0aWNhdGVkIHBsb3RzIHRoYXQgZGlzcGxheSBkYXRhIGZyb20gbXVsdGlwbGUgc291cmNlcy4gCgpZb3UndmUgYWxyZWFkeSBjcmVhdGVkIGxheWVycyB3aXRoIGZ1bmN0aW9ucyBsaWtlIGBnZW9tX3BvaW50KClgIGFuZCBgZ2VvbV9oaXN0b2dyYW0oKWAuIEluIHRoaXMgY2hhcHRlciwgeW91J2xsIGRpdmUgaW50byB0aGUgZGV0YWlscyBvZiBhIGxheWVyLCBhbmQgaG93IHlvdSBjYW4gY29udHJvbCBhbGwgZml2ZSBjb21wb25lbnRzOiBkYXRhLCB0aGUgYWVzdGhldGljIG1hcHBpbmdzLCB0aGUgZ2VvbSwgc3RhdCwgYW5kIHBvc2l0aW9uIGFkanVzdG1lbnRzLiBUaGUgZ29hbCBoZXJlIGlzIHRvIGdpdmUgeW91IHRoZSB0b29scyB0byBidWlsZCBzb3BoaXN0aWNhdGVkIHBsb3RzIHRhaWxvcmVkIHRvIHRoZSBwcm9ibGVtIGF0IGhhbmQuCgojIyAxNC4zLjEgRXhlcmNpc2VzCgoxLiAgVGhlIGZpcnN0IHR3byBhcmd1bWVudHMgdG8gZ2dwbG90IGFyZSBgZGF0YWAgYW5kIGBtYXBwaW5nYC4gVGhlIGZpcnN0CiAgICB0d28gYXJndW1lbnRzIHRvIGFsbCBsYXllciBmdW5jdGlvbnMgYXJlIGBtYXBwaW5nYCBhbmQgYGRhdGFgLiBXaHkgZG9lcyB0aGUKICAgIG9yZGVyIG9mIHRoZSBhcmd1bWVudHMgZGlmZmVyPyAoSGludDogdGhpbmsgYWJvdXQgd2hhdCB5b3Ugc2V0IG1vc3QgCiAgICBjb21tb25seS4pCgpBbnN3ZXI6IG1vc3QgcGxvdHMgdXNlIGNvbW1vbiBkYXRhIGZvciBhbGwgbGF5ZXJzLCB3aGVyZSB0aGUgYWVzdGhldGljcyBhcmUgbW9yZSBsaWtlbHkgdG8gdmFyeS4KCkdHIFNvbHV0aW9uczoKCi0gQ29tbW9ubHksIHlvdSBmaXJzdCBzZXQgdGhlIGRhdGEgaW4gYGdncGxvdCgpYCBhbmQgdGhlbiBzZXQgYWVzdGhldGljcyBpbnNpZGUgeW91ciBsYXllciBmdW5jdGlvbnMsIGxpa2UgYGdlb21fcG9pbnQoKWAsIGBnZW9tX2JveHBsb3QoKWAsIG9yIGBnZW9tX2hpc3RvZ3JhbSgpYC4gCgotLS0KCjIuICBUaGUgZm9sbG93aW5nIGNvZGUgdXNlcyBkcGx5ciB0byBnZW5lcmF0ZSBzb21lIHN1bW1hcnkgc3RhdGlzdGljcyBhYm91dAogICAgZWFjaCBjbGFzcyBvZiBjYXIuIAoKYGBge3J9CmNsYXNzIDwtIGdncGxvdDI6Om1wZyAlPiUKICBncm91cF9ieShjbGFzcykgJT4lCiAgc3VtbWFyaXNlKG4gPSBuKCksIGh3eSA9IG1lYW4oaHd5KSkKYGBgCgogICAgVXNlIHRoZSBkYXRhIHRvIHJlY3JlYXRlIHRoaXMgcGxvdDoKCkFuc3dlcjogd2l0aCBzb21lIGhlbHAgZnJvbSB0aGUgc291cmNlIGNvZGUgdG8gZ2V0IHRoZSBtZWFzdXJlbWVudHMgcmlnaHQsIGhlcmUgaXMgdGhlIHNvbHV0aW9uOgoKYGBge3J9CmdncGxvdChnZ3Bsb3QyOjptcGcsIGFlcyhjbGFzcywgaHd5KSkgKwogIGdlb21fcG9pbnQoKSArCiAgZ2VvbV9qaXR0ZXIod2lkdGggPSAwLjI1KSArCiAgZ2VvbV9wb2ludChkYXRhID0gY2xhc3MsIGNvbG9yID0gInJlZCIsIHNpemUgPSA1KSArCiAgZ2VvbV90ZXh0KGFlcyh5ID0gMTAsIGxhYmVsID0gcGFzdGUwKCJuID0gIiwgbikpLCBkYXRhID0gY2xhc3MsIHNpemUgPSAzKQpgYGAKCkdHIFNvbHV0aW9uczoKCmBgYHtyfQpnZ3Bsb3QyOjptcGcgJT4lCiAgZ2dwbG90KGFlcyhjbGFzcywgaHd5KSkgKwogIGdlb21faml0dGVyKHdpZHRoID0gMC4xNSwgaGVpZ2h0ID0gMC4zNSkgKwogIGdlb21fcG9pbnQoCiAgICBkYXRhID0gY2xhc3MsIGFlcyhjbGFzcywgaHd5KSwKICAgIGNvbG9yID0gInJlZCIsCiAgICBzaXplID0gNgogICkgKwogIGdlb21fdGV4dChkYXRhID0gY2xhc3MsIGFlcyh5ID0gMTAsIHggPSBjbGFzcywgbGFiZWwgPSBwYXN0ZTAoIm4gPSAiLCBuKSkpCmBgYAoKLSBJIHBsb3R0ZWQgMyBkaWZmZXJlbnQgbGF5ZXJzOiBqaXR0ZXJlZCBwb2ludHMsIHJlZCBwb2ludCBmb3IgdGhlIHN1bW1hcnkgbWVhc3VyZSwgbWVhbiwgYW5kIHRleHQgZm9yIHRoZSBzYW1wbGUgc2l6ZSAobikuCgotLS0KCiMjIDE0LjQuMyBFeGVyY2lzZXMKCjEuICBTaW1wbGlmeSB0aGUgZm9sbG93aW5nIHBsb3Qgc3BlY2lmaWNhdGlvbnM6CgpgYGB7ciwgZXZhbCA9IEZBTFNFfQpnZ3Bsb3QoZ2dwbG90Mjo6bXBnKSArCiAgZ2VvbV9wb2ludChhZXMobXBnJGRpc3BsLCBtcGckaHd5KSkKCmdncGxvdCgpICsKICBnZW9tX3BvaW50KG1hcHBpbmcgPSBhZXMoeSA9IGh3eSwgeCA9IGN0eSksIGRhdGEgPSBtcGcpICsKICBnZW9tX3Ntb290aChkYXRhID0gbXBnLCBtYXBwaW5nID0gYWVzKGN0eSwgaHd5KSkKCmdncGxvdChkaWFtb25kcywgYWVzKGNhcmF0LCBwcmljZSkpICsKICBnZW9tX3BvaW50KGFlcyhsb2coYnJhaW53dCksIGxvZyhib2R5d3QpKSwgZGF0YSA9IG1zbGVlcCkKYGBgCgpBbnN3ZXI6CgpgYGB7cn0KZ2dwbG90KGdncGxvdDI6Om1wZywgYWVzKGRpc3BsLCBod3kpKSArCiAgZ2VvbV9wb2ludCgpCgpnZ3Bsb3QoZ2dwbG90Mjo6bXBnLCBhZXMoY3R5LCBod3kpKSArCiAgZ2VvbV9wb2ludCgpICsKICBnZW9tX3Ntb290aChtZXRob2QgPSAibG9lc3MiLCBmb3JtdWxhID0geSB+IHgpCgpnZ3Bsb3QobXNsZWVwLCBhZXMobG9nKGJyYWlud3QpLCBsb2coYm9keXd0KSkpICsKICBnZW9tX3BvaW50KG5hLnJtID0gVFJVRSkKYGBgCgpHRyBTb2x1dGlvbnMgb2ZmZXJzIGEgc2ltaWxhciBzb2x1dGlvbiBmb3IgdGhlIGZpcnN0IHR3byBhbmQgYSBzdHJhbmdlIHNvbHV0aW9uIGZvciB0aGUgdGhpcmQgKHNpbmNlIHRoZSBgZGlhbW9uZHNgIGRhdGEgaXMgbmV2ZXIgdXNlZCBpbiB0aGUgdGhpcmQgcGxvdCk6CgpgYGB7ciwgZXZhbCA9IEZBTFNFfQpnZ3Bsb3QoZ2dwbG90Mjo6bXBnKSArCiAgZ2VvbV9wb2ludChhZXMoZGlzcGwsIGh3eSkpCgpnZ3Bsb3QoZ2dwbG90Mjo6bXBnLCBhZXMoY3R5LCBod3kpKSArCiAgZ2VvbV9wb2ludCgpICsKICBnZW9tX3Ntb290aCgpCgptc2xlZXBfcHJvY2Vzc2VkIDwtIG1zbGVlcCAlPiUKICBtdXRhdGUoCiAgICBicmFpbnd0X2xvZyA9IGxvZyhicmFpbnd0KSwKICAgIGJvZHl3dF9sb2cgPSBsb2coYm9keXd0KQogICkKCmdncGxvdChkaWFtb25kcywgYWVzKGNhcmF0LCBwcmljZSkpICsKICBnZW9tX3BvaW50KGFlcyhicmFpbnd0X2xvZywgYm9keXd0X2xvZyksCiAgICBkYXRhID0gbXNsZWVwX3Byb2Nlc3NlZAogICkKYGBgCgpOb3RlOiBJIHByZWZlciBteSBhbnN3ZXIgdG8gR0cgU29sdXRpb25zLgoKLS0tCgoyLiAgV2hhdCBkb2VzIHRoZSBmb2xsb3dpbmcgY29kZSBkbz8gRG9lcyBpdCB3b3JrPyBEb2VzIGl0IG1ha2Ugc2Vuc2U/CiAgICBXaHkvd2h5IG5vdD8KCmBgYHtyLCBldmFsID0gRkFMU0V9CmdncGxvdChnZ3Bsb3QyOjptcGcpICsKICBnZW9tX3BvaW50KGFlcyhjbGFzcywgY3R5KSkgKwogIGdlb21fYm94cGxvdChhZXModHJhbnMsIGh3eSkpCmBgYAoKQW5zd2VyOiBpdCBkb2VzIHdvcmssIGJ1dCBkb2VzIG5vdCBtYWtlIHNlbnNlLCBhbmQgc2hvdWxkIGJlIGRvbmUgYXMgc2VwYXJhdGUgcGxvdHMgc28gdGhhdCB0aGUgdmFyaWFibGVzIGNvbXBhcmlzb25zIGFyZSB2aXNpYmxlOgoKYGBge3J9CmdncGxvdChnZ3Bsb3QyOjptcGcsIGFlcyhjbGFzcywgY3R5KSkgKwogIGdlb21fcG9pbnQoKSArCiAgY29vcmRfZmxpcCgpCgpnZ3Bsb3QoZ2dwbG90Mjo6bXBnLCBhZXModHJhbnMsIGh3eSkpICsKICBnZW9tX2JveHBsb3QoKSArCiAgY29vcmRfZmxpcCgpCmBgYAoKR0cgU29sdXRpb25zOgoKLSBJdCBwbG90cyBwb2ludHMgb2YgYGNsYXNzYCB2cyBgY3R5YCBhbmQgdGhlbiBhIGJveHBsb3Qgb2YgYHRyYW5zYCB2cyBgaHd5YC4gSXQgZG9lc24ndCBtYWtlIHNlbnNlIHRvIHBsb3QgbGF5ZXJzIHdpdGggZGlmZmVyZW50IGB4YCBhbmQgYHlgIHZhcmlhYmxlcy4KCi0tLQoKMy4gIFdoYXQgaGFwcGVucyBpZiB5b3UgdHJ5IHRvIHVzZSBhIGNvbnRpbnVvdXMgdmFyaWFibGUgb24gdGhlIHggYXhpcyBpbiAKICAgIG9uZSBsYXllciwgYW5kIGEgY2F0ZWdvcmljYWwgdmFyaWFibGUgaW4gYW5vdGhlciBsYXllcj8gV2hhdCBoYXBwZW5zIGlmIAogICAgeW91IGRvIGl0IGluIHRoZSBvcHBvc2l0ZSBvcmRlcj8KCkFuc3dlcjogbGV0J3MgZXhwZXJpbWVudCEKClRoaXMgY29kZSB0aHJvd3MgYW4gZXJyb3IsIGBFcnJvcjogRGlzY3JldGUgdmFsdWUgc3VwcGxpZWQgdG8gY29udGludW91cyBzY2FsZWAKCmBgYHtyLCBldmFsID0gRkFMU0V9CmdncGxvdChnZ3Bsb3QyOjptcGcsIGFlcyhkaXNwbCwgaHd5KSkgKwogIGdlb21fcG9pbnQoKSArCiAgZ2VvbV9wb2ludChhZXMoZHJ2LCBod3kpLCBjb2xvciA9ICJyZWQiKQpgYGAKClJldmVyc2luZyB0aGUgb3JkZXIgd29ya3MsIGJ1dCBkcmF3cyBhIHN0cmFuZ2UgcGxvdDoKCmBgYHtyfQpnZ3Bsb3QoZ2dwbG90Mjo6bXBnLCBhZXMoZGlzcGwsIGh3eSkpICsKICBnZW9tX3BvaW50KGFlcyhkcnYsIGh3eSksIGNvbG9yID0gInJlZCIpICsKICBnZW9tX3BvaW50KCkKYGBgCgpHRyBTb2x1dGlvbnM6CgotIE5vdCBzdXJlCgotLS0KCiMjIDE0LjUuMSBFeGVyY2lzZXMKCjEuICBEb3dubG9hZCBhbmQgcHJpbnQgb3V0IHRoZSBnZ3Bsb3QyIGNoZWF0c2hlZXQgZnJvbSAKICAgIFtyc3R1ZGlvXShodHRwOi8vd3d3LnJzdHVkaW8uY29tL3Jlc291cmNlcy9jaGVhdHNoZWV0cy8pIHNvIHlvdSBoYXZlIGEgaGFuZHkgdmlzdWFsCiAgICByZWZlcmVuY2UgZm9yIGFsbCB0aGUgZ2VvbXMuCgpBbnN3ZXI6IGNoZWF0c2hlZXRzIGhhdmUgbW92ZWQgdG8gW3Bvc2l0XShodHRwczovL3Bvc2l0LmNvL3Jlc291cmNlcy9jaGVhdHNoZWV0cy8pIChhcyB0aGUgY29tcGFueSByZWJyYW5kZWQpLgoKLS0tCgoyLiAgTG9vayBhdCB0aGUgZG9jdW1lbnRhdGlvbiBmb3IgdGhlIGdyYXBoaWNhbCBwcmltaXRpdmUgZ2VvbXMuIFdoaWNoCiAgICBhZXN0aGV0aWNzIGRvIHRoZXkgdXNlPyBIb3cgY2FuIHlvdSBzdW1tYXJpc2UgdGhlbSBpbiBhIGNvbXBhY3QgZm9ybT8KCkFuc3dlcjogZnJvbSAxNC41LCB0aGUgcHJpbWl0aXZlcyBhcmU6CgotIGBnZW9tX2JsYW5rKClgOiBubyBhZXN0aGV0aWNzLCAiZHJhdyBub3RoaW5nIgotIGBnZW9tX3BvaW50KClgOiAqKmB4YCoqLCAqKmB5YCoqLCBgYWxwaGFgLCBgY29sb3JgLCBgZmlsbGAsIGBncm91cGAsIGBzaGFwZWAsIGBzaXplYCwgYHN0cm9rZWAsCiAgImRyYXcgcG9pbnRzIgotIGBnZW9tX3BhdGgoKWA6ICoqYHhgKiosICoqYHlgKiosIGBhbHBoYWAsIGBjb2xvcmAsIGBncm91cGAsIGBsaW5ldHlwZWAsIGBsaW5ld2lkdGhgLAogICJjb25uZWN0IG9ic2VydmF0aW9ucyIKLSBgZ2VvbV9yaWJib24oKWA6ICoqYHhgIG9yIGB5YCoqLCAqKmB5bWluYCBvciBgeG1pbmAqKiwgKipgeW1heGAgb3IgYHhtYXhgKiosIGBhbHBoYWAsIGBjb2xvcmAsCiAgYGZpbGxgLCBgZ3JvdXBgLCBgbGluZXR5cGVgLCBgbGluZXdpZHRoYCwgImRyYXcgYW4gYXJlYSBhbG9uZyBhIGxpbmUiCi0gYGdlb21fc2VnbWVudCgpYDogKipgeGAqKiwgKipgeWAqKiwgKipgeGVuZGAqKiwgKipgeWVuZGAqKiwgYGFscGhhYCwgYGNvbG9yYCwgYGdyb3VwYCwgYGxpbmV0eXBlYCwKICBgbGluZXdpZHRoYCwgImNvbm5lY3QgdHdvIHBvaW50cyIKLSBgZ2VvbV9yZWN0KClgOiAqKmB4YCoqLCAqKmB5YCoqLCBgYWxwaGFgLCBgY29sb3JgLCBgZmlsbGAsIGBncm91cGAsIGBoZWlnaHRgLCBgbGluZXR5cGVgLAogIGBsaW5ld2lkdGhgLCBgd2lkdGhgLCAiZHJhdyByZWN0YW5nbGVzIgotIGBnZW9tX3BvbHlnb24oKWA6ICoqYHhgKiosICoqYHlgKiosIGBhbHBoYWAsIGBjb2xvcmAsIGBmaWxsYCwgYGdyb3VwYCwgYGxpbmV0eXBlYCwgYGxpbmV3aWR0aGAsCiAgYHN1Ymdyb3VwYCwgImRyYXcgcG9seWdvbnMiCi0gYGdlb21fdGV4dCgpYDogKipgeGAqKiwgKipgeWAqKiwgKipgbGFiZWxgKiosIGBhbHBoYWAsIGBhbmdsZWAsIGBjb2xvcmAsIGBmYW1pbHlgLCBgZm9udGZhY2VgLAogIGBncm91cGAsIGBoanVzdGAsIGBsaW5laGVpZ2h0YCwgYHNpemVgLCBgdmp1c3RgLCAiZHJhdyB0ZXh0IgoKLS0tCgozLiAgV2hhdCdzIHRoZSBiZXN0IHdheSB0byBtYXN0ZXIgYW4gdW5mYW1pbGlhciBnZW9tPyBMaXN0IHRocmVlIHJlc291cmNlcwogICAgdG8gaGVscCB5b3UgZ2V0IHN0YXJ0ZWQuCgpBbnN3ZXI6CgotIFIgRG9jdW1lbnRhdGlvbiBmb3IgZ2dwbG90MiwgZWl0aGVyIGJ1aWx0LWluIG9yIFtvbmxpbmVdKGh0dHBzOi8vZ2dwbG90Mi50aWR5dmVyc2Uub3JnKQotIFBvc2l0IFtjaGVhdHNoZWV0c10oaHR0cHM6Ly9wb3NpdC5jby9yZXNvdXJjZXMvY2hlYXRzaGVldHMvKQotIFRoZSBbUiBHcmFwaCBHYWxsZXJ5XShodHRwczovL3ItZ3JhcGgtZ2FsbGVyeS5jb20pCgotLS0KCjQuICBGb3IgZWFjaCBvZiB0aGUgcGxvdHMgYmVsb3csIGlkZW50aWZ5IHRoZSBnZW9tIHVzZWQgdG8gZHJhdyBpdC4KCkFuc3dlcjogaW4gdGhlIG9yZGVyIHRoZXkgYXBwZWFyIGluIHRoZSBbRXhlcmNpc2VzXShodHRwczovL2dncGxvdDItYm9vay5vcmcvbGF5ZXJzLmh0bWwjZXhlcmNpc2VzLTExKToKCjEuIGBnZW9tX3Zpb2xpbmAKMS4gYGdlb21fcG9pbnRgIChhY3R1YWxseSB1c2VzIGBnZW9tX2NvdW50YCkKMS4gYGdlb21faGV4YAoxLiBgZ2VvbV9wb2ludGAgKGFjdHVhbGx5IHVzZXMgYGdlb21faml0dGVyYCkKMS4gYGdlb21fYXJlYWAKMS4gYGdlb21fcGF0aGAKCk5vdGU6IHZlcmlmeWluZyBteSBhbnN3ZXJzIGFnYWluc3QgdGhlIFtzb3VyY2UgY29kZV0oaHR0cHM6Ly9naXRodWIuY29tL2hhZGxleS9nZ3Bsb3QyLWJvb2svYmxvYi9tYXN0ZXIvbGF5ZXJzLlJtZCksIEkgZ290IHR3byB3cm9uZywgYWx0aG91Z2ggdGhlIHVuZGVybHlpbmcgZ2VvbSBpcyBgZ2VvbV9wb2ludGAuCgpHRyBTb2x1dGlvbnM6CgpTdGFydGluZyBmcm9tIHRvcCBsZWZ0LCBjbG9ja3dpc2UgZGlyZWN0aW9uOgoKLSBgZ2VvbV92aW9saW4oKWAsIGBnZW9tX3BvaW50KClgLCBgZ2VvbV9wb2ludCgpYCwgYGdlb21fcGF0aCgpYCwgYGdlb21fYXJlYSgpYCwgYGdlb21faGV4KClgLgoKTm90ZTogR0cgU29sdXRpb25zIG1ha2VzIHRoZSBzYW1lIG1pc3Rha2VzIEkgZGlkLgoKLS0tCgo1LiAgRm9yIGVhY2ggb2YgdGhlIGZvbGxvd2luZyBwcm9ibGVtcywgc3VnZ2VzdCBhIHVzZWZ1bCBnZW9tOgoKICAgICogRGlzcGxheSBob3cgYSB2YXJpYWJsZSBoYXMgY2hhbmdlZCBvdmVyIHRpbWUuCiAgICAqIFNob3cgdGhlIGRldGFpbGVkIGRpc3RyaWJ1dGlvbiBvZiBhIHNpbmdsZSB2YXJpYWJsZS4KICAgICogRm9jdXMgYXR0ZW50aW9uIG9uIHRoZSBvdmVyYWxsIHRyZW5kIGluIGEgbGFyZ2UgZGF0YXNldC4KICAgICogRHJhdyBhIG1hcC4KICAgICogTGFiZWwgb3V0bHlpbmcgcG9pbnRzLgoKQW5zd2VycyBiZWxvdzoKCi0gRGlzcGxheSBob3cgYSB2YXJpYWJsZSBoYXMgY2hhbmdlZCBvdmVyIHRpbWU6IGBnZW9tX2xpbmVgLCB3aXRoIHRpbWUgb24gdGhlIHggYXhpcywgb3IgYGdlb21fcGF0aGAKICB0byBzaG93IGNoYW5nZXMgaW4gdHdvIGRpbWVuc2lvbnMgb3ZlciB0aW1lLgotIFNob3cgdGhlIGRldGFpbGVkIGRpc3RyaWJ1dGlvbiBvZiBhIHNpbmdsZSB2YXJpYWJsZTogb25lIG9mIHRoZSBkaXN0cmlidXRpb24gcGxvdHMsCiAgYGdlb21faGlzdG9ncmFtYCBhbmQgYGdlb21fZG90cGxvdGAgYXJlIGdvb2QgY2hvaWNlcy4KLSBGb2N1cyBhdHRlbnRpb24gb24gdGhlIG92ZXJhbGwgdHJlbmQgaW4gYSBsYXJnZSBkYXRhc2V0OiBgZ2VvbV9zbW9vdGhgLgotIERyYXcgYSBtYXA6IGBnZW9tX21hcGAgb3IgaXRzIHN1Y2Nlc3NvciwgYGdlb21fc2ZgLgotIExhYmVsIG91dGx5aW5nIHBvaW50czogYGdlb21fdGV4dGAgb3IgYGdlb21fbGFiZWxgLgoKLS0tCgojIyAxNC42LjIgRXhlcmNpc2VzCgoxLiAgVGhlIGNvZGUgYmVsb3cgY3JlYXRlcyBhIHNpbWlsYXIgZGF0YXNldCB0byBgc3RhdF9zbW9vdGgoKWAuIFVzZSAKICAgIHRoZSBhcHByb3ByaWF0ZSBnZW9tcyB0byBtaW1pYyB0aGUgZGVmYXVsdCBgZ2VvbV9zbW9vdGgoKWAgZGlzcGxheS4KCmBgYHtyfQptb2QgPC0gbG9lc3MoaHd5IH4gZGlzcGwsIGRhdGEgPSBnZ3Bsb3QyOjptcGcpCnNtb290aGVkIDwtIGRhdGEuZnJhbWUoZGlzcGwgPSBzZXEoMS42LCA3LCBsZW5ndGgub3V0ID0gNTApKQpwcmVkIDwtIHByZWRpY3QobW9kLCBuZXdkYXRhID0gc21vb3RoZWQsIHNlID0gVFJVRSkKc21vb3RoZWQkaHd5IDwtIHByZWQkZml0CnNtb290aGVkJGh3eV9sd3IgPC0gcHJlZCRmaXQgLSAxLjk2ICogcHJlZCRzZS5maXQKc21vb3RoZWQkaHd5X3VwciA8LSBwcmVkJGZpdCArIDEuOTYgKiBwcmVkJHNlLmZpdApgYGAKCkFuc3dlcjogdGhlIGV4ZXJjaXNlIGlzIHRvIHJlcGxpY2F0ZSBgZ2VvbV9zbW9vdGhgIHVzaW5nIHRoZSBgc21vb3RoZWRgIGRhdGEgZnJhbWUsIHdoaWNoIGluY2x1ZGVzIGEgbGluZSBhbmQgYSByaWJib246CgpgYGB7cn0KZ2dwbG90KGdncGxvdDI6Om1wZywgYWVzKGRpc3BsLCBod3kpKSArCiAgZ2VvbV9wb2ludCgpICsKICBnZW9tX3Ntb290aChtZXRob2QgPSAibG9lc3MiLCBmb3JtdWxhID0geSB+IHgpCgpnZ3Bsb3QoZ2dwbG90Mjo6bXBnLCBhZXMoZGlzcGwsIGh3eSkpICsKICBnZW9tX3BvaW50KCkgKwogIGdlb21fbGluZShkYXRhID0gc21vb3RoZWQsIGNvbG9yID0gImJsdWUiLCBsaW5ld2lkdGggPSAxKSArCiAgZ2VvbV9yaWJib24obWFwcGluZyA9IGFlcyh5bWluID0gaHd5X2x3ciwgeW1heCA9IGh3eV91cHIpLCBkYXRhID0gc21vb3RoZWQsIGFscGhhID0gMC4yKQpgYGAKCkEgcGVyZmVjdCBtYXRjaCEKCkdHIFNvbHV0aW9uczoKCmBgYHtyfQpzbW9vdGhlZCAlPiUKICBnZ3Bsb3QoYWVzKGRpc3BsLCBod3kpKSArCiAgZ2VvbV9saW5lKGNvbG9yID0gImRvZGdlcmJsdWUxIikgKwogIGdlb21fcmliYm9uKGFlcyh5bWluID0gaHd5X2x3ciwgeW1heCA9IGh3eV91cHIpLCBhbHBoYSA9IDAuNCkKYGBgCgotLS0KCjIuICBXaGF0IHN0YXRzIHdlcmUgdXNlZCB0byBjcmVhdGUgdGhlIGZvbGxvd2luZyBwbG90cz8KCkFuc3dlcjogaW4gdGhlIG9yZGVyIHRoZXkgYXBwZWFyIGluIHRoZSBbRXhlcmNpc2VzXShodHRwczovL2dncGxvdDItYm9vay5vcmcvbGF5ZXJzLmh0bWwjZXhlcmNpc2VzLTEyKToKCjEuIGBzdGF0X2VjZGZgCjEuIGBzdGF0X3FxYAoxLiBgc3RhdF9kZW5zaXR5YAoKQ29uZmlybWVkIGNvcnJlY3QgYnkgcmV2aWV3aW5nIHRoZSBbc291cmNlIGNvZGVdKGh0dHBzOi8vZ2l0aHViLmNvbS9oYWRsZXkvZ2dwbG90Mi1ib29rL2Jsb2IvbWFzdGVyL2xheWVycy5SbWQpLgoKR0cgU29sdXRpb25zOiBGcm9tIGxlZnQgdG8gcmlnaHQsCgpgc3RhdF9lY2RmKClgLCBgc3RhdF9xcSgpYCwgYHN0YXRfZnVuY3Rpb24oKWAKCi0tLQoKMy4gIFJlYWQgdGhlIGhlbHAgZm9yIGBzdGF0X3N1bSgpYCB0aGVuIHVzZSBgZ2VvbV9jb3VudCgpYCB0byBjcmVhdGUgYSBwbG90CiAgICB0aGF0IHNob3dzIHRoZSBwcm9wb3J0aW9uIG9mIGNhcnMgdGhhdCBoYXZlIGVhY2ggY29tYmluYXRpb24gb2YgYGRydmAgYW5kIAogICAgYHRyYW5zYC4KCkFuc3dlcjogaW4gYWRkaXRpb24sIGZhY2V0IGJ5IHllYXIuCgpgYGB7cn0KZ2dwbG90KGdncGxvdDI6Om1wZywgYWVzKGRydiwgdHJhbnMpKSArCiAgZ2VvbV9jb3VudChhZXMoc2l6ZSA9IGFmdGVyX3N0YXQocHJvcCksIGdyb3VwID0gMSkpICsKICBzY2FsZV9zaXplKGxhYmVscyA9IHNjYWxlczo6bGFiZWxfcGVyY2VudCgpKSArCiAgZmFjZXRfd3JhcCh2YXJzKHllYXIpKSArCiAgbGFicyh0aXRsZSA9ICJDb21iaW5hdGlvbnMgb2YgZHJpdmUgdHJhaW4gYW5kIHRyYW5zbWlzc2lvbnMiLCB4ID0gTlVMTCwgeSA9IE5VTEwpICsKICBsYWJzKHNpemUgPSAiJSBvZiBjYXJzIikgKwogIHRoZW1lX3F1bygpCmBgYAoKR0cgU29sdXRpb25zOgoKYGBge3J9CmdncGxvdDI6Om1wZyAlPiUKICBnZ3Bsb3QoYWVzKGRydiwgdHJhbnMpKSArCiAgZ2VvbV9jb3VudChhZXMoc2l6ZSA9IGFmdGVyX3N0YXQocHJvcCksIGdyb3VwID0gMSkpCmBgYAoKLS0tCgojIyAxNC43LjEgRXhlcmNpc2VzCgoxLiAgV2hlbiBtaWdodCB5b3UgdXNlIGBwb3NpdGlvbl9udWRnZSgpYD8gUmVhZCB0aGUgZG9jdW1lbnRhdGlvbi4KCkFuc3dlcjogYXMgdGhlIGRvY3VtZW50YXRpb24gc3RhdGVzLCAiTnVkZ2luZyBpcyBidWlsdCBpbiB0byBgZ2VvbV90ZXh0KClgIGJlY2F1c2UgaXQncyBzbyB1c2VmdWwgZm9yIG1vdmluZyBsYWJlbHMgYSBzbWFsbCBkaXN0YW5jZSBmcm9tIHdoYXQgdGhleSdyZSBsYWJlbGxpbmcuIgoKR0cgU29sdXRpb25zOiBBY2NvcmRpbmcgdG8gdGhlIGhlbHAgcGFnZSwgYHBvc2l0aW9uX251ZGdlKClgIGlzIGdlbmVyYWxseSB1c2VmdWwgZm9yIGFkanVzdGluZyB0aGUgcG9zaXRpb24gb2YgaXRlbXMgb24gZGlzY3JldGUgc2NhbGVzIGJ5IGEgc21hbGwgYW1vdW50LiBOdWRnaW5nIGlzIGJ1aWx0IGluIHRvIGdlb21fdGV4dCgpIGJlY2F1c2UgaXQncyBzbyB1c2VmdWwgZm9yIG1vdmluZyBsYWJlbHMgYSBzbWFsbCBkaXN0YW5jZSBmcm9tIHdoYXQgdGhleSdyZSBsYWJlbGxpbmcuCgotLS0KCjIuICBNYW55IHBvc2l0aW9uIGFkanVzdG1lbnRzIGNhbiBvbmx5IGJlIHVzZWQgd2l0aCBhIGZldyBnZW9tcy4gRm9yIGV4YW1wbGUsCiAgICB5b3UgY2FuJ3Qgc3RhY2sgYm94cGxvdHMgb3IgZXJyb3JzIGJhcnMuIFdoeSBub3Q/IFdoYXQgcHJvcGVydGllcyBtdXN0IGEgCiAgICBnZW9tIHBvc3Nlc3MgaW4gb3JkZXIgdG8gYmUgc3RhY2thYmxlPyBXaGF0IHByb3BlcnRpZXMgbXVzdCBpdCBwb3NzZXNzCiAgICB0byBiZSBkb2RnZWFibGU/CgpBbnN3ZXI6IHJlYWRpbmcgdGhlIGRvY3MsIGBwb3NpdGlvbl9zdGFjaygpYCByZXF1aXJlcyB0aGF0IGdlb21zIGhhdmUgYSBwb3NpdGlvbiAocG9pbnRzLCBsaW5lcywgdGV4dCkgb3IgYSBkaW1lbnNpb24gKGJhciwgYXJlYSkuIEJveHBsb3RzIGFuZCBlcnJvciBiYXJzIGNhbid0IGJlIHN0YWNrZWQgc2luY2UgdGhleSBkb24ndCBoYXZlIGEgcG9zaXRpb24gb3IgYXJlYS4gQSBnZW9tIG11c3QgaGF2ZSBhIHdpZHRoIGluIG9yZGVyIHRvIGJlIGRvZGdlYWJsZSwgd2hpY2ggY2FuIGJlIHNldCB3aXRoIGBwb3NpdGlvbl9kb2RnZSh3aWR0aCA9IC4uLilgLgoKR0cgU29sdXRpb25zOiBOb3Qgc3VyZQoKLS0tCgozLiAgV2h5IG1pZ2h0IHlvdSB1c2UgYGdlb21faml0dGVyKClgIGluc3RlYWQgb2YgYGdlb21fY291bnQoKWA/IFdoYXQgYXJlCiAgICB0aGUgYWR2YW50YWdlcyBhbmQgZGlzYWR2YW50YWdlcyBvZiBlYWNoIHRlY2huaXF1ZT8KCkFuc3dlcjogYGdlb21faml0dGVyKClgIHByZXNlcnZlcyB0aGUgc2l6ZSBhbmQgbnVtYmVyIG9mIHBvaW50cyBidXQgbm90IHBvc2l0aW9uLCBhbmQgYGdlb21fY291bnQoKWAgcHJlc2VydmVzIHRoZSBwb3NpdGlvbiBidXQgbm90IG51bWJlciBvciBzaXplLiBgZ2VvbV9qaXR0ZXIoKWAgY2FuIGJlIGEgYmV0dGVyIGNob2ljZSB3aGVuIHRoZXJlIGFyZSBmZXcgb3ZlcmxhcHBpbmcgcG9pbnRzLiAKCkdHIFNvbHV0aW9uczogYGdlb21faml0dGVyKClgIGFkZHMgYSBzbWFsbCBhbW91bnQgb2YgcmFuZG9tIHZhcmlhdGlvbiB0byB0aGUgbG9jYXRpb24gb2YgZWFjaCBwb2ludC4gSXQgaXMgdXNlZnVsIGZvciBsb29raW5nIGF0IGFsbCB0aGUgb3ZlcnBsb3R0ZWQgIHBvaW50cy4gT24gdGhlIG90aGVyIGhhbmQsIGBnZW9tX2NvdW50KClgIGNvdW50cyB0aGUgbnVtYmVyIG9mIG92ZXJsYXBwaW5nIG9ic2VydmF0aW9ucyBhdCBlYWNoIGxvY2F0aW9uLiBJdCBpcyB1c2VmdWwgZm9yIHVuZGVyc3RhbmRpbmcgdGhlIG51bWJlciBvZiBwb2ludHMgaW4gYSBsb2NhdGlvbi4KCi0tLQoKNC4gIFdoZW4gbWlnaHQgeW91IHVzZSBhIHN0YWNrZWQgYXJlYSBwbG90PyBXaGF0IGFyZSB0aGUgYWR2YW50YWdlcyBhbmQKICAgIGRpc2FkdmFudGFnZXMgY29tcGFyZWQgdG8gYSBsaW5lIHBsb3Q/CgpBbnN3ZXI6IGEgc3RhY2tlZCBhcmVhIHBsb3QgaXMgYSBnb29kIHdheSB0byBzaG93IHRoZSByZWxhdGlvbnNoaXAgb2YgcmVsYXRlZCB2YXJpYWJsZXMsIHNob3dpbmcgaG93IHBhcnRzIG9mIGEgd2hvbGUgY2hhbmdlIG92ZXIgdGltZSwgZm9yIGV4YW1wbGUsIHBsb3R0aW5nIHRoZSBwaGFzZXMgb2YgaW5jaWRlbnQgcmVzcG9uc2UgKG1lYW4gdGltZSB0byBkZXRlY3QsIG1lYW4gdGltZSB0byByZXNvbHZlKS4gSXQgaXMgdmVyeSBzaW1pbGFyIHRvIGEgbGluZSBwbG90LCBhbmQgbWFrZXMgcmVsYXRpdmUgdmFsdWVzIChwcm9wb3J0aW9ucykgZWFzaWVyIHRvIGNvbXBhcmUgYW5kIGFic29sdXRlIHZhbHVlcyBoYXJkZXIgdG8gY29tcGFyZS4KCkdHIFNvbHV0aW9uczogU3RhY2tlZCBhcmVhIHBsb3Qgc2VlbXMgdXNlZnVsIHdoZW4geW91IHdhbnQgdG8gcG9ydHJheSBhbiBhcmVhIHdoZXJlYXMgYSBsaW5lIHBsb3Qgc2VlbXMgdXNlZnVsIHdoZW4geW91IGp1c3QgbmVlZCBhIGxpbmUuCgotLS0KCiMgMTUgU2NhbGVzIGFuZCBndWlkZXMKClRoZSBzY2FsZXMgdG9vbGJveCBpbiBDaGFwdGVycyAxMCB0byAxMiBwcm92aWRlcyBleHRlbnNpdmUgZ3VpZGFuY2UgZm9yIGhvdyB0byB3b3JrIHdpdGggc2NhbGVzLCBmb2N1c2luZyBvbiBzb2x2aW5nIGNvbW1vbiBkYXRhIHZpc3VhbGlzYXRpb24gcHJvYmxlbXMuIFRoZSBwcmFjdGljYWwgZ29hbHMgb2YgdGhlIHRvb2xib3ggbWVhbiB0aGF0IHRvcGljcyBhcmUgaW50cm9kdWNlZCB3aGVuIHRoZXkgYXJlIG1vc3QgcmVsZXZhbnQ6IGZvciBleGFtcGxlLCBzY2FsZSB0cmFuc2Zvcm1hdGlvbnMgYXJlIGRpc2N1c3NlZCBpbiByZWxhdGlvbiB0byBjb250aW51b3VzIHBvc2l0aW9uIHNjYWxlcyAoU2VjdGlvbiAxMC4xLjcpIGJlY2F1c2UgdGhhdCBpcyB0aGUgbW9zdCBjb21tb24gc2l0dWF0aW9uIGluIHdoaWNoIHlvdSBtaWdodCB3YW50IHRvIHRyYW5zZm9ybSBhIHNjYWxlLiBIb3dldmVyLCBiZWNhdXNlIGdncGxvdDIgYWltcyB0byBwcm92aWRlIGEgZ3JhbW1hciBvZiBncmFwaGljcywgdGhlcmUgaXMgbm90aGluZyBwcmV2ZW50aW5nIHlvdSBmcm9tIHRyYW5zZm9ybWluZyBvdGhlciBraW5kcyBvZiBzY2FsZXMgKHNlZSBTZWN0aW9uIDE1LjYpLiBUaGlzIGNoYXB0ZXIgYWltcyB0byBpbGx1c3RyYXRlIHRoZXNlIGNvbmNlcHRzOiBJJ2xsIGRpc2N1c3MgdGhlIHRoZW9yeSB1bmRlcnBpbm5pbmcgc2NhbGVzIGFuZCBndWlkZXMsIGFuZCBnaXZlIGV4YW1wbGVzIHNob3dpbmcgaG93IGNvbmNlcHRzIHRoYXQgSSd2ZSBkaXNjdXNzZWQgc3BlY2lmaWNhbGx5IGZvciBwb3NpdGlvbiBvciBjb2xvdXIgc2NhbGVzIGFsc28gYXBwbHkgZWxzZXdoZXJlLgoKIyMgU2V0dGluZyBjb2xvciB3aXRoIGxpbWl0cwoKTGV0J3MgY3JlYXRlIGEgcGFpciBvZiBwbG90cyBjb250cm9sbGluZyBjb2xvciB3aXRoIGxpbWl0cyAoZnJvbSAxMS4zLjUpISBGaXJzdCwgd2UnbGwganVzdCBwbG90IGJvdGggaW5kZXBlbmRlbnRseToKCmBgYHtyfQpnZ185OSA8LSBnZ3Bsb3QyOjptcGcgfD4KICBmaWx0ZXIoeWVhciA9PSAxOTk5KSB8PgogIGdncGxvdChhZXMoZGlzcGwsIGh3eSwgY29sb3IgPSBmbCkpICsKICBnZW9tX3BvaW50KCkKCmdnXzA4IDwtIGdncGxvdDI6Om1wZyB8PgogIGZpbHRlcih5ZWFyID09IDIwMDgpIHw+CiAgZ2dwbG90KGFlcyhkaXNwbCwgaHd5LCBjb2xvciA9IGZsKSkgKwogIGdlb21fcG9pbnQoKQoKZ2dfOTkKZ2dfMDgKYGBgCgpOb3csIGxldCdzIHJlcGxvdCB1c2luZyBsaW1pdHM6CgpgYGB7cn0KZ2dfOTkgKwogIGxpbXMoeCA9IGMoMSwgNyksIHkgPSBjKDEwLCA0NSkpICsKICBzY2FsZV9jb2xvcl9kaXNjcmV0ZSgKICAgIGxpbWl0cyA9IGMoImMiLCAiZCIsICJlIiwgInAiLCAiciIpLAogICAgYnJlYWtzID0gYygiZCIsICJwIiwgInIiKSwKICAgIGxhYmVscyA9IGMoImRpZXNlbCIsICJwcmVtaXVtIiwgInJlZ3VsYXIiKQogICkKCmdnXzA4ICsKICBsaW1zKHggPSBjKDEsIDcpLCB5ID0gYygxMCwgNDUpKSArCiAgc2NhbGVfY29sb3JfZGlzY3JldGUoCiAgICBsaW1pdHMgPSBjKCJjIiwgImQiLCAiZSIsICJwIiwgInIiKSwKICAgIGxhYmVscyA9IGMoImNvbXByZXNzZWQiLCAiZGllc2VsIiwgImV0aGFub2wiLCAicHJlbWl1bSIsICJyZWd1bGFyIikKICApCmBgYAojIyBLZXkgZ2x5cGhzCgpMZXQncyB1c2UgYSBrZXkgZ2x5cGghIChgZHJhd19rZXlfdGltZXNlcmllcygpYCkKCmBgYHtyfQpnZ3Bsb3QoZWNvbm9taWNzLCBhZXMoZGF0ZSwgcHNhdmVydCwgY29sb3IgPSAiUGVyc29uYWxcblNhdmluZ3NcblJhdGUiKSkgKwogIGdlb21fbGluZShrZXlfZ2x5cGggPSAidGltZXNlcmllcyIpICsKICBsYWJzKHggPSBOVUxMLCB5ID0gTlVMTCwgY29sb3IgPSBOVUxMKSArCiAgdGhlbWVfcXVvKCkKYGBgCgojIDE2IENvb3JkaW5hdGUgc3lzdGVtcwoKQ29vcmRpbmF0ZSBzeXN0ZW1zIGhhdmUgdHdvIG1haW4gam9iczoKCiogQ29tYmluZSB0aGUgdHdvIHBvc2l0aW9uIGFlc3RoZXRpY3MgdG8gcHJvZHVjZSBhIDJkIHBvc2l0aW9uIG9uIHRoZSBwbG90LgogIFRoZSBwb3NpdGlvbiBhZXN0aGV0aWNzIGFyZSBjYWxsZWQgYHhgIGFuZCBgeWAsIGJ1dCB0aGV5IG1pZ2h0IGJlIGJldHRlciAKICBjYWxsZWQgcG9zaXRpb24gMSBhbmQgMiBiZWNhdXNlIHRoZWlyIG1lYW5pbmcgZGVwZW5kcyBvbiB0aGUgY29vcmRpbmF0ZSAKICBzeXN0ZW0gdXNlZC4gRm9yIGV4YW1wbGUsIHdpdGggdGhlIHBvbGFyIGNvb3JkaW5hdGUgc3lzdGVtIHRoZXkgYmVjb21lIGFuZ2xlIAogIGFuZCByYWRpdXMgKG9yIHJhZGl1cyBhbmQgYW5nbGUpLCBhbmQgd2l0aCBtYXBzIHRoZXkgYmVjb21lIGxhdGl0dWRlIGFuZCAKICBsb25naXR1ZGUuCgoqIEluIGNvb3JkaW5hdGlvbiB3aXRoIHRoZSBmYWNldGVyLCBjb29yZGluYXRlIHN5c3RlbXMgZHJhdyBheGVzIGFuZCBwYW5lbAogIGJhY2tncm91bmRzLiBXaGlsZSB0aGUgc2NhbGVzIGNvbnRyb2wgdGhlIHZhbHVlcyB0aGF0IGFwcGVhciBvbiB0aGUgYXhlcywgYW5kCiAgaG93IHRoZXkgbWFwIGZyb20gZGF0YSB0byBwb3NpdGlvbiwgaXQgaXMgdGhlIGNvb3JkaW5hdGUgc3lzdGVtIHdoaWNoIAogIGFjdHVhbGx5IGRyYXdzIHRoZW0uIFRoaXMgaXMgYmVjYXVzZSB0aGVpciBhcHBlYXJhbmNlIGRlcGVuZHMgb24gdGhlIAogIGNvb3JkaW5hdGUgc3lzdGVtOiBhbiBhbmdsZSBheGlzIGxvb2tzIHF1aXRlIGRpZmZlcmVudCB0aGFuIGFuIHggYXhpcy4gCgojIyBQb2xhciBjb29yZGluYXRlcwoKTGV0J3MgZHJhdyBhIHNwaXJhbCB3aXRoIHBvbGFyIGNvb3JkaW5hdGVzIQoKYGBge3J9CmRhdGEuZnJhbWUoeCA9IGMoMSwgMjAwKSwgeSA9IGMoMjAwLCAxKSkgfD4KICBnZ3Bsb3QoYWVzKHgsIHkpKSArCiAgZ2VvbV9saW5lKCkgKwogIGNvb3JkX3BvbGFyKCkKYGBgCgpXZSBjYW4gdXNlIHBvbGFyIGNvb3JkaW5hdGVzIHRvIGRyYXcgYSBwaWUgY2hhcnQ6CgpgYGB7cn0KZ2dwbG90KG10Y2FycywgYWVzKGZhY3RvcigxKSwgZmlsbCA9IGZhY3RvcihjeWwpKSkgKwogIGdlb21fYmFyKHdpZHRoID0gMSkgKwogIHNjYWxlX3hfZGlzY3JldGUoTlVMTCwgZXhwYW5kID0gYygwLCAwKSkgKwogIHNjYWxlX3lfY29udGludW91cyhOVUxMLCBleHBhbmQgPSBjKDAsIDApKSArCiAgY29vcmRfcG9sYXIodGhldGEgPSAieSIpICsKICBsYWJzKHRpdGxlID0gIk51bWJlciBvZiBjeWxpbmRlcnMiLCBmaWxsID0gTlVMTCkgKwogIHRoZW1lX3ZvaWQoKQpgYGAKCiMgMTcgRmFjZXRpbmcKCllvdSBmaXJzdCBlbmNvdW50ZXJlZCBmYWNldGluZyBpbiBTZWN0aW9uIDIuNS4gRmFjZXRpbmcgZ2VuZXJhdGVzIHNtYWxsIG11bHRpcGxlcyBlYWNoIHNob3dpbmcgYSBkaWZmZXJlbnQgc3Vic2V0IG9mIHRoZSBkYXRhLiBTbWFsbCBtdWx0aXBsZXMgYXJlIGEgcG93ZXJmdWwgdG9vbCBmb3IgZXhwbG9yYXRvcnkgZGF0YSBhbmFseXNpczogeW91IGNhbiByYXBpZGx5IGNvbXBhcmUgcGF0dGVybnMgaW4gZGlmZmVyZW50IHBhcnRzIG9mIHRoZSBkYXRhIGFuZCBzZWUgd2hldGhlciB0aGV5IGFyZSB0aGUgc2FtZSBvciBkaWZmZXJlbnQuIFRoaXMgc2VjdGlvbiB3aWxsIGRpc2N1c3MgaG93IHlvdSBjYW4gZmluZS10dW5lIGZhY2V0cywgcGFydGljdWxhcmx5IHRoZSB3YXkgaW4gd2hpY2ggdGhleSBpbnRlcmFjdCB3aXRoIHBvc2l0aW9uIHNjYWxlcy4KCiMjIEZhY2V0IGdyaWQKCkxldCdzIGRyYXcgYSBmYWNldCBncmlkIQoKYGBge3J9CmdncGxvdDI6Om1wZyB8PgogIGZpbHRlcihjeWwgIT0gNSkgfD4KICBnZ3Bsb3QoYWVzKGRpc3BsLCBod3kpKSArCiAgZ2VvbV9wb2ludCgpICsKICBnZW9tX3Ntb290aChtZXRob2QgPSAicmxtIiwgZm9ybXVsYSA9IHkgfiB4KSArCiAgZmFjZXRfZ3JpZChkcnYgfiBjeWwpICsKICBsYWJzKHggPSBOVUxMLCB5ID0gTlVMTCkKYGBgCgojIyBGcmVlIHNjYWxlcwoKRnJlZSBzY2FsZXMgYXJlIHVzZWZ1bCB3aGVuIGZhY2V0aW5nIGFjcm9zcyBkaWZmZXJlbnQgdmFyaWFibGVzIG92ZXIgdGhlIHNhbWUgdGltZSBwZXJpb2Q6CgpgYGB7cn0KZ2dwbG90KGVjb25vbWljc19sb25nLCBhZXMoZGF0ZSwgdmFsdWUpKSArCiAgZ2VvbV9saW5lKCkgKwogIGZhY2V0X3dyYXAofnZhcmlhYmxlLCBzY2FsZXMgPSAiZnJlZV95IiwgbmNvbCA9IDEpCmBgYAoKIyMgRmFjZXQgc3BhY2UKCmBmYWNldF9ncmlkKClgIGhhcyBhbiBhZGRpdGlvbmFsIHBhcmFtZXRlciBjYWxsZWQgYHNwYWNlYCwgd2hpY2ggdGFrZXMgdGhlIHNhbWUgdmFsdWVzIGFzIGBzY2FsZXNgLiAgV2hlbiBzcGFjZSBpcyAiZnJlZSIsIGVhY2ggY29sdW1uIChvciByb3cpIHdpbGwgaGF2ZSB3aWR0aCAob3IgaGVpZ2h0KSBwcm9wb3J0aW9uYWwgdG8gdGhlIHJhbmdlIG9mIHRoZSBzY2FsZSBmb3IgdGhhdCBjb2x1bW4gKG9yIHJvdykuICBUaGlzIG1ha2VzIHRoZSBzY2FsaW5nIGVxdWFsIGFjcm9zcyB0aGUgd2hvbGUgcGxvdDogMSBjbSBvbiBlYWNoIHBhbmVsIG1hcHMgdG8gdGhlIHNhbWUgcmFuZ2Ugb2YgZGF0YS4gKFRoaXMgaXMgc29tZXdoYXQgYW5hbG9nb3VzIHRvIHRoZSAnc2xpY2VkJyBheGlzIGxpbWl0cyBvZiBsYXR0aWNlLikgRm9yIGV4YW1wbGUsIGlmIHBhbmVsIGEgaGFkIHJhbmdlIDIgYW5kIHBhbmVsIGIgaGFkIHJhbmdlIDQsIG9uZS10aGlyZCBvZiB0aGUgc3BhY2Ugd291bGQgYmUgZ2l2ZW4gdG8gYSwgYW5kIHR3by10aGlyZHMgdG8gYi4gVGhpcyBpcyBtb3N0IHVzZWZ1bCBmb3IgY2F0ZWdvcmljYWwgc2NhbGVzLCB3aGVyZSB3ZSBjYW4gYXNzaWduIHNwYWNlIHByb3BvcnRpb25hbGx5IGJhc2VkIG9uIHRoZSBudW1iZXIgb2YgbGV2ZWxzIGluIGVhY2ggZmFjZXQsIGFzIGlsbHVzdHJhdGVkIGJlbG93LgoKYGBge3J9Cm1wZzIgPC0gc3Vic2V0KGdncGxvdDI6Om1wZywgY3lsICE9IDUgJiBkcnYgJWluJSBjKCI0IiwgImYiKSAmIGNsYXNzICE9ICIyc2VhdGVyIikKbXBnMiRtb2RlbCA8LSByZW9yZGVyKG1wZzIkbW9kZWwsIG1wZzIkY3R5KQptcGcyJG1hbnVmYWN0dXJlciA8LSByZW9yZGVyKG1wZzIkbWFudWZhY3R1cmVyLCAtbXBnMiRjdHkpCgpnZ3Bsb3QobXBnMiwgYWVzKGN0eSwgbW9kZWwpKSArCiAgZ2VvbV9wb2ludCgpICsKICBmYWNldF9ncmlkKG1hbnVmYWN0dXJlciB+IC4sIHNjYWxlcyA9ICJmcmVlIiwgc3BhY2UgPSAiZnJlZSIpICsKICBsYWJzKHggPSBOVUxMLCB5ID0gTlVMTCkgKwogIHRoZW1lKHN0cmlwLnRleHQueSA9IGVsZW1lbnRfdGV4dChhbmdsZSA9IDApKQpgYGAKCiMjIEdyb3VwaW5nIGFuZCBmYWNldGluZwoKTGV0J3MgY29tYmluZSBncm91cGluZyBhbmQgZmFjZXRpbmchCgpgYGB7cn0KIyBOZWVkIHRvIHVzZSBkcGx5cjo6c2VsZWN0IGZvciBkaXNhbWJpZ3VhdGlvbiBmb3IgYnVpbGRfYW5hbHlzaXNfc2l0ZSgpCmdncGxvdChnZ3Bsb3QyOjptcGcsIGFlcyhkaXNwbCwgaHd5KSkgKwogIGdlb21fcG9pbnQoZGF0YSA9IGRwbHlyOjpzZWxlY3QoZ2dwbG90Mjo6bXBnLCAtZHJ2KSwgY29sb3IgPSAiZ3JleTc1IikgKwogIGdlb21fcG9pbnQoYWVzKGNvbG9yID0gZHJ2KSkgKwogIGZhY2V0X3dyYXAofmRydikKYGBgCgojIyAxNy43IEV4ZXJjaXNlcwoKMS4gIERpYW1vbmRzOiBkaXNwbGF5IHRoZSBkaXN0cmlidXRpb24gb2YgcHJpY2UgY29uZGl0aW9uYWwKICAgIG9uIGN1dCBhbmQgY2FyYXQuIFRyeSBmYWNldGluZyBieSBjdXQgYW5kIGdyb3VwaW5nIGJ5IGNhcmF0LiBUcnkKICAgIGZhY2V0aW5nIGJ5IGNhcmF0IGFuZCBncm91cGluZyBieSBjdXQuIFdoaWNoIGRvIHlvdSBwcmVmZXI/CgpBbnN3ZXI6IGZhY2V0aW5nIGJ5IGNhcmV0IHJlcXVpcmVzIGRpc2NyZXRpemluZywgaGVyZSB3ZSB1c2UgYGN1dF9udW1iZXIoKWA6CgpgYGB7cn0KZ2dwbG90KGRpYW1vbmRzLCBhZXMocHJpY2UsIGdyb3VwID0gY2FyYXQsIGNvbG9yID0gY2FyYXQpKSArCiAgZ2VvbV9oaXN0b2dyYW0oYmlucyA9IDEwMCkgKwogIHNjYWxlX2NvbG9yX3ZpcmlkaXNfYygpICsKICBmYWNldF93cmFwKH5jdXQpCgpkaWFtb25kcyB8PgogIG11dGF0ZShjYXJhdF9uID0gY3V0X251bWJlcihjYXJhdCwgNikpIHw+CiAgZ2dwbG90KGFlcyhwcmljZSwgZ3JvdXAgPSBjdXQsIGZpbGwgPSBjdXQpKSArCiAgZ2VvbV9oaXN0b2dyYW0oYmlucyA9IDEwMCkgKwogIHNjYWxlX2NvbG9yX3ZpcmlkaXNfZCgpICsKICBmYWNldF93cmFwKH5jYXJhdF9uKQpgYGAKCkZhY2V0aW5nIGJ5IGN1dCBzZWVtcyBwcmVmZXJhYmxlLCBzaW5jZSBpdCBwcm92aWRlcyBhbiBpbnNpZ2h0IG5vdCBwcm92aWRlZCBieSBmYWNldGluZyBieSBjYXJhdDogdGhlcmUgYXJlIG1vcmUgbGFyZ2UgY2FyYXQgZGlhbW9uZHMgd2l0aCBhIEZhaXIgY3V0LgoKR0cgU29sdXRpb25zOiB0YWtlcyBhIGRpZmZlcmVudCBhcHByb2FjaCwgYW5kIGNvbmNsdWRlczogIkl0IG1ha2VzIG1vcmUgc2Vuc2UgdG8gZmFjZXQgYnkgY3V0IGJlY2F1c2UgaXRzIGEgZGlzY3JldGUgdmFyaWFibGUuIEZhY2V0aW5nIGJ5IGNhcmF0LCBhIGNvbnRpbnVvdXMgdmFyaWFibGUsIG1ha2VzIHRvbyBtYW55IGZhY2V0cyBhbmQgcmVuZGVycyB0aGUgcGxvdCB1bnJlYWRhYmxlISIKCi0tLQoKMi4gIERpYW1vbmRzOiBjb21wYXJlIHRoZSByZWxhdGlvbnNoaXAgYmV0d2VlbiBwcmljZSBhbmQgY2FyYXQgZm9yCiAgICBlYWNoIGNvbG91ci4gV2hhdCBtYWtlcyBpdCBoYXJkIHRvIGNvbXBhcmUgdGhlIGdyb3Vwcz8gSXMgZ3JvdXBpbmcgYmV0dGVyIAogICAgb3IgZmFjZXRpbmc/IElmIHlvdSB1c2UgZmFjZXRpbmcsIHdoYXQgYW5ub3RhdGlvbiBtaWdodCB5b3UgYWRkIHRvIAogICAgbWFrZSBpdCBlYXNpZXIgdG8gc2VlIHRoZSBkaWZmZXJlbmNlcyBiZXR3ZWVuIHBhbmVscz8KCkFuc3dlcjogY29tcGFyaW5nIGlzIGhhcmQgYmVjYXVzZSBvZiBvdmVybGFwIGJldHdlZW4gZ3JvdXBzIGFuZCBvdmVycGxvdHRpbmcuIE92ZXJhbGwsIGdyb3VwaW5nIHNlZW1zIGVhc2llciB0byByZWFkIHRoYW4gZmFjZXRpbmcuIEFkZGluZyBhIHJlZmVyZW5jZSBsaW5lIChpbiB0aGlzIGNhc2UsIGEgcm9idXN0IGxpbmVhciByZWdyZXNzaW9uKSBtYWtlcyBpdCBlYXNpZXIgdG8gc2VlIGRpZmZlcmVuY2VzIGFjcm9zcyBmYWNldGluZyBwYW5lbHMuCgpgYGB7cn0KZ2dwbG90KGRpYW1vbmRzLCBhZXMoY2FyYXQsIHByaWNlKSkgKwogIGdlb21fcG9pbnQoYWVzKGNvbG9yID0gY29sb3IpKSArCiAgZ2VvbV9zbW9vdGgobWV0aG9kID0gInJsbSIsIGZvcm11bGEgPSB5IH4geCwgc2UgPSBGQUxTRSkgKwogIGNvb3JkX2NhcnRlc2lhbih5bGltID0gYygwLCBtYXgoZGlhbW9uZHMkcHJpY2UpKSkKCmdncGxvdChkaWFtb25kcywgYWVzKGNhcmF0LCBwcmljZSkpICsKICBnZW9tX3BvaW50KGFlcyhjb2xvciA9IGNvbG9yKSkgKwogIGdlb21fc21vb3RoKGRhdGEgPSBkcGx5cjo6c2VsZWN0KGRpYW1vbmRzLCAtY29sb3IpLCBtZXRob2QgPSAicmxtIiwgZm9ybXVsYSA9IHkgfiB4LCBzZSA9IEZBTFNFKSArCiAgY29vcmRfY2FydGVzaWFuKHlsaW0gPSBjKDAsIG1heChkaWFtb25kcyRwcmljZSkpKSArCiAgZmFjZXRfd3JhcCh+Y29sb3IpCmBgYAoKR0cgU29sdXRpb25zOgoKYGBge3J9CmRpYW1vbmRzICU+JQogIGdncGxvdChhZXMoY2FyYXQsIHByaWNlKSkgKwogIGdlb21fcG9pbnQoYWVzKGNvbG9yID0gY29sb3IpKQoKZGlhbW9uZHMgJT4lCiAgZ2dwbG90KGFlcyhjYXJhdCwgcHJpY2UpKSArCiAgZ2VvbV9wb2ludChhZXMoY29sb3IgPSBjb2xvcikpICsKICBmYWNldF93cmFwKH5jb2xvcikKYGBgCgotIEkgdGhpbmsgaXRzIGJldHRlciB0byB1c2UgZ3JvdXBpbmcgdG8gY29tcGFyZSB0aGUgZGlmZmVyZW50IGNvbG9ycy4gVGhlIHBhbmVscyBhbGwgaGF2ZSB0aGUgc2FtZSBzaGFwZSwgc28gaXQncyBoYXJkIHRvIGNvbXBhcmUgdGhlIGdyb3VwcyBhY3Jvc3MgZmFjZXRzLiBJZiBJIHVzZSBmYWNldGluZywgSSdkIGFkZCB0aGF0IHRoZSBwbG90IGlzIGZhY2V0dGVkIGJ5IGRpYW1vbmQgY29sb3VyLCBmcm9tIEQgKGJlc3QpIHRvIEogKHdvcnN0KS4KCi0tLQoKMy4gIFdoeSBpcyBgZmFjZXRfd3JhcCgpYCBnZW5lcmFsbHkgbW9yZSB1c2VmdWwgdGhhbiBgZmFjZXRfZ3JpZCgpYD8KCkFuc3dlcjogd2hlbiBmYWNldGluZyBieSBhIHNpbmdsZSB2YXJpYWJsZSwgYGZhY2V0X3dyYXAoKWAgaXMgZWFzaWVyIHRvIHVzZSBhcyBpdCB3cmFwcyB0aGUgZmFjZXRzIHRvIGZpdCB0aGUgcGxvdCBzcGFjZSBhdXRvbWF0aWNhbGx5LiBgZmFjZXRfZ3JpZCgpYCBpcyBnZW5lcmFsbHkgbW9yZSB1c2VmdWwgb25seSB3aGVuIGZhY2V0aW5nIHdpdGggdHdvIHZhcmlhYmxlcy4KCkdHIFNvbHV0aW9uczogSSB0aGluayBgZmFjZXRfd3JhcCgpYCBpcyBtb3JlIHVzZWZ1bCB0aGFuIGBmYWNldF9ncmlkKClgIGJlY2F1c2UgdGhlIGZvcm1lciBmdW5jdGlvbiBpcyB1c2VmdWwgaWYgeW91IGhhdmUgYSBzaW5nbGUgdmFyaWFibGUgd2l0aCBtYW55IGxldmVscyBhbmQgd2FudCB0byBhcnJhbmdlIHRoZSBwbG90cyBpbiBhIG1vcmUgc3BhY2UgZWZmaWNpZW50IG1hbm5lci4gSW4gZGF0YSBhbmFseXNpcywgaXRzIGV4dHJlbWVseSBjb21tb24gdG8gaGF2ZSBhIHNpbmdsZSB2YXJpYWJsZSB3aXRoIG1hbnkgbGV2ZWxzIHRoYXQgdGhlIGFuYWx5c3Qgd2FudHMgdG8gYXJyYW5nZSB0aGUgZm9yIGVhc3kgY29tcGFyaXNvbi4gQWx0aG91Z2ggYGZhY2V0X2dyaWQoKWAgd29ya3Mgb24gc2luZ2xlIHZhcmlhYmxlcywgYGZhY2V0X3dyYXAoKWAgaW52b2x2ZXMgbGVzcyB0eXBpbmcgd2hlbiB5b3UgaGF2ZSBhIHNpbmdsZSB2YXJpYWJsZS4KCi0tLQoKNC4gIFJlY3JlYXRlIHRoZSBmb2xsb3dpbmcgcGxvdC4gSXQgZmFjZXRzIGBtcGcyYCBieSBjbGFzcywgb3ZlcmxheWluZwogICAgYSBzbW9vdGggY3VydmUgZml0IHRvIHRoZSBmdWxsIGRhdGFzZXQuCgpBbnN3ZXI6IHBsb3QgYmVsb3cuCgpgYGB7cn0KZ2dwbG90KG1wZzIsIGFlcyhkaXNwbCwgaHd5KSkgKwogIGdlb21fcG9pbnQoKSArCiAgZ2VvbV9zbW9vdGgoZGF0YSA9IGRwbHlyOjpzZWxlY3QobXBnMiwgLWNsYXNzKSwgbWV0aG9kID0gImxvZXNzIiwgZm9ybXVsYSA9IHkgfiB4LCBzZSA9IEZBTFNFKSArCiAgZmFjZXRfd3JhcCh+Y2xhc3MpCmBgYAoKQ29tcGFyaW5nIHRvIHRoZSBbc291cmNlIGNvZGVdKGh0dHBzOi8vZ2l0aHViLmNvbS9oYWRsZXkvZ2dwbG90Mi1ib29rL2Jsb2IvbWFzdGVyL2ZhY2V0LlJtZCksIHRoZSBhbnN3ZXIgaXMgY29ycmVjdCEKCkdHIFNvbHV0aW9uczoKCmBgYHtyfQptcGcyICU+JQogIGdncGxvdChhZXMoZGlzcGwsIGh3eSkpICsKICBnZW9tX3BvaW50KCkgKwogIGdlb21fc21vb3RoKGRhdGEgPSBtcGcyICU+JSBkcGx5cjo6c2VsZWN0KC1jbGFzcyksIHNlID0gRkFMU0UsIG1ldGhvZCA9ICJsb2VzcyIpICsKICBmYWNldF93cmFwKH5jbGFzcykKYGBgCgotLS0KCiMgMTggVGhlbWVzCgpJbiB0aGlzIGNoYXB0ZXIgeW91IHdpbGwgbGVhcm4gaG93IHRvIHVzZSB0aGUgZ2dwbG90MiB0aGVtZSBzeXN0ZW0sIHdoaWNoIGFsbG93cyB5b3UgdG8gZXhlcmNpc2UgZmluZSBjb250cm9sIG92ZXIgdGhlIG5vbi1kYXRhIGVsZW1lbnRzIG9mIHlvdXIgcGxvdC4gVGhlIHRoZW1lIHN5c3RlbSBkb2VzIG5vdCBhZmZlY3QgaG93IHRoZSBkYXRhIGlzIHJlbmRlcmVkIGJ5IGdlb21zLCBvciBob3cgaXQgaXMgdHJhbnNmb3JtZWQgYnkgc2NhbGVzLiBUaGVtZXMgZG9uJ3QgY2hhbmdlIHRoZSBwZXJjZXB0dWFsIHByb3BlcnRpZXMgb2YgdGhlIHBsb3QsIGJ1dCB0aGV5IGRvIGhlbHAgeW91IG1ha2UgdGhlIHBsb3QgYWVzdGhldGljYWxseSBwbGVhc2luZyBvciBtYXRjaCBhbiBleGlzdGluZyBzdHlsZSBndWlkZS4gVGhlbWVzIGdpdmUgeW91IGNvbnRyb2wgb3ZlciB0aGluZ3MgbGlrZSBmb250cywgdGlja3MsIHBhbmVsIHN0cmlwcywgYW5kIGJhY2tncm91bmRzLgoKVGhpcyBzZXBhcmF0aW9uIG9mIGNvbnRyb2wgaW50byBkYXRhIGFuZCBub24tZGF0YSBwYXJ0cyBpcyBxdWl0ZSBkaWZmZXJlbnQgZnJvbSBiYXNlIGFuZCBsYXR0aWNlIGdyYXBoaWNzLiBJbiBiYXNlIGFuZCBsYXR0aWNlIGdyYXBoaWNzLCBtb3N0IGZ1bmN0aW9ucyB0YWtlIGEgbGFyZ2UgbnVtYmVyIG9mIGFyZ3VtZW50cyB0aGF0IHNwZWNpZnkgYm90aCBkYXRhIGFuZCBub24tZGF0YSBhcHBlYXJhbmNlLCB3aGljaCBtYWtlcyB0aGUgZnVuY3Rpb25zIGNvbXBsaWNhdGVkIGFuZCBoYXJkZXIgdG8gbGVhcm4uIGdncGxvdDIgdGFrZXMgYSBkaWZmZXJlbnQgYXBwcm9hY2g6IHdoZW4gY3JlYXRpbmcgdGhlIHBsb3QgeW91IGRldGVybWluZSBob3cgdGhlIGRhdGEgaXMgZGlzcGxheWVkLCB0aGVuICphZnRlciogaXQgaGFzIGJlZW4gY3JlYXRlZCB5b3UgY2FuIGVkaXQgZXZlcnkgZGV0YWlsIG9mIHRoZSByZW5kZXJpbmcsIHVzaW5nIHRoZSB0aGVtaW5nIHN5c3RlbS4gCgojIyAxOC4yLjEgRXhlcmNpc2VzCgoxLiAgVHJ5IG91dCBhbGwgdGhlIHRoZW1lcyBpbiBnZ3RoZW1lcy4gV2hpY2ggZG8geW91IGxpa2UgdGhlIGJlc3Q/CgpBbnN3ZXI6IHRoZSAiaW50ZXJlc3RpbmciIHRoZW1lcyBhcmUgZGlzcGxheWVkIGJlbG93LiBGcm9tIHRoZSB0b3AgZm91ciwgSSdkIHBpY2sgYHRoZW1lX3NvbGFyaXplZF8yKClgLCBhbHRob3VnaCBgdGhlbWVfZml2ZXRoaXJ0eWVpZ2h0KClgIGlzIGEgY2xvc2UgcnVubmVyLXVwLgoKYGBge3J9CmJhc2UgPC0gZ2dwbG90KGdncGxvdDI6Om1wZywgYWVzKGRpc3BsLCBod3kpKSArCiAgZ2VvbV9wb2ludChhZXMoY29sb3IgPSBmYWN0b3IoY3lsKSkpICsKICBnZW9tX3Ntb290aChtZXRob2QgPSAibG9lc3MiLCBmb3JtdWxhID0geSB+IHgpICsKICBsYWJzKAogICAgdGl0bGUgPSAiRnVlbCBlY29ub215IGRlY2xpbmVzIGFzIGVuZ2luZSBzaXplIGluY3JlYXNlcyIsCiAgICBzdWJ0aXRsZSA9ICIxOTk5LTIwMDgiLAogICAgY2FwdGlvbiA9ICJEYXRhIGZyb20gaHR0cHM6Ly9mdWVsZWNvbm9teS5nb3YvIiwKICAgIHggPSAiRGlzcGxhY2VtZW50IChsaXRlcnMpIiwKICAgIHkgPSAiTWlsZXMgcGVyIGdhbGxvbiAoaGlnaHdheSkiLAogICAgY29sb3IgPSAiQ3lsaW5kZXJzIgogICkKCmJhc2UKYmFzZSArIHRoZW1lX2NhbGMoKQpiYXNlICsgdGhlbWVfZml2ZXRoaXJ0eWVpZ2h0KCkKYmFzZSArIHRoZW1lX2hjKCkKYmFzZSArIHRoZW1lX3NvbGFyaXplZF8yKCkKYGBgCgotLS0KCjIuICBXaGF0IGFzcGVjdHMgb2YgdGhlIGRlZmF1bHQgdGhlbWUgZG8geW91IGxpa2U/IFdoYXQgZG9uJ3QgeW91IGxpa2U/ICAgCiAgICBXaGF0IHdvdWxkIHlvdSBjaGFuZ2U/CgpBbnN3ZXI6IG15IHBlcnNvbmFsIHRoZW1lLCBgdGhlbWVfcXVvKClgIHVzZXMgYSB3aGl0ZSBiYWNrZ3JvdW5kIHdpdGggbGlnaHQgZ3JheSBncmlkbGluZXMgKGJhc2VkIG9uIGB0aGVtZV9taW5pbWFsKClgKSwgYm9sZCB0aXRsZXMsIGNhcHRpb25zIGxlZnQtYWRqdXN0ZWQsIGFuZCBhIGJldHRlciBmb250LCBbTGF0b10oaHR0cHM6Ly93d3cubGF0b2ZvbnRzLmNvbSkuCgpgYGB7cn0KYmFzZSArCiAgdGhlbWVfcXVvKCkKYGBgCgotLS0KCjMuICBMb29rIGF0IHRoZSBwbG90cyBpbiB5b3VyIGZhdm91cml0ZSBzY2llbnRpZmljIGpvdXJuYWwuIFdoYXQgdGhlbWUKICAgIGRvIHRoZXkgbW9zdCByZXNlbWJsZT8gV2hhdCBhcmUgdGhlIG1haW4gZGlmZmVyZW5jZXM/CgpBbnN3ZXI6IHRoZSBwbG90cyBmcm9tIFt0aGlzIHBhcGVyXShodHRwczovL2RvaS5vcmcvMTAuMTAxNi9qLnNzY2kuMjAxOC4wNy4wMjEpIG9uICpTYWZldHkgU2NpZW5jZSogbW9zdCBjbG9zZWx5IHJlc2VtYmxlIGB0aGVtZV9jbGFzc2ljKClgLCB3aXRoIGZldyBkaWZmZXJlbmNlcywgdGhlIG1vc3Qgbm90YWJsZSBiZWluZyB0aGUgcG9zaXRpb24gb2YgdGhlIGxlZ2VuZCBpbiBGaWd1cmVzIDQsIDUsIDgsIGFuZCA5LgoKLS0tCgojIyAxOC40LjYgRXhlcmNpc2VzCgoxLiAgQ3JlYXRlIHRoZSB1Z2xpZXN0IHBsb3QgcG9zc2libGUhIChDb250cmlidXRlZCBieSBBbmRyZXcgRC4gU3RlZW4sIAogICAgVW5pdmVyc2l0eSBvZiBUZW5uZXNzZWUgLSBLbm94dmlsbGUpCgpBbnN3ZXI6IHVzaW5nIHRoZSBzYW1lIGJhc2UsIGFsdGVyIGNvbG9ycyBhbmQgdGhlbWUgc2V0dGluZ3MsIG11c3Qgc3RpbGwgYmUgbGVnaWJsZToKCmBgYHtyfQpiYXNlICsKICBnZW9tX3Ntb290aChtZXRob2QgPSAibG9lc3MiLCBmb3JtdWxhID0geSB+IHgsIGNvbG9yID0gIm9yYW5nZSIsIGZpbGwgPSAibGltZWdyZWVuIikgKwogIHRoZW1lX2dyZXkoYmFzZV9mYW1pbHkgPSAiQ29taWMgU2FucyBNUyIpICsKICB0aGVtZSgKICAgIHBsb3QuYmFja2dyb3VuZCA9IGVsZW1lbnRfcmVjdChmaWxsID0gInNreWJsdWUiLCBjb2xvciA9ICJwdXJwbGUiKSwKICAgIHBsb3QudGl0bGUgPSBlbGVtZW50X3RleHQoZmFjZSA9ICJib2xkIiwgaGp1c3QgPSAxLCBjb2xvciA9ICJyZWQiKSwKICAgIHBsb3Quc3VidGl0bGUgPSBlbGVtZW50X3RleHQoY29sb3IgPSAieWVsbG93IiksCiAgICBwbG90LmNhcHRpb24gPSBlbGVtZW50X3RleHQoaGp1c3QgPSAwLjUsIGNvbG9yID0gImJsdWUiKSwKICAgIHBsb3QubWFyZ2luID0gbWFyZ2luKDUwLCA1MCwgNTAsIDUwKSwKICAgIGF4aXMubGluZSA9IGVsZW1lbnRfbGluZShjb2xvciA9ICJtYXJvb24iLCBsaW5ldHlwZSA9ICJkb3RkYXNoIiksCiAgICBheGlzLnRleHQgPSBlbGVtZW50X3RleHQoY29sb3IgPSAiaG90cGluayIpLAogICAgYXhpcy50aXRsZSA9IGVsZW1lbnRfdGV4dChjb2xvciA9ICJncmVlbiIpLAogICAgbGVnZW5kLmJhY2tncm91bmQgPSBlbGVtZW50X3JlY3QoZmlsbCA9ICJsZW1vbmNoaWZmb24iLCBjb2xvciA9ICJncmF5NTAiKSwKICAgIGxlZ2VuZC5rZXkgPSBlbGVtZW50X3JlY3QoZmlsbCA9ICJwaW5rIiwgY29sb3IgPSAiYmxhY2siKSwKICAgIGxlZ2VuZC50ZXh0ID0gZWxlbWVudF90ZXh0KGNvbG9yID0gInB1cnBsZSIpLAogICAgbGVnZW5kLnRpdGxlID0gZWxlbWVudF90ZXh0KGNvbG9yID0gImRlZXBwaW5rIiksCiAgICBwYW5lbC5iYWNrZ3JvdW5kID0gZWxlbWVudF9yZWN0KGZpbGwgPSAibGF2ZW5kZXIiKSwKICAgIHBhbmVsLmdyaWQgPSBlbGVtZW50X2xpbmUobGluZXR5cGUgPSAidHdvZGFzaCIpCiAgKSArCiAgc2NhbGVfY29sb3JfZXhjZWwoKQpgYGAKCi0tLQoKMi4gIGB0aGVtZV9kYXJrKClgIG1ha2VzIHRoZSBpbnNpZGUgb2YgdGhlIHBsb3QgZGFyaywgYnV0IG5vdCB0aGUgCiAgICBvdXRzaWRlLiBDaGFuZ2UgdGhlIHBsb3QgYmFja2dyb3VuZCB0byBibGFjaywgYW5kIHRoZW4gdXBkYXRlIHRoZQogICAgdGV4dCBzZXR0aW5ncyBzbyB5b3UgY2FuIHN0aWxsIHJlYWQgdGhlIGxhYmVscy4KCkFuc3dlcjoKCmBgYHtyfQpiYXNlICsKICB0aGVtZV9kYXJrKCkgKwogIHRoZW1lKAogICAgcGxvdC5iYWNrZ3JvdW5kID0gZWxlbWVudF9yZWN0KGZpbGwgPSAiYmxhY2siKSwKICAgIGxlZ2VuZC5iYWNrZ3JvdW5kID0gZWxlbWVudF9yZWN0KGZpbGwgPSAiYmxhY2siKSwKICAgIHRleHQgPSBlbGVtZW50X3RleHQoY29sb3IgPSAiZ3JheTUwIikKICApCmBgYAoKLS0tCgozLiAgTWFrZSBhbiBlbGVnYW50IHRoZW1lIHRoYXQgdXNlcyAibGluZW4iIGFzIHRoZSBiYWNrZ3JvdW5kIGNvbG91ciBhbmQKICAgIGEgc2VyaWYgZm9udCBmb3IgdGhlIHRleHQuCgpBbnN3ZXI6CgpgYGB7cn0KYmFzZSArCiAgdGhlbWVfbWluaW1hbChiYXNlX2ZhbWlseSA9ICJHZW9yZ2lhIikgKwogIHRoZW1lKAogICAgcGxvdC5iYWNrZ3JvdW5kID0gZWxlbWVudF9yZWN0KGZpbGwgPSAibGluZW4iKSwKICAgIHBhbmVsLmdyaWQubWFqb3IgPSBlbGVtZW50X2xpbmUoY29sb3IgPSAiZ3JheTg1IiksCiAgICBwYW5lbC5ncmlkLm1pbm9yID0gZWxlbWVudF9saW5lKGNvbG9yID0gImdyYXk5MCIpCiAgKQpgYGAKCi0tLQoKNC4gIFN5c3RlbWF0aWNhbGx5IGV4cGxvcmUgdGhlIGVmZmVjdHMgb2YgYGhqdXN0YCB3aGVuIHlvdSBoYXZlIGEgbXVsdGlsaW5lCiAgICB0aXRsZS4gV2h5IGRvZXNuJ3QgYHZqdXN0YCBkbyBhbnl0aGluZz8KCkFuc3dlcjogd2l0aCBtdWx0aWxpbmUgdGl0bGVzLCBgaGp1c3RgIGFmZmVjdHMgYm90aCBsaW5lcyBpbiB0aGUgc2FtZSB3YXksIGJldHdlZW4gbGVmdCBqdXN0aWZpZWQgKDApLCBjZW50ZXJlZCAoMC41KSwgYW5kIHJpZ2h0IGp1c3RpZmllZCAoMSkuIGB2anVzdGAgZG9lcyBzbGlnaHRseSBhbHRlciB0aGUgdmVydGljYWwganVzdGlmaWNhdGlvbiwgYnV0IG5vdCBzaWduaWZpY2FudGx5IHNpbmNlIHR3byBsaW5lcyBhcmUganVzdCB3aXRoaW4gdGhlIHZlcnRpY2FsIG1hcmdpbnMuCgpgYGB7cn0KbXVsdGkgPC0gYmFzZSArCiAgbGFicyh0aXRsZSA9ICJGdWVsIGVjb25vbXkgZGVjbGluZXMgYXMgZW5naW5lIHNpemUgaW5jcmVhc2VzXG4xOTk5LTIwMDgiLCBzdWJ0aXRsZSA9IE5VTEwpCgptdWx0aSArIHRoZW1lKHBsb3QudGl0bGUgPSBlbGVtZW50X3RleHQoaGp1c3QgPSAwKSkKbXVsdGkgKyB0aGVtZShwbG90LnRpdGxlID0gZWxlbWVudF90ZXh0KGhqdXN0ID0gMC4yNSkpCm11bHRpICsgdGhlbWUocGxvdC50aXRsZSA9IGVsZW1lbnRfdGV4dChoanVzdCA9IDAuNSkpCm11bHRpICsgdGhlbWUocGxvdC50aXRsZSA9IGVsZW1lbnRfdGV4dChoanVzdCA9IDEpKQptdWx0aSArIHRoZW1lKHBsb3QudGl0bGUgPSBlbGVtZW50X3RleHQoaGp1c3QgPSAxLCB2anVzdCA9IDApKQpgYGAKCi0tLQo=</div>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeSourceEmbed("ggplot2-4.Rmd");
  window.initializeCodeFolding("show" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = false;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
